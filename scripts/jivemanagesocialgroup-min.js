function updateMembers(a){if(a&&a.value!="header"&&checkUserSelections()){if(a.value=="sendMessage"){$j("#email-group-message-form").show();$j("#messageSubject").focus()}else{if(currentView=="invitees"){if(a.value=="delete"){$j("#delete-confirm-box").show();$j("#resend-confirm-box").hide()}else{if(a.value=="resend"){$j("#resend-confirm-box").show();$j("#delete-confirm-box").hide()}}return}else{if(a.value=="delete"){$j("#delete-confirm-box").show();$j("#resend-confirm-box").hide();return}finishFormSubmit();if(a.value=="export"){$j("#modify-members").val("header")}return}}}else{$j("#modify-members").val("header")}}function doMemberAction(){$j("#delete-confirm-box").hide();finishFormSubmit()}function doInviteAction(){$j("#delete-confirm-box").hide();$j("#resend-confirm-box").hide();finishFormSubmit()}function finishFormSubmit(){if(numPages>1){paginate($j("#paginationStart").val(),$j("#paginationStart").val())}else{$j("#form-select-members").each(function(){this.submit()})}}function paginate(b,c){var a=["start","oldStart","numResults","searchFilter","sort","ascending"];$j("#form-select-members [name=start]").val(b);$j("#form-select-members [name=oldStart]").val(c);$j("#form-select-members").find("input").filter(function(){return $j.inArray(this.name,a)>=0}).prop("disabled",false);$j("#form-select-members").each(function(){this.submit()})}function totalMembersSelected(){return $j("[name=selectedMembers]:checked").length}function selectAll(a){if(a){$j("[name=selectedMembers]:enabled").prop("checked",true)}else{$j("[name=selectedMembers]:enabled").prop("checked",false)}updateTotal()}function activateSelectAll(){if(allSelected()){$j("#form-select-all").prop("checked",true)}else{$j("#form-select-all").prop("checked",false)}}function allSelected(){return $j("[name=selectedMembers]:enabled:not(:checked)").length===0}function updateTotal(){$j("#total-members-selected").html($j("<strong/>").text(totalMembersSelected()));updateConfirmBoxes();activateSelectAll()}function updateConfirmBoxes(){$j("#total-selected-for-delete").text(totalMembersSelected());$j("#total-selected-for-resend").text(totalMembersSelected())}$j(document).ready(function(){var h,f,c=0,i=1,g=currentView=="invitees"?"inviter":"role",k=$j("#group-members-table"),b={name:"#jive-sgroup-name",inviter:"#jive-sgroup-inviter",role:"#jive-sgroup-role",dateInvited:"#jive-sgroup-invitedate",inviteStatus:"#jive-sgroup-invitestatus",status:"#jive-sgroup-status",joined:"#jive-sgroup-joindate",lastActivity:"#jive-sgroup-activity"};function e(){var l=Array.prototype.slice.call(arguments,0);return l.filter(function(n,m){return !l.slice(0,m).some(function(o){return o.column==n.column})}).map(function(n){var m=$j(b[n.column||g]).index();return[m,n.direction]})}function j(l){return Object.keys(b).filter(function(m){return l.is(b[m])}).first()}function a(){var l,m;l=$j("#paginationSort").val()||"";l=l.match(/none/)?"":l;m=($j("#paginationSortOrder").val()||"").match(/desc|false/)?c:i;return{column:l,direction:m}}function d(){var n=k.find("[class*=headerSort]"),l,m;if(n.length>1){n=n.filter(":not(#jive-sgroup-name):first")}l=j(n);m=n.attr("class").match(/SortUp/)?i:c;return{column:l,direction:m}}if(k[0]&&k[0].children[1]&&k[0].children[1].childElementCount>0){if($j("#jive-sgroup-invitedate").length==0){k.tablesorter({sortList:e(a(),{column:"name",direction:i}),headers:{3:{sorter:"shortDate"}},textExtraction:"complex"})}else{k.tablesorter({sortList:e(a(),{column:"name",direction:i}),headers:{2:{sorter:"shortDate"},4:{sorter:false},5:{sorter:false}},textExtraction:"complex"})}}if(numPages>1){k.one("sortEnd",function(){k.bind("sortEnd",function(){var l=d();$j("paginationNumResults").prop("disabled",false);$j("#paginationSort").prop("disabled",false).val(l.column);$j("#paginationSortOrder").prop("disabled",false).val(l.direction==i?"true":"false");$j("#form-select-members").each(function(){this.submit()})})})}updateTotal()});function checkUserSelections(){if($j("[name=selectedMembers]").is(":checked")){return true}else{showError(selectMemberMsg);return false}}function showError(b){var a='<span class="jive-icon-med jive-icon-redalert"></span>';$j("#error-box").html($j("<div/>").append(a).append(document.createTextNode(b))).show();setTimeout(function(){$j(document).click(hideMsgBoxes)},1000)}function getSelectedIDs(){return $j("#group-members-table [name=selectedMembers]:checked").map(function(){return this.id.match(/-/)?this.id.split("-").last():this.id}).toArray()}function showEmailInfo(b){var a='<span class="jive-icon-med jive-icon-info"></span>';$j("#email-info-box").html($j("<div/>").append(a).append(document.createTextNode(b)));setTimeout(function(){$j(document).click(hideMsgBoxes)},1000)}function showEmailError(c,b){if(!c){c=emailSendError(b)}var a='<span class="jive-icon-med jive-icon-redalert"></span>';$j("#email-error-box").html($j("<div/>").append(a).append(document.createTextNode(c))).fadeIn();setTimeout(function(){$j(document).click(hideMsgBoxes)},1000)}function hideMsgBoxes(){if($j("#email-info-box").length){$j("#email-info-box").hide()}if($j("#email-error-box").length){$j("#email-error-box").hide()}if($j("#error-box").length){$j("#error-box").hide()}$j(document).unbind("click",hideMsgBoxes)}function emailMembers(){var d=$j("#messageSubject").val();var b=$j("#messageBody").val();var a=$j("#copySelf").prop("checked");if(!d||!b){showError(subjMsgReq);return}if(!checkUserSelections()){return}var c=getSelectedIDs();SocialGroup.emailMembers($j("#hiddenSocialGroupID").val(),d,b,c,a,{callback:function(e){if(e.length===0){$j("#email-group-message-form").hide();showEmailInfo(emailSuccessMsg);$j("#messageSubject").val("");$j("#messageBody").val("");$j("#modify-members").val("header")}else{showEmailError(null,e)}},errorHandler:function(e){showEmailError(emailMiscError)}})}function doMemberSearch(){var c=$j("#group-members-search").val();$j("#no-current-results-msg").hide();$j("#no-other-results-msg").hide();$j("#other-results-msg").hide();$j("#no-current-listed-msg").hide();$j("#no-other-listed-msg").hide();if(numPages>1||prevSearch){if(currentView=="invitees"){window.location.href=inviteSearchUrl+"&numResults="+numResults+"&searchFilter="+encodeURIComponent(c)}else{window.location.href=memberSearchUrl+"&numResults="+numResults+"&searchFilter="+encodeURIComponent(c)}}else{var b=$j("#group-members-table-body tr:has(td[class=jive-sgroup-membername])"),a=b.hide().filter(function(){var d=new RegExp(c,"i"),e=$j(this);return e.find("a").html().match(d)||e.find("[name=username]").val().match(d)||e.find("[name=email]").val().match(d)}).show().length;$j("#total-members-shown").text(a);$j("#total-currentview-listed").text(a);calculateOppositeViewSearchTotal(a,c);updateOtherViewLink(c);return false}}function updateOtherViewLink(b){var a=$j("#otherViewLink").attr("href");if(!b||b!=searchText){a=a.replace(/searchFilter=[^&]*(&|$)/,"")}if(b&&b!=searchText){a+="&searchFilter="+encodeURIComponent(b)}$j("#otherViewLink").attr("href",a);$j("#otherOnlyResultsLink").attr("href",a);$j("#otherResultsLink").attr("href",a);$j("#alsoOtherResultsLink").attr("href",a)}function calculateOppositeViewSearchTotal(b,a){if(currentView){if(currentView=="invitees"){SocialGroup.matchingMemberCount($j("#hiddenSocialGroupID").val(),a,{callback:function(c){showOtherResults(c,b,a)},errorHandler:function(){showOtherResults(0,b,a)}})}else{SocialGroup.matchingInviteeCount($j("#hiddenSocialGroupID").val(),a,{callback:function(c){showOtherResults(c,b,a)},errorHandler:function(){showOtherResults(0,b,a)}})}}}function showOtherResults(a,b,c){if(a==0){$j("#no-other-results-qry").text(c);if(b==0){if(!c||$j.trim(c)==""){$j("#no-other-listed-msg").show()}else{$j("#no-other-results-msg").show()}}}else{$j("#no-current-results-qry").text(c);if(b==0){if(!c||$j.trim(c)==""){$j("#current-other-listed-cnt").text(a);$j("#no-current-listed-msg").show()}else{$j("#current-other-listed-cnt").text(a);$j("#no-current-results-msg").show()}}else{$j("#other-results-cnt").text(a);$j("#other-results-msg").show()}}$j("#current-other-results-cnt").text(a);$j("#total-otherview-listed").text(a)}function resetMemberSearch(){if(numPages>1||prevSearch){if(currentView=="invitees"){window.location.href=inviteSearchUrl+"&numResults="+numResults}else{window.location.href=memberSearchUrl+"&numResults="+numResults}}else{var b=$j("#group-members-table-body tr:has(td[class=jive-sgroup-membername])");var a=b.length;b.show();$j("#total-members-shown").text(a);$j("#total-currentview-listed").text(a);$j("#no-current-results-msg").hide();$j("#no-other-results-msg").hide();$j("#other-results-msg").hide();$j("#no-current-listed-msg").hide();$j("#no-other-listed-msg").hide();resetOtherResultsTotal();updateOtherViewLink("");$j("#group-members-search").val("");return false}}function resetOtherResultsTotal(){if(currentView){if(currentView=="invitees"){SocialGroup.matchingMemberCount($j("#hiddenSocialGroupID").val(),"",{callback:function(a){$j("#total-otherview-listed").text(a)},errorHandler:function(){}})}else{SocialGroup.matchingInviteeCount($j("#hiddenSocialGroupID").val(),"",{callback:function(a){$j("#total-otherview-listed").text(a)},errorHandler:function(){}})}}}function clearSearchText(){var a=$j("#group-members-search");if(a.val()==searchText){a.val("")}hasFocusedSearchForm(true)}var hasFocusedSearchForm=(function(){var a=false;return function(b){if(typeof b=="undefined"){return a}else{a=b}}})();$j(document).keypress(function(a){if(a.keyCode==jive.Event.KEY_RETURN){if(hasFocusedSearchForm()){return doMemberSearch()}}});function displayStatusMessage(b,c,a){Jive.AlertMessage(b,{beforeStart:function(){$j("#"+b).html($j("<div/>").append($j("<span/>").addClass("jive-icon-med").addClass(a)).append(document.createTextNode(c)))}})}jive.namespace("groups");jive.groups.RoleEditor=function(j){var d=j.roles,a=j.socialGroupID,c=j.tokenGUID,g=j.updateMemberCellUrl,i=j.i18n;function b(){SocialGroup.setToken("update.sgroup.member.cell."+a,{callback:function(k){c=k}})}function f(k){return k.closest("tr").attr("id")}function e(k){return(k.closest("tr").attr("partner")=="true"?true:false)}function h(k){var l=k.find(":input:not(:submit)"),m={};m[l.attr("name")]=l.val();m.id=f(k);return m}$j(document).ready(function(){$j("#group-members-table td.jive-sgroup-memberrole:not(.noedit)").click(function(){var k=$j(this),n=k.closest("tr"),m=k.children(),o=e(k),l=$j(jive.groups.soy.editableRoleCell({roles:d,i18n:i,isPartner:o}));if(k.data("editing")){return false}else{k.data("editing",true)}l.find(":submit").click(function(){$j.ajax({url:g+"&update.sgroup.member.cell."+a+"="+c,type:"POST",data:h(k),dataType:"html",success:function(p){b();if(!p.match("cell-update-error")){var u=p.split("___"),s=u[1],t=u[2],r=u[3],q=u[4];if(p.match("cell-delete")){n.hide()}else{n.find("td[class=jive-member-status-cell]").each(function(){var v=$j(this);SocialGroup.getMemberStatus(s,{callback:function(w){var x=v.find("span:first");x.text(getMemberStatusText(w));x.attr("id",r+"__"+t+"__"+q)}})})}}k.data("editing",false);k.html(p)},error:function(){alert(jive.groups.soy.genericErrorMsg({i18n:i}))}});return false});l.find(".editor_cancel").click(function(){k.data("editing",false);k.html(m);return false});k.html(l);return false})})};