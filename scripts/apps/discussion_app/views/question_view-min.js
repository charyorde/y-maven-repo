jive.namespace("DiscussionApp");jive.DiscussionApp.QuestionView=function(l,f,j){jive.conc.observable(this);var g=this;var k;var q={open:"open",resolved:"resolved",assumed_resolved:"assumed_resolved"};function a(s){h(s);r(s);n(s);if($j.browser.msie&&$j.browser.version<7){$j("#jive-thread-messages-container").hide().show()}}function o(s,u){var w=u.numHelpful;var t=u.totalNumHelpful;var x=t-w;r(u);if(x==0){n(u)}else{var v=s.closest(".js-thread-post-wrapper");e(v,u)}$j(s).closest(".jive-thread-reply-btn").append(jive.discussions.soy.qHelpfulAnswerFadeOutText({question:u,i18n:j}));clearTimeout(k);k=setTimeout(function(){$j(".helpfulRemaining").fadeOut(200,function(){$j(this).remove()})},3000);return false}function b(s,u){var w=u.numHelpful;var t=u.totalNumHelpful;var x=t-w;if(x==1){n(u)}else{var v=$j(s.closest(".js-thread-post-wrapper"));e(v,u)}r(u);return false}function n(s){$j(".js-thread-post-wrapper").each(function(){e($j(this),s)})}function e(s,t){var v=$j(s).find("a:first").attr("name");var u=parseInt(v,10);p(s,u,t);i($j(s).find("section"),u,t)}function i(x,z,v){if(v.canManageQuestionState){var u=v.numHelpful;var B=v.totalNumHelpful;var A=B-u;var s=$j(x).closest(".j-thread-post").find("header");var t=s.find(".j-dotted-star");var y=$j(x).find(".jive-thread-reply-btn");if(s.find(".j-dotted-star").length==0){s.append('<span class="j-dotted-star j-ui-elem"/>')}if(y.length==0){$j(x.append($j("<div>").addClass("jive-thread-reply-btn")));y=$j(x).find(".jive-thread-reply-btn")}var w=s.find(".j-helpful-star");y.empty();t.unbind();if(v.correctAnswer&&z==v.correctAnswer.ID){y.append(jive.discussions.soy.qUnmarkAsCorrect({question:v,i18n:j}));y.find(".jive-thread-reply-btn-correct-unmark").click(function(){f.unMarkAsCorrect(z,g.renderAll);return false})}else{if(v.helpfulAnswers&&(m(v.helpfulAnswers,z))){y.append(jive.discussions.soy.qUnmarkAsHelpful({question:v,i18n:j}));y.find(".jive-thread-reply-btn-helpful-unmark").click(function(){f.unMarkAsHelpful(z,g.unMarkAsHelpful.bind(g,$j(y)));return false});w.click(function(C){f.markAsCorrect(z,g.renderAll);C.preventDefault()})}else{if(v.questionState!="resolved"&&!(v.helpfulAnswers&&(m(v.helpfulAnswers,z)))){y.append(jive.discussions.soy.qMarkAsCorrect({question:v,i18n:j}));y.find(".jive-thread-reply-btn-correct").add(w).click(function(){f.markAsCorrect(z,function(C){g.renderAll(C);jive.dispatcher.dispatch("trial.updatePercentComplete")});return false})}if(A>0){y.append(jive.discussions.soy.qMarkAsHelpful({question:v,i18n:j}));y.find(".jive-thread-reply-btn-helpful").add(t).click(function(){f.markAsHelpful(z,g.markAsHelpful.bind(g,$j(y)));return false})}}}}}function p(s,u,t){var v=$j(s).closest(".js-thread-post-wrapper");if(t.correctAnswer&&u==t.correctAnswer.ID){if(!v.is(".j-correct")){v.addClass("j-correct");$j(s).find("header h6").prepend(jive.discussions.soy.qCorrectAnswer({question:t,i18n:j}));if($j(s).find(".j-correct-star").length<1){$j(s).find("header").append('<a class="j-star j-correct-star j-ui-elem"></a>');$j(s).find(".j-star").addClass("popped")}}}else{if(t.helpfulAnswers&&(m(t.helpfulAnswers,u))){if(!v.is(".j-helpful")){v.addClass("j-helpful");$j(s).find("header h6").prepend(jive.discussions.soy.qHelpfulAnswer({question:t,i18n:j}));if($j(s).find(".j-helpful-star").length<1){$j(s).find("header").append('<a class="j-star j-helpful-star j-ui-elem"></a>');$j(s).find(".j-star").addClass("popped")}}}else{v.removeClass("j-correct");v.removeClass("j-helpful");v.find(".thisCorrect").remove();v.find(".thisHelpful").remove();v.find(".j-star").remove()}}}function h(s){if(s.questionState=="open"){$j(".jive-answer-type-answered").remove();$j(".jive-answer-type-assumedanswered").remove()}else{if(s.questionState=="assumedResolved"){$j(".jive-answer-type-answered").remove();$j(".jive-answer-type-notanswered").remove()}else{$j(".jive-answer-type-assumedanswered").remove();$j(".jive-answer-type-notanswered").remove()}}$j(".js-original-header h1").after(jive.discussions.soy.qDisplayQuestionStateMessage({question:s,questionStateEnum:q,i18n:j}));if(s.questionState=="open"){$j(".jive-answer-type-notanswered").find("em").find("a").click(function(){f.markAssumedAnswered(g.renderQuestionStateMessage)})}}function r(s){$j("div.j-answer-rollup").remove();if(!s.threaded){d(s)}var t=$j(jive.discussions.soy.qDisplayInlineAnswers({question:s,questionStateEnum:q,i18n:j,currentUserPartner:_jive_current_user.partner}));$j(".j-original-message").append(t);jive.rte.renderedContent.emit("renderedContent",t)}function d(s){if(s.correctAnswer&&!c(s.correctAnswer.ID)){s.correctAnswer.useFullURL=true}s.helpfulAnswers&&s.helpfulAnswers.some(function(t){if(!c(t.ID)){t.useFullURL=true}})}function c(s){return($j("a[name='"+s+"']").length>0)}function m(t,s){return t&&t.some(function(u){return u.ID==s})}this.renderAll=a;this.renderInlineAnswers=r;this.markAsHelpful=o;this.unMarkAsHelpful=b;this.renderQuestionStateMessage=h;this.renderResponses=n;this.renderReply=e;this.renderAnswerButtons=i;this.renderReplyDetails=p};