jive.namespace("StatusInput");if(!jive.StatusInput.StatusInputDropDown){jive.StatusInput.StatusInputDropDown=$Class.extend({init:function(b,a){this._$statusInputContainer=$j(b);this._i18n=a.i18n;this._dd=null;this._data={search:null,friends:null,history:null};this._statusInputIdPostfix=a.statusInputIdPostfix},_getCollectionFromData:function(a){return a.mentionCollection},_getCollectionEntriesFromData:function(a){return a.mentionCollection.entries},_makeSelection:function(e,f,b){var d=e.html(),c=e.attr("href"),a;$j.each(f.mentionCollection.entries,function(g){var h=$j(this.html).attr("href");if(h===c){a=g;return false}});this.emit("interactionFinished",$j.extend({index:a,value:d,href:c},this._getCollectionEntriesFromData(f)[a]))},_renderData:function(c,e,l,o){o=o||{};var h=o.fnHandleRender;var i=o.renderIfDataIsNull||false;var a=o.fnHandleRenderNoData;var k=o.selectionPrefix;var b=o.extraTemplateData||{};if(typeof this._getCollectionFromData(c)=="object"||i){var j=this._data[e]=c;var f=this._getCollectionEntriesFromData(j)||{};var g=this;var d=l.call(this,$j.extend({i18n:g._i18n,entries:f},b));var n=$j(".j-js-autocomplete");if(n.length>0){n.remove()}this._$statusInputContainer.after(d);this._dd=$j(".j-js-autocomplete");var m=this._$statusInputContainer.position();this._dd.css("top",(m.top+this._$statusInputContainer.parent().height())+"px");this._dd.css("left",m.left+"px");this._dd.bind("keyup mouseup",function(p){p.stopPropagation()});this._dd.bind("keydown",function(p){p.stopPropagation();switch(p.keyCode){case 27:g.emit("interactionFinished");break;case 38:g.selectItem(g._getSelectItemIndex()-1);p.stopImmediatePropagation();return false;break;case 40:g.selectItem(g._getSelectItemIndex()+1);p.stopImmediatePropagation();return false;break;case 13:p.stopImmediatePropagation();break;case 32:g.selectItem(g._getSelectItemIndex());g._makeSelection(g._getSelectedItem(),j,k);p.preventDefault();break;default:break}});this._dd.find(".j-autocomplete-results a").click(function(p){g._makeSelection($j(this),j,k);p.preventDefault()});if(h!=null){h()}this.show()}else{this.dataRef=null;if(a!=null){a()}else{this.hide()}}},renderSearchData:function(a){this._renderData(a,"search",jive.statusinput.dropdown.ddSearch)},hide:function(){if(this._dd!=null){this._dd.hide()}},show:function(){if(this._dd!=null){this._dd.slideDown("fast")}},isVisible:function(){var a=$j(".j-js-autocomplete");return this._dd&&!!a.length&&a.is(":visible")},selectItem:function(a){if(this._dd==null){return}var b=this._getSelectItems();if(a<0||a>=b.length){return}this.deselectItem();this._selectItemHelper(b[a],true)},deselectItem:function(b){var c=this._getSelectItems();if(b!=null&&(b<0||b>=c.length)){return}var a=b==null?this._getSelectedItem():c[b];if(a.length==0){return}this._selectItemHelper(a);this._selectedIndex=-1},_getSelectItems:function(){return this._dd.find("."+jive.StatusInput.StatusInputDropDown.selectableItemClassName)},_getSelectedItem:function(){return this._dd.find("."+jive.StatusInput.StatusInputDropDown.selectedItemClassName)},_getSelectItemIndex:function(a){a=a||this._getSelectedItem()[0];return this._getSelectItems().index(a)},_selectItemHelper:function(c,d){var a=d?"focus":"blur",b=jive.StatusInput.StatusInputDropDown.selectedItemClassName+" j-selected";$j(c).toggleClass(b,d)[a]()}});jive.StatusInput.StatusInputDropDown.selectedItemClassName="jive-js-status-input-selected";jive.StatusInput.StatusInputDropDown.selectableItemClassName="jive-js-status-input-selectable";jive.conc.observable(jive.StatusInput.StatusInputDropDown.prototype);jive.StatusInput.StatusInputDropDown.delay=(function(){var a=0;return function(c,b){clearTimeout(a);a=setTimeout(c,b)}})()};