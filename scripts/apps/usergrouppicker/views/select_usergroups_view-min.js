jive.namespace("UserGroupPicker");jive.UserGroupPicker.SelectGroupsView=function(){var j={},d,k=$j(this).closest(".jive-modal:visible"),c=false,b=0,m={},f=_jive_base_url+"/group-autocomplete-modal.jspa";function g(t){if(!m.hasOwnProperty(t.groupID)){m[t.groupID]=t;++b;q();a();!c&&i()}}function s(){var t=Object.keys(m).join(", #groupChk-");t.length&&(t="#groupChk-"+t);$j(t).prop("checked",true).each(function(){$j(this).closest("tr").addClass("selected")})}function a(){var t=[];$j.each(m,function(){t.push(this.displayName)});$j("#preview").text(t.join(", "))}function h(t){delete m[t.groupID];--b;q();a();$j("#groupChk-"+t.groupID).closest("tr").removeClass("selected")}function l(v,u){var t=jive.util.extractDataAttributes(v);return u?t[u]:t}function o(){d.delegate("#grouppicker-addGroupsButton","click",function(t){t.preventDefault();!$j(this).hasClass("j-disabled")&&i()});d.delegate("#group-picker-modal-content a:not([data-action])","click",function(t){t.preventDefault();r($j(this).attr("href")).addCallback(p)});d.delegate("#group-picker-modal-content a[data-action=goToPage]","click",function(t){t.preventDefault();$j("#profilesearchform-start").val(jive.util.extractDataAttributes(this).page);d.find("form").submit()});d.delegate("#group-picker-modal-content :checkbox","click",function(){var t=$j(this),v=t.closest(".jive-table-cell-checkbox"),u={avatar:$j("#"+t.val()+"-avatar").html(),displayName:v.children().not("input").html(),groupID:t.val(),groupName:v.find(":hidden").val()};this.checked?g(u):h(u)});d.delegate(".grouppicker-sort-link","click",function(t){t.preventDefault();$j("#profilesearchform-sort").val(l(this,"sortType"));$j("#profilesearchform").submit()})}function n(){d.find("form").ajaxForm({beforeSubmit:function(t){t.push({name:"selectedGroups",value:e()});$j("#people-search-submit").prop("disabled",true);$j("#people-search-submit").val(jive.UserPicker.soy.searching())},success:function(t){p(t)}})}function e(){var t=[];$j.each(m,function(u){return t.push(u)});return t.join(",")}function i(){var t=[];$j.each(m,function(){t.push(this)});m={};b=0;d.find("#grouppicker-addGroupsButton").after(jive.UserPicker.soy.renderModalLoading());j.emit("select",{groups:t})}function r(t){var u=new jive.conc.Promise();$j.get(t+"&selectedGroups="+e(),u.emitSuccess.bind(u));return u}function p(u){var t=$j(jive.UserGroupPicker.soy.renderGroupPickerModal({body:u}));$j("#group-picker-modal-content").replaceWith(t.find("#group-picker-modal-content"));q();a();s();n()}function q(){var t=b>0?"removeClass":"addClass";d.find("#grouppicker-addGroupsButton")[t]("j-disabled")}j.setOptions=function(t){c=typeof(t.multiple)!="undefined"?t.multiple:false;return j};j.open=function(){$j.ajax({url:f,data:{multiple:c},success:function(t){j.render({body:t})}});return j};j.close=function(){d.find(".close").trigger("click");return j};j.render=function(t){d=$j(jive.UserGroupPicker.soy.renderGroupPickerModal(t));o();q();d.lightbox_me({zIndex:300015,destroyOnClose:true,parentLightbox:k,onLoad:function(){var u=d.find(".jive-body-popup-container-grouppicker");c=l(u,"isMultiple");n()}})};jive.conc.observable(j);return j};