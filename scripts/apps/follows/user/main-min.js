jive.namespace("FollowUserApp");jive.FollowUserApp.Main=jive.oo.Class.extend(function(a){var b=jive.FollowUserApp;this.init=function(d){var c=this;this.followView=d.followView;this.relSource=new jive.UserRelationshipSource();this.labelSource=new jive.UserRelationshipListSource();this.streamsSource=new jive.ActivityStream.BuilderServices();this.followView.addListener("manageAssociations",function(f,i,e,g){var h={objectType:f,id:i,itemStreamCounts:e};c.streamsSource.manageAssociations([h]).addCallback(function(j){g.emitSuccess(j)}).addErrback(function(k,j){g.emitError(k,j)})}).addListener("setItemAssociation",function(f,l,i,h,g,k){var j={type:f,id:l},e={};e[f]={};e[f][l]=g;c.streamsSource.setItemAssociations([j],i,h,e).addCallback(function(m){k.emitSuccess(m)}).addErrback(function(n,m){k.emitError(n,m)})}).addListener("removeAllAssociations",function(e,h,g,f){c.streamsSource.removeAllAssociations(e,h).addCallback(function(){f.emitSuccess();if(!(e==3&&h==window._jive_current_user.ID)){setTimeout(function(){jive.switchboard.emit("unfollow.user",jQuery.extend({},{id:h,labelIDs:g}))},200)}}).addErrback(function(j,i){f.emitError(j,i)})}).addListener("addLabel",function(f,e,g){jive.conc.synchronize({add:c.labelSource.addListMember(e,f),label:c.labelSource.get(e)}).addCallback(function(h){jive.switchboard.emit("userlabel.applied",h.label,f);g.emitSuccess()}).addErrback(function(i,h){g.emitError(i,h)})}).addListener("removeLabel",function(f,e,g){c.labelSource.removeListMember(e,f).addCallback(function(){jive.switchboard.emit("userlabel.unapplied",{id:e},f);g.emitSuccess()}).addErrback(function(i,h){g.emitError(i,h)})});jive.switchboard.addListener("userlabel.created",function(e){c.followView.addLabelItem(e)});jive.switchboard.addListener("userlabel.updated",function(e){c.followView.updateLabelItem(e);c.labelView().update(e)});jive.switchboard.addListener("userlabel.removed",function(e){c.followView.removeLabelItem(e.id);c.labelView().remove(e)});jive.switchboard.addListener("userlabel.applied",function(f,e){c.followView.apply(f,e);c.labelView(e).add(f)});jive.switchboard.addListener("userlabel.unapplied",function(f,e){c.followView.unapply(f,e);c.labelView(e).remove(f)})};a.labelView=function(c){return new b.LabelsView(c)}});