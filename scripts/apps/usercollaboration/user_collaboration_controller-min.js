jive.namespace("UserCollaboration");jive.UserCollaboration.Main=jive.oo.Class.extend(function(a){var b=jive.UserCollaboration;this.init=function(e){var c=this;this.model=new b.Model(e);c.participants=e.participants;c.objectuser=e.objectuser;c.currentUser=e.currentUser;c.item=e.item;c.participantsInput=e.participantsInput;c.form=e.form;c.finishedCallback=e.finishedCallback;var d=(function(){var j={};j.userlists=[];j.users=[];for(var g=0,k=c.participants.length;g<k;g++){var h=c.participants[g];j.users.push({id:h.id,anonymous:h.anonymous,enabled:h.enabled,visible:h.visible,objectType:h.objectType,username:h.username,email:h.email,entitled:h.entitled,prop:{directMessageActionLinkShown:true,isVisibleToPartner:h.prop.isVisibleToPartner},avatarID:h.avatarID,displayName:h.displayName,disabled:true})}j.users.push({id:c.objectuser.id,anonymous:c.objectuser.anonymous,enabled:c.objectuser.enabled,visible:c.objectuser.visible,objectType:c.objectuser.objectType,username:c.objectuser.username,email:c.objectuser.email,entitled:c.objectuser.entitled,prop:{directMessageActionLinkShown:true,isVisibleToPartner:c.objectuser.prop.isVisibleToPartner},avatarID:c.objectuser.avatarID,displayName:c.objectuser.displayName,disabled:true});return j})();var f=new jive.UserPicker.Main({multiple:true,listAllowed:true,startingUsers:d,disabled:false,canInvitePartners:true,$input:c.participantsInput,relatedMessage:$j(jive.soy.direct_messaging.notRelated())});c.form.submit(function(j){var h=c.form.find('input[name="participants"]').val(),k=h.split(",");for(var g=0;g<k.length;g++){if(k[g]==c.objectuser.id){k.splice(g,1);break}}h=k.join(",");if(c.item.typeShare){c.model.addShareCollaborators(c.item.id,h).addCallback(function(i){c.finishedCallback(i);c.form.closest(".jive-modal").trigger("close")}).addErrback(function(i){$j("<div>"+i+"</div>").message({style:"error"})})}else{c.model.addCollaborators(c.item.id,h).addCallback(function(i){c.finishedCallback(i);c.form.closest(".jive-modal").trigger("close")}).addErrback(function(i){$j("<div>"+i+"</div>").message({style:"error"})})}j.preventDefault()})}});