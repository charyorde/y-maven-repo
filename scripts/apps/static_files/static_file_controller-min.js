define("jive.staticFileController",["jquery"],function(a){if(!jive.staticFileController||!jive.staticFileController.singleton){var b=jive.oo.Class.extend(function(c){this.init=function(){var d=this;a(document).on("click",".js-static-file-control",function(h){h.preventDefault();var g=a(this),i=g.data("containertype"),f=g.data("containerid");d.createModal(i,f)})};this.createModal=function(g,e){var d=this;var f=osapi.jive.corev3.places.get({entityDescriptor:[g,e]});f.execute(function(k){if(k.error){var j=k.error.code;var i=k.error.message}else{d.placeObj=k.list[0];var h=new jive.conc.Promise();h.addCallback(function(l){d.files=l;d.parseFileExtensions();require(["jive.staticFileModalView"],function(m){d.modalView=new m({placeObj:d.placeObj,staticFiles:d.files,containerType:g});d.addModalListeners()})});d.getFileList(d.placeObj,h)}})};this.getFileList=function(e,f){var d=this,g=e.getStatics();g.execute(function(h){if(h.error){f.emitError()}else{d.files=h.list;d.parseFileExtensions();f.emitSuccess(d.files)}})};this.addModalListeners=function(){var d=this;d.modalView.addListener("getList",function(e){d.getFileList(d.placeObj,e)}).addListener("deleteFile",function(e,f){a.each(d.files,function(g,j){if(j.id==e){var h=j.destroy();h.execute(function(l){if(l.error){var k=l.error.code;var i=l.error.message}else{d.getFileList(d.placeObj,f)}});return false}})})};this.parseFileExtensions=function(){var d=this;a.each(d.files,function(f,g){var e=g.filename;g.fileExtension=e.split(".").pop().toLowerCase();g.iconClass=jive.shared.file.fileTypeIconClass({extension:g.fileExtension,size:"med"})})}});jive.staticFileController={};jive.staticFileController.singleton=new b()}});