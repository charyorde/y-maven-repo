jive.namespace("UserPicker");jive.UserPicker.Messages=jive.oo.Class.extend(function(a){this.init=function(e,c){this.userMessages=c&&c.userMessages||[];this.listMessages=c&&c.listMessages||[];var b=this;$j(".j-user-autocomplete").focus(function(){b.hideUserMessages()});this.$permissionmsg=c&&c.permissionsMessage;if(this.$permissionmsg){e.before(this.$permissionmsg.hide())}this.$relatedmsg=c&&c.relatedMessage;if(this.$relatedmsg){e.before(this.$relatedmsg.hide())}var d=jive.UserPicker.soy.limitMessage({limit:c.maxSelectedCount});this.$limitmsg=(c&&c.maxSelectedMessage)||$j(d);if(this.$limitmsg){e.before(this.$limitmsg.hide())}};this.showUserMessages=function(c){var b=this;if(c.pasted&&c.pasted.length){b.handlePaste(c.pasted)}else{if(c.added){b.handleAdd(c.added)}}};a.handlePaste=function(d){var c,b=this;$j.each(d,function(f,e){$j.each(b.userMessages,function(h,i){var g=b.renderMessage(e,i,false);c={context:g,user:e,message:i}})});if(d.length){setTimeout(function(){b.showMessage(c.user,c.message,c.context)},1000)}};a.handleAdd=function(c){var b=this;if(c.users){$j.each(b.listMessages,function(d,e){b.renderMessage(c,e,true)})}else{$j.each(c,function(d,e){$j.each(b.userMessages,function(f,g){b.renderMessage(e,g,(d==c.length-1))})})}};a.renderMessage=function(e,f,c){var b=this;var d=b.getMessagePopoverContext(e,f);if(d.length){var g=b.getPopoverSelector(e,f);d.closest(".jive-chooser-list").parent().delegate(g,"click",function(h){b.showMessage(e,f,$j(g));h.preventDefault()});if(c){b.showMessage(e,f,d)}}return d};a.getPopoverSelector=function(c,d){var b=this;return b.getItemSelector(c)+" "+b.getMessagePopoverContextSelector(d)};a.showMessage=function(c,d,b){setTimeout(function(){var e=$j(d.render(c)).popover({context:b,position:"right"});e.addClass("js-userpicker-user-msg");if(c.id>0){if(c.users){e.parent(".js-pop").attr("data-list-id",c.id)}else{e.parent(".js-pop").attr("data-user-id",c.id)}}else{e.parent(".js-pop").attr("data-user-email",c.email)}},0)};a.removeMessages=function(b){this.findPopoverForSelected(b).remove()};a.findPopoverForSelected=function(b){if(b.id>0){if(b.users){return $j('.js-pop[data-list-id="'+b.id+'"]')}else{return $j('.js-pop[data-user-id="'+b.id+'"]')}}else{return $j('.js-pop[data-user-email="'+b.email+'"]')}};a.getMessagePopoverContext=function(d,e){var b=this;var c=b.getItem(d);return c.find(b.getMessagePopoverContextSelector(e))};a.getItem=function(b){return $j(this.getItemSelector(b))};a.getItemSelector=function(b){if(b.id>0){if(b.users){return"li[data-list-id='"+b.id+"']"}else{return"li[data-user-id='"+b.id+"']"}}else{if(b.email){return"li[data-user-email='"+b.email+"']"}}console.error("[no selector can be created for user or list: "+b+"]")};a.getMessagePopoverContextSelector=function(b){if(b.popoverSelector){return b.popoverSelector}else{if(b.type=="info"){return"span.jive-icon-info:visible"}else{if(b.type=="warn"){return"span.jive-icon-warn:visible"}else{if(b.type=="error"){return"span.jive-icon-error:visible"}else{if(b.type=="success"){return"span.jive-icon-success:visible"}}}}}};this.hideUserMessages=function(){$j(".js-userpicker-user-msg").trigger("close")};this.togglePermissionMessage=function(b){if(this.$permissionmsg){if(b){this.$permissionmsg.hide()}else{this.$permissionmsg.show()}}};this.toggleRelatedMessage=function(b){if(this.$relatedmsg){if(b){this.$relatedmsg.hide()}else{this.$relatedmsg.show()}}};this.toggleLimitMessage=function(b){if(this.$limitmsg){if(b){this.$limitmsg.show()}else{this.$limitmsg.hide()}}}});