jive.namespace("UserPicker");jive.UserPicker.SelectPeopleView=function(){var p=jive.conc.observable({}),b,i=false,e=false;name="",selectedUsers={},browseModalUrl=_jive_base_url+"/user-autocomplete-modal.jspa";function j(r){var q=r.map(function(s){return"userChk-"+s});return $j("input[id^=userChk-]").filter(function(){var s=$j(this).attr("id");return q.some(function(t){return s===t})})}function g(q){selectedUsers[q.userID]=q;k();m();!i&&c();j([q.userID]).closest("tr").addClass("selected")}function n(){j(Object.keys(selectedUsers)).each(function(){$j(this).prop("checked",true).closest("tr").addClass("selected")})}function m(){var r=[];$j.each(selectedUsers,function(){r.push(this.displayName)});var q=jive.util.escapeHTML(r.join(", "));$j("#preview").html(q)}function f(q){delete selectedUsers[q.userID];k();m();j([q.userID]).closest("tr").removeClass("selected")}function l(){b.delegate("#userpicker-options-link","click",function(q){q.preventDefault();$j("#jive-people-search-options").toggle()});b.delegate("#userpicker-addUsersButton","click",function(q){q.preventDefault();!$j(this).hasClass("j-disabled")&&c()});b.delegate("#user-picker-modal-content a:not([data-action])","click",function(q){q.preventDefault();d($j(this).attr("href")).addCallback(h)});b.delegate("#user-picker-modal-content a[data-action=goToPage]","click",function(q){q.preventDefault();$j("#profilesearchform-start").val($j(this).data("page"));b.find("form").submit()});b.delegate("#user-picker-modal-content :checkbox","click",function(){var q=$j(this),s=q.closest(".jive-table-cell-checkbox"),r={avatar:$j("#"+q.val()+"-avatar").html(),displayName:s.children().not("input").html(),userID:q.val(),userName:s.find(":hidden").val()};this.checked?g(r):f(r)});b.delegate(".userpicker-sort-link","click",function(q){q.preventDefault();$j("#profilesearchform-sort").val($j(this).data("sortType"));$j("#profilesearchform").submit()})}function a(){b.find("form").ajaxForm({beforeSubmit:function(q){q.push({name:"selectedUsers",value:o()});$j("#people-search-submit").prop("disabled",true);$j("#people-search-submit").val(jive.UserPicker.soy.searching())},success:function(q){h(q)}})}function o(){var q=[];$j.each(selectedUsers,function(r){return q.push(r)});return q.join(",")}function c(){var q=[];$j.each(selectedUsers,function(){q.push(this)});selectedUsers={};b.find("#userpicker-addUsersButton").after(jive.UserPicker.soy.renderModalLoading());p.emit("select"+name,{users:q})}function d(q){var r=new jive.conc.Promise();$j.get(q+"&selectedUsers="+o(),r.emitSuccess.bind(r));return r}function h(r){var q=$j(jive.UserPicker.soy.renderUserPickerModal({body:r}));$j("#user-picker-modal-content").replaceWith(q.find("#user-picker-modal-content"));k();m();n();a()}function k(){$j("#userpicker-addUsersButton").toggleClass("j-disabled",$j.isEmptyObject(selectedUsers))}p.setOptions=function(q){i=typeof(q.multiple)!="undefined"?q.multiple:false;name=typeof(q.name)!="undefined"?q.name:"";e=typeof(q.canInvitePartners)!="undefined"?q.canInvitePartners:false;return p};p.open=function(){$j.ajax({url:browseModalUrl,data:{multiple:i,canInvitePartners:e},success:function(q){p.render({body:q})}});return p};p.close=function(){b.find(".close").trigger("click");return p};p.render=function(q){b=$j(jive.UserPicker.soy.renderUserPickerModal(q));l();k();b.lightbox_me({zIndex:300015,destroyOnClose:true,parentLightbox:$j(".jive-modal:visible"),onLoad:function(){i=b.find(".jive-body-popup-container-userpicker").data("isMultiple");a()}})};return p};