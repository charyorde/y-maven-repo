jive.namespace("UserPicker");jive.UserPicker.ResultListView=jive.oo.Class.extend(function(a){jive.conc.observable(this);this.init=function(c){var b=this;this.$chooser=c.$chooser;this.$input=c.$input;this.hidden=true;this.emailAllowed=c.emailAllowed;this.userAllowed=c.userAllowed;this.listAllowed=c.listAllowed;this.trial=c.trial;this.canInvitePartners=c.canInvitePartners;this.canInvitePreprovisioned=c.canInvitePreprovisioned;this.invitePreprovisionedDomainRestricted=c.invitePreprovisionedDomainRestricted;this.domains=c.domains||[];this.onShow=c.onShow||$j.noop;this.onHide=c.onHide||$j.noop;this.onSelect=c.onSelect||$j.noop;this.$input.after(this.$chooser);this.$chooser.hide().on("mouseover","a",function(){b.highlightRow($j(this).closest("li"))}).on("click","a",function(d){d.preventDefault();b.emit("select",this);b.onSelect.call(null,this)})};this.highlightRow=function(b){this.clearExtraInfo();this.findSelectedItem().removeClass("hover");this.showExtraInfo(b.addClass("hover"))};this.clearHighlight=function(){var b=this.findSelectedItem();b.removeClass("hover")};this.highlightFirst=function(){this.findSelectedItem().removeClass("hover");this.showExtraInfo(this.$chooser.find("li:first").addClass("hover"))};this.highlightNext=function(){var c=this;c.clearExtraInfo();var b=this.findSelectedItem();if(b.next().length){c.showExtraInfo(b.removeClass("hover").next().addClass("hover"))}else{if(b.parent("ul").nextAll("ul:first").length){c.showExtraInfo(b.removeClass("hover").parent("ul").nextAll("ul:first").find("li:first").addClass("hover"))}}};this.highlightPrev=function(){var c=this;c.clearExtraInfo();var b=c.findSelectedItem();if(b.prev().length){c.showExtraInfo(b.removeClass("hover").prev().addClass("hover"))}else{if(b.parent("ul").prevAll("ul:first").length){c.showExtraInfo(b.removeClass("hover").parent("ul").prevAll("ul:first").find("li:last").addClass("hover"))}}};a.clearExtraInfo=function(){this.$chooser.find(".j-select-user-extra-info").hide()};a.showExtraInfo=function(b){b.find(".j-select-user-extra-info").show()};this.findSelectedItem=function(){return this.$chooser.find("li.hover")};this.render=function(b){var c=this.getMessage();this.$chooser.html(jive.UserPicker.soy.renderUserList({results:b,noResultsMessage:c}));this.show()};a.getMessage=function(){var b;if(this.emailAllowed&&!this.userAllowed&&!this.listAllowed){if(this.isValidEmailAddressFragment(this.$input.val())){if(this.domains.length>0&&!this.canInvitePartners){b=jive.UserPicker.soy.pleaseEnterValidDomain({trial:this.trial,domains:this.domains})}else{b=jive.UserPicker.soy.pleaseEnterEmail({})}}else{b=jive.UserPicker.soy.pleaseEnterValidEmail({})}}else{if(this.emailAllowed){if(this.isEmailAddressInput(this.$input.val())){if(this.domains.length>0&&!this.canInvitePartners){b=jive.UserPicker.soy.pleaseEnterValidDomain({trial:this.trial,domains:this.domains})}else{b=jive.UserPicker.soy.pleaseEnterEmail({})}}else{b=jive.UserPicker.soy.noUsersMatchMessage({trial:this.trial,domains:this.domains,emailAllowed:true})}}else{b=jive.UserPicker.soy.noUsersMatchMessage({emailAllowed:true})}}return b};this.show=function(){var b=this;this.$chooser.show().css({left:this.$input.position().left,top:this.$input.position().top+this.$input.outerHeight()});if(this.hidden){if(this._blurHandler){$j(document).off("focus click","body",this._blurHandler)}this._blurHandler=function(e){var c=$j(e.target),d=e.target==b.$input.get(0),f=c.closest(b.$chooser).length>0;if(!d&&!f){b.hide()}};$j(document).on("focus click","body",this._blurHandler);this.emit("show");this.hidden=false;this.onShow.call(null)}};this.hide=function(){this.$chooser.hide();if(this._blurHandler){$j(document).off("focus click","body",this._blurHandler);delete this._blurHandler}if(!this.hidden){this.emit("hide");this.hidden=true;this.onHide.call(null)}};this.resultSize=function(){return this.$chooser.find("li").size()};this.findNameMatches=function(b){return this.$chooser.find("li a").filter(function(d,c){return $j(c).data("user-username").toLowerCase().trim().startsWith(b)||jive.util.equalsIgnoreCaseAndPadding(b,$j(c).data("user-name"))})};a.isEmailAddressInput=function(b){return b.match("^([\\w\\.!#$%&*\\+/?\\^`{}\\|~_'=-]+)@([\\w\\.-]+)?$")};a.isValidEmailAddressFragment=function(b){return b.match("^([\\w\\.!#$%&*\\+/?\\^`{}\\|~_'=-]+)@?([\\w\\.-]+)?$")}});