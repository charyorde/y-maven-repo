jive.namespace("MicroBlogging");jive.MicroBlogging.AttachmentView=jive.AbstractView.extend(function(a,b){this.init=function(c){b.init.call(this,c);this.$imageContainer=null;this.isCreateForm=c.isCreateForm||true;this.resizeHandlerRegistered=false};a.getSoyTemplate=function(c){return jive.statusinput.attachments.renderAttachment(c)};a.getSoyTemplateAttachments=function(c){return jive.statusinput.attachments.renderAttachments(c)};a.renderAttachments=function(d){var c=this.getContent();c.append(this.getSoyTemplateAttachments($j.extend({removable:this.isCreateForm},d)));if(this.isCreateForm){c.slideDown("fast",function(){$j(this).animate({opacity:1},500)})}else{c.css("opacity","1").show()}};a.renderAttachment=function(d){var c=this.getContent().find("li.j-attached-loading");c.before(this.getSoyTemplate($j.extend({removable:this.isCreateForm},d)))};a.registerResizeHandler=function(){if(!this.resizeHandlerRegistered){var c=this;$j(window).resize((function(){var d;return function(){var e=$j(window).width();if(d&&e!==d){c.resize()}d=e}})());this.resizeHandlerRegistered=true}};this.postRender=function(){b.postRender.call(this);var e=this.getContent();this.registerResizeHandler();var d=e.find("ul.j-attached-items"),c=this;e.find(".j-attachment-arrow").unbind();e.find(".j-attachment-arrow").mousedown(function(){try{c.scrollHandler($j(this),d)}catch(f){console.log(f)}}).mouseup(function(){d.stop();return false}).click(function(){return false});this.resize()};this.add=function(e,f){var c=this,g=f.meta,d=this.getContent(),i=d.find("ul.j-attached-items"),h=g[0];$j.extend(h,{originalURL:e});if(i.length>0){this.renderAttachment({attachment:h});c.postRender()}else{this.renderAttachments({attachments:g})}d.find("li:not(.j-attached-loading):last > .j-remove-attachment").click(function(){c.emitP("removeImage",h.id).addCallback(function(j){c.removeAttachment(h.id)}).addErrback(function(k,j){console.log("error removing attachment with id "+h.id)});return false});this.hideLoadingNotification();this.resize();this.scrollHandler(d.find(".j-attachment-arrow-right"),d.find("ul.j-attached-items"))};this.showLoadingNotification=function(){var c=this.getContent().find("li.j-attached-loading");if(c.length==0){this.renderAttachments({entry:{meta:[]}})}c.show()};this.hideLoadingNotification=function(){var c=this.getContent().find("li.j-attached-loading");c.hide();if(c.length&&c.siblings(":not(.j-attached-loading)").size()==0){this.reset()}};this.reset=function(){this.getContent().html("").hide().find(".j-attached-loading").hide();this.metaData=[]};this.removeAttachment=function(d){var c=$j("#"+d);if(c.size()>0&&c.siblings(":not(.j-attached-loading)").size()==0){this.reset()}c.remove();if(this.metaData){this.metaData=this.metaData.filter(function(e){return d!==e.id})}};this.removeAllAttachments=function(){var d=this;var c=this.getContent().find("ul.j-attached-items li:not(.j-attached-loading)").map(function(){return parseInt(this.id)});for(var f=0,e=c.length;f<e;f++){d.emitP("removeImage",c[f]).addCallback(function(g){d.removeAttachment(c[f])}).addErrback(function(h,g){console.log("error removing attachment with id "+c[f])})}};this.hide=function(){this.hideAllMenus();this.getContent().hide()};this.resize=function(){var d=0,c=this.getContent();c.find("li.j-attached-image, li.j-attached-video").each(function(){d+=$j(this).outerWidth()});var e=this.getAttachmentScrollDim();if(e.containerWidth<e.attachmentsWidth){this.showArrows()}else{this.hideArrows()}c.find("ul.j-attached-items").css("width",e.attachmentsWidth+"px")};this.scrollHandler=function(e,d){var f,i=e.outerWidth()*2,h=this.getAttachmentScrollDim(),g=h.attachmentsWidth-h.containerWidth,c=parseInt(d.css("left"));if(isNaN(c)){c=0}if(e.hasClass("j-attachment-arrow-right")&&g>0){f=c+(g+i);d.stop().animate({left:(-g-i)},f*5,"linear")}else{if(g>0){f=c*-1;d.stop().animate({left:0},f*5,"linear")}}};a.getAttachmentScrollDim=function(){var c=this.getContent(),d={containerWidth:c.context.width,attachmentsWidth:0};c.find("li.j-attached-image, li.j-attached-video").each(function(){d.attachmentsWidth+=$j(this).outerWidth()});return d};a.showArrows=function(){var c=this.getContent();c.find(".j-attachment-arrow").css("display","block");c.find("ul.j-attached-items").css("margin-left","20px")};a.hideArrows=function(){var c=this.getContent();c.find(".j-attachment-arrow").hide();c.find("li.j-attached-image, li.j-attached-video").first().css("margin-left","0px")}});jive.MicroBlogging.AttachmentView.views={};