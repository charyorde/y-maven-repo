jive.namespace("ActivityStream");jive.ActivityStream.BuilderServices=jive.RestService.extend(function(a){a.resourceType="stream-config";a.pluralizedResourceType=a.resourceType;this.getInitialViewData=function(c){var b=this.RESOURCE_ENDPOINT+"/getInitialView";return this.commonAjaxRequest(new jive.conc.Promise(),"POST",{url:b,data:c.selectedStreamID+""})};this.getActivityStreams=function(b,d){var c=this.RESOURCE_ENDPOINT+"/user/activity/streams";if(b!=undefined&&d!=undefined){c+="/"+b+"/"+d}return this.commonAjaxRequest(new jive.conc.Promise(),"GET",{url:c})};this.getActivityStream=function(c){var b=this.RESOURCE_ENDPOINT+"/"+c;return this.commonAjaxRequest(new jive.conc.Promise(),"GET",{url:b})};this.manageAssociations=function(b,h){var d=this.RESOURCE_ENDPOINT+"/user/associations/manage",j=new jive.conc.Promise();if(h){d=$j.param.querystring(d,h)}var f=[],g={};for(var e=0,c=b.length;e<c;e++){f.push({objectType:b[e].objectType,objectID:b[e].id});if(!g[b[e].objectType+""]){g[b[e].objectType+""]={}}g[b[e].objectType+""][b[e].id+""]=b[e].itemStreamCounts}j.addCallback(function(l){for(var k=0,o=l.length;k<o;k++){var m=l[k];if(m.addedRelationship){if(!(m.associatedObjectType==3&&m.associatedObjectID==window._jive_current_user.ID)){jive.switchboard.emit("follow.user",jQuery.extend({},{id:m.associatedObjectID}))}jive.switchboard.emit("associations.create",m.addedRelationshipStreamViewBean.streamViewBean)}else{if(m.associatedObjectType!=3){if(g[m.associatedObjectType+""][m.associatedObjectID+""]==0){var n={objectType:m.associatedObjectType,objectID:m.associatedObjectID};jive.switchboard.emit("follow.create",n)}}}}});return this.commonAjaxRequest(j,"POST",{url:d,data:JSON.stringify(f)})};this.createNewStream=function(c){var b=this.RESOURCE_ENDPOINT;return this.commonAjaxRequest(new jive.conc.Promise(),"POST",{url:b,data:JSON.stringify(c.map(function(d){return{objectType:d.type,objectID:d.id}}))})};this.deleteStream=function(c,d){var b=this.RESOURCE_ENDPOINT+"/"+c;d.addCallback(function(h){var m=h.deletedStream;jive.switchboard.emit("associations.destroy",m);var k=m.specifiedPlaces;for(var f=0,e=k.length;f<e;f++){var g=k[f].type+"",l=k[f].id+"";if(k[f].prop.followInfo.streamsAssociatedBean.streamIDs.length==1){var j={objectType:g,objectID:l};jive.switchboard.emit("follow.destroy",j)}}});return this.commonAjaxRequest(d,"DELETE",{url:b})};this.modifyConfig=function(b){var c=this.RESOURCE_ENDPOINT+"/"+b.id+"/modify";return this.commonAjaxRequest(new jive.conc.Promise(),"POST",{url:c,data:JSON.stringify({name:b.name,receiveEmails:b.receiveEmails,defaultStream:b.defaultStream})})};this.pinHomeNav=function(c,d){var b=this.RESOURCE_ENDPOINT+"/pinHomeNavView";this.commonAjaxRequest(d,"POST",{url:b,data:c})};this.addItemsToStream=function(g,b,f,e,d){var c=this.RESOURCE_ENDPOINT+"/"+f+"/objects";if(d){c=$j.param.querystring(c,d)}g.addCallback(function(q){jive.switchboard.emit("associations.create",q.streamViewBean);for(var p=0,m=q.addedRelationships.length;p<m;p++){jive.switchboard.emit("follow.user",jQuery.extend({},{id:q.addedRelationships[p]}))}var l=q.streamViewBean.specifiedPlaces;for(var n=0,h=l.length;n<h;n++){var r=l[n].type+"",k=l[n].id+"";if(e[r]&&!e[r][k]){var o={objectType:r,objectID:k};jive.switchboard.emit("follow.create",o)}}});return this.commonAjaxRequest(g,"POST",{url:c,data:JSON.stringify(b.map(function(h){return{objectType:h.type,objectID:h.id}}))})};this.removeItemsFromStream=function(g,b,f,e,d){var c=this.RESOURCE_ENDPOINT+"/"+f+"/objects/remove";if(d){c=$j.param.querystring(c,d)}g.addCallback(function(h){jive.switchboard.emit("associations.destroy",h.streamViewBean);var n=h.streamViewBean.specifiedPlaces;for(var k=0,j=n.length;k<j;k++){var l=n[k].type+"",o=n[k].id+"";if(e[l]&&e[l][o]==1){var m={objectType:l,objectID:o};jive.switchboard.emit("follow.destroy",m)}}});return this.commonAjaxRequest(g,"POST",{url:c,data:JSON.stringify(b.map(function(h){return{objectType:h.type,objectID:h.id}}))})};this.setItemAssociations=function(b,f,c,e,d){var g=new jive.conc.Promise();if(c){return this.addItemsToStream(g,b,f,e,d)}else{return this.removeItemsFromStream(g,b,f,e,d)}};this.removeAllAssociations=function(d,f,c){var b=this.RESOURCE_ENDPOINT+"/"+d+"/"+f,e=new jive.conc.Promise();if(c){b=$j.param.querystring(b,c)}e.addCallback(function(){var g={objectType:d,objectID:f};jive.switchboard.emit("follow.destroy",g)});return this.commonAjaxRequest(e,"DELETE",{url:b})}});