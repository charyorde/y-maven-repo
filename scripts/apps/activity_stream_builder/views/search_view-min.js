jive.namespace("ActivityStream");jive.ActivityStream.BuilderSearchView=jive.AbstractView.extend(function(A){this.init=function(B){var C=this;C.currentSearchPage=B.searchPage;C.lastSearchType=B.searchPage;C.lastSearchTerm="";C.lastSubfilter="all";C.spinnerHTML=$j(jive.eae.common.loadingSpinner());C.maxResultsPerSet=10;C.resetStartingIndex();C.subFilters={people:"all",places:"all"}};this.postRender=function(){var B=this;B.$entireBuilderPage=$j("#stream-elements");B.$searchPageLinks=B.$entireBuilderPage.find("a.j-js-search-page-type");B.$searchPageLinksSearch=B.$entireBuilderPage.find("a.j-js-search-page-type.j-toggle-search");B.$searchField=$j("#j-stream-edit-search-textfield");B.$searchField.placeHeld();B.$clearSearch=$j("#j-asb-clear-search");B.typeAheadInput=new jive.TypeaheadInput("#j-stream-edit-search-textfield",{suppressEnterKey:true});B.typeAheadInput.addListener("change",function(C){B.typeAheadChangeDetected(C)}).addListener("clear",function(){B.typeAheadChangeDetected()});B.$searchPageLinks.click(function(D){var C=$j(this).data("pagetype");if(C!=B.currentSearchPage){B.changeSearchPage(C)}D.preventDefault()});B.$searchPageLinksSearch.click(function(C){B.$searchField.focus();C.preventDefault()});B.$clearSearch.click(function(C){C.preventDefault();B.typeAheadInput.val("");$j("#j-stream-edit-search-textfield").change()});B.$entireBuilderPage.delegate("a.j-js-show-more-results","click",function(D){var C=$j(this).data("searchtype");B.startingIndexes[C]+=B.maxResultsPerSet;B.doSearch(C,B.subFilters[C],B.getSetCurrentSearchTerm());D.preventDefault()})};this.typeAheadChangeDetected=function(B){var C=this;if(C.currentSearchPage=="suggested"){C.changeSearchPage("people-places")}else{C.resetStartingIndex();C.doSearch("people-places",C.subFilters,B||"")}};this.changeSearchPage=function(C){var D=this,B="font-color-normal";D.currentSearchPage=C;D.$searchPageLinks.removeClass(B);D.$searchPageLinks.filter("a[data-pagetype="+C+"]").addClass(B);D.resetStartingIndex();if(C=="people-places"){D.doSearch("people-places",D.subFilters,D.getSetCurrentSearchTerm())}else{D.doSearch("suggested","all",D.getSetCurrentSearchTerm(""))}};this.doSearch=function(C,D,E){var G=this;G.currentSearchTerm=E||"";G.currentSearchType=C;var F=0;if(C=="people"||C=="places"){F=G.startingIndexes[C]}var B={type:C,subfilters:D,value:E||"",start:F,maxResults:G.maxResultsPerSet};if(B.type=="people-places"&&B.value.trim()==""){B.type="places";B.subfilters="all"}G.showLoading();G.emitP("search",B).addCallback(function(I,H){G.doneLoading()})};this.showLoading=function(){var C=this,B=C.getContent();C.$searchField.after(C.spinnerHTML)};this.doneLoading=function(){var B=this;B.$searchField.next().remove()};this.getSetCurrentSearchTerm=function(B){var C=this;if(B!=undefined){C.$searchField.val(B);return B}return C.$searchField.val()};this.resetStartingIndex=function(B){var C=this;if(B){C.startingIndexes[B]=0}else{C.startingIndexes={people:0,places:0}}}})