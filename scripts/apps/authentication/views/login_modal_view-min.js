jive.namespace("Authentication");jive.Authentication.LoginModalView=jive.AbstractView.extend(function(a){a.init=function(c){var b=this;b.options=c||{};$j(function(){var d=$j("#navLogin, #jive-guest-link-auth");d.click(function(f){b.renderForm();f.preventDefault()})})};a.renderForm=function(){var b=this;var c=$j(jive.authentication.loginModal({rememberMe:b.options.rememberMe,passwordReset:b.options.passwordReset,forgotUsername:b.options.forgotUsername,captchaField:b.options.captchaField,usernameIsEmail:b.options.usernameIsEmail}));b.$lb=c.lightbox_me({destroyOnClose:true,onLoad:function(){b.$usernameField=c.find('input[name="username"]');b.$passwordField=c.find('input[name="password"]');b.$rememberMeField=c.find('input[name="autoLogin"]');b.$captchaField=c.find("#captchaInput");b.$submitButton=c.find('input[name="submit"]');b.attachBlurHandlers(c);b.attachSaveHandler(c);b.focusOnFirstInput(c)}})};a.focusOnFirstInput=function(b){b.find(":input:first").focus()};a.attachBlurHandlers=function(c){var b=this;c.find("input.field").keyup(function(d){b.checkRequiredFields();d.preventDefault()})};a.attachSaveHandler=function(c){var b=this;c.submit(function(d){b.submitForm($j(this));d.preventDefault()})};a.checkRequiredFields=function(){var b=this;if(b.$usernameField.val()==""||b.$passwordField.val()==""){b.$submitButton.attr("disabled","disabled")}else{b.$submitButton.removeAttr("disabled")}};a.submitForm=function(d){var b=this;if(d.attr("disabled")!="disabled"){d.val(d.data("submit-text"));d.attr("disabled","disabled");b.showSpinner();var c={username:b.$usernameField.val(),password:b.$passwordField.val()};if(b.$captchaField.length){c=$j.extend(c,{captcha:b.$captchaField.val()})}if(b.$rememberMeField.length){c=$j.extend(c,{rememberMe:b.$rememberMeField.is(":checked")})}b.emitP("login",c).addCallback(function(){b.handleLogin()}).always(function(){b.hideSpinner()})}};a.handleLogin=function(){if(this.$lb){this.$lb.trigger("close")}}});