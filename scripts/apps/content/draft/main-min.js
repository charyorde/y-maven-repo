jive.namespace("draft");jive.draft.Main=jive.oo.Class.extend(function(a){this.init=function(b){a.main=this;this.options=$j.extend({enabled:true,interval:10,keepaliveInterval:90,objectType:null,draftObjectType:null,draftObjectID:null,editorId:null,subject:null,images:[],properties:[],confirmationMessage:jive.i18n.getMsg("global.unsaved_changes.text"),saveMessage:jive.i18n.getMsg("forum.post.save_and_edit.text"),savedMessage:jive.i18n.getMsg("forum.post.save_and_edit.text")},b);b=this.options;this.view=new jive.draft.View(b);this.model=new jive.draft.Model(b);this.view.addListener("keepalive",function(c){a.main.model.get("")});this.view.addListener("display",function(c){var d=b.objectType+"/"+b.draftObjectType+"/"+b.draftObjectID;a.main.model.display(d).addCallback(function(e){a.main.view.display(e)})});this.view.addListener("create",function(c,d){a.main.model.create(c).addCallback(function(e){a.main.view.saved(e,d)}).addErrback(function(){d.emitError()})});this.view.addListener("save",function(c,d){a.main.model.save(c).addCallback(function(e){a.main.view.saved(e,d)}).addErrback(function(){d.emitError()})});this.view.addListener("restore",function(c){a.main.view.restore(c)});this.view.addListener("destroy",function(c){a.main.model.destroy(c).addCallback(function(d){a.main.view.destroy(c)})})};this.pause=function(){a.main.view.pause()};this.unpause=function(){a.main.view.unpause()}});