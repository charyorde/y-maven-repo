jive.namespace("content.common");jive.content.common.Main=jive.oo.Class.extend(function(a){var b=jive.content.common;this.init=function(d){d=$j.extend({submitHandlers:{draft:this.draftSubmitHandler,publish:this.publishSubmitHandler}},d);var c=this;this.view=this.createView(d);this.model=this.createModel(d);this.processUnload=true;new jive.content.common.multipart.Main({view:this.view});this.view.addListener("save",function(e){c.model.save(e,c.contributeOptions(e)).addCallback(function(f){c.processUnload=false;c.view.success(f)}).addErrback(function(){c.view.enableButtons()})});this.view.addListener("save-multipart",function(e){var f=e[0];var g=e[1];c.model.saveMultipart(f,c.contributeOptions(g)).addCallback(function(h){c.processUnload=false;c.view.success(h)}).addErrback(function(){c.view.enableButtons()})});$j(window).unload(function(){if(window.editor&&window.editor.toArray().length>0){window.editor.toArray()[0].teardownServices()}if(d.unloadURL&&c.processUnload){var e=c.view.getContent();var f=c.view.buildEventData(e);f.formMethod=e.data("formmethod");f.formAction=d.unloadURL;c.model.unload(f,c.contributeOptions(f))}});jive.conc.nextTick(function(){$j("#jive-compose-title").find("input[name=subject]").focus()});jive.localexchange.addListener("placeChanged",function(e){if(e&&e.prop.isModerated){$j("#jive-moderation-box").show()}else{$j("#jive-moderation-box").hide()}})};a.createView=function(c){return new b.View(c)};a.createModel=function(c){return new b.Model(c)};a.contributeOptions=function(c){return{}};a.publishSubmitHandler=function(c){$j(c).find("#draft").val(false);return c};a.draftSubmitHandler=function(c){$j(c).find("#draft").val(true);return c}});