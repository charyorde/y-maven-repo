jive.namespace("content.common");jive.content.common.View=jive.AbstractView.extend(function(b,c){var d=jQuery;var a;this.init=function(e){c.init.call(this,e);this.options=d.extend({submitHandlers:{},beforeRteSelector:"#subject"},e);a=this;d(function(){var f=a.getContent();b.contentRTE=new ContentRTE(a.options);new jive.Validator({form:f});$j(a.options.beforeRteSelector).keydown(function(g){return b.contentRTE.focusOnGUIEditor(g)});f.submit(function(l){var i=a.getContent(),g;if(!l.isDefaultPrevented()){if(i.data("submit-id")){var h=i.data("submit-id");i.removeData("submit-id");var k=a.options.submitHandlers[h];if(k){k(i)}}a.addRenamedToken(i);g=a.removeEmptyNonRequiredFiles(i);setTimeout(g,500);a.disableButtons();if(a.isMultipartForm(i)){i.attr("enctype","multipart/form-data");a.emit("save-multipart",[i,a.buildEventData(i)])}else{var j=a.buildEventData(i);j.formMethod=i.data("formmethod");j.formAction=i.data("formaction");a.emit("save",j)}l.preventDefault()}})})};this.success=function(i){var k=a.getContent();if(!i||i.code){k.find("button").enable();if(i&&i.code&&i.message){$j("<p>"+i.message+"</p>").message({style:"error"})}else{$j(jive.error.rest.soy.errorSaving({href:window.location})).message({showClose:true,style:"error"})}return}if(i.fieldErrors||i.errors){k.find("button").enable()}if(i.fieldErrors){var g=k.find(":input").data("validator");var l={};d.each(i.fieldErrors,function(o,n){l[n.field]=jive.i18n.getMsg(n.text)});g.invalidate(l)}d("#jive-error-box").remove();if(i.errors){var m=[];d.each(i.errors,function(o,n){m[o]={message:jive.i18n.getMsg(n)}});var e=d(jive.error.form.actionErrors({actionErrors:m}));k.before(e);d.scrollTo(e,800)}if(i.redirect){if(window.editor&&window.editor.toArray().length>0){window.editor.toArray()[0].teardownServices()}var j=$j.deparam.querystring();if(j.fromQ){var f="fromQ="+j.fromQ;if(j.qstep){var h=parseInt(j.qstep,10);if(j.fromQ!="-775000491"){f+="&qstep="+(1+h)}else{f+="&qstep="+(h)}}i.redirect=$j.param.querystring(i.redirect,f)}window.location=i.redirect}};this.buildEventData=function(e){return e.toObject({mode:"all"})[0]};b.isMultipartForm=function(g){var e=g.data("formenctype");if(e){return e=="multipart/form-data"}var f=g.find(":file, .js-file-input");if(this.options.multipartFormFilter){f=f.filter(this.options.multipartFormFilter)}return f.length>0||g.attr("enctype")=="multipart/form-data"};b.addRenamedToken=function(e){if(e.find("input[name='jive.token.name']")){$j("<input type='hidden' name='jiveTokenName' value='"+e.find("input[name='jive.token.name']").val()+"'/>").appendTo(e)}};b.removeEmptyNonRequiredFiles=function(e){var f=[];e.find(":file").each(function(){var g=d(this),h;if(!g.attr("required")&&!g.val()){h=d("<div></div>");g.after(h);g.detach();f.push({original:g,replacement:h})}});return function(){f.forEach(function(g){g.replacement.replaceWith(g.original)});f=[]}};this.enableSubmitButton=function(){a.getContent().find("#submitButton").prop("disabled",false)};this.enableButtons=function(){a.getContent().find("button").prop("disabled",false)};this.disableButtons=function(){a.getContent().find("button").prop("disabled",true)};this.enableSubmitButtons=function(){a.getContent().find("button:not([data-submit-id=cancel])").prop("disabled",false)};this.disableSubmitButtons=function(){a.getContent().find("button:not([data-submit-id=cancel])").prop("disabled",true)}});