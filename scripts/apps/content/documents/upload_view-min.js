jive.namespace("content.documents");jive.content.documents.UploadView=jive.content.common.View.extend(function(a,e){var d;this.init=function(g){e.init.call(this,g);if(g.actionBean.subject){d=g.actionBean.subject;$j("#subject").attr("value",d);$j("#jive-upload-doc-title").show()}$j("#officeintegration").click(function(){$j("#jive-office-plugin-download").popover({context:$j("#jive-plugin-popup"),destroyOnClose:false});return false});this.maxSize=g.binaryBodyConfig.maxFileSize;this.fileExtensions=g.binaryBodyConfig.fileExtensions||[];this.allowByDefault=g.binaryBodyConfig.allowAllByDefault;this.fromQuest=g.fromQuest;for(var h=0;h<this.fileExtensions.length;++h){this.fileExtensions[h]=c(this.fileExtensions[h])}var f=this;define(["jive.FileInput"],function(k){var j=f.fromBodyBean(g.actionBean.binaryBodyBean);var i=new k("#uploadFile",{files:j});if(i.dragAndDrop()){$j(".js-file-upload").addClass("j-file-drag-and-drop");$j("#jive-compose-current-details").remove()}i.addListener("change",function(r){var p,m,o,l;if(typeof r==="object"&&r.type==="file"&&r.nodeType===1){p=r;l=b(p.value);if(p.files&&p.files[0]&&p.files[0].size){o=p.files[0].size}}else{if(r.length>0){p=r[0];o=p.size;l=p.name}}if(l){if(!f.isValidType(l)){m=jive.i18n.getMsg("doc.upload.err.contnt_type.text")}else{if(!f.isValidSize(o)){m=jive.i18n.getMsg("doc.upload.err.doc_too_lrg.text")}}if(m){var n=jive.Validator.prototype.getValidator.call({options:{form:f.getContent()}});var q={};q.uploadFile=m;n.invalidate(q);i.reset();if(!d){$j("#subject").attr("value","")}}else{f.getContent().prev(".jive-error-box").remove();f.getContent().find(".jive-error-message").remove();$j("#jive-upload-doc-title").show();if(!d){$j("#subject").attr("value",l)}}}else{if(!d){$j("#subject").attr("value","")}$j("#jive-upload-doc-title").hide()}})})};function c(f){return f.substr(f.lastIndexOf(".")+1)}function b(g){if(g.substr(0,12)=="C:\\fakepath\\"){return g.substr(12)}var f=g.lastIndexOf("/");if(f>=0){return g.substr(f+1)}f=g.lastIndexOf("\\");if(f>=0){return g.substr(f+1)}return g}a.isValidType=function(g){var f=false;var h=c(g);if(this.allowByDefault&&this.fileExtensions.indexOf(h)<0){f=true}else{if(!this.allowByDefault&&this.fileExtensions.indexOf(h)>=0){f=true}}return f};a.isValidSize=function(f){return f==null||this.maxSize>=f};a.fromBodyBean=function(f){var g;if(f){g={name:f.name,uploadDate:f.uploadDate};if(typeof f.size==="string"){g.size=0;g.formattedSize=f.size}else{g.size=f.size}return[g]}else{return[]}}});