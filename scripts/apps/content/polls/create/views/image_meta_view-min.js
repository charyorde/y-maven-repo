jive.namespace("content.polls");jive.content.polls.ImageMetaView=jive.content.polls.MetaView.extend({init:function(f,a,e,b){this._super(f,a,e,b);var c=this;var d=this._$container;d.find("form").submit(function(){if(c._$container.find("input[type=file]").val()==""){return false}c.emit("completed",$j(this));c.resetFileInputForm();return false});this._$imageContainer=e.find(".jive-js-image-container")},resetFileInputForm:function(){this._$imageContainer.find("li.j-attached-loading").show();jive.StatusInput.bindAttachment(this._$imageContainer.find("ul.j-attached-items"),true)},error:function(a,c,b){this.emit("error",c);if($j(this._$imageContainer).find("ul li").size()==1){this.reset()}},add:function(e){var d=this;var c=this._$imageContainer.find("ul.j-attached-items");var b=this._$imageContainer;if(c.length>0){e.forEach(function(f){jive.StatusInput.renderAttachmentWrapper({attachment:f},c,true);b.find("li.j-attached-image:last > .j-remove-attachment").click(function(){d.emit("removeImage",f.id)})})}else{jive.StatusInput.renderAttachmentsWrapper({entry:{meta:e}},this._$imageContainer,true);b.find("li.j-attached-image > .j-remove-attachment").each(function(){$j(this).click(function(){d.emit("removeImage",e[$j(this).parent("li").index()].id)})})}this._$container.hide();if(e.length>0){this._$imageContainer.find("li.j-attached-loading").hide();var a=this._$imageContainer.find("li.j-attached-loading").remove();this._$imageContainer.find("ul.j-attached-items").append(a);jive.StatusInput.bindAttachment(c,true)}this._$imageContainer.show()},reset:function(){this._$imageContainer.html("");this._$imageContainer.hide();this._$imageContainer.find("li.j-attached-loading").hide()},show:function(){var c=this._$container.find("input[type=file]");var b=$j("<input type='file'>");b.attr("name",c.attr("name"));this._$container.find("input[type=file]").before(b).remove();var a=this;this._fileInputInterval=setInterval(function(){if(b.val()){clearInterval(a._fileInputInterval);a._$container.find("form").submit()}},100);this._super()},hide:function(){clearInterval(this._fileInputInterval);this._super()},remove:function(a){if($j("#"+a).size()>0&&$j("#"+a).siblings().size()<=1){this.reset()}$j("#"+a).remove()}});