jive.namespace("content.polls");jive.content.polls.OptionListView=function(j,c){jive.conc.observable(this);var t,d=new jive.ext.y.HashTable(),o=[],l=c.edit,a=this;function g(v,u){t=v;if(u){b()}q()}function e(v){var u=d.get(v);u.removeSuccess();d.clear(v)}function p(){$j.each(d.toArray(),function(u,v){v.removeSuccess()});d=new jive.ext.y.HashTable();t=[]}function s(u){m(u);$j("#poll-choice-"+u.id).effect("highlight",{color:"#ff9"},2000);$j("#poll-choice-"+u.id+" input.choice").focus()}function f(x,w){var v=jive.polls.option.soy.error({message:x});$j(".j-poll-option-message").html(v).show().delay(2000).fadeOut("slow");if(w!=null){var u=d.get(w);u.removeError()}}function b(){t.forEach(function(u){m(u)});$j(j).sortable({update:function(u,v){h(u,v)}})}function q(){t.forEach(function(v){var u=d.get(v.id);u.setIndex(v.index)})}function m(x){r(x);var u=$j("#poll-choice-"+x.id),v=new jive.content.polls.OptionView(u,{edit:l});d.put(x.id,v);v.addListener("moveUp",function(z,y){a.emit("moveOption",z,y)}).addListener("moveDown",function(z,y){a.emit("moveOption",z,y)}).addListener("remove",function(y){a.emit("removeOption",y)});var w=i(x.meta);w.forEach(n.partial(_,v,x))}function h(x,y){var w=y.item;var v=(w.attr("id")||"").split("-").last();var u=$j(".jive-voting-option").index(w);a.emit("moveOption",v,u)}function n(A,v,z){var x=k(A.view);var u=k(A.service);var y=new x(A.id,A.container,v.getDOMElement(),c);var w=new u(c);o.push(y);if(y instanceof jive.content.polls.ImageMetaView){a.addListener("reset",function(){y.reset()})}y.addListener("activated",function(){for(var B=0;B<o.length;B++){if(o[B]!==y){o[B].hide()}}y.show()}).addListener("deactivated",function(){y.hide()}).addListener("completed",function(D){var C=function(E){y.add(E)};var B=function(E,G,F){y.error(E,G,F);y.hide()};w.create(z,D,C,B)}).addListener("removeImage",function(B){w.remove(B);y.remove(B)}).addListener("error",function(B){a.displayError(B)});if(y instanceof jive.content.polls.ImageMetaView){if(typeof(A.attachmentdata)!="undefined"&&A.attachmentdata.length>0){y.add(A.attachmentdata)}}}function k(u){if(typeof u!="function"){u=u.split(".").reduce(function(w,v){return w[v]},window)}return u}function i(u){if(typeof(u.length)=="undefined"){return new Array(u)}return u}function r(v){var u=jive.polls.option.soy.renderEdit({option:v});$j(j).append(u)}this.updateOptions=q;this.setContent=g;this.addContent=s;this.displayError=f;this.removeOption=e;this.removeOptions=p;$j(document).ready(function(){$j(".jive-add-poll-option-link").click(function(){a.emit("newOption")})})};