jive.namespace("PublishBar");jive.PublishBar.PlaceView=jive.oo.Class.extend(function(a){jive.conc.observable(this);this.init=function(c,d){var b=this;this.$searchTarget=$j(d);this.$input=$j(c);this.$input.focus(function(){var e=$j("#js-visibility-place")[0],f=b.clearContainerResults.bind(b).delayed(250);$j(document.body).off("click.placeViewInput").on("click.placeViewInput",function(g){if(!$j.contains(e,g.target)){$j(document.body).off("click.placeViewInput");f()}})});$j(c).each(function(){$j(this).focus(function(){if(!$j(this).val()||$j(this).val().trim()==""){b.emitP("suggest").addCallback(function(f){b.showContainerResults($j.extend({suggested:true},f))})}else{b.emitP("search",$j(this).val()).addCallback(function(f){b.showContainerResults($j.extend({suggested:false},f))})}});var e=new jive.TypeaheadInput(this);e.addListener("change",function(f){b.emitP("search",f).addCallback(function(g){b.showContainerResults($j.extend({suggested:false},g))})});$j(this).keydown(function(f){switch(f.keyCode){case $j.ui.keyCode.UP:b.highlightPrev();return false;case $j.ui.keyCode.DOWN:b.highlightNext();return false;case $j.ui.keyCode.ESCAPE:b.clearContainerResults();return false;case $j.ui.keyCode.ENTER:var g=b.findSelectedItem();if(g.length){b.selectPlace(g.attr("data-objecttype"),g.attr("data-objectid"))}f.preventDefault();return false}return true})});$j("#js-publishbar-place-browse").click(function(f){b.emit("browse");f.preventDefault()})};a.clearContainerResults=function(){this.$searchTarget.empty().hide();this.$input.val("")};a.showContainerResults=function(c){var b=this;if(b.searchResults){b.searchResults.remove()}b.searchResults=$j(jive.publishbar.placeSearchResults($j.extend({communityFeatureVisible:jive.global.communityFeatureVisible},c)));b.$searchTarget.empty().append(b.searchResults).show();b.$searchTarget.find("a.js-target-container").click(function(f){var d=$j(this);b.selectPlace(d.attr("data-objecttype"),d.attr("data-objectid"));f.preventDefault()})};this.findSelectedItem=function(){return this.$searchTarget.find("a.j-selected")};this.highlightFirst=function(){this.findSelectedItem().removeClass("j-selected");this.$searchTarget.find("a.js-target-container:first").addClass("j-selected")};this.highlightLast=function(){this.findSelectedItem().removeClass("j-selected");this.$searchTarget.find("a.js-target-container:last").addClass("j-selected")};this.highlightNext=function(){var c=this;var b=c.findSelectedItem();if(b.parent().nextAll().find("a.js-target-container").length){b.removeClass("j-selected");b.parent().nextAll().find("a.js-target-container").first().addClass("j-selected")}else{b.removeClass("j-selected");c.highlightFirst()}};this.highlightPrev=function(){var c=this;var b=c.findSelectedItem();if(b.parent().prevAll().find("a.js-target-container").length){b.removeClass("j-selected").parent().prevAll().find("a.js-target-container").first().addClass("j-selected")}else{b.removeClass("j-selected");c.highlightLast()}};this.selectPlace=function(c,b){this.emit("selectPlace",c,b)}});