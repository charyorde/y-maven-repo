jive.namespace("invite");jive.invite.InviteView=jive.AbstractView.extend(function(A){this.init=function(B,I,P,F,K,D,E,M,H,L,O,N,G,C){this.invitees={};this.inviteeLists={};var J=this;this.params={message:N,container:B,inviteEmail:F,inviteUsers:K,canInvitePartners:D,canInviteJustPartners:E,canInvitePreprovisioned:M,invitePreprovisionedDomainRestricted:H,domains:P,companyName:I,maxInviteCount:L,invitePeriodHours:O,trial:G,systemInvite:(B==null||(B.id==1&&B.type=="community"))};this.$trigger=$j(C||"#j-invite-button");this.$trigger.click(function(Q){J.open();Q.preventDefault()})};A.getSoyTemplate=jive.invite.create;this.open=function(){this.initialize();this.$template.lightbox_me({destroyOnClose:true,centered:true,onLoad:function(){setTimeout(function(){$j("#invitees").focus()},0)}})};this.close=function(){this.$template.trigger("close")};this.clearErrors=function(){for(var C in this.invitees){this.invitees[C].reset()}for(var B in this.inviteeLists){this.inviteeLists[B].reset()}};this.addErrorMessage=function(C,B,E){var D=this.getInviteeView(B,E);D.addErrorMessage(C)};this.reportComplete=function(C,B,E){var D=this.getInviteeView(C,E);if(B){D.markError()}else{D.markSuccess()}};this.startProgress=function(){this.showSpinner({"inline":true,"showLabel":false,"context":this.getContent().find(".j-form-buttons")})};this.setProgress=function(B){if(B>=100){this.hideSpinner()}};A.getInviteeView=function(B,C){if(C){return this.inviteeLists[B]}else{return this.invitees[B]}};A.initialize=function(){this.invitees={};this.inviteeLists={};this.content=this.$template=$j(this.getSoyTemplate(this.params));var B=this;this.$form=this.$template.find("#jive-invite-form");this.autocomplete=new jive.UserPicker.Main({emailAllowed:this.params.inviteEmail,userAllowed:this.params.inviteUsers,valueIsUsername:this.params.inviteUsers,listAllowed:this.params.inviteUsers,canInvitePartners:this.params.canInvitePartners,canInviteJustPartners:this.params.canInviteJustPartners,canInvitePreprovisioned:this.params.canInvitePreprovisioned,invitePreprovisionedDomainRestricted:this.params.invitePreprovisionedDomainRestricted,domains:this.params.domains,multiple:true,trial:this.params.trial,maxSelectedCount:this.params.maxInviteCount,maxSelectedMessage:$j(jive.invite.maxInvitationsError(this.params)),selectionCallbacks:[this.updateInvitees],$input:this.$template.find("#invitees"),placeholder:" "});this.$form.submit(function(C){C.preventDefault();B.submit(this)})};A.submit=function(D){var C=this.autocomplete.getSelectedUsersAndLists();this.updateInvitees(this.$template,C.users,C.userlists);var E=this.getUsers();var B=this.getLists();if(E.length>0||this.listsHasUsers(B)){this.emit("submit",$j(D).find('textarea[name="message"]').val(),E,B,this.getSelectedGroups(),this.getSelectedSpaces())}else{$j(jive.invite.requiredRecipientsError()).message({style:"error"})}};A.listsHasUsers=function(C){var B=false;if(C.length>0){C.forEach(function(E,D){if(E.users.length>0){B=true}})}return B};A.getUsers=function(){var E=[];for(var C in this.invitees){var B={};B.identifier=C;var D=this.invitees[B.identifier].getContent();B.id=D.data("user-id");B.userName=D.data("user-name");E.push(B)}return E};A.getLists=function(){var B=[];for(var D in this.inviteeLists){var E={};E.identifier=D;var C=this.inviteeLists[E.identifier].getContent();E.users=[];C.find("a.jive-username-link").each(function(G,I){var H=$j(I);var F={};F.userName=H.data("username");F.id=H.data("userid");E.users.push(F)});B.push(E)}return B};A.updateInvitees=function(D,E,B){var C=this;this.invitees={};this.inviteeLists={};E.forEach(function(F,G){var H=D.find('[data-user-name="'+F.username+'"]');C.invitees[F.username]=new jive.invite.InviteeView(H)});B.forEach(function(G,F){var H=D.find('[data-list-id="'+G.id+'"]');C.inviteeLists[G.id]=new jive.invite.InviteeView(H)})};A.getSelectedGroups=function(){var B="";$j('select[name="recoGroup"]').change(function(){$j('select[name="recoGroup"] option:selected').each(function(){B+=$j(this).attr("value")+","});$j("#selected-gids").text(B)}).trigger("change");return B};A.getSelectedSpaces=function(){var B="";$j('select[name="recoPages"]').change(function(){$j('select[name="recoPages"] option:selected').each(function(){B+=$j(this).attr("value")+","});$j("#selected-spids").text(B)}).trigger("change");return B}})