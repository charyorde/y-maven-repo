jive.namespace("admin.apps.services");jive.admin.apps.services.EntryView=jive.admin.apps.services.AbstractView.extend(function(a){a.REQUIRED_FIELDS_ALL=["service-field-name","service-field-tags","service-field-uri"];a.REQUIRED_FIELDS_OAUTH2=["service-field-oauth2-client-id","service-field-oauth2-client-secret","service-field-oauth2-authentication-url","service-field-oauth2-access-token-url"];a.errors=-1;this.init=function(r,g,n,j,h){var q=this;this.content=$j(jive.admin.apps.services.entry({service:r,authStyles:g}));if(r.authStyle=="oauth2"){this.content.find(".oauth2-only").show()}this.content.find("#service-field-authentication").change(function(){if(r.id>0){q.content.find("#service-field-help-warn").fadeIn("slow",function(){})}if(q.content.find("#service-field-authentication").val()=="oauth2"){q.content.find(".oauth2-only").slideDown("slow");q.content.find("#service-field-oauth2-client-id").focus()}else{q.content.find(".oauth2-only").slideUp("fast")}return false});this.content.find("#cancel-service-button").click(function(t){var u={service:r};q.emit("cancel-service",u);return false});this.content.find("#save-service-button").click(function(t){var u={service:r};q.emit("save-service",u);return false});this.content.find("#test-service-button").click(function(t){var u={service:r};q.content.find("#test-service-working").show();q.content.find("#test-service-success").hide();q.content.find("#test-service-failure").hide();q.content.find("#test-service-message").text("").hide();q.emit("test-service",u);return false});var b=this.content.find("#groups-filter");var o={groups:n,groupLists:[]};var i={multiple:true,startingGroups:o,$input:b};var e=new jive.UserGroupPicker.Main(i);var p=this.content.find("#users-filter");var c={users:h,userlists:[]};var f={multiple:true,startingUsers:c,$input:p,name:"users"};var s=new jive.UserPicker.Main(f);var l=this.content.find("#owners-filter");var k={users:j,userlists:[]};var d={multiple:true,startingUsers:k,$input:l,name:"owners"};var m=new jive.UserPicker.Main(d)};this.erase=function(){$j("#services-entry-div").html("")};this.getContent=function(){return this.content};this.getServiceID=function(){var b=$j("#serviceID").val();return b};this.hide=function(){$j("#services-entry-div").fadeOut()};this.populate=function(c){c.authStyle=$j("#service-field-authentication").val();c.description=$j("#service-field-description").val();c.displayName=$j("#service-field-name").val();c.groups=[];var e=$j("#groups-select div ul");if(e){$j(e).find("li").each(function(f,g){c.groups.push($j(g).attr("data-group-id"))})}c.iconURL=$j("#service-field-iconURL").val();c.lenient=$j("#lenient").is(":checked");c.name=$j("#service-field-name").val();c.owners=[];var b=$j("#owners-select div ul");if(b){$j(b).find("li").each(function(f,g){c.owners.push($j(g).attr("data-user-id"))})}c.properties.oauth2AccessTokenURL=$j("#service-field-oauth2-access-token-url").val();c.properties.oauth2AuthenticationURL=$j("#service-field-oauth2-authentication-url").val();c.properties.oauth2ClientID=$j("#service-field-oauth2-client-id").val();c.properties.oauth2ClientSecret=$j("#service-field-oauth2-client-secret").val();c.properties.oauth2RedirectURL=$j("#service-field-oauth2-redirect-url").val();c.properties.oauth2Scope=$j("#service-field-oauth2-scope").val();c.serviceURL=$j("#service-field-uri").val();c.tags=$j("#service-field-tags").val().split(" ");c.users=[];var d=$j("#users-select div ul");if(d){$j(d).find("li").each(function(f,g){c.users.push($j(g).attr("data-user-id"))})}c.wsdlURL=$j("#service-field-wsdlURL").val()};this.render=function(){var b=this;$j("#services-entry-div").html("").html(b.getContent())};this.show=function(){$j(".jive-error-text").html("").hide();$j("#services-entry-div").fadeIn();$j("#service-field-name").focus()};this.testResults=function(c){var b=this;b.content.find("#test-service-working").hide();if(c){b.content.find("#test-service-failure").show();b.content.find("#test-service-message").text(c).show()}else{b.content.find("#test-service-success").show()}};this.validate=function(){var b=this;b.errors=0;$j(".jive-error-text").html("").hide();b.validateRequired(b.REQUIRED_FIELDS_ALL);if($j("#services.field-authentication").val()=="oauth2"){b.validateRequired(b.REQUIRED_FIELDS_OAUTH2)}if(b.errors>0){b.validateError("service-field-summary","Please correct the errors shown above and try saving again")}return(b.errors==0)};this.validateError=function(d,c){var b=this;$j("#"+d+"-error").html("<p>"+c+"</p>").show();b.errors++};this.validateRequired=function(b){var c=this;$j(b).each(function(d,e){var f=$j("#"+e).val();if(!f||(f=="")){c.validateError(e,"This field is required")}})}});