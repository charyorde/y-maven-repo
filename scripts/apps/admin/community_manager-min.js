jive.namespace("admin");jive.admin.CommunityManager=function(D,B,E){var w=null;var x=null;var l,K;var F,G,h,q;var t,C;Event.observe(window,"load",function(){var L=document.getElementById("spaceForm").communityID.value;u(L);f();e()});$j(document).ready(function(){$j("#jive-browse-tab a").click(function(){a("browse");return false});$j("#jive-search-tab a").click(function(){a("search");return false});$j("#spacesearchform").submit(function(){p();return false});function L(M){$j(M).filter(function(){return $j(this).attr("id").match(/^\d+$/)}).map(function(){j($j(this).attr("id"))})}$j("#search-div td span[id]:not(.disabled)").live("mousedown",function(){z(this);return false}).live("dblclick",function(){L(this);return false});$j("#search-div td a[id]:not(.disabled)").live("click",function(){L(this);return false});$j(".jive-pagination a").live("click",function(){var M=($j(this).attr("href").match(/start=(\d+)/)||[])[1];if(M){$j("#spacesearchform-start").val(M);p();return false}})});function f(){var L;if(L=document.getElementById("community-management")){L.onclick=H}if(L=document.getElementById("community-settings")){L.onclick=H}if(L=document.getElementById("community-permissions")){L.onclick=H}if(L=document.getElementById("community-summary")){L.onclick=H}if(L=document.getElementById("community-doc-management")){L.onclick=H}if(L=document.getElementById("community-thread-management")){L.onclick=H}if(L=document.getElementById("community-tagsets")){L.onclick=H}if(L=document.getElementById("community-merge")){L.onclick=H}}function H(){var L=this.href;var N=J();if(N==null){N=1}var M=document.getElementById("space_"+N);if(!M){alert(D.messages.selectspace);return false}if(!M.hasAdminPerm){alert(D.messages.noperm);return false}if(this.id=="community-merge"&&N==1){alert(D.messages.mergeroot);return false}L=L.replace(/communityID=\d*/,"communityID="+N);L=L.replace(/community=\d*/,"community="+N);location.replace(L);return false}function v(L){return($j(L).attr("id").match(/\d+/)||[])[0]}function o(L){if(typeof L=="function"){$j("body").css("cursor","wait");L();$j("body").css("cursor","")}else{if(L){$j("body").css("cursor","wait")}else{$j("body").css("cursor","")}}}function u(M){var N=M?M:1;w=new JsTree();w.setSelectable(true);w.setSelectionCallback(i);w.setDoubleClickCallback(y);w.setLoadFunction(A);var L=function(Q){var O=w.addNode(null,"space_"+Q.ID,Q.name);O.hasAdminPerm=Q.hasAdminPerm;if(!O.hasAdminPerm){w.disable(O)}b(O,Q);var P=document.getElementById("tree-div");if(P.firstChild){P.replaceChild(w.getRoot(),P.firstChild)}else{P.appendChild(w.getRoot())}k(w.getRoot());m(N)};CommunityUtils.getCommunityTree(N,L)}function A(L){o(function(){var M=v(L);CommunityUtils.getCommunities(M,function(N){b(L,N);k(L);w.openNode(L)})})}function b(M,P){var O,N;for(var L=0;L<P.children.length;L++){N=P.children[L];O=w.addNode(M,"space_"+N.ID,N.name);O.hasAdminPerm=N.hasAdminPerm;if(N.children&&N.children.length>0){b(O,N)}else{if(N.hasChildren){w.setHasChildren(O)}}if(!N.hasAdminPerm){w.disable(O)}}}function k(O){var L,N;for(var M=0;M<O.childNodes.length;M++){N=O.childNodes[M];L=N.nodeName.toLowerCase();if((L=="ul")||(L=="li")){k(N)}}L=O.nodeName.toLowerCase();if(!E){if((L=="li")&&O.childList&&(O.childList.childNodes.length>1)&&O.hasAdminPerm){$j(O.childList).sortable({axis:"y",stop:d})}}}function m(N){var L="space_"+N;var M=document.getElementById(L);if(M&&M.hasAdminPerm){w.setSelected(L);return}M=c(w.getRoot().firstChild);if(M){w.setSelected(M.id)}}function c(N){if(N.hasAdminPerm){return N}if(N.childList==null){return null}var L=null;var M,O;for(M=0;M<N.childList.childNodes.length;M++){O=N.childList.childNodes[M];if(O.hasAdminPerm){return O}}for(M=0;M<N.childList.childNodes.length;M++){O=N.childList.childNodes[M];L=c(O);if(L){return L}}return null}function i(L){var M=L.parentNode.parentNode.hasAdminPerm;if(!E){if(L.hasAdminPerm){F.removeClassName("disabled");F.onclick=I;G.removeClassName("disabled");G.onclick=s}else{F.addClassName("disabled");F.onclick=null;G.addClassName("disabled");G.onclick=null}if((L.id!="space_1")&&(M||L.hasAdminPerm)){h.removeClassName("disabled");h.onclick=g;q.removeClassName("disabled");q.onclick=r}else{h.addClassName("disabled");h.onclick=null;q.addClassName("disabled");q.onclick=null}L.insertBefore(l,L.childList)}}function e(){l=document.createElement("span");l.className="button-bar";if(!E){F=new Element("a").update(D.button.create);F.href="#";l.appendChild(F);G=new Element("a").update(D.button.edit);G.href="#";l.appendChild(G);h=new Element("a").update(D.button.move);h.href="#";l.appendChild(h);q=new Element("a").update(D.button["delete"]);q.href="#";l.appendChild(q);K=document.createElement("span");K.className="search-button-bar";t=new Element("a").update(D.button.edit);t.href="#";t.onclick=s;K.appendChild(t);C=new Element("a").update(D.button["delete"]);C.href="#";C.onclick=r;K.appendChild(C)}}function n(O){var N=new Object();var M=0,L=0;while(O){M+=O.offsetTop;L+=O.offsetLeft;O=O.offsetParent}N.left=L;N.top=M;return N}function y(M){if(!M.hasAdminPerm){alert(D.messages.noperm);return}var L=M.id.substr(M.id.indexOf("_")+1);j(L)}function d(N,P){if(!E){var O=v(P.item);var Q=v(N.target);var L=-1;$j(N.target).children().each(function(R,S){if(S.id==P.item.attr("id")){L=R;return false}});var M=document.getElementById("spaceForm");M.communityID.value=Q;M.subCommunityID.value=O;M.newIndex.value=L;o(true);$j.ajax({url:$j(M).attr("action"),type:"post",data:$j(M).serialize(),error:function(){alert(D.messages.reorderError)},complete:function(){o(false)}})}}function I(){if(!E){var M=J();if(M){var L=document.getElementById("spaceForm");L.action.value="newcat";L.communityID.value=M;L.submit()}}}function s(){var L=J();if(L){window.location.href="community-overview.jspa?refererURL=community-main.jsp&communityID="+L}}function g(){if(!E){var M=J();if(M){var L=document.getElementById("spaceForm");L.action.value="movecat";L.communityID.value=M;L.submit()}}}function r(){if(!E){var L=J();if(L){if(L==1){alert(D.messages.cantdeleteroot);return}window.location.href="community-overview.jspa?refererURL=community-delete.jsp&communityID="+L}}}function J(){var L=document.getElementById("browse-tab");if((L.style.display=="block")||(L.style.display=="")){if(w.getSelected()){var M=w.getSelected().id;M=M.substr(M.indexOf("_")+1);return M}}else{if(x){return x.id}}return 0}function a(O){var L=document.getElementById("jive-browse-tab");var R=document.getElementById("jive-search-tab");var P=document.getElementById("browse-tab");var M=document.getElementById("search-tab");if(O=="browse"){if(P.style.display=="none"){var S=J();if(S){var Q="space_"+S;if(document.getElementById(Q)){w.setSelected(Q)}else{u(S)}}P.style.display="block";M.style.display="none";L.className="jive-body-tab jive-body-tabcurrent active";R.className="jive-body-tab"}}else{if(O=="search"){if(M.style.display=="none"){var S=J();if(S){var N=document.getElementById(S);if(N){z(N)}else{z(null)}}M.style.display="block";P.style.display="none";R.className="jive-body-tab jive-body-tabcurrent active";L.className="jive-body-tab";document.getElementById("queryString").focus()}}}}function j(L){window.location.replace("community-main.jsp?communityID="+L)}function z(L){if(x){x.parentNode.className=""}x=L;if(x){x.parentNode.className="selectedRow";x.appendChild(K)}}function p(){x=null;var N=document.getElementById("spacesearchform-start").value;var M=document.getElementById("queryString").value;var L={resultTypes:"COMMUNITY",queryString:M,start:N,spacesearchform:"spacesearchform",view:"search"};new Ajax.Updater("search-div",B,{method:"get",asynchronous:true,evalScripts:true,parameters:L})}};