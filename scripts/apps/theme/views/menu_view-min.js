jive.namespace("Theme");define("jive.Theme.MenuView",["jquery"],function(b){return function a(e,f){var q=jive.conc.observable({}),o={top:0,left:0},j={},l="",g="below",n={},c=null,d=null;var m=function(){c.find("button").click(function(){var s=b(this);s.closest("ul").children().removeClass("active");s.closest("li").addClass("active");s.trigger("cssUpdate")});c.find(".disclosure-item").click(function(){b(this).toggleClass("open").next().slideToggle(400)});c.find(".backgroundPosition a").click(function(s){s.preventDefault();var t=b(this).closest("td");t.addClass("selected").closest("table").find("td.selected").not(t).removeClass("selected")});c.find("a[data-action]").click(function(w){w.preventDefault();var u=b(this).data();switch(u.action){case"changeImage":i(this);b(this).closest("form").find(":file, [data-widget-type=fileName]").each(function(){var y=b(this),x=y.is(":file")?y.data("image-name"):y.attr("name");if(y.is(":file")){q.emit("imageFileReset",x)}});break;case"deleteTheme":if(window.confirm(e.confirmThemeDelete({themeName:u.name}))){q.emit("delete",u.id)}break;case"setCssValue":var v=b(this),s=v.closest(".j-js-selectable");if(s.length>0){k(s)}else{var t=v.addClass("active").data("name");b("[data-name="+t+"]").not(this).removeClass("active")}b(this).trigger("cssUpdate");break;case"setTheme":q.reset();q.emit("setSkin",u.id);break}})};var h=function(){c.find(":input").each(function(){var t=b(this),s=j[t.attr("name")];f(t,j).setValue(s)});c.find("a[data-action=setCssValue], button[data-name=buttonStyle]").each(function(){var u=b(this),t=u.data();if(j.hasOwnProperty(t.name)&&j[t.name]===t.value){var s=u.parent();if(s.is(".j-js-selectable")){k(s)}else{u.addClass("active")}u.filter("[data-type=bgPosition]").parent().addClass("selected")}})};var k=function(s){s.closest(".j-js-selectableList").children().removeClass("active");return s.addClass("active")};var i=function(s){var t=b(s).closest("form");t.removeClass("inProgress complete").addClass("default").find(".filename").text("");t.find(":file, [data-widget-type=fileName]").val("");return t};var p=function(w,u){var s=b(w.target),t=s.data("name")||s.attr("name");if(u===""){q.emit("deleteCssValue",t)}else{var v=b.extend({},b.isPlainObject(u)?u:{});switch(true){case s.is("a, button"):v[t]=s.data("value");break;case s.is(":text, :radio:checked"):v[t]=u||s.val();break;case s.is(":checkbox"):if(s.is(":checked")){v[t]=true}else{v={};q.emit("deleteCssValue",t)}break}q.emit("updateCssValues",v)}return false};var r=function(u,t){var s={};s[t.id]=t.url;s[t.id+"Url"]=t.displayUrl;s[t.id+"Name"]=t.name;s[t.id]=t.url;if(t.id==="headerLogo"){s.headerLogo=t.url;s.headerLogoUrl=t.displayUrl;q.emit("logoImageUpdated",s)}b(u.target).trigger("cssUpdate",s);return false};q.setAdjustment=function(s){o=s;return q};q.setCssValues=function(s){j=s;return q};q.setMenuId=function(s){l=s;return q};q.setOrientation=function(s){g=s;return q};q.setReferenceNode=function(s){d=s;return q};q.setSoyData=function(s){n=s||{};return q};q.reset=function(){b(".js-pop > :eq(0)").trigger("close");o={top:0,left:0};j={};c=null;d=null;l="";g="below";n={};return q};q.show=function(){c=b(e[l](n));h();m();c.bind("cssUpdate",p);c.bind("imageUploaded",r);c.popover({closeOtherPopovers:true,context:d,position:g||"below"});c.closest(".js-pop").offset(function(s,t){return{left:t.left+o.left,top:t.top+o.top}});return q};q.update=function(){c.html(b(e[l](n)).html());h();m()};return q}});