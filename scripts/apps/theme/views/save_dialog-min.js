jive.namespace("Theme");define("jive.Theme.SaveDialog",["jquery"],function(b){return function a(d){var o=jive.conc.observable({}),h={},k=null,l=false,f,g;var c=function(){return b.trim(g("#theme-name").val())};var n=function(p){p.preventDefault();f.trigger("close");h={};k=null;l=false;f=g=undefined};var j=function(q){var p=c();q.preventDefault();if(p){o.emit("save",p,g("#publish-toggle").is(":checked"),l?"preview":"edit");f.trigger("close")}else{b(d.themeNameRequiredMessage()).message({style:"warn"})}};var i=function(p){return h.hasOwnProperty(p)&&k.name===p&&!k.predefined};var e=function(){var p=i(c())&&!l;g("#save-publish-warning").toggle(p);g("#save-publish-message").toggle(!p)};var m=function(){var s=c(),r=i(s),u=false;g("#save-name-warning").html(function(){if(r&&l){u=true;return d.changeThemeName({text:s})}else{if(h.hasOwnProperty(s)||r){return d.saveDialogWarning({text:s})}}return""});var p=g("#publish-switch"),t=g("#publish-toggle");if(r){p.removeClass("switch-on switch-off");t.prop("checked",true)}else{if(p.hasClass("switch-lock")){t.prop("checked",false)}}p.toggleClass("switch-lock",r);t.prop("disabled",r);var q=g("#theme-save");q.prop("disabled",u);if(l){q.text(d.saveAndContinue())}else{if(r){q.text(d.saveAndPublish())}else{q.text(d.save())}}e();var v=t.is(":checked");g("#publish-switch").not(".switch-lock").toggleClass("switch-on",v).toggleClass("switch-off",!v)};o.setCustomPaletteNames=function(p){h={};(p||[]).forEach(function(q){h[q]=true});return o};o.setPublishedPalette=function(p){k=p;return o};o.setMode=function(p){p=(p||"").toLowerCase();if(!/^edit|preview$/.test(p)){throw new TypeError("Invalid mode")}l=p!=="edit";return o};o.show=function(p){f=b(d.saveDialog({name:p}));f.toggleClass("previewMode",l);g=f.find.bind(f);g("form").submit(j);g("#theme-save").click(j);g("#publish-toggle").change(m.aritize(0));g("#theme-cancel-save").click(n);var q=g("#theme-name");q.bind("keyup paste",m.aritize(0));m();f.lightbox_me({destroyOnClose:true,onLoad:function(){q.focus();e()}});return o};return o}});