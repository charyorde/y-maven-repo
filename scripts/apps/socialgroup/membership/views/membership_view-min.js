jive.namespace("MembershipApp");jive.MembershipApp.MembershipView=jive.oo.Class.extend(function(a){var b="browse",d="landing";jive.conc.observable(this);this.init=function(g,i,f){var e=this;this.joinContainer=g;this.leaveContainer=i;this.options=f||{};var h="objectID" in f?d:b;this.isPage=function(j){return h===j};$j(document).ready(function(){if(e.isPage(d)){$j(document).delegate(e.joinContainer,"click",function(j){e.joinGroup($j(this));j.preventDefault()});$j(document).delegate(e.leaveContainer,"click",function(j){e.displayLeaveGroupModal($j(this));j.preventDefault()})}else{$j("body").on("click",".sgroup-join, .sgroup-leave",function(k){k.preventDefault();var j=$j(this);if(j.is(".sgroup-join")){e.joinGroup(j)}else{e.displayLeaveGroupModal(j)}})}})};this.joinGroup=function(f){var e=this;var g=e.determineObjectID(f);e.emitP("join",g).addCallback(function(h){var i=$j.noop;if(e.isPage(d)){if(!h.banned){$j(e.leaveContainer).show();$j(e.joinContainer).hide()}i=function(){if(h.memberToContribute){window.location=c(1)}}}else{$j(f).closest(".j-thumb-back, .j-td-follow-action").find("a.sgroup-leave").show();$j(f).hide()}e.displayMessage(jive.socialgroups.soy.joinConfirmation(h),i);$j("#jive-link-socialgroup-startFollowing").hide();$j("#jive-link-socialgroup-following").show()}).addErrback(function(i,h){console.log("got error message: "+i+" code: "+h);e.displayError(i,h)})};this.displayLeaveGroupModal=function(f){var e=this;var g=e.determineObjectID(f);e.emitP("prepareLeave",g).addCallback(function(j){var h=$j(jive.socialgroups.soy.leaveGroup(j));$j("body").append(h);var i=$j("body").find("#jive-modal-leave-group");i.lightbox_me({closeSelector:".jive-modal-close, .close",destroyOnClose:true});i.find("#group-leave-submit").click(function(){e.leaveGroup(f,j);i.trigger("close")})}).addErrback(function(i,h){e.displayError(i,h)})};this.leaveGroup=function(f,g){var e=this;var h=e.determineObjectID(f);e.emitP("leave",h).addCallback(function(){var i=$j.noop;if(e.isPage(d)){$j(e.joinContainer).show();$j(e.leaveContainer).hide();$j("#jive-link-socialgroup-following").hide();$j("#jive-link-socialgroup-startFollowing").show();i=function(){if(!g.visibleAfterLeaving){window.location=jive.app.url({path:"/groups"})}else{if(g.memberToContribute){window.location=c(-1)}}}}else{$j(f).closest(".j-thumb-back, .j-td-follow-action").find("a.sgroup-join").show();$j(f).hide()}e.displayMessage(jive.socialgroups.soy.leaveConfirmation(g),i)}).addErrback(function(j,i){e.displayError(j,i)})};this.displayMessage=function(e,f){$j("<p />").html(e).message({style:"success",dismissCallback:f||$j.noop})};this.displayError=function(g,f){var e=jive.socialgroups.soy.renderError({message:g,code:f,href:window.location.href});$j(e).message({style:"error",showClose:true})};this.determineObjectID=function(e){var f=this.options.objectID||e.attr("data-objectid")||0;return parseInt(f,10)};function c(e){return window.location.href.replace(/\?(.*&)?qstep=(\d+)/,function(h,f,i){var g=parseInt(i)+e;return"?"+f+"qstep="+g})}this.tearDown=function(){var e=this;if(e.isPage(d)){$j(e.joinContainer).off("click");$j(e.leaveContainer).off("click")}else{$j(".sgroup-join").off("click");$j(".sgroup-leave").off("click")}}});