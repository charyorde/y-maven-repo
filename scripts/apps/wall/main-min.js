jive.namespace("Wall");if(!jive.Wall.Main){jive.Wall.Main=$Class.extend({init:function(a){var b=this;this._meta=a.meta||[];this.statusInputID="message-"+a.statusInputIdPostfix;this._statusInputIdPostfix=a.statusInputIdPostfix;this._submitBtnID=a.submitBtnID||".j-submit-mb";this._initEditorView(a);this._initStatusInput(a);this._initWallSource(a);this._wallStatusInputs.addListener("ready",function(){b._setupStatusInputObservableHandlers();b._setupEditorViewObservableHandlers();b._setupMetaBtns(a);b._wireUpAtMentionBtn(a);b._wallEntry=null;var c=[];b._meta.forEach(function(d){b.initMeta(d,c,a,b._wallEditorView.getContainer(),function(e){b._getEntry(e)})});b._wallStatusInputs.getStatusInput(b.statusInputID).triggerOnFocusAnimation()})},displayInfo:function(a){this._wallEditorView.entryPublishedInfo(a)},displayWarn:function(a){this._wallEditorView.entryPublishedWarn(a)},displayError:function(a){this._wallEditorView.entryPublishedError(a)},_initEditorView:function(a){this._wallEditorView=new jive.Wall.EditorView(a.editorContainer,$j.extend({notificationContainer:$j(a.editorContainer).parent()},a))},_setupEditorViewObservableHandlers:function(){var a=this;var c=function(d){a._wallEditorView.enableForm();if(d.status=="AWAITING_MODERATION"){a.displayWarn(jive.i18n.getMsg("we.form.posted.moderation"))}else{a._wallEditorView.entryPublished(d)}a._wallStatusInputs.resetText(a.statusInputID);a.emit("reset");a._wallEntry=null};var b=function(d){a._wallEditorView.enableForm();a.displayError(d)};this._wallEditorView.addListener("submit",function(){var d={message:a._wallStatusInputs.getSubmitVals(a.statusInputID)};if(a._wallEntry){$j.extend(true,a._wallEntry,d)}else{a._wallEntry=d}a._wallSource.publish(a._wallEntry,c,b)})},_initStatusInput:function(a){this._wallStatusInputs=new jive.MicroBlogging.StatusInputs("#statusInputs-"+a.statusInputIdPostfix,{idPostfix:a.statusInputIdPostfix,focusOnRdy:a.focusOnRdy,mobileUI:a.mobileUI,maxCharCount:a.maxCharCount})},_setupStatusInputObservableHandlers:function(){var c=this;this._wallStatusInputs.getStatusInput(this.statusInputID).addListener("imageURLMatch",function(d){c.emit("imageURLMatch",d)}).addListener("youtubeURLMatch",function(d){c.emit("youtubeURLMatch",d)}).addListener("linkURLMatch",function(d){c.emit("linkURLMatch",d,function(e){c._wallStatusInputs.getStatusInput(c.statusInputID).swapLinkFor(d,e)})}).addListener("characterLenMsg",function(d,e){c._wallEditorView.handleCharacterLenMsg(d,e)}).addListener("dataError",function(d){c.displayError()});var b=this._wallEditorView.getContainer().find(".j-attach-action-container");var a=this._wallEditorView.getContainer().find(this._submitBtnID);this._wallStatusInputs.getStatusInput(this.statusInputID).addListener("focus",function(){if(b.is(":hidden")){a.css({opacity:0}).show().animate({opacity:1});if(($j.browser.msie&&$j.browser.version<7)){b.show()}else{b.css({opacity:0,height:1}).show().animate({height:"24px"},200,"linear",function(){$j(this).animate({opacity:1},300,"linear");$j(this).css("height","auto")})}b.parent(".j-wall-form").next(".j-mb-last-update").addClass(".j-mb-last-update-active")}})},_setupMetaBtns:function(a){var b=$j("#"+a.domContainerId)},_initWallSource:function(a){this._wallSource=new jive.Wall.WallSource(a)},_wireUpAtMentionBtn:function(a){var b=this;$j("#"+a.domContainerId).find("a.jive-js-mention-button").click(function(c){b._wallStatusInputs.getStatusInput(b.statusInputID).handleAtMentionButtonClick();c.stopPropagation()})},_getEntry:function(c){if(this._wallEntry!=null&&this._wallEntry.objectType&&this._wallEntry.objectId){c(this._wallEntry)}else{var a=this;var b=function(d){a._wallEntry=d;c(a._wallEntry)};this._wallSource.createDraft(b)}}});jive.Wall.Main.prototype.initMeta=function initMeta(h,b,k,g,d){var c=new h.view(h.id,h.container,g,k,h.viewType);var e=new h.service(k);b.push(c);var i=e instanceof jive.Wall.VideoLinkMetaSource;var a=c instanceof jive.Wall.ImageMetaView&&!i;var j=e instanceof jive.Wall.LinkMetaSource;var f=this;if(typeof this.notificationView=="undefined"){this.notificationView=new jive.shared.NotificationView(g,{info:".jive-info-box:first",warn:".jive-warn-box:first",error:".jive-error-box:first"})}if(j){this.addListener("linkURLMatch",function(m,l){e.create(h,m,l)})}else{if(a){this.addListener("imageURLMatch",function(n){var o=c.getDataForURLImage(n);var p=function(q,s,r){c.error(q,s,r)};var m=function(q){c.add(q,n)};var l=function(q){e.create(q,o,m,p,true)};c.add([]);c.formSubmitted();d(l)}).addListener("reset",function(){c.reset()})}else{if(i){this.addListener("youtubeURLMatch",function(n){var o={videoURL:n};var p=function(q,s,r){c.error(q,s,r)};var m=function(q){c.add(q,n)};var l=function(q){e.create(q,o,m,p,true)};c.formSubmitted();d(l)})}}}c.addListener("removeImage",function(l){e.remove(l);c.remove(l)});c.addListener("activated",function(){for(var l=0;l<b.length;l++){if(b[l]!==c){b[l].hide()}}c.show()}).addListener("deactivated",function(){c.hide()});c.addListener("error",function(l){f.notificationView.error(l)}).addListener("warn",function(l){f.notificationView.warn(l)}).addListener("info",function(l){f.notificationView.info(l)});if(!i){c.addListener("completed",function(o){var m=function(p,r,q){c.error(p,r,q)};var n=function(p){c.add(p)};var l=function(p){e.create(p,o,n,m)};c.formSubmitted();d(l)})}};jive.conc.observable(jive.Wall.Main.prototype);jive.Wall.Main.ATTACHMENT_TYPE_IMAGE="111";jive.Wall.Main.ATTACHMENT_TYPE_VIDEO="801";jive.Wall.Main.COMMENT_TYPE="105";jive.Wall.Main.DOCUMENT_TYPE="102";jive.Wall.Main.bindComments=function(b,a){var c=b+a.canComment+a.canCreateImage;if(!arguments.callee[c]){$j(".j-view-comments:not(.j-disabled)").live("click",function(){var d=$j(this).closest("td").find(".j-inline-comment-wrapper");var e=d.find(".jive-comment-container").attr("data-statusid");if(d.find(".comment-form").length<1){d.find("ul").append(jive.wall.commentForm({statusID:e,user:_jive_current_user,canComment:a.canComment,canCreateImage:a.canCreateImage,canAtMention:!jive.rte.mobileUI}));jive.Wall.CommentHelper.initComment(e,{wallEntryTypeID:b})}if(($j.browser.msie&&$j.browser.version<7)){d.show()}else{d.slideToggle(300)}return false});arguments.callee[c]=true}};jive.Wall.Main.bindRepostAndComments=function(b,a){if(!arguments.callee[b+a]){$j(".js-mb-comment-form").live("submit",function(c){jive.Wall.CommentHelper.submitComment(this,b,a);c.preventDefault()});$j(".j-comment-delete").live("click",function(c){jive.Wall.CommentHelper.destroyComment($j(this).attr("commentid"));c.preventDefault()});$j(".j-repost-submit, .js-mb-repost-form").live("click submit",function(c){jive.Wall.RepostHelper.submitRepost($j(this).data("status-id")||$j(this).attr("data-statusid"));c.preventDefault()});arguments.callee[b+a]=true}};jive.Wall.Main.bindRowHover=function(){if(!arguments.callee.alreadyCalled){$j(".jive-table-activity tr").live("mouseenter",function(){$j(this).find(".jive-activity-action a").removeClass("font-color-meta-light");$j(this).find(".jive-activity-action .jive-icon-comment-grey").removeClass("jive-icon-comment-grey").addClass("jive-icon-comment");$j(this).find(".jive-icon-like-grey").removeClass("jive-icon-like-grey").addClass("jive-icon-like");$j(this).find(".jive-icon-permalink").removeClass("jive-icon-permalink").addClass("jive-icon-permalink-active")}).live("mouseleave",function(){$j(this).find(".jive-activity-action a").addClass("font-color-meta-light");$j(this).find(".jive-activity-action .jive-icon-comment").removeClass("jive-icon-comment").addClass("jive-icon-comment-grey");$j(this).find(".jive-icon-like").removeClass("jive-icon-like").addClass("jive-icon-like-grey");$j(this).find(".jive-icon-permalink-active").removeClass("jive-icon-permalink-active").addClass("jive-icon-permalink")});$j(".jive-icon-permalink, .jive-icon-permalink-active").live("mouseenter",function(){$j(this).addClass("jive-icon-permalink-hover")}).live("mouseleave",function(){$j(this).removeClass("jive-icon-permalink-hover")});arguments.callee.alreadyCalled=true}}};