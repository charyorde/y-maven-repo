jive.namespace("ReadTracking");jive.ReadTracking.ReadTrackingView=jive.AbstractView.extend(function(a){jive.conc.observable(this);this.init=function(b){this.i18n=b.i18n;this.options=b;this.readTrackLock=false};this.postRender=function(){var b=this;$j("#j-dynamic-pane").undelegate();$j("#j-dynamic-pane").delegate("#j-js-communications a.j-js-read-trigger","click",function(c){b.markRead($j(this),c)}).delegate("#j-js-communications a.j-js-unread-trigger","click",function(c){b.markUnread($j(this),c)}).delegate("#communications-mark-all-read","click",function(c){b.markAllRead($j(this),c)});jive.switchboard.addListener("inbox.read",function(c,e,d){$j("#"+d).removeClass("j-act-unread").addClass("j-act-read");$j("[data-linkedid="+d+"]").removeClass("j-act-unread").addClass("j-act-read")}).addListener("inbox.unread",function(c,e,d){$j("#"+d).removeClass("j-act-read").addClass("j-act-unread");$j("[data-linkedid="+d+"]").removeClass("j-act-read").addClass("j-act-unread")}).addListener("inbox.markAllRead",function(){$j("#j-comm-activity-list").find("div.j-js-ibx-item").removeClass("j-act-unread").addClass("j-act-read");$j("#j-js-communications-exp").find("div.j-act-exp-view").removeClass("j-act-unread").addClass("j-act-read")})};this.markRead=function(i,h){var l=this;if(h){h.stopPropagation()}if(l.isReadTrackUnlocked()){var b,c,f,j;if(i.closest("div.j-act-exp-view").length){var g=i.closest("div.j-act-exp-view");b=g.attr("data-linkedid");c=b.split("_")[1];f=b.split("_")[2];j=g.hasClass("j-act-read")}else{var d=i.closest("div.j-js-ibx-item");b=d.attr("id");c=b.split("_")[1];f=b.split("_")[2];j=d.hasClass("j-act-read")}if(!j){var k=this;l.emitP("markRead",c,f,b,true)}}if(h){h.preventDefault()}};this.markUnread=function(i,h){var l=this;if(h){h.stopPropagation()}if(l.isReadTrackUnlocked()){var b,c,f,j;if(i.closest("div.j-act-exp-view").length){var g=i.closest("div.j-act-exp-view");b=g.attr("data-linkedid");c=b.split("_")[1];f=b.split("_")[2];j=g.hasClass("j-act-read")}else{var d=i.closest("div.j-js-ibx-item");b=d.attr("id");c=b.split("_")[1];f=b.split("_")[2];j=d.hasClass("j-act-read")}if(j){var k=this;l.emitP("markRead",c,f,b,false)}}if(h){h.preventDefault()}};this.markAllRead=function(d,h){var c=this;if(h){h.stopPropagation()}var g=true;if(jive.ActivityStream.activityNotifier&&jive.ActivityStream.activityNotifier.getPollCount()){var b=$j("#jive-nav-link-communications").find(".j-js-update-indicator"),f=parseInt(b.data("count"),10);if(f==0){g=false}}if(g){c.emitP("markAllRead")}if(h){h.preventDefault()}};this.isReadTrackUnlocked=function(){var b=this;if(!b.readTrackLock){b.readTrackLock=true;setTimeout(function(){b.readTrackLock=false},400);return true}else{return false}}});