jive.namespace("Navbar.Menu.Apps");jive.Navbar.Menu.Apps.InstallAnimation=jive.oo.Class.extend(function(a){var e=jQuery;var f=new jive.conc.Promise();var d="";var c={initialDelay:500,delayAfterPlacedInLauncher:250,targetSlide:750,iconSweep:2500,multiInstallDelay:333,showMarkers:false,showDouble:false};jive.conc.observable(this);this.init=function(){this._animationQueue=[];this._active=-1;this._animationRunning=false};this.getPromise=function(){return f};a.begin=function(){var g=this;g.emitP("begin").addCallback(function(i){if(i&&i.length>0){g.stripDomain(i);var h=g.showTarget(i);if(h){window.setTimeout(function(){g.animate()},c.initialDelay)}else{g._animationQueue.length=0;g.addToQueue("--last-item--");g.hideTarget()}}else{g._animationQueue.length=0;g.end(false)}}).addErrback(function(){g._animationQueue.length=0;g.end(false)})};a.stripDomain=function(h){var j=/^https?:\/\/.+?\//;if(h&&h.length){for(var g=0;g<h.length;++g){h[g].url=h[g].url.replace(j,"/");h[g].iconSrc=h[g].iconSrc.replace(j,"/");h[g].largeIconSrc=h[g].largeIconSrc.replace(j,"/");h[g].favIconSrc=h[g].favIconSrc.replace(j,"/")}}};a.showTarget=function(E){var v=this;var z=$j("<div/>").css({position:"absolute",width:"100%",top:"0",left:"0",visibility:"hidden","z-index":"9999"}).html($j("#j-header-wrap").clone());z.find("#j-header-wrap").removeAttr("id");z.appendTo($j("body"));z.delegate("*","click",function(i){i.preventDefault()});var o=z.find("#appsQuickLaunchLink").addClass("active");var r=o.offset().top+o.outerHeight();var u=$j(document).scrollTop();var x=z.outerHeight();var C=u-x-40;var D=$j("<div/>").addClass("j-pop").css({position:"absolute",top:"0",left:"0",visibility:"hidden","z-index":"9999"}).append($j("<div/>").addClass("j-quick-menu j-pop-main").attr("id","animatedAppQuickLaunchMenu").html($j(jive.nav.menu.apps.instances.content({links:E}))));D.append($j("<span/>").addClass("belowArrow pointer"));D.insertBefore(z);D.delegate("*","click",function(i){i.preventDefault()});d=D.find(".app-list-sm-icon").length?"app-list-sm-icon":"app-list-lg-icon";var g=$j(document).scrollTop()+r+8+3;var l=D.outerHeight();var B=g-l-r-40;var s=o.offset().left+o.outerWidth()/2;var k=D.outerWidth();var w=Math.max(s-k/2,96);D.find("> .pointer").css("left",(s-w-9)+"px");var t=window.setTimeout(function(){t=null;u=$j(document).scrollTop();C=Math.max(u-x-40,($j("body > .jive-modal").length==0)?0:-9999);z.css({top:C+"px",visibility:""});z.animate({top:u+"px"},c.targetSlide,"easeInOutSine",function(){v.emit("animation.show-header.end")});g=$j(document).scrollTop()+r+8+3;B=g-l-r-40;D.css({top:B+"px",left:w+"px",visibility:""});D.animate({top:g+"px"},c.targetSlide,"easeInOutSine",function(){v.emit("animation.show-target.end")})},c.initialDelay);var j=this.hideTarget;var A=this.resolveTarget;var h=this.addToQueue;this.hideTarget=function(){v.hideTarget=j;v.resolveTarget=A;if(t){window.clearTimeout(t);t=null;z.remove();D.remove();n.remove();v.end(false);return}C=Math.max(u-x-20,($j("body > .jive-modal").length==0)?0:-9999);z.animate({top:C+"px"},c.targetSlide,"easeInOutSine",function(){v.emit("animation.hide-header.end");z.remove();v.end(true)});D.animate({top:B+"px"},c.targetSlide,"easeInOutSine",function(){v.emit("animation.hide-target.end");D.remove()});n.remove()};this.resolveTarget=function(G){if(G.end.position&&G.end.position.resolved){return}G.end.element=D.find(G.end.selector);if(G.end.element.length){var H=G.end.element.offset();var J=G.end.element.find(".js-app-icon");G.end.size=J.innerWidth();if(G.start.size!=G.end.size){var F=G.start.element.find("img.js-app-icon");F.css("margin-top",((F.css("margin-top")||0)+(128-G.start.size)/2)+"px");var I=F.clone().attr("src",J.attr("src"));F.addClass("app-icon-1").css({width:G.start.size+"px",height:G.start.size+"px",opacity:"1","margin-left":(0-G.start.size)+"px"});I.addClass("app-icon-2").css({width:G.start.size+"px",height:G.start.size+"px",opacity:"0.001"});I.insertBefore(F);G.start.element.find(".app-icon-1").css({"margin-top":"-"+G.start.size+"px"})}if(c.showMarkers){jive.Navbar.Menu.Apps.InstallAnimation.rt(0,0).prependTo(G.end.element)}var i=v.getIconCenter(G.start.element);G.end.position={x:H.left+w,y:H.top+g,resolved:true};if(!G.start.position.resolved){G.start.position={x:G.start.position.x-i.left,y:G.start.position.y-i.top,resolved:true}}}};this.addToQueue=function(i){if(i==="--last-item--"){v.addToQueue=h;return}i.start.element.prependTo(n);this.resolveTarget(i);this._animationQueue.push(i);h.apply(this,arguments);i.start.element.css({top:i.start.position.y+"px",left:i.start.position.x+"px"})};var n=$j("<span/>").attr("id","__animation_appIconHolder").addClass("j-pop").addClass(d).css({position:"absolute",top:"0",left:"0"}).appendTo($j("body"));var m=0;for(var y=0;y<this._animationQueue.length;++y){var p=this._animationQueue[y];p.start.element.prependTo(n);this.resolveTarget(p);if(p.end.element.length){m++;p.start.element.css({top:p.start.position.y+"px",left:p.start.position.x+"px"});if(!c.showDouble){p.end.element.css({visibility:"hidden"})}}else{p.start.element.remove()}}this.emit("animation.app-icon.start");this._animationRunning=true;return m};a.hideTarget=function(){this.end(true)};a.resolveTarget=function(g){g.end.element=[]};a.addToQueue=function(g){this._animationQueue.push(g)};a.animate=function(){var k;do{k=this._animationQueue.shift();if(!k){this.addToQueue("--last-item--");return}}while(!k.end.element.length);this._active++;var j=this;window.setTimeout(function(){j.animate()},c.multiInstallDelay);var g={x:$j(window).width()/2+$j(document).scrollLeft(),y:$j(window).height()/2+$j(document).scrollTop()};function h(n,m,o){return{x:n.x+m,y:n.y+o}}k.start.element.delegate("*","click",function(m){m.preventDefault()});var i=[k.start.position,g,h(k.end.position,0,150),h(k.end.position,0,-32),k.end.position];var l={css:function(q){var p=1-q;var r=i.concat();while(r.length>1){for(var o=0,n=1,m=r.length;n<m;++o,++n){r[o]={x:Math.round(r[o].x*q+r[n].x*p),y:Math.round(r[o].y*q+r[n].y*p)}}r.length--}return{left:r[0].x+"px",top:r[0].y+"px"}}};k.start.element.animate({path:l},c.iconSweep,"easeOutSine",function(){function m(){k.start.element.remove();j._active--;if(j._active==0){j.emit("animation.app-icon.end");j.hideTarget()}}if(c.showDouble){k.end.element.css({visibility:""});window.setTimeout(m,c.delayAfterPlacedInLauncher);return}k.end.element.css({visibility:"",opacity:"0.001"});k.end.element.animate({opacity:"1"},Math.round(c.delayAfterPlacedInLauncher*0.333),"easeInOutSine");k.start.element.animate({opacity:"0"},Math.round(c.delayAfterPlacedInLauncher),"easeInOutSine",m)});if(k.start.size!=k.end.size){k.start.element.find(".app-icon-1").animate({opacity:"0.001",width:k.end.size+"px",height:k.end.size+"px","margin-top":"-"+k.end.size+"px"},c.iconSweep,"easeOutCubic");k.start.element.find(".app-icon-2").animate({opacity:"1",width:k.end.size+"px",height:k.end.size+"px"},c.iconSweep,"easeOutCubic");k.start.element.find(".app-icon-2, .j-app-title").animate({opacity:"1"},c.iconSweep)}else{k.start.element.find(".j-app-title").animate({opacity:"1"},c.iconSweep)}};a.end=function(g){if(g){f.emitSuccess()}else{f.emitError()}if(this._animationQueue.length){f=new jive.conc.Promise();this.begin()}else{this.emit("destroy");this._active=false}};function b(h){var g=h?/^(0|[1-9]\d*)(.\d+)?/.exec(h):null;return g?Number(g[0]):0}a.getIconCenter=function(g){var i=g.position();var h=g.find("img.js-app-icon");var k=h.position();var j={top:k.top-i.top+b(h.css("margin-top"))+h.innerHeight()/2,left:k.left-i.left+b(h.css("margin-left"))+h.innerWidth()/2};console.log("getIconCenter(ele,ctr,box,child)",g,j,i,k);return j};this.install=function(g,j){var k=g.iconAnimationStart||{};switch(k.size||128){case 48:new Image().src=g.iconSrc;break;default:new Image().src=g.largeIconSrc;break;k.size=128}var h=$j(jive.nav.menu.apps.instances.renderAppInstanceLink({largeIconSrc:g.largeIconSrc,smallIconSrc:g.iconSrc,iconSize:k.size,url:"#",title:g.title})).css({position:"absolute","z-index":"9999"});h.find(".j-app-title").css({opacity:"0.001"});if(c.showMarkers){jive.Navbar.Menu.Apps.InstallAnimation.rt(0,0).prependTo(h)}j=j||{};j.left=j.left||$j(window).width()/2+$j(document).scrollLeft();j.top=j.top||$j(window).height()/2+$j(document).scrollTop();var i={start:{element:h,position:{x:j.left+(k.x||0),y:j.top+(k.y||0)},size:k.size},end:{selector:"li:has(#app-ql-"+g.appUUID+")"}};this.addToQueue(i);if(this._active==-1){this._active=0;this.begin()}};this.isAnimationRunning=function(){return this._animationRunning}});jive.Navbar.Menu.Apps.InstallAnimation.rt=function(a,d){var c="data:image/png;base64,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";var b=$j("<img/>").attr("src",c).css({position:"absolute",left:(a-12)+"px",top:(d-12)+"px",width:"25px",height:"25px"});return $j("<div/>").css({position:"relative",overflow:"visible","z-index":"10001",visibility:""}).append(b).appendTo($j("body"))};