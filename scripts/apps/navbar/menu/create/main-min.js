jive.namespace("Navbar.Menu.Create");jive.Navbar.Menu.Create.Main=jive.Navbar.Menu.Main.extend(function(a,c){var b=jive.Navbar.Menu.Create;a.init=function(e,f){var d=this;c.init.call(this,e,f);this.suggestedContainers=new jive.Placepicker.SuggestedContainersSource({containerType:containerType,containerID:containerID});this.containers=new jive.Placepicker.SearchContainersSource();this.browseContainers=new jive.Placepicker.BrowseContainersSource();this.placePicker=new jive.Placepicker.PlacePickerSource("create",{containerType:containerType,containerID:containerID});this.quickCreateSource=new b.QuickCreateSource();this.userPrefSource=new jive.Browse.User.ItemSource();this.contentTypes={};this.currentContainerType=containerType;this.currentContainerID=containerID;this.listView.addListener("toggle",function(g){g.addCallback(function(h){d.initializeData(h)})});jive.localexchange.addListener("actions.create",function(g){d.selectedContentType=g.contentType;d.upload=g.upload;d.populate(new jive.conc.Promise()).addCallback(function(i){d.initializeData(i);var h=new jive.Placepicker.Main($j.extend({pickerContext:"create",followLinks:true,objectType:d.selectedContentType,upload:d.upload},d.contentTypes[d.selectedContentType]));h.showPicker();d.invalidate()})});jive.Accessibility.main.addHotkey("c",false,false,false,jive.Accessibility.clickAction($j(e)))};a.buildListView=function(g,h){var e=new b.TypeChooserView(),f=new b.ContainerChooserView(),i=new b.QuickCreateView(),d=this;d.flowController=new b.CreateFlowController(g,h,{contentType:f,toggleView:e},e);e.addListener("contentType",function(k,j){d.selectedContentType=k;d.upload=j}).addListener("toggleView",function(j){d.userPrefSource.setUserProperty({userID:"current",propName:"CreateMenuService.smallView",propValue:String(j)})});f.addListener("render",function(j){d.suggestedContainers.get(d.selectedContentType).addCallback(function(k){j.emitSuccess(jQuery.extend({upload:d.upload,selectedContentType:d.contentTypes[d.selectedContentType]},k))})});f.addListener("search",function(j,k){d.containers.findAll({query:j,contentType:d.selectedContentType,maxReturned:10}).addCallback(function(l){k.emitSuccess(jQuery.extend({contentType:d.selectedContentType,containerType:containerType,containerID:containerID,upload:d.upload},l))})});f.addListener("browse",function(k){var j=new jive.Placepicker.Main($j.extend({pickerContext:"create",followLinks:true,objectType:d.selectedContentType,containerType:k.containerType,containerID:k.containerID,upload:d.upload},k.selectedContentType));j.showPicker()});e.addListener("quickCreate",function(k,j){d.selectedContentType=k;d.url=j;if(jive.DirectMessaging.isContentTypeEqualTo(k)){d.flowController.close();jive.DirectMessaging.create({trackingID:"cmenu"}).showModal()}else{i.render()}});i.addListener("fetch",function(j){d.flowController.close();d.quickCreateSource.fetch(d.url,j)});return d.flowController};a.buildItemSource=function(){return new jive.Navbar.Menu.CreateSource()};a.sourceParams=function(){return{containerType:containerType,containerID:containerID}};a.initializeData=function(e){var d=this;if(e){e.sections.reduce(function(f,g){return f.concat(g.items)},[]).filter(function(f){return f.urlParams&&f.urlParams.contentType}).forEach(function(f){if(f.id===null){delete f.id}d.contentTypes[f.urlParams.contentType]=jQuery.extend({id:f.urlParams.contentType,headingKey:f.headingKey,personalContainerTitleKey:f.personalContainerTitleKey,personalContainerCaptionKey:f.personalContainerCaptionKey,searchPlaceholderKey:f.searchPlaceholderKey},f)})}$j("a.js-container-context").each(function(){$j(this).querystring("containerType="+d.currentContainerType+"&containerID="+d.currentContainerID);$j(this).removeClass("js-container-context")})}});