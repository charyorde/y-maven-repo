jive.namespace("Navbar.Menu.Home");jive.Navbar.Menu.Home.Main=jive.oo.Class.extend(function(a){this.init=function(c){var b=this;b.$button=$j(c);b.menuSource=new jive.ActivityStream.StreamSource();b.counts={inbox:0,actions:0,tasks:0};b.pendingActionsCount=0;$j(c).delegate(".j-js-update-indicator","click",function(h){var d=$j(this),f=$j("#j-home-global-nav-menu");if(!f.length){var g=$j(this);b.$menu=$j(jive.nav.menu.home.main({data:"",counts:""}));b.spinner=new jive.loader.LoaderView();b.$menu.html(b.spinner.getContent());b.$menu.delegate("div.j-aq-entry","click",function(e){if(!$j(h.target).is("a")){window.location=jive.app.url({path:"/actions"});e.preventDefault()}});b.$menu.popover({context:g,darkPopover:false,destroyOnClose:true,putBack:false,onLoad:function(){b.menuSource.getGlobalNavMenu().addCallback(function(i){if(i.inboxItems.activityContainerList.length||i.actionItems.actionQueueList.length||i.taskItems.taskList.length){var e=$j(jive.nav.menu.home.content({data:i,counts:b.counts}));b.$menu.trigger("popover.html",[e]);b.spinner.destroy()}else{b.spinner.destroy();b.$menu.trigger("close");d.hide();d.data("count",0);d.html("0");$j("#jive-nav-link-communications .j-js-update-indicator").hide().data("count",0).html("0");$j("#jive-nav-link-actions .j-js-update-indicator").hide().data("count",0).html("0")}})}})}else{f.trigger("close")}h.preventDefault()});jive.ActivityStream.activityNotifier.addListener("activityStream.poll",function(d){b.updateCount(d)});jive.switchboard.addListener("inbox.read",function(){b.decrementNewCount("inbox",1)}).addListener("inbox.unread",function(){b.decrementNewCount("inbox",-1)}).addListener("inbox.markAllRead",function(){b.decrementNewCount("inbox",10000)}).addListener("actions.actionTaken",function(){b.decrementNewCount("actions",1)}).addListener("tasks.taskComplete",function(){b.decrementNewCount("tasks",1)}).addListener("tasks.taskIncomplete",function(){b.decrementNewCount("tasks",-1)})};this.updateCount=function(c){var b=this;b.counts.inbox=c.fullCounts.communications.unreadCount;b.counts.actions=c.fullCounts.actions;b.counts.tasks=c.fullCounts.overdueTasks;b.renderCounts()};this.decrementNewCount=function(c,d){var b=this;if(b.counts[c]<=50||d>1000){b.counts[c]=b.counts[c]-d;if(b.counts[c]<0){b.counts[c]=0}b.renderCounts()}};this.renderCounts=function(){var b=this,e=b.counts.inbox+b.counts.actions+b.counts.tasks,d=$j(jive.welcome.updateIndicator({type:"count",count:e,extraCssClasses:"j-navbadge-count j-ui-elem"}));var c=b.$button.find(".j-js-update-indicator");if(c.length){c.replaceWith(d)}else{b.$button.append(d)}if(b.$button.hasClass("active")){b.updateTitleCount(e)}};this.updateTitleCount=function(c){var e=document.title,d=e.indexOf(")");if(d!=-1){e=e.substring(e.indexOf(")")+2)}var b="";if(c>0){b=jive.home.countForTitle({count:c})}document.title=b+" "+e}});