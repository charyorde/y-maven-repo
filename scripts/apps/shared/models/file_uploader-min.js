define("jive.FileUploader",["jquery","jive.RestService"],function(b,a){return a.extend(function(d,g){this.save=function(j){var i=this;if(b(j).is("form")){return jive.util.securedForm(j).flatMap(function(k){var l=i.saveUrl(j),m=i.saveMethod(j);return i.uploadForm(m,l,j)})}else{return g.save.call(this,j)}};d.uploadForm=function(m,j,k){var i=b(k),l;if(typeof FormData!=="undefined"&&typeof File!=="undefined"){l=new FormData();i.serializeArray().forEach(function(n){l.append(n.name,n.value)});i.find('input[type="file"]').each(function(){if(!this.multiple&&this.files.length>=1){l.append(this.name,this.files[0])}});i.find(".js-file-input").each(function(){var p=b(this),n=p.data("name"),o=p.data("value");if(n&&o){l.append(n,o)}});return this.uploadFormData(m,j,l)}else{return this.hiddenIFrameSubmit(m,j,k)}};var h=/[^{\[]*<textarea(?:\s[^>]*)?>(.*?)<\/textarea>/i,f=/[^{\[]*<body(?:\s[^>]*)?>(.*?)<\/body>/i,c=/[^{\[]*<pre(?:\s[^>]*)?>(.*?)<\/pre>/i;function e(k,j){var i=j.match(k);return i?i[1]:null}d.uploadFormData=function(l,i,j){var k=new jive.conc.Promise();this.commonAjaxRequest(k,l,{url:i,data:j,processData:false,contentType:false,dataFilter:function(o,m){var n=e(h,o)||e(c,o)||e(f,o)||o;return m==="json"?b.trim(n.replace(/^throw [^;]*;/,"")):n},timeout:0},j);return k};d.hiddenIFrameSubmit=function(n,j,k){var i=b(k),m=new jive.conc.Promise(),l=this;i.ajaxSubmit({url:j,type:n,contentType:"json",dataType:"json",success:function(o){l.normalizeID(o);m.emitSuccess(o)},error:this.errorCallback(m,this.errorSaving),timeout:0});return m}})});