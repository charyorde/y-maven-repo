jive.RestService=jive.oo.Class.extend(function(a){var b=jQuery;a.resourceType="abstract";a.displayGenericErrorMessages=true;a.putOnUpdate=false;a.init=function(d){var c=this;this.pluralizedResourceType=this.pluralizedResourceType||this.resourceType+"s";var e=jive.rest.url("/"+this.pluralizedResourceType);this.RESOURCE_ENDPOINT=(d&&d.forceSecure)?jive.secure(e):e;this.POST_RESOURCE_ENDPOINT=this.RESOURCE_ENDPOINT;this.defaultParams={}};this.suppressGenericErrorMessages=function(){this.displayGenericErrorMessages=false};a.commonAjaxRequest=function(j,e,d,h){var g=this,i,c,f;e=e.toUpperCase();if(e=="POST"){f={contentType:"application/json; charset=utf-8"};c=this.errorSaving}else{if(e=="GET"){c=this.errorFinding}else{if(e=="PUT"){f={contentType:"application/json; charset=utf-8"};c=this.errorUpdating}else{if(e=="DELETE"){c=this.errorDestroying}}}}b.ajax(b.extend({type:e,dataType:"json",success:i||function(k,m,l){g.normalizeID(k);j.emitSuccess(k)},error:this.errorCallback(j,c),timeout:120000},f||{},d));return j};this.save=function(d){this.normalizeID(d);var c=this.saveUrl(d);var e=this.saveMethod(d);return this.commonAjaxRequest(new jive.conc.Promise(),e,{url:c,data:JSON.stringify(this.withoutId(d))},d)};this.get=function(f,e){var c=this.RESOURCE_ENDPOINT+"/"+f,d=jQuery.extend({},this.defaultParams,e||{});return this.commonAjaxRequest(new jive.conc.Promise(),"GET",{url:c,data:d})};this.findAll=function(e){var c=this.RESOURCE_ENDPOINT,d=b.extend({},this.defaultParams,e);return this.commonAjaxRequest(new jive.conc.Promise(),"GET",{url:c,data:d})};this.destroy=function(e){var d=new jive.conc.Promise(),c=this;if(e.hasOwnProperty("id")){e=e.id}b.ajax({type:"DELETE",url:this.RESOURCE_ENDPOINT+"/"+e,success:function(){d.emitSuccess()},error:function(f){c.maybeEmitError(d,c.errorDestroying,[null,f&&f.status])},timeout:30000});return d};a.normalizeID=function(c){var d=c?(c.id||c[this.resourceType+"ID"]):null;if(c&&d){c.id=d}};a.unwrapResponse=function(c){if(Object.keys(c).length===1){return c[Object.keys(c)[0]]}else{return c}};a.errorCallback=function(e,c){var d=this;return function(k,l,h){var i,g,f;try{i=JSON.parse(k.responseText)}catch(j){}g=i?i.message:null;f=(i&&i.code)?i.code:k.status;if(l!=="error"||k.status>=100){d.maybeEmitError(e,c,[g,f])}}};a.maybeEmitError=function(e,c,d){if(this.displayGenericErrorMessages){this.displayError(c())}e.emitError.apply(e,d)};a.displayError=function(c){b(c).message({style:"error"})};a.errorSaving=function(){return jive.error.rest.soy.errorSaving({href:window.location})};a.errorFinding=function(){return jive.error.rest.soy.errorFinding({href:window.location})};a.errorUpdating=function(){return jive.error.rest.soy.errorUpdating({href:window.location})};a.errorDestroying=function(){return jive.error.rest.soy.errorDestroying({href:window.location})};a.withoutId=function(c){var d={};Object.keys(c).forEach(function(e){if(e!="id"){d[e]=c[e]}});return d};a.saveUrl=function(c){if(c.id){return this.RESOURCE_ENDPOINT+"/"+c.id}else{return this.POST_RESOURCE_ENDPOINT}};a.saveMethod=function(c){if(c.id&&this.putOnUpdate){return"PUT"}else{return"POST"}}});define("jive.RestService",function(){return jive.RestService});