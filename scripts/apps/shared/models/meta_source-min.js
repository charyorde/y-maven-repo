jive.MetaSource=jive.RestService.extend(function(a){jive.conc.observable(this);a.resourceType="meta";a.pluralizedResourceType=a.resourceType;this.createLink=function(d){var e=new jive.conc.Promise(),b=this,c={url:jive.action.url("link-meta",{url:encodeURIComponent(d)}),dataType:"html",success:function(f){console.log("jive.MetaSource.createLink SUCCESS "+f);e.emitSuccess(f)},error:function(f){console.log("jive.MetaSource.createLink ERROR "+f);b.errorCallback(e,this.errorSaving)}};$j.ajax(c);return e};this.createVideo=function(d,g){var f=new jive.conc.Promise(),b=this,e={contentObjectType:d.objectType,object:d.objectId,videoURL:encodeURIComponent(g)},c={url:jive.action.url("video-link-meta",e),dataType:"json",success:function(h){console.log("jive.MetaSource.createVideo SUCCESS "+h);f.emitSuccess(h)},error:function(h){console.log("jive.MetaSource.createVideo ERROR "+h);b.errorCallback(f,this.errorSaving)}};$j.ajax(c);return f};this.normalizeVideoData=function(b){if(b.meta&&b.meta.length>0){b.meta.forEach(function(d){var c=d.properties;if(c!=undefined){var g={};if(c.entry!=undefined&&c.entry.length!=0){var f=c.entry;for(var e=0;e<f.length;e++){g[f[e].key]=f[e].value}}d.properties=g}})}else{b.meta=[]}return b};this.createImage=function(f,d,b,k){var h=this,c=this.RESOURCE_ENDPOINT+"/imageJackson/"+f.objectType+"/"+f.objectId+"/attachment",g="",j=new jive.conc.Promise();if(b){console.log("Got image url");g=encodeURIComponent(d);c=this.RESOURCE_ENDPOINT+"/imageJackson/"+f.objectType+"/"+f.objectId}var i={url:c,dataType:"xml",data:{imageURL:g},contentType:"text/xml; charset=utf-8",complete:function(m,l){if($j(m.responseXML).find("meta id").length>0){h.fetch($j(m.responseXML).find("meta id").text()).addCallback(function(p){j.emitSuccess(p)}).addErrback(function(q,p){h.errorCallback(j,this.errorSaving)})}else{var o=$j(m.responseXML).find("code").text();var n=$j(m.responseXML).find("message").text();j.emitError(n,o)}},error:function(n,p,o){console.log("Error jive.Wall.ImageMetaSource create"+n+", "+p+", "+o);var m=$j(n.responseXML).find("code").text();var l=$j(n.responseXML).find("message").text();h.errorCallback(j,this.errorSaving)}};if(b){var e=k.find("input[name=image]");if(e.length>0){e.val("")}}else{k.find("input[name=imageURL]").val("")}k.ajaxSubmit(i);return j};this.fetch=function(c){var b=this.RESOURCE_ENDPOINT+"/"+c;return this.commonAjaxRequest(new jive.conc.Promise(),"GET",{url:b})};this.remove=function(c){var b=this.RESOURCE_ENDPOINT+"/remove/"+c;return this.commonAjaxRequest(new jive.conc.Promise(),"GET",{url:b})}});