jive.TypeaheadInput=jive.oo.Class.extend(function(b){var c=jQuery;jive.conc.observable(this);b.init=function(g,f){var d=this;f=f||{};this.element=c(g);this.minLength=f.minLength||2;this.delay=f.delay||333;this.suppressEnterKey=f.suppressEnterKey;var h=this.processKey.bind(this);if(c.browser.mozilla){this.element.keypress(function(i){h(i)})}else{this.element.keydown(function(i){h(i)})}this.element.bind("search change",h);this.element.focus(function(){d.focused=true;d.startWatch(h)});this.element.blur(function(){d.focused=false;d.stopWatch(h)});if(!("placeholder" in c("<input>")[0])){this.placeholder=this.element.attr("placeholder");this.placeheldClass=((this.element.data("placeHeld")||{}).options||{}).className}var e=this.delay;this.getDelay=c.isFunction(e)?this.delay:function(){return e};this.isClear=a(this.minLength,this.element.val())};this.val=function(d){if(this.focused&&typeof d!="undefined"){}else{if(d===""&&this.placeholder){this.element.val(this.placeholder);this.element.addClass(this.placeheldClass)}else{return this.element.val.apply(this.element,arguments)}}};b.processKey=function(g){var f=this.element.val(),d=this;if(g&&g.which=="13"&&d.suppressEnterKey){g.preventDefault()}if(f!==this.prevValue){if(this.timeout){clearTimeout(this.timeout)}this.timeout=setTimeout(function(){d.emitChange(d.element.val())},this.getDelay(f));this.prevValue=f}};b.emitChange=function(d){if(!this.isClear&&a(this.minLength,d)){this.emit("clear");this.isClear=true}else{if(d.length>=this.minLength&&!this.placeheld()){this.emit("change",d);this.isClear=false}}};function a(d,e){return c.trim(e)===""||e.length<d}b.placeheld=function(){if(this.placeholder&&this.placeheldClass){return this.element.val()===this.placeholder&&this.element.hasClass(this.placeheldClass)}else{return false}};b.startWatch=function(e){var d=this;this.stopWatch(e);this.watchTimeout=setTimeout(function(){e();d.startWatch(e)},333)};b.stopWatch=function(){clearTimeout(this.watchTimeout)}});