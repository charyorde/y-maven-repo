jive.namespace("SharedViews");jive.SharedViews.RteView=$Class.extend({init:function(a,b){this._preferredMode=window.preferredMode||b.preferredMode||"advanced";this._container=$j(a);this._formActionContainer=(b.formActionContainer)?$j(b.formActionContainer):this._container;this._rteDisabledBrowser=b.rteDisabledBrowser;this._resourceID=b.resourceID;this._resourceType=b.resourceType;this._isAnonymous=b.isAnonymous;this._templateName=b.templateName||"rte-template";this._bodyContent=b.bodyContent;this._settingsID=b.settingsID||"mini";this._i18n=b.i18n;this.images_enabled=b.imagesEnabled;var c=this;$j(document).ready(function(){c._render();if(!c._rteDisabledBrowser){c._createRTE()}c._addListeners()})},remove:function(){if(!this._rteDisabledBrowser){if(this._rte){this._rte.destroy()}window.editor.clear("wysiwygtext");jive.rte.multiRTE=jive.rte.multiRTE.filter(function(a){return a!="wysiwygtext"})}this._container.find("form").remove();$j(window).unbind("unload",this._unloadCallback);this.emit("remove")},val:function(a){if(a){this._rte.setHTML(a);return this}else{return this._getContentBody()}},setPreviewButtonText:function(a){this._container.find("[name=preview]").val(a)},focus:function(){this._rte.tinymceFocus()},_initEditor:function(){this._currentMode="advanced";var a=this;var b=new jive.rte.RTEListener();b.doneTogglingMode=function(){if(a._currentMode=="advanced"){a._currentMode="rawhtml"}else{a._currentMode="advanced"}a._refreshLinks();a.emit("toggle",a._currentMode)};this._rte.addListener(b);if(this._preferredMode=="rawhtml"){this._rte.toggleEditorMode("wysiwygtext")}else{if(tinymce.isIE){this._rte.toggleEditorMode();this._rte.toggleEditorMode()}}},_initRTE:function(){var a=this;if(this._rte.isTextOnly()){$j("#wysiwyg-panel").removeClass("loading");this._preferredMode="rawhtml";this._currentMode="rawhtml";return}this._initEditor();this._refreshLinks();setTimeout(function(){a.focus()},0);this.emit("ready")},_createRTE:function(){var b=this;var a={images_enabled:this.images_enabled||false};this._rte=new jive.rte.RTE(jiveControl,"wysiwygtext",this._settingsID,a);window.editor.put("wysiwygtext",this._rte);jive.rte.multiRTE.push("wysiwygtext");var c=new jive.rte.RTEListener();c.initFinished=function(d){b._initRTE()};this._rte.addListener(c)},_getContentBody:function(){if(!this._rteDisabledBrowser){return this._rte.getHTML()}else{return this._container.find("textarea:visible").val()}},_getValues:function(){return{body:this._getContentBody()}},_postHandler:function(){this.emit("post",this._getValues());return false},_addListeners:function(){var a=this;this._formActionContainer.find("[name=post]").click(function(){return a._postHandler()}).end().find("[name=preview]").click(function(){a.emit("preview",a._getValues());return false}).end().find("[name=cancel]").click(function(){a.emit("cancel",a._getValues());a._unload();return false});this._container.find(".toggle_preferred_mode").click(function(){var b=a._currentMode;WikiTextConverter.setPreferredEditorMode(b,{callback:function(){a._preferredMode=b;window.preferredMode=b;a._refreshLinks()},timeout:DWRTimeout});return false}).end().find(".toggle_html").click(function(){a._rte.toggleEditorMode("wysiwygtext");return false});this._unloadCallback=this._unload.bind(this);$j(window).bind("unload",this._unloadCallback)},_unload:(function(){}),_template:(function(){var b={};return function a(f,e){var c=/^[\w\-]+$/.test(f)?b[f]=b[f]||a(document.getElementById(f).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+f.replace(/[\r\t\n]/g," ").replace(/(^|%>)(.+?)(<%|$)/,function(g,h,i,j){return h+d(i)+j}).split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return e?c(e):c;function d(g){return g.replace("'","&apos;").replace("\\","\\\\")}}})(),_render:function(){this._container.append(this._template(this._templateName,{body:this._bodyContent}))},_refreshLinks:function(){this._container.find(".toggle_html").toggle(this._currentMode=="rawhtml");this._container.find(".toggle_preferred_mode").toggle(this._preferredMode!=this._currentMode)}});jive.SharedViews.RteView.setMiniRTEQuotedMsg=function(c,b,d,a){window._jive_gui_quote_text=jive.DiscussionApp.soy.rteMsgQuote({i18n:b,userName:c,isAnonymous:d,msgBody:a})};jive.conc.observable(jive.SharedViews.RteView.prototype);