$j(window).load(function(){var m="jive.tabs",l=5000,j=15000,g=false,c=new Date().getTime()+Math.random(),b=c+"",n=false,a={},f="",i=(function(){var o={setItem:function(q,r){this.key=r},getItem:function(q){return this.key}};try{return(!!localStorage.getItem?localStorage:o)}catch(p){return o}})();$j(window).unload(function(){if(n){console.log("unloading tab")}var o=i.getItem(m);try{o=o?JSON.parse(o):{}}catch(p){o={}}if(o[b]){delete o[b]}if(g){k()}i.setItem(m,JSON.stringify(o))});if(n){console.log("my tab id is: "+b)}function e(){var o=i.getItem(m);if(f===""||f!==o){if(o===undefined||o===null||o===""||o==="{}"){o={};o[b]={id:c,m:true};f=JSON.stringify(o);i.setItem(m,f);d();h()}else{try{f=o;o=o?JSON.parse(o):{};var u=false,p=true,r=false,t=false;for(var q in o){if(o[q].id){u=u||o[q].m;r=r||(c==o[q].id);p=p&&(c<=o[q].id)}}if(!r){o[b]={id:c,m:false};t=true}if(!u&&p){o[b].m=true;t=true}if(t){f=JSON.stringify(o);i.setItem(m,f);if(g&&o[b].m==false){k()}if(o[b].m==true){h()}else{d();a.handle=window.setTimeout(function(){if(n){console.log("Cardiac arrest, triggering an election")}i.setItem(m,"{}");e()},j)}}}catch(s){o={};o[b]={id:c,m:true};f=JSON.stringify(o);i.setItem(m,f);d();h()}}}}e();$j(window).bind("storage.socketHolderListener",function(o){e()});function d(){if(a.handle){if(g){window.clearInterval(a.handle)}else{window.clearTimeout(a.handle)}a.handle=null}}jive.switchboard.addListener("socketHolder.heartbeat",function(){if(g){return}if(n){console.log("I heard the heartbeat")}d();a.handle=window.setTimeout(function(){if(n){console.log("Cardiac arrest, triggering an election")}i.setItem(m,"{}");e()},j)});function h(){g=true;if(n){console.log("it's A-ME!")}a.handle=window.setInterval(function(){if(n){console.log("Sending heartbeat")}jive.switchboard.emit("socketHolder.heartbeat")},l)}function k(){d();g=false;if(n){console.log("tearing down socket holder")}}});