define("jive.FileInput",["jquery"],function(a){return jive.AbstractView.extend(function(b){b.init=function(e,c){var f=a(e),d=c?c.files:[];this.content=f;this.fieldName=f.prop("name");this.required=f.prop("required");if(typeof FormData!=="undefined"&&typeof File!=="undefined"&&this.draganddrop()){this.content=a("<div></div>");f.after(this.content);this.hideInput(f);if(d&&d.length>0){this.select(d)}else{this.reset()}this.preventDefaultDropBehavior();this._dragAndDrop=true}else{this.addInputEvents(f);this._dragAndDrop=false}};this.dragAndDrop=function(){return this._dragAndDrop};this.reset=function(){if((typeof this.dragAndDrop()==="undefined")||this.dragAndDrop()){var c=a(jive.shared.file.dropTarget()),d=this;this.replaceWith(c);this.content=c;this.addDropEvents(c);c.on("click",function(e){e.preventDefault();d.fileBrowser()})}if(this.$input){this.$input.prop("required",this.required);this.clearInput()}};b.select=function(f){var e=f[0],h=e.name,g=h.split(".").slice(1).join(".").toLowerCase(),d=this;var c=a(jive.shared.file.filledDropTarget(a.extend({fileName:h,extension:g},e,{size:e.formattedSize||e.size})));if(e instanceof File){c.data("name",this.fieldName);c.data("value",e)}this.clearInput();this.replaceWith(c);this.content=c;this.addDropEvents(c);c.on("click",function(i){i.preventDefault();d.reset();d.emitChange([])});this.$input.prop("required",false);this.emitChange(f)};b.fileBrowser=function(){this.$input.trigger("click")};b.addDropEvents=function(c){var d=this;c.on("dragenter",function(e){e.preventDefault()}).on("dragleave",function(){a(this).removeClass("j-drag-over")}).on("dragover",function(e){e.preventDefault();e.stopPropagation();a(this).addClass("j-drag-over");e.originalEvent.dataTransfer.dropEffect="copy"}).on("drop",function(f){f.preventDefault();var e=f.originalEvent.dataTransfer.files;if(e.length>=1){d.select(e)}})};b.hideInput=function(d){var c=this;this.$input=d;d.css({width:0,height:0,opacity:0,position:"absolute","z-index":-1000});d.on("change",function(e){if(this.files&&this.files.length>0){c.select(this.files)}})};b.clearInput=function(){var d=this.$input,c=d.clone(true);c.val("");d.replaceWith(c);this.$input=c};b.preventDefaultDropBehavior=function(){a(document).on("dragover",function(d){var c=d.target&&d.target.type==="file";if(!c){d.preventDefault();d.stopPropagation()}}).on("drop",function(f){var e=f.originalEvent.dataTransfer,d=e&&e.files&&e.files.length>0,c=f.target&&f.target.type==="file";if(d&&!c){f.preventDefault()}})};b.addInputEvents=function(d){var c=this;d.on("change",function(){c.emitChange(this)})};b.emitChange=function(c){this.emit("change",c)};b.draganddrop=function(){var c=document.createElement("div");return("draggable" in c)||("ondragstart" in c&&"ondrop" in c)}})});