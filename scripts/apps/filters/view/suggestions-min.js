jive.namespace("Filters");jive.Filters.Suggestions=jive.AbstractView.extend(function(a){var c=jQuery,b=jive.Filters;a.init=function(d){this.context=d;this.hidden=true};this.render=function(e){var d=this;if(this.hidden&&this.context.is(":visible")){this.content=c(e);this.keyTargets=c(this.context).add(this.content);this.keyHandler=this.handleKeydown.bind(this);this.selectedIndex=0;this.content.delegate(".js-suggestion a","click",function(g){var f=c(this).data("value");d.emitSelection(f);g.preventDefault()});this.content.bind("focus click",function(){d.emit("focus")});this.content.autocomplete({context:this.context,addClass:"j-autocomplete"});this.context.prop("autocomplete","off");this.content.one("close",function(){d.hide()});this.keyTargets.keydown(this.keyHandler);this.hidden=false}};this.hide=function(){if(!this.hidden){this.content.trigger("close");this.keyTargets.unbind("keydown",this.keyHandler);this.emit("blur");this.emit("close");this.hidden=true}};this.isVisible=function(){return !this.hidden};this.html=function(e){if(e){this.content.html(e);var d=this.selectedIndex,f=c(".js-suggestion:visible:nth-child("+d+") a",e);if(d>0){f.addClass("j-selected")}}else{return this.content.children()}};a.handleKeydown=function(d){switch(d.keyCode){case c.ui.keyCode.UP:this.selectPrevious();d.preventDefault();break;case c.ui.keyCode.DOWN:this.selectNext();d.preventDefault();break;case c.ui.keyCode.TAB:this.hide();break;case c.ui.keyCode.ENTER:this.selectCurrent();d.preventDefault();break;case c.ui.keyCode.ESCAPE:this.hide();d.preventDefault();break}};a.incrementSelection=function(f){var d=this.selectedIndex+f,e=this.content.find(".js-suggestion:visible:nth-child("+(d)+") a");if(e.length>0&&d>0){this.content.find(".j-selected").removeClass("j-selected");e.addClass("j-selected");this.selectedIndex=d}};a.resetSelection=function(){this.selectedIndex=0;this.content.find(".j-selected").removeClass("j-selected")};a.selectNext=function(){this.incrementSelection(1)};a.selectPrevious=function(){this.incrementSelection(-1)};a.selectCurrent=function(){var e=this.content.find(".js-suggestion:visible a.j-selected"),d=this;if(e.length>0){this.emitSelection(e.data("value"))}};a.emitSelection=function(e){var d=this;this.emitP("selection",e).addCallback(function(){d.resetSelection()})}});