jive.namespace("Tips");jive.Tips.TipView=jive.AbstractView.extend(function(a){a.init=function(b){this.tipView=$j.extend({},b)};a.getId=function(){return this.tipView.id};this.hasBeenViewed=function(){return this.shown};this.hasValidSelector=function(){var c=this;if(c.tipView.selector){var d=$j(c.tipView.selector);var b=(c.tipView.hiddenSelectorAllowed||d.is(":visible"));return(d.length>0)&&b}return false};a.getLoadSelector=function(){return this.tipView.loadSelector};this.isInitialTip=function(){return this.initialTip};this.render=function(f){var c=this;this.shown=false;c.triggerEventType=f.triggerEventType;c.triggerSelector=f.triggerSelector;c.groupId=f.id;var b=f.getTipViewsWithValidSelectors();var e=f.findIndexById(c.getId(),b);this.initialTip=e==0;var g=$j.extend(c.tipView,{groupId:c.groupId,count:b.length,first:c.initialTip,last:e==(b.length-1),index:e});var d=jive.tips.renderTip(g);c.$tipElement=$j(d);c.bindTipElementHandlers(f)};a.bindTipElementHandlers=function(c){var b=this;b.$tipElement.find(".js-next-tip").bind("click",function(d){c.showNextTip();d.preventDefault()});b.$tipElement.find(".js-prev-tip").bind("click",function(d){c.showPreviousTip();d.preventDefault()});b.$tipElement.find(".js-ignore-tips").bind("click",function(d){c.skip();d.preventDefault()});b.$tipElement.find(".js-close-tips").bind("click",function(d){c.dismiss();d.preventDefault()})};this.display=function(){var b=this;b.$tipSelector=$j(b.tipView.selector).filter(":first");if(b.$tipSelector.length>0){var c=b.$tipSelector;if(b.triggerSelector){c=$j(b.triggerSelector)}if(c.length>0){this.showTip(c)}else{if(console){console.warn("Please ensure a valid trigger selector is specified for tip "+this.tipView.id)}}}else{if(console){console.warn("Please ensure a valid selector is specified for tip "+this.tipView.id)}}};a.isTransientTrigger=function(){return this.isMouseoverTrigger()||this.isFocusTrigger()};a.isMouseoverTrigger=function(){return this.triggerEventType=="mouseover"};a.isFocusTrigger=function(){return this.triggerEventType=="focus"};a.showTip=function(d){var b=this;if(b.triggerEventType&&b.isInitialTip()){b.$triggerSelector=d;b.$triggerSelector.one(b.triggerEventType,function(f){b.showPopover(f)})}else{var c=b.getLoadSelector();if(c){b.showTipWithLoadSelector(c)}else{b.showPopover()}}};a.showTipWithLoadSelector=function(d){var b=this;var c=$j(d);if(c.length>0){if(c.is("img")){c.imagesLoaded(function(){b.showPopover()})}else{c.bind("load",function(){b.showPopover()})}}else{b.showPopover()}};a.showPopover=function(f){var c=this;if(!c.shown){var b=c.determineTipContext(f);var d={context:b,closeOtherPopovers:true,closeOtherPopoversSelector:"BODY > .js-pop > .j-tips[data-group-id='"+c.groupId+"']"};if(c.tipView.hiddenSelectorAllowed){c.handleInvisibleContext(b)}d=$j.extend(d,c.unbindDefocusHandlers());d=$j.extend(d,c.addCloseOptions());d=$j.extend(d,c.addOffsetOptions());c.$tipElement.popover(d);var e=c.$tipElement.closest(".js-pop");e.css("z-index",b.effectiveZIndex({relativeTo:e})+5);c.bindDefocusHandlers();c.shown=true}};a.hasCloseSelector=function(){return(this.tipView.closeSelector&&this.tipView.closeSelector.length>0)||false};a.isCloseOnClick=function(){return this.hasCloseSelector()&&this.tipView.closeSelector.trim().toLowerCase()=="body"};a.addOffsetOptions=function(){var b=this;return{nudge:{top:b.tipView.belowOffset,bottom:b.tipView.aboveOffset}}};a.addCloseOptions=function(){var b=this;var d=b.hasCloseSelector();var c={closeOnClick:d};if(d){c=$j.extend(c,{closeOnClickSelector:b.tipView.closeSelector})}return c};a.bindDefocusHandlers=function(){var b=this;if(!b.isCloseOnClick()){b.$tipElement.bind("click",function(){b.focusTip()});jive.conc.nextTick(function(){$j("BODY").bind("click",function(c){b.blurTip(c)})})}};a.unbindDefocusHandlers=function(){var b=this;var c={};if(!b.isCloseOnClick()){c=$j.extend(c,{onClose:function(){b.$tipElement.unbind("click",b.focusTip);$j("BODY").unbind("click",b.blurTip);b.restoreContextVisibility()}})}return c};a.determineTipContext=function(e){var d=this;var c=d.$tipSelector;if(e){var b=$j(e.currentTarget);var f=b.find(d.tipView.selector);if(f.length==0&&d.triggerSelector){f=$j(e.target).find(d.triggerSelector)}if(f&&f.length>0){c=f}}return c};a.blurTip=function(f){var b=this;if(b.$tipElement){var c=b.$tipElement.parent();var d=$j(f.target).parents().andSelf().toArray().reduce(function(h,e){return h||e==c[0]},false);var g=$j(f.target).parents("body").length>0;if(!d&&g){c.addClass("j-pop-blurred");b.restoreContextVisibility()}}};a.focusTip=function(){if(this.$tipElement){this.$tipElement.parent().removeClass("j-pop-blurred")}};a.handleInvisibleContext=function(c){var b=this;if(!c.is(":visible")){b.hiddenSelector=true;var e=c.attr("style");var d=e&&e.match(/display:/);b.cssDiplayValue=(d)?c.css("display"):"";c.show()}};a.restoreContextVisibility=function(){var b=this;if(b.hiddenSelector&&b.$tipSelector.is(":visible")){b.$tipSelector.css("display",b.cssDiplayValue)}};this.close=function(){if(this.$tipElement){this.$tipElement.trigger("close")}}});