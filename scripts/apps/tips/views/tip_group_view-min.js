jive.namespace("Tips");jive.Tips.TipGroup=jive.AbstractView.extend(function(a){a.init=function(c){var b=this;b.id=c.id;b.index=c.index;b.triggerSelector=c.triggerSelector;b.triggerEventType=c.triggerEventType;b.dismissKey=c.dismissKey||[];b.tips=c.visibleTips||[];b.refreshSelector=c.refreshSelector;b.refreshTimeout=c.refreshTimeout||b.getRefreshTimeout();var d=c.state||{};b.state=new jive.Tips.TipGroupState($j.extend(d,{stateKey:b.dismissKey}));b.buildTipViews();b.bindRefreshHandler()};a.buildTipViews=function(){var b=this;b.tipViews=[];b.activeTipIndex=-1;var c=b.state.getCurrentTipId();$j.each(b.tips,function(e,f){var d=new jive.Tips.Tip(f);if(f.id==c){b.activeTipIndex=(e-1)}b.tipViews.push(d)});while(b.activeTipIndex>=(b.tipViews.length-1)){b.activeTipIndex--}};a.destroyTipViews=function(){$j.each(this.tipViews,function(c,b){b.close()})};a.refresh=function(){var b=this;if(!b.isHidden()){b.destroyTipViews();setTimeout(function(){b.buildTipViews();b.showNextTip()},b.refreshTimeout)}};a.isHidden=function(){return this.state&&(this.state.isSkipped()||this.state.isDismissed())};a.getRefreshTimeout=function(){return jive.localexchange?1000:5000};this.hasVisibleTips=function(){return this.getTipViewsWithValidSelectors().length>0};this.showNextTip=function(){var b=this;var c=b.tipViews;if(c&&b.activeTipIndex<(c.length-1)){b.activeTipIndex++;if(!b.showActiveTip()){b.showNextTip()}}else{if(b.hasVisibleTips()){b.resetSequence()}}};this.showPreviousTip=function(){var b=this;if(b.activeTipIndex>0){b.activeTipIndex--;if(!b.showActiveTip()){b.showPreviousTip()}}else{if(b.hasVisibleTips()){b.resetSequence()}}};a.resetSequence=function(){var b=this;b.activeTipIndex=-1;b.showNextTip()};a.showActiveTip=function(){var b=this;var c=b.getCurrentTipView();if(c){if(c.hasValidSelector()){c.render(b);c.display();b.storeState(c);return true}else{return false}}else{return false}};a.storeState=function(c){var b=this;var d=b.state.getCurrentTipId();if(c.getId()!=d){b.state.setCurrentTipId(c.getId());if(d){b.emit("state",b.state)}}};this.findIndexById=function(b,c){return $j.inArray(b,this.getTipIds(c))};a.getCurrentTipView=function(){return this.tipViews[this.activeTipIndex]};this.skip=function(){var b=this;b.state.setSkipped(true);b.state.setDismissed(false);b.emit("close",b.state)};this.dismiss=function(){var b=this;b.state.setSkipped(false);b.state.setDismissed(true);b.emit("close",b.state)};a.getTipIds=function(b){return $j.map(b,function(c){return c.getId()})};a.getTipViewsWithValidSelectors=function(){var b=this;return $j.map(b.tipViews,function(c){return c.hasValidSelector()?c:null})};a.bindRefreshHandler=function(){var b=this;if(b.hasRefreshSelector()){$j(b.refreshSelector).bind("click",function(c){b.refresh();c.preventDefault()})}else{if(jive.localexchange&&jive.localexchange.viewupdatesource){jive.localexchange.addListener("view.update.start",function(){if(!b.isHidden()){b.destroyTipViews()}});jive.localexchange.addListener("view.update.stop",function(){if(!b.isHidden()){setTimeout(function(){b.buildTipViews();b.showNextTip()},b.refreshTimeout)}})}}};a.hasRefreshSelector=function(){return(this.refreshSelector&&this.refreshSelector.length>0)||false}});