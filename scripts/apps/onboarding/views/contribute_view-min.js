jive.namespace("Onboarding");define("jive.onboarding.ContributeView",["jquery"],function(a){return jive.AbstractView.extend(function(b){this.init=function(d){var c=this;c.questID=d.questID;c.setupPageTips(d.queryParams,"",window.location.href);jive.locationState.addListener("change",c.setupPageTips.bind(c))};this.postRender=function(d){var c=this;c.$viewHeader=a(d.selector);c.$viewContainer=a(d.selector+"-body");c.$viewContainer.on("click","#j-contribute-step-1-trigger, #j-contribute-step-2-trigger",function(g){var f=a(this).closest(".js-quest-step");a("html, body").animate({scrollTop:0},"fast");jive.locationState.setState({fromQ:c.questID,qstep:f.data("step")},"","activity");g.preventDefault()});var e=function(g){for(var h=0,f=g.quests[2].steps.length;h<f;h++){var j=g.quests[2].steps[h],k=j.id,l=c.$viewContainer.find("div.js-quest-step[data-step="+k+"] .js-do-step");if(j.state=="completed"){l.addClass("completed")}}};jive.switchboard.removeListener("onboarding.state.update",e).addListener("onboarding.state.update",e)};this.setupPageTips=function(g,m,c){var k=this,l=g.fromQ,e=g.qstep||"1";if(l==k.questID){if(e=="1"){var f=function(){var s=function(){k.closeTip();q.remove();a("html, body").animate({scrollTop:0},"fast");var u=a(jive.onboarding.quests.contribute.pageTips({step:e,renderLocation:"banner_post_comment"}));var t=a("body");t.append(u);t.on("click.postConfirmationTip",function(w){var v=a(w.target);if(!v.closest(".js-onboarding-tip").length||v.hasClass("js-back-to-onb")){t.off("click.postConfirmationTip");k.closeTip();if(v.hasClass("js-back-to-onb")){jive.locationState.setState({},"","get-started")}}});k.emitP("getAllQuestProgressData").addCallback(function(v){jive.switchboard.emit("onboarding.state.update",v)});jive.switchboard.removeListener("activity.stream.comment.created",s)};var p=a("#j-activity-page .j-act-header h1");if(p.length){var r="all-activity";a("body").append(a(jive.onboarding.quests.contribute.pageTips({step:e,renderLocation:"stream_header"})));var q=a('<style type="text/css"> a.j-reply-micro, a.j-reply-rte { background: #e28044; color: #fff !important; font-weight: bold; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; padding: 2px 5px; margin: -2px;} </style>');q.appendTo(p);jive.switchboard.addListener("activity.stream.comment.created",s)}jive.switchboard.removeListener("activity.stream.controller.initialized",f)};jive.switchboard.addListener("activity.stream.controller.initialized",f)}else{if(e=="2"){var f=function(){var p=a("#j-activity-page .j-act-header h1");if(p.length){var t="all-activity",r=jive.ActivityStream.MBController.getMicrobloggingView();jive.ActivityStream.MBController.addListener("submitSuccess",function(){k.closeTip();var v=a(jive.onboarding.quests.contribute.pageTips({step:e,renderLocation:"banner_post_mb"}));var u=a("body");u.append(v);u.on("click.postConfirmationTip",function(x){var w=a(x.target);if(!w.closest(".js-onboarding-tip").length||w.hasClass("js-back-to-onb")){u.off("click.postConfirmationTip");k.closeTip();if(w.hasClass("js-back-to-onb")){jive.locationState.setState({},"","get-started")}}});k.emitP("getAllQuestProgressData").addCallback(function(w){jive.switchboard.emit("onboarding.state.update",w)})});var s=a(jive.onboarding.quests.contribute.pageTips({step:e,renderLocation:"mb_body"}));a("#statusInputs-mb-header-editor").prepend(s);var q=a(jive.onboarding.quests.contribute.pageTips({step:e,renderLocation:"at_mention_btn"})).hide();a("#status-input-actions-mb-header-editor a.jive-js-mention-button").after(q);r.addListener("focus",function(){s.hide();q.show()}).addListener("cancel",function(){s.show();q.hide()})}jive.switchboard.removeListener("activity.stream.controller.initialized",f)};jive.switchboard.addListener("activity.stream.controller.initialized",f)}else{if(e=="3"){if(a("#jive-compose-title").length){var j="create-discussion";a("body").addClass("j-quest-active");var o=a("#create-discussion");o.append('<input type="hidden" name="fromQuest" value="'+k.questID+'" />');o.append('<input type="hidden" name="qstep" value="'+e+'" />');a("#jive-compose-title").prepend(a(jive.onboarding.quests.contribute.pageTips({step:e,renderLocation:"create-subject"})));a("div.jive-editor-panel").prepend(a(jive.onboarding.quests.contribute.pageTips({step:e,renderLocation:"create-body"})));a("#js-people").before(a(jive.onboarding.quests.contribute.pageTips({step:e,renderLocation:"create-publishbar"})));a("#submitButton").before(a(jive.onboarding.quests.contribute.pageTips({step:e,renderLocation:"create-post"})));a("#js-people").click();if(a.browser.msie&&a.browser.version<9){a("#js-people").change()}}else{if(a("#jive-thread-messages-container").length){var j="view-discussion";var i=a(jive.onboarding.quests.contribute.pageTips({step:e,renderLocation:j}));a("#jive-thread-messages-container").prepend(i);var h=a("body");h.on("click.postConfirmationTip",function(r){var p=a(r.target);if(!p.closest(".js-onboarding-tip").length||p.hasClass("js-back-to-onb")){h.off("click.postConfirmationTip");k.closeTip();if(p.hasClass("js-back-to-onb")){var q=jive.app.url({path:"/get-started"});window.location=q}}})}}}else{if(e=="4"){if(a("#create-document").length){var j="create-document",n=a("#create-document");n.append('<input type="hidden" name="fromQuest" value="'+k.questID+'" />');n.append('<input type="hidden" name="qstep" value="'+e+'" />');a("body").addClass("j-quest-active");var d=a("#js-place");d.click();if(a.browser.msie&&a.browser.version<9){d.change()}a("#jive-compose-title").prepend(a(jive.onboarding.quests.contribute.pageTips({step:e,renderLocation:"create-subject"})));a("div.jive-editor-panel").prepend(a(jive.onboarding.quests.contribute.pageTips({step:e,renderLocation:"create-body"})));d.before(a(jive.onboarding.quests.contribute.pageTips({step:e,renderLocation:"create-publishbar"})));a("#submitButton").before(a(jive.onboarding.quests.contribute.pageTips({step:e,renderLocation:"create-post"})))}else{if(window.location.href.indexOf("/docs/DOC")!=-1){j="view-document";i=a(jive.onboarding.quests.contribute.pageTips({step:e,renderLocation:j}));a("div.doc-page").prepend(i);var h=a("body");h.on("click.postConfirmationTip",function(r){var p=a(r.target);if(!p.closest(".js-onboarding-tip").length||p.hasClass("js-back-to-onb")){h.off("click.postConfirmationTip");k.closeTip();if(p.hasClass("js-back-to-onb")){var q=jive.app.url({path:"/get-started"});window.location=q}}})}}}}}}}if(c.indexOf("tools.jspa")!=-1&&a("#jiveanywhere_div").length){k.emit("markStepComplete",k.questID,"5")}};this.closeTip=function(d){var c=this;var e="div.js-onboarding-tip[data-fromq="+c.questID+"]";if(d){e+="[data-location="+d+"]"}var f=a(e);if(f.length){f.each(function(){var h=a(this);var g=h.closest("div.js-pop").length;if(g.length){g.trigger("close");g.remove()}else{h.remove()}})}}})});