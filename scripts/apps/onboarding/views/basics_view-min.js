jive.namespace("Onboarding");define("jive.onboarding.BasicsView",["jquery","jive.filters.ItemGridView","jive.membershipApp.Main","jive.followApp.Main"],function(d,a,b,c){return jive.AbstractView.extend(function(e){this.init=function(g){var f=this;f.questID=g.questID;f.followApp=null};this.postRender=function(g){var f=this;f.$viewHeader=d(g.selector);f.$viewContainer=d(g.selector+"-body");f.$viewContainer.on("click",".js-do-step",function(m){var k=d(this),i=k.closest(".js-quest-step"),l=i.data("step");if(l=="1"){var j=d(jive.onboarding.quests.basics.stepModal({step:l,viewData:{}}));j.lightbox_me({destroyOnClose:true,centered:true,onLoad:function(){f.emit("markStepComplete",f.questID,l)}})}else{f.emitP("getStepData",f.questID,l).addCallback(function(o){var r=d(jive.onboarding.quests.basics.stepModal({step:l,viewData:o}));if(l=="3"&&(o.interests||o.bio)){f.prevInterestsVal=o.interests||"";f.prevBioVal=o.bio||"";f.saveProfileData(f.prevInterestsVal,f.prevBioVal)}else{if(l=="2"){var p=r.find("#j-onb-followable-suggestions");p.delegate("a.js-create-direct-message","click",function(t){t.preventDefault();var s=d(this).closest("[data-object-id]").attr("data-object-id");jive.DirectMessaging.sendMessageToUserIds([s])});var n=p.find(".j-browse-thumbnails");n.css({width:(100*o.suggestedPeople.length)+"%"});if(o.suggestedPeople.length>3){f.scrollPage=1;var q=r.find(".j-onb-scrollarrow").show();q.on("click",function(s){s.preventDefault();f.scrollSuggestions(n,d(s.target),o.suggestedPeople,3)})}}}r.lightbox_me({destroyOnClose:true,centered:true,onLoad:function(){f.emit("markStepComplete",f.questID,l);var t=d("#j-onb-followable-suggestions");if(!f.followApp){f.followApp=new c({i18n:null})}f.itemGridView=new a({baseSelector:"#j-onb-followable-suggestions",noInitVGrid:true});if(l=="3"){d("#j-onb-interests").placeHeld();d("#j-onb-bio").placeHeld();var u=new jive.TypeaheadInput("#j-onb-interests",{delay:500}),s=new jive.TypeaheadInput("#j-onb-bio",{delay:500});u.addListener("change",f.typeAheadChangeDetected.bind(f)).addListener("clear",f.typeAheadChangeDetected.bind(f));s.addListener("change",f.typeAheadChangeDetected.bind(f)).addListener("clear",f.typeAheadChangeDetected.bind(f))}r.on("click",".js-follow-these",function(w){w.preventDefault();var v=[];r.find(".j-thumb-back").each(function(){var B=d(this),x=B.find(".j-js-follow-controls");if(!x.length){x=B.find(".js-follow-user-link");var A=x.find("a.js-follow")}else{A=x.find(".start-follow a")}if(A.length&&A.css("display")!="none"){var D=A.closest(".js-browse-thumbnail"),y=D.data("object-type"),C=D.data("object-id"),z=x.data("streamsassoc");v.push({objectType:y,id:C,itemStreamCounts:z})}});if(v.length){f.emitP("followObjects",v,l).addCallback(function(F){for(var C=0,G=F.length;C<G;C++){var B=F[C],I=B.streams,J=d(".js-browse-thumbnail[data-object-type="+B.associatedObjectType+"][data-object-id="+B.associatedObjectID+"]"),E=J.find(".j-js-follow-controls");if(!E.length){E=J.find(".js-follow-user-link");var y=E.find("a.js-follow"),x=E.find("a.js-following")}else{y=E.find(".start-follow a");x=E.find(".following a")}y.hide();var A=E.data("streamsassoc");var H=0;for(var z=0,D=I.length;z<D;z++){if(I[z].selected){H++}}if(H!=A){E.data("streamsassoc",H);x.find(".j-js-streams-assoc-count").replaceWith(jive.people.profile.streamsAssociatedCount({count:H,renderLocation:E.data("location")}))}x.show();if(E.find(".j-js-friend-list-chooser-container")){E.find("a.js-connection-label-btn").show()}}r.find(".js-done-following").show()})}})},onClose:function(){f.followApp.tearDown();if(f.membershipApp){f.membershipApp.tearDown()}f.followApp=null;f.membershipApp=null}})})}m.preventDefault()});var h=function(k){for(var l=0,j=k.quests[0].steps.length;l<j;l++){var m=k.quests[0].steps[l],n=m.id,o=f.$viewContainer.find("div.js-quest-step[data-step="+n+"] .js-do-step");if(m.state=="completed"){o.addClass("completed")}}};jive.switchboard.removeListener("onboarding.state.update",h).addListener("onboarding.state.update",h)};this.scrollSuggestions=function(f,i,h,j){var g=this;if(!i.hasClass("disabled")&&!g.scrolling){g.scrolling=true;var l=-1;if(!i.hasClass("next")){l=1}g.scrollPage=g.scrollPage-l;var k=(f.find("li").first().outerWidth(true)*j*(g.scrollPage-1)*-1);f.css({left:k+"px"});if(Math.ceil(h.length/j)==g.scrollPage){d(".j-onb-scrollarrow.next").addClass("disabled");d(".j-onb-scrollarrow.prev").removeClass("disabled")}else{if(g.scrollPage==1){d(".j-onb-scrollarrow.next").removeClass("disabled");d(".j-onb-scrollarrow.prev").addClass("disabled")}else{d(".j-onb-scrollarrow.next").removeClass("disabled");d(".j-onb-scrollarrow.prev").removeClass("disabled")}}setTimeout(function(){g.scrolling=false},500)}};this.typeAheadChangeDetected=function(){var h=this,j=d("#j-onb-interests"),i=d("#j-onb-bio"),g=j.val(),k=i.val();if(g!=h.prevInterestsVal||k!=h.prevBioVal){if(g.length>3500){d(".j-onboarding-prof-maxchars").hide();var f=d(jive.onboarding.quests.basics.tooManyCharsError());j.after(f);f.delay(2000).fadeOut("slow")}else{if(k.length>3500){d(".j-onboarding-prof-maxchars").hide();f=d(jive.onboarding.quests.basics.tooManyCharsError());i.after(f);f.delay(2000).fadeOut("slow")}else{h.saveProfileData(g,k)}}}};this.saveProfileData=function(j,g){var f=this,i=false;if(j!=f.prevInterestsVal||g!=f.prevBioVal){f.prevInterestsVal=j;f.prevBioVal=g;i=true}var h=d("#j-profile-spinner");h.show();f.emitP("updateUserProfile",j,g).addCallback(function(n){var o=d("#j-onb-profile-recos"),m=o.find(".j-onb-scrollarrow"),l=o.find("#j-onb-followable-suggestions");if(n&&n.suggestedPlaces&&n.suggestedPlaces.length&&(j||g)){l.html(jive.browse.grid.itemGrid({itemViewID:"thumb",browseViewID:"j-onb-followable-suggestions",itemGridDetailsColumns:{},hierarchyViewSupported:false,items:n.suggestedPlaces}));f.membershipApp=new b({});if(n.suggestedPlaces.length==1){l.find("ul.j-browse-thumbnails").append(jive.onboarding.quests.basics.placeholderItem())}var k=l.find(".j-browse-thumbnails");k.css({width:(100*Math.ceil(n.suggestedPlaces.length/2))+"%"});m.off("click").on("click",function(p){p.preventDefault();f.scrollSuggestions(k,d(p.target),n.suggestedPlaces,2)});if(n.suggestedPlaces.length>2){f.scrollPage=1;d(".j-onb-scrollarrow.next").removeClass("disabled");d(".j-onb-scrollarrow.prev").addClass("disabled");m.show()}else{m.hide()}o.fadeIn("fast")}else{if(j||g){m.hide();l.html(jive.onboarding.quests.basics.noSuggestions({type:n.suggestedPlacesExist?"possibleSuggestionsExist":"noPossibleSuggestionsExist"}))}else{m.hide();l.html(jive.onboarding.quests.basics.noSuggestions({type:"placeholder"}))}}h.hide();if(i){d("#j-onboarding-saved").show().delay(2000).fadeOut("slow")}})}})});