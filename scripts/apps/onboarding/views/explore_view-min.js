jive.namespace("Onboarding");define("jive.onboarding.ExploreView",["jquery"],function(a){return jive.AbstractView.extend(function(b){this.init=function(d){var c=this;c.questID=d.questID;c.setupPageTips(d.queryParams);jive.locationState.addListener("change",c.setupPageTips.bind(c))};this.postRender=function(d){var c=this;c.$viewHeader=a(d.selector);c.$viewContainer=a(d.selector+"-body");c.instanceName=d.instanceName;c.$viewContainer.on("click","#j-explore-step-1-trigger",function(f){c.showTourTip(0);f.preventDefault()}).on("click","#j-explore-step-3-trigger",function(f){$j("html, body").animate({scrollTop:0},"fast");jive.locationState.setState({fromQ:c.questID,qstep:"3"},"","activity");f.preventDefault()}).on("click","#j-explore-step-5-trigger",function(f){c.emitP("getStepData",c.questID,"5").addCallback(function(g){if(g.oAuthEnabled){var h=jive.app.url({path:g.mobileUrl});h=a.param.querystring(h,{fromQ:c.questID,qstep:5});window.location=h}else{c.popMobileTaskModal(g)}});f.preventDefault()});var e=function(g){for(var h=0,f=g.quests[1].steps.length;h<f;h++){var j=g.quests[1].steps[h],k=j.id,l=c.$viewContainer.find("div.js-quest-step[data-step="+k+"] .js-do-step");if(j.state=="completed"){l.addClass("completed")}}};jive.switchboard.removeListener("onboarding.state.update",e).addListener("onboarding.state.update",e)};this.showTourTip=function(g){var k=this,f=a(jive.onboarding.quests.explore.tourTip({index:g,instanceName:k.instanceName})),e=a("body");if(g==7){k.emit("markStepComplete",k.questID,"1")}var c=a("#onboarding-tour");if(c.length){a("#j-onb-tour-arrow").remove();c.html(f.html());e.removeClass("j-onb-tour-"+(g-1)+" j-onb-tour-"+(g+1));var i=c.find("#j-onb-tour-arrow").detach();if(i.length){var j,d,h;switch(g){case 1:h=a("#jive-nav-link-home");j=h.offset().top-40;d=h.offset().left+h.width()-35;i.offset({top:j,left:d});break;case 2:h=a("#navCreate");j=h.offset().top-40;d=h.offset().left+h.width()-35;i.offset({top:j,left:d});break;case 3:h=a("#jive-nav-link-activity");j=h.offset().top-27;d=h.offset().left-30;i.offset({top:j,left:d});break;case 4:h=a("#jive-nav-link-connections");j=h.offset().top-27;d=h.offset().left-30;i.offset({top:j,left:d});break;case 5:h=a("#jive-nav-link-communications");j=h.offset().top-27;d=h.offset().left-30;i.offset({top:j,left:d});break;case 6:h=a("#jive-nav-link-actions");j=h.offset().top-22;d=h.offset().left-30;i.offset({top:j,left:d});break}a("body").append(i.css("position","absolute").show())}c.off("click.pagination").on("click.pagination",".js-prev-tip",function(l){l.preventDefault();k.showTourTip(g-1)}).on("click.pagination",".js-next-tip",function(l){l.preventDefault();k.showTourTip(g+1)})}else{f.lightbox_me({destroyOnClose:true,modalCSS:{top:"120px"},showOverlay:false,onClose:function(){e.removeClass("j-onb-tour-0 j-onb-tour-1 j-onb-tour-2 j-onb-tour-3 j-onb-tour-4 j-onb-tour-5 j-onb-tour-6 j-onb-tour-7");a("#j-onb-tour-arrow").remove()},onLoad:function(){f.on("click.pagination",".js-next-tip",function(l){l.preventDefault();k.showTourTip(g+1)})}})}$j("html, body").animate({scrollTop:0},"fast");e.addClass("j-onb-tour-"+g)};this.setupPageTips=function(j,h,e){var c=this,f=j.fromQ,g=j.qstep||"1";if(f==c.questID){if(g=="3"){var d=function(){var m=function(p,o,s){if(p){c.closeTip();l.remove();$j("html, body").animate({scrollTop:0},"fast");var r=$j(jive.onboarding.quests.explore.pageTips({step:g,renderLocation:"banner_post_like"}));var q=a("body");q.append(r);q.on("click.postConfirmationTip",function(u){var t=a(u.target);if(!t.closest(".js-onboarding-tip").length||t.hasClass("js-back-to-onb")){q.off("click.postConfirmationTip");c.closeTip();if(t.hasClass("js-back-to-onb")){jive.locationState.setState({},"","get-started")}}});c.emitP("getAllQuestProgressData").addCallback(function(t){jive.switchboard.emit("onboarding.state.update",t)});jive.switchboard.removeListener("acclaim.recorded",m)}};var k=$j("#j-activity-page .j-act-header h1");if(k.length){var n="all-activity";a("body").append($j(jive.onboarding.quests.explore.pageTips({step:g,renderLocation:"stream_header"})));var l=$j('<style type="text/css"> a.jive-acclaim-likelink.like{ background: #e28044; color: #fff !important; font-weight: bold; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; padding: 2px 5px; margin: -2px;} </style>');l.appendTo(k);jive.switchboard.addListener("acclaim.recorded",m)}jive.switchboard.removeListener("activity.stream.controller.initialized",d)};jive.switchboard.addListener("activity.stream.controller.initialized",d)}else{if(g=="4"){if($j("body.j-body-yourplaces").length){var i="places";$j("#jive-body").prepend($j(jive.onboarding.quests.explore.pageTips({step:g,renderLocation:"places"})));var e=jive.app.url({path:"/create-group!input.jspa"});$j("#js-onboarding-create-group-link").attr("href",e);jive.switchboard.addListener("sgroup.member.join",function(){$j("#js-join-tip").remove();var k=$j(jive.onboarding.quests.explore.pageTips({step:g,renderLocation:"places-success"}));$j("#jive-body").prepend(k);k.on("click",".js-back-to-onb",function(){var l=jive.app.url({path:"/get-started"});window.location=l})})}}}}};this.popMobileTaskModal=function(d){var c=this;var e=$j(jive.onboarding.quests.explore.mobileModal({url:d.mobileUrl}));var f={closeSelector:".close",modalCSS:{top:"100px"},destroyOnClose:true};e.lightbox_me(f);e.delegate(".js-qr-code-whats-this","click",function(g){g.preventDefault();if(c.whatsThisVisible){c.hideWhatsThisMessage()}else{c.showWhatsThisMessage($j(this))}})};this.closeTip=function(d){var c=this;var e="div.js-onboarding-tip[data-fromq="+c.questID+"]";if(d){e+="[data-location="+d+"]"}var f=$j(e);if(f.length){f.each(function(){var h=$j(this);var g=h.closest("div.js-pop").length;if(g.length){g.trigger("close");g.remove()}else{h.remove()}})}}})});