jive.namespace("Trial");define("jive.trial.PanelView",["jquery"],function(a){return jive.AbstractView.extend(function(b){jive.conc.observable(this);this.init=function(f){var d=this;this.trialBannerID="#jive-trial-banner";this.trialPanelID="#jive-trial-panel";this.trialLoadingID="#jive-trial-panel-loading";this.trialHelpLinkID="#jive-trial-help-link";this.trialHelpPanelID="#jive-trial-help-panel";this.trialProgress=f.trialProgress;var g=$j(d.trialBannerID),j=$j(d.trialPanelID),e=$j(d.trialHelpLinkID),h=$j(d.trialHelpPanelID);if(g){g.click(function(k){if(jive.Trial.ModalController){jive.Trial.ModalController.closeModal()}if(h.is(".j-active")){$j("#jive-trial-curtain, #jive-trial-help-panel").removeClass("j-active");b.setJiveHelpCopy(true)}if(j.is(".j-active")){d.closePanel()}else{d.loadPanel()}k.preventDefault()});$j(document).delegate("a[data-showq]","click",function(l){var k=$j(this).data("showq");$j("div.js-trial-tip").remove();$j("html, body").animate({scrollTop:0},"fast",null,function(){d.loadPanel(k)});l.preventDefault()});if(d.trialProgress.questCompletionTips.userTips.length){d.showProgressTips(d.trialProgress.questCompletionTips)}if(d.trialProgress.newProgress>0){var i=$j("#j-trial-progress-bar-completed");d.emit("saveProgress",d.trialProgress.newestItemTime);d.flashProgressUpdate(i,3,d.trialProgress.newProgress)}}if(e){e.click(function(){j.is(".j-active")&&d.closePanel();var k=h.is(".j-active");$j("#jive-trial-help-link").toggleClass("open",!k);$j("#jive-trial-curtain, #jive-trial-help-panel").toggleClass("j-active",!k);b.setJiveHelpCopy(k);k||e.find(".j-js-chat-indicator").hide();return false})}$j("#jive-trial-help-panel a").click(function(k){k.preventDefault();window.open(this.getAttribute("href"))});$j("#jive-trial-help-panel iframe").load(function(){this.contentWindow.jQuery("body").on("onMessageToVisitor",function(){if(!$j("#jive-trial-help-panel").is(".j-active")){$j("#jive-trial-help-link .j-js-chat-indicator").show()}})});$j("#jive-trial-help-panel .close").click(function(k){k.preventDefault();e.click()})};this.loadPanel=function(e){var d=this,f=$j(d.trialPanelID);d.emitP("loadPanel").addCallback(function(g){if(e){g.lastViewedQuest=null}f.empty().append(jive.trial.panel({data:g}));d.initPanelJavascript(g);$j("#jive-trial-curtain, #jive-trial-panel, #jive-trial-banner").addClass("j-active");if(e){$j("div.j-goal-nav a[data-questname="+e+"]").click()}})};this.closePanel=function(){var d=this,e=$j(d.trialPanelID);$j("#jive-trial-curtain, #jive-trial-panel, #jive-trial-banner").removeClass("j-active");d.videoTeardown();e.empty()};this.initPanelJavascript=function(e){var h=this,l=$j(".j-panel.trial .j-goal-container"),d=$j(".j-goals",l),g=$j("div.section",l),k=g.length,i=100;if(k>0){h.trialVideos=[];h.trialVideos.push(Wistia.embed("6f7950d404",{videoWidth:"570",videoHeight:"365",controlsVisibleOnLoad:true}));h.trialVideos.push(Wistia.embed("b8c47e6cac",{videoWidth:"570",videoHeight:"365",controlsVisibleOnLoad:true}));h.trialVideos.push(Wistia.embed("a26f53f98e",{videoWidth:"570",videoHeight:"365",controlsVisibleOnLoad:true}));h.trialVideos.push(Wistia.embed("9a4efbeb33",{videoWidth:"570",videoHeight:"365",controlsVisibleOnLoad:true}));d.css({width:(100*k)+"%"});g.css({width:(100/k)+"%"});if(e.lastViewedQuest){var j=$j("div.j-goal-nav").find("a[data-questname="+e.lastViewedQuest+"]");var f=j.parent("li").index();h.goToPane(f,d,i)}$j("div.j-goal-nav").delegate("a","click",function(n){var m=$j(this).parent("li").index();h.goToPane(m,d,i);h.pauseVideos();$j(".j-active",$j(".j-goal-nav")).removeClass("j-active");$j(this).parent("li").addClass("j-active");h.emit("saveLastViewedQuest",$j(this).data("questname")+"");n.preventDefault()});$j("div.j-quest-tasks").delegate("li.j-available","click",function(m){if(!$j(m.target).is("a")){m.preventDefault();var n=$j(this).data("stepaction");if(n){switch(n){case"mobile_modal":h.popMobileTaskModal();break;default:window.location=n}}}}).delegate("a.j-js-show-grouped-users","click",function(n){var o=$j(this),m=$j("div.j-js-grouped-users[data-linkedID="+o.attr("data-linkedID")+"]");m.popover({context:o,destroyOnClose:false});m.closest("div.js-pop").css({"z-index":1004});n.preventDefault()})}$j(document).bind("click.trialPanelOpen",function(n){var m=$j(n.target);if(!m.closest("#jive-trial-panel").length&&!m.closest("div.jive-tooltip2").length&&!m.closest("div.js-pop").length&&!m.closest("div.jive-modal").length&&!m.closest("div.js_lb_overlay").length){h.closePanel();$j(document).unbind("click.trialPanelOpen")}})};this.pauseVideos=function(){var d=this,f=d.trialVideos.length;for(var e=0;e<f;e++){d.trialVideos[e].pause()}};this.videoTeardown=function(){var d=this,f=d.trialVideos.length;for(var e=0;e<f;e++){d.trialVideos[e].remove()}};this.goToPane=function c(h,g,e){g.css({left:-(e*($j(this.trialPanelID+" div.section").eq(h).index()))+"%"});var d=$j(this.trialPanelID+" div.j-goal-nav li").eq(h),f=$j(this.trialPanelID+" span.selectedArrow");f.css({left:d.position().left+(d.width()/2)-(f.width()/2)+"px"})};this.updateProgressBar=function(f){var d=this,e=$j("#jive-trial-banner div.j-progress-bar-container"),g=$j("#j-trial-progress-bar-completed");d.emit("saveProgress",f.newestItemTime);if(g.is(":animated")){g.stop().clearQueue()}e.data("currentprogress",f.currentProgress);e.find(".js-displayed-percent").text(f.currentProgress+"%");g.title=f.currentProgress;if(f.questCompletionTips.userTips.length){d.showProgressTips(f.questCompletionTips)}d.flashProgressUpdate(g,3,f.newProgress)};this.flashProgressUpdate=function(e,j,i,f){var d=this;if(f==undefined){f=0}var h=e.width();var g=Math.round(e.closest(".j-index-holder").width()*(i/100));if(f<j){e.delay(400).animate({width:"+="+g},0).delay(400).animate({width:"-="+g},0,null,function(){d.flashProgressUpdate(e,j,i,f+1)})}else{e.width(h+g)}};this.showProgressTips=function(h){var d=this,e=null;if(h.userTips.length){$j("div.js-trial-tip").remove();for(var g=0,f=h.questCompletionData.length;g<f;g++){if(!h.questCompletionData[g].completed){e=h.questCompletionData[g].questID;break}}}for(g=0,tipsLength=h.userTips.length;g<tipsLength;g++){if(h.userTips[g]!="jive.trial.quests.fewerMeetings.questReadyToComplete"||tipsLength==1){var j=$j(jive.trial.renderProgressTip({template:h.userTips[g],nextQuestID:e}));j.delegate("#quest-complete-close","click",function(i){i.preventDefault();$j("div.js-trial-tip").remove()});$j(d.trialBannerID).after(j);d.emit("clearUserTipQueue")}}$j("html, body").animate({scrollTop:0},"fast");$j(d.trialBannerID).one("click",function(){$j("div.js-trial-tip").remove()})};this.popMobileTaskModal=function(){var d=this;var e=$j(jive.trial.quests.stayInTouch.mobileModal({}));var f={closeSelector:".close",modalCSS:{top:"100px"},destroyOnClose:true};e.lightbox_me(f);e.delegate(".js-qr-code-whats-this","click",function(g){g.preventDefault();if(d.whatsThisVisible){d.hideWhatsThisMessage()}else{d.showWhatsThisMessage($j(this))}})};b.setJiveHelpCopy=function(d){var e=d?jive.trial.openHelp():jive.trial.closeHelp();$j("#jive-trial-help-link .j-js-title").text(e)};b.showWhatsThisMessage=function(e){var d=this;this.whatsThisVisible=true;$j("#js-qr-code-whats-this").popover({context:e,destroyOnClose:false,onClose:function(){d.whatsThisVisible=false}})};b.hideWhatsThisMessage=function(){$j("#js-qr-code-whats-this").trigger("close")}})});