jive.namespace("Trial");define("jive.trial.PanelMain",["jquery","jive.trial.PanelView","jive.trial.TipHelper","jive.trial.PanelSource"],function(c,d,a,b){return jive.oo.Class.extend(function(e){this.init=function(g){var f=this;this.daysRemaining=g.daysRemaining;this.trialAdmin=g.trialAdmin;this.trialAdminData=g.trialAdminData;this.instanceURL=g.instanceURL;this.communityName=g.communityName;this.initActiveQuestID();this.trialView=new d(g);this.trialTipHelper=new a(g);this.trialSource=new b();this.trialView.addListener("loadPanel",function(h){f.trialSource.get("panel").addCallback(function(i){i.daysRemaining=f.daysRemaining;i.trialAdmin=f.trialAdmin;i.trialAdminData=f.trialAdminData;i.instanceURL=f.instanceURL;h.emitSuccess(i)})}).addListener("saveLastViewedQuest",function(h){f.trialSource.saveLastViewedQuest(h)}).addListener("saveProgress",function(h){f.trialSource.saveProgress(h)}).addListener("clearUserTipQueue",function(){f.trialSource.clearUserTipQueue()});this.trialTipHelper.addListener("shouldSetupPage",function(h,i,j){j.addCallback(function(k){if(k){f.activeQuestID=h;f.activeQuestStep=i}else{f.initActiveQuestID()}});f.trialSource.getShouldShowTips(h,i,j)}).addListener("clearActiveQuest",function(){f.initActiveQuestID()}).addListener("getAllQuestProgressData",function(h){f.trialSource.get("panel").addCallback(function(i){h.emitSuccess(i)})});jive.dispatcher.listen("trial.updatePercentComplete",function(){f.trialSource.get("percentComplete").addCallback(function(h){if(h.newProgress>0){jive.switchboard.emit("trial.updatePercentComplete",h)}})});jive.switchboard.addListener("trial.updatePercentComplete",function(h){f.updateProgressBar(h)});if(g.showTrialPanelImmediately){this.trialView.loadPanel()}};e.initActiveQuestID=function(){this.activeQuestID="";this.activeQuestStep=null};e.updateProgressBar=function(f){this.trialView.updateProgressBar(f)};this.getActiveQuestAndStep=function(){return{activeQuestID:this.activeQuestID,activeQuestStep:this.activeQuestStep}}})});