jive.namespace("Activity.Info");jive.Activity.Info.ActivityInfoView=jive.AbstractView.extend(function(a){var c=jQuery;function b(d){return d==="bookmark"}this.init=function(e){var d=this;this.$modal=null;this.pageSize=e.pageSize;this.soyParams={};this.renderModal=function(f){return $j(jive.soy.acclaim.renderAcclaimModal(f))};this.handleFollow=function(h){if(this.$modal){var g=this.$modal.find("table.js-everyone-list, table.js-friends-list"),f="tr[data-user-id="+h.id+"]";if(!g.eq(1).find(f).length){g.eq(0).find(f).clone().prependTo(g.eq(1).find("tbody"))}}};jive.switchboard.addListener("follow.user.complete",this.handleFollow.bind(this))};this.showUsers=function(d,i){var e=this,g={centered:true,destroyOnClose:true,onClose:function(){$j(".js-pop").remove()}};this.soyParams=a.buildSoyParams(d,i);this.$modal&&this.$modal.remove();var f=this.renderModal(this.soyParams);if(b(d.activityType)){var h=jive.soy.acclaim.privateBookmarkNotification();f.find("table.js-everyone-list tbody").each(function(){$j(this).append(h)})}this.$modal=f.lightbox_me(g);this.$modal.find("#jive-view-picker input:checkbox").click(function(){var j=$j("#jive-view-picker input:checked");var k=0;if(j.length==1){k=j.val()}else{if(j.length==2){k=3}}e.$modal.find("table").hide();e.$modal.find("table").eq(k).show()});this.$modal.find(".jive-modal-content").endlessScroll({fireDelay:false,callback:function(j){if(e.soyParams.moreResults){e.emitP("loadUsersFromIndex",i,e.pageSize*j).addCallback(function(k){e.soyParams.moreResults=k.moreResults;e.appendUsers(k)})}}})};this.appendUsers=function(e){var j=e&&e.items?e.items:[];if(j.length>0){this.$modal.find(".j-js-private-bookmark-notification").remove();var d=this.$modal.find(".jive-modal-content tbody:visible");var g=d.parent().attr("id");var h=this.renderModal($j.extend({},this.soyParams,{users:j}));var f=h.find("table#"+g+" tr");d.append(f.clone());if(b(this.soyParams.activityType)){var i=jive.soy.acclaim.privateBookmarkNotification();d.append(i)}}};a.buildSoyParams=function(d,e){return{activityType:e.activityType,bidirectionalGraph:d.bidirectionalGraph,currentUserID:d.currentUserID,currentUserPartner:d.currentUserPartner,moreResults:d.moreResults,objectID:e.objectID,objectType:e.objectType,totalCount:d.totalCount,users:d.items,youID:e.youID||d.currentUserID,youPartner:e.youPartner||d.currentUserPartner}}});