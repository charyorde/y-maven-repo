jive.namespace("ActivityStream");jive.ActivityStream.ActivityStreamItemView=jive.ActivityStream.StreamItemCommonView.extend(function(a,b){this.init=function(c){b.init.call(this,c);this.hideData={objectType:parseInt(this.hideDataArr[1],10),objectID:parseInt(this.hideDataArr[2],10),containerType:parseInt(this.hideDataArr[3],10),containerID:parseInt(this.hideDataArr[4],10)};this.subActivitiesByDomID={};this.originalCommentIDs=[];this.activityListLength=this.data.activityList.length;for(var d=this.activityListLength-1;d>=0;d--){this.subActivitiesByDomID[this.data.activityList[d].content.domIDPostfix]=this.data.activityList[d]}this.fullRepliesLoaded=false;this.autoFilledOnExpand=false;this.fullContentContainerInitialized=false;this.replacedCollapsedActivity=null;this.rteLoading=false};this.getSoyTemplate=function(c){return jive.eae.activitystream.groupedActivityStreamItem(c)};this.handleClick=function(J,s,j){var G=this,m=$j(J.target),w=false,p=G.getContent();if(s.filter(".j-expand-comments").length){G.expandClickHandler(s.filter(".j-expand-comments").first(),J)}else{if(m.hasClass("j-reply-rte")){var D=new jive.conc.Promise();G.replyRTE(m,s,D,j)}else{if(s.filter("a.j-js-show-full-act").length){v=s.filter("a.j-js-show-full-act").first();var K=v.closest(".j-act-node"),l=K.attr("id"),z=l.split("-")[l.split("-").length-1],d=G.subActivitiesByDomID[z],E=K.attr("data-objectid"),B=K.attr("data-objecttype"),A=K.find("div.j-excerpt-full-html-content"),n=K.find("div.j-act-sub-preview"),r=K.find("div.j-excerpt"),k=$j(jive.eae.common.loadingSpinner());v.closest(".j-act-preview-control").after(k);if(d&&d.parentActivity){k.remove();p.find(".j-js-show-full-content").click()}else{K.addClass("j-expanded");if(A.html()){n.show();r.hide();k.remove()}else{G.emit("getFullContent",{objectType:B,objectID:E,containerType:"",containerID:""},function(e){A.html(e.html);k.remove();r.hide();jive.rte.renderedContent.emit("renderedContent",n);n.show()})}v.closest(".j-act-preview-control").addClass("j-previewing")}}else{if(s.filter("a.j-js-hide-full-act").length){v=s.filter("a.j-js-hide-full-act").first();K=v.closest(".j-act-node");n=K.find("div.j-act-sub-preview");r=K.find("div.j-excerpt");v.closest(".j-act-preview-control").removeClass("j-previewing");K.removeClass("j-expanded");n.hide();r.show()}else{if(s.filter("a.j-js-show-full-content").length){v=s.filter("a.j-js-show-full-content").first();B=v.attr("data-objectType");E=v.attr("data-objectID");var u=v.attr("data-containerType"),t=v.attr("data-containerID"),o=p.find("div.js-full-content-container");if(!G.fullContentContainerInitialized){o.html(jive.eae.activitystream.activityStreamFullContentView({activityContainer:G.data,user:G.viewingUserData,streamType:G.streamType,filterType:G.filterType,canCreateMbImage:G.canCreateMbImage,canCreateMbVideo:G.canCreateMbVideo,mbCreationModerated:G.mbCreationModerated}));G.fullContentContainerInitialized=true}var x=p.find("div.js-full-content-body");k=$j(jive.eae.common.loadingSpinner());v.before(k);if(!x.html()){v.hide();G.emit("getFullContent",{objectType:B,objectID:E,containerType:u,containerID:t},function(P){var R=p.find("div.j-act-coll-view");if(R.length){var O=R.children(".j-act-node"),M=O.length;for(var Q=0;Q<M;Q++){var T=$j(O[Q]),N=T.attr("id"),L=G.subActivitiesByDomID[N.split("-")[N.split("-").length-1]];if(T.is(":visible")&&L&&L.parentActivity&&!T.children("div.j-js-collapsed").hasClass("j-mod")){T.hide()}}}x.html(P.html);if(P.extraData.poll){G.initPollView(P.extraData,o)}else{if(P.extraData.questionData&&(P.extraData.questionData.correctAnswer||P.extraData.questionData.helpfulAnswers.length)){var e={open:"open",resolved:"resolved",assumed_resolved:"assumed_resolved"},S=$j(jive.discussions.soy.qDisplayInlineAnswers({question:P.extraData.questionData,questionStateEnum:e,i18n:{correctAnswer:jive.eae.common.jsI18nHelper({key:"forum.thrd.correct_answer.link"}),byWord:jive.eae.common.jsI18nHelper({key:"global.by"}),onWord:jive.eae.common.jsI18nHelper({key:"global.on"}),helpfulAnswers:jive.eae.common.jsI18nHelper({key:"question.helpfulAnswers.text"}),helpfulAnswer:jive.eae.common.jsI18nHelper({key:"forum.thrd.helpful_answer.link"}),seeThisAnswer:jive.eae.common.jsI18nHelper({key:"question.seeThisAnswer.text"})},currentUserPartner:_jive_current_user.partner}));x.append(S)}}o.show();k.remove();v.next("a.j-js-hide-full-content").show();p.addClass("j-act-tl-preview");jive.rte.renderedContent.emit("renderedContent",o)})}else{I=p.find("div.j-act-coll-view");if(I.length){y=I.children(".j-act-node");F=y.length;for(H=0;H<F;H++){g=$j(y[H]);c=g.attr("id");q=G.subActivitiesByDomID[c.split("-")[c.split("-").length-1]];if(g.is(":visible")&&q&&q.parentActivity&&!g.children("div.j-js-collapsed").hasClass("j-mod")){g.hide()}}}o.show();v.hide();v.next("a.j-js-hide-full-content").show();k.remove();p.addClass("j-act-tl-preview")}}else{if(s.filter("a.j-js-hide-full-content").length){var v=s.filter("a.j-js-hide-full-content").first();o=p.find("div.js-full-content-container");o.hide();p.find("a.j-js-hide-full-content").each(function(){if($j(this).prev("a.j-js-show-full-content").length){$j(this).hide()}});p.removeClass("j-act-tl-preview");var I=p.find("div.j-act-coll-view");if(I.length){var y=I.children(".j-act-node"),F=y.length;for(var H=0;H<F;H++){var g=$j(y[H]),c=g.attr("id"),q=G.subActivitiesByDomID[c.split("-")[c.split("-").length-1]];if(!g.is(":visible")&&!p.find("div.j-act-exp-view").is(":visible")&&q&&q.parentActivity&&!g.children("div.j-js-collapsed").hasClass("j-mod")){g.show()}}}p.find("a.j-js-show-full-content").show()}else{if(m.hasClass("j-act-hidemenu")){var f=m;p.addClass("j-js-hide-popover-showing j-hide-popover-showing");G.emit("unhidemenu",G.hideData,function(e){var L=false;if(e.exclusionRules.item||e.exclusionRules.context||e.exclusionRules["type-context"]){L=true}var i=$j(jive.eae.activitystream.hideUnhideMenu({activityContainer:G.data,streamType:G.streamType,alreadyHidden:L}));i.find("a.j-act-hidelink").click(function(M){G.emit("hide","item",G.hideData,true);i.trigger("close");M.preventDefault()});i.find("a.j-js-hide").click(function(N){var M=$j(this);if(M.hasClass("j-js-context")){G.emit("hide","context",G.hideData,true)}else{if(M.hasClass("j-js-type-from-context")){G.emit("hide","type-context",G.hideData,true)}}i.trigger("close");N.preventDefault()});i.popover({context:f,darkPopover:true,onClose:function(){p.removeClass("j-js-hide-popover-showing j-hide-popover-showing")}})})}else{if(s.filter("a.j-js-show-older").length){v=s.filter("a.j-js-show-older").first();var C=p.find("div.j-act-exp-view"),h=C.clone(true);if(!v.hasClass("j-js-loading")){v.addClass("j-js-loading");v.append(jive.eae.common.loadingSpinner());G.fillInMyGaps(h,function(){h.hide();C.after(h);C.remove();h.show();var e=h.find(".j-js-slide-in");if(e.length){e.show();var i=h.find("div.j-js-sub-act-to-show");i.unwrap();i.removeClass("j-js-sub-act-to-show")}v.removeClass("j-js-loading");v.find(".j-loading-spinner").remove()})}}else{w=G.handleClickCommon(m,J,s,p)}}}}}}}}if(w&&jive.rte.mobileUI&&J.type=="touchend"&&!G.getContent().hasClass("j-act-active")&&G.getContent().find(".j-expand-comments").length){G.expandClickHandler(G.getContent().find(".j-expand-comments").first(),J)}$j(".j-act-entry").removeClass("j-act-active");p.addClass("j-act-active");return w};this.postRender=function(){var d=this,c=this.getContent();if(d.data.jiveObject.typeWallEntry){var e="collapsed-attachmentContainer-"+d.data.jiveObject.domIDPostfix;if(e in jive.MicroBlogging.AttachmentView.views){jive.MicroBlogging.AttachmentView.views[e].resize()}}jive.rte.renderedContent.emit("renderedContent",c)};this.expandClickHandler=function(g,p){var i=this,q=g;if(!q.hasClass("j-js-loading")){q.addClass("j-js-loading");var f=q.closest("div.j-act-entry"),j=$j(jive.eae.common.loadingSpinner()),n=f.find("div.j-act-exp-view"),l=f.hasClass("j-act-grouped"),c=f.attr("data-objectType"),d=f.attr("data-objectID"),r=f.attr("data-containerType"),s=f.attr("data-containerID"),m;q.find(".jive-icon-arrow-down-focus").hide().after(j);if(l){var k=null,t=f.find("li.j-act-g-item").filter(function(){var u=$j(this),e=u.data("timestamp");if(!k||e<k){k=e}return $j(this).css("display")=="none"}),o=t.length,h=5;if(o){t.show();h=((5-o)>0?(5-o):0)}if(h){i.emitP("fillInStreamItem",c,d,k,h).addCallback(function(e){f.find(".j-act-g-list").append(i.buildExpandedView({activityList:e.items,jiveObject:{expandedActivityStreamViewTemplate:i.data.jiveObject.expandedActivityStreamViewTemplate}}));if(!e.hasMore){f.find("div.j-preview-trigger").remove()}f.addClass("j-js-expanded j-act-expanded");j.remove();q.find(".jive-icon-arrow-down").show();q.removeClass("j-js-loading")})}else{f.addClass("j-js-expanded j-act-expanded");j.remove();q.find(".jive-icon-arrow-down").show();q.removeClass("j-js-loading")}}else{if(n.length&&!n.html()){m=i.buildExpandedView(i.data)}else{m=n.clone(true)}i.getFullReplies(m,function(){if(m.length){var e=f.find("a.j-show-more"),w=m.find(".j-sub-activity-items");if(m.css("display")=="none"){var u=w.children(".j-act-node");if(i.data.jiveObject.objectType!=1500&&!i.data.jiveObject.typeTask&&!i.autoFilledOnExpand){i.fillInMyGaps(m,function(){i.autoFilledOnExpand=true;i.switchExpandedCollapsedViews("expanded",m);q.removeClass("j-js-loading");j.remove();q.find(".jive-icon-arrow-down").show()})}else{if(i.data.jiveObject.objectType==1500||i.data.jiveObject.typeTask){$j(u).each(function(){$j(this).show()})}else{var v=i.data.activityList.filter(function(x){return(x.content.typeComment||x.content.typeMessage)}).length;if(v<i.data.replyCount){m.find(".j-show-older").show()}}i.switchExpandedCollapsedViews("expanded",m);q.removeClass("j-js-loading");j.remove();q.find(".jive-icon-arrow-down").show()}}else{i.switchExpandedCollapsedViews("collapsed");q.removeClass("j-js-loading");j.remove();q.find(".jive-icon-arrow-down").show()}}else{q.removeClass("j-js-loading");j.remove();q.find(".jive-icon-arrow-down").show()}})}}p.preventDefault()};this.replyRTE=function(m,d,r,p){var n=this,f=n.getContent(),l=m.closest(".j-act-rte-replyable"),o={},j=l.attr("id"),i=j.split("-")[j.split("-").length-1],h=n.subActivitiesByDomID[i],k=d.filter(".j-act-parent-reply-view");if(!n.rteLoading){n.rteLoading=true;r.addCallback(function(){n.rteLoading=false});if(k.length){k.find(".j-act-replyto").hide()}else{f.find(".j-act-replyto").show()}o.parent={};if(h&&(h.content.typeComment||h.content.typeMessage||h.content.typeExternalActivity)){o.type="sub";o.activity=h;if(!h.content.typeExternalActivity){var e=l.find(".j-excerpt-full-html-content .jive-rendered-content");if(e.length){o.htmlContent=$j.trim(e.html())}else{o.htmlContent=$j.trim(l.find(".j-excerpt").html())}}}else{o.type="parent";o.parent.originalAuthor=n.data.originalAuthor;var c="";if(n.data.jiveObject.typeThread){var g=n.getContent(),q=g.find(".js-full-content-body .jive-rendered-content");if(q.length){c=$j.trim(q.html())}else{c=$j.trim(g.find(".j-excerpt-slug").html())}}o.htmlContent=c}o.idPostfix=i;o.viewingUser=n.viewingUserData;if(o.activity&&o.activity.content.jsAppActivityRepliedToData&&o.activity.content.jsAppActivityRepliedToData.id){o.parent.jiveObject={};o.parent.jiveObject.id=o.activity.content.jsAppActivityRepliedToData.id;o.parent.jiveObject.objectType=o.activity.content.jsAppActivityRepliedToData.objectType}else{o.parent.jiveObject=n.data.jiveObject}o.parent.container=n.data.container;o.objectID=l.attr("data-objectid");o.objectType=l.attr("data-objecttype");o.objectVisibility=l.attr("data-extvisible");if(p){p.emit("formReady",o)}n.showRTE(o,l,r)}};this.switchExpandedCollapsedViews=function(g,e){var u=this,h=u.getContent(),d=h.find("div.j-act-coll-view"),r=h.find("div.j-act-exp-view"),p=h.find("#exp-parent-reply-"+u.data.jiveObject.domIDPostfix),f=h.find(".j-show-older"),m=false,v;if(g=="expanded"){h.find(".j-expand").text(jive.eae.common.jsI18nHelper({key:"eae.stream.showfewercomments"}));if(f.data("more")){f.show()}var l=d.find("div.j-panel-rte");if(l.length&&l.is(":visible")){m=true}d.hide();e.show();r.replaceWith(e);if(m){var o=u.rteView.getHTML();var k=d.find("div.j-act-node"),n=k.data("objecttype"),q=k.data("objectid"),w=e.find("div.j-act-node[data-objecttype="+n+"][data-objectid="+q+"]"),s=new jive.conc.Promise();s.addCallback(function(){u.rteView.setHTML(o)});var j=w.find(".j-reply-rte"),c=j.add(j.parents());u.replyRTE(j,c,s)}if(!p.length){p=$j(jive.eae.activitystream.expViewParentReplyLink({activityContainer:u.data}));d.after(p)}p.show();h.addClass("j-js-expanded j-act-expanded")}else{if(g=="collapsed"){h.find(".j-expand").text(jive.eae.common.jsI18nHelper({key:"eae.stream.showmorecomments"}));f.hide();if(p.length){p.hide()}var t=r.find("div.j-panel-rte"),x=t.is(":visible");if(t.length&&x){v=t.closest("div.j-panel-rte-wrap");var i=v.prev("div.j-act-node");k=d.find("div.j-act-node");if(i.length&&i.data("objecttype")==k.data("objecttype")&&i.data("objectid")==k.data("objectid")){m=true}}r.hide();d.show();if(m){var o=u.rteView.getHTML(),s=new jive.conc.Promise();s.addCallback(function(){u.rteView.setHTML(o)});var j=k.find(".j-reply-rte"),c=j.add(j.parents());u.replyRTE(j,c,s)}else{if(t.length&&x){v.remove()}}h.removeClass("j-js-expanded j-act-expanded")}}};this.fillInMyGaps=function(e,j){var d=this,h=new jive.ActivityStream.FillInTheGapRequest({originalIDs:d.originalCommentIDs,timestamp:d.gapTimestamp,fullContent:true,pageSize:5}),f=d.getContent(),c,i=(d.data.jiveObject.typeThread?d.data.jiveObject.threadID:d.data.jiveObject.id),g=f.find(".j-show-older");if(d.data.jiveObject.typeThread){c=1}else{if(d.data.activityList.length&&d.data.activityList[0].content.commentContentResource&&d.data.activityList[0].content.commentContentResource.objectType==129){c=129}else{c=d.data.jiveObject.objectType}}d.emit("fillInTheGaps",{objectType:c,objectID:i},h,function(r){var u;if(!r.hasMore){g.hide();g.data("more",false);u=e.find(".j-act-node");$j(u).each(function(){var x=$j(this);if(x.css("display")=="none"){if(e.css("display")!="none"){x.addClass("j-js-sub-act-to-show")}else{jive.rte.renderedContent.emit("renderedContent",x);x.show()}}})}else{g.show();g.data("more",true);d.gapTimestamp=r.items[r.items.length-1].creationDate}var n=r.items.length;u=e.find(".j-sub-activity-items").clone();for(var s=0;s<n;s++){var o=r.items[s],q=false,w=d.data.activityList.length;for(var k=0;k<w;k++){var p=d.data.activityList[k];if(parseInt(p.creationDate,10)>parseInt(o.creationDate,10)){q=true;d.subActivitiesByDomID[o.content.domIDPostfix]=o;var m=$j(jive.eae.common.subactivity({activity:o,activityContainer:d.data,isHidden:false,user:d.viewingUserData,streamType:d.streamType,hideStub:true,addedInline:false,forceCurrent:false,canCreateMbImage:false,canCreateMbVideo:false,mbCreationModerated:false}));m.find(".j-act-preview-control").hide();m.addClass("j-js-sub-act-to-show");if(k==0){u.prepend(m);var t=u.find("#node-collapsed-"+p.content.domIDPostfix);if(t.css("display")=="none"){t.addClass("j-js-sub-act-to-show")}}else{var v=u.find("#node-collapsed-"+d.data.activityList[k-1].content.domIDPostfix);if(v.length){v.after(m)}else{u.prepend(m)}}jive.rte.renderedContent.emit("renderedContent",m);d.data.activityList.splice(k,0,o);break}}if(!q){d.data.activityList.push(o);d.subActivitiesByDomID[o.content.domIDPostfix]=o;m=$j(jive.eae.common.subactivity({activity:o,activityContainer:d.data,isHidden:false,user:d.viewingUserData,streamType:d.streamType,hideStub:true,addedInline:false,forceCurrent:false,canCreateMbImage:false,canCreateMbVideo:false,mbCreationModerated:false}));m.find(".j-act-preview-control").hide();m.addClass("j-js-sub-act-to-show");u.append(m);jive.rte.renderedContent.emit("renderedContent",m)}}var l=u.find("div.j-js-sub-act-to-show");if($j.browser.msie&&$j.browser.version<=7){d.replaceAroundRTE(e.find(".j-sub-activity-items"),u)}else{if(e.css("display")!="none"){l.wrapAll('<div class="j-js-slide-in" style="display:none"/>')}else{l.css("display","block")}d.replaceAroundRTE(e.find(".j-sub-activity-items"),u)}l.removeClass("j-js-sub-act-to-show");d.postRender();if(j){j()}})};this.replaceAroundRTE=function(c,f){var d=c.find("div.j-panel-rte-wrap"),e=f.find("div.j-panel-rte-wrap").index();if(d.length&&e>=0){d.prevAll().remove();d.before(f.children().slice(0,e));d.nextAll().remove();d.after(f.children().slice(1))}else{c.replaceWith(f)}};this.getFullReplies=function(d,f){var c=this,e=c.getContent();if(c.data.jiveObject.objectType==1500){c.getLikeData(d,function(){c.fullRepliesLoaded=true;f()})}else{c.fullRepliesLoaded=true;f()}};this.showRTE=function(d,c,j){var g=this,h=c.closest("div.j-act-entry"),i=h.find("div.j-panel-rte");if(!i.length){var f=$j(jive.eae.common.rtePanel({user:g.viewingUserData,hideGuestURLField:(g.data.jiveObject.typeThread?true:false),externallyVisible:d.objectVisibility}));i=f.find("div.j-panel-rte");h.find("div.j-act-coll-view").after(f)}function e(){var k=h.find("div.j-panel-rte-wrap").detach();c.after(k);var l=k.find("div.j-panel-rte-loading");g.rteSpinner=new jive.loader.LoaderView();g.rteSpinner.appendTo(l);l.show();g.initRTE(h,d,j)}if(i.is(":visible")){i.hide();h.find(".jive-comment-error").hide();if(!c.next().hasClass("j-panel-rte-wrap")){e()}else{j.emitSuccess()}}else{e()}};this.slideOpenRTE=function(c){var f=this,g=$j("#"+f.rteLocation),e=g.find("div.j-panel-rte"),d=g.find("div.j-panel-rte-loading");d.hide();f.rteSpinner.getContent().remove();f.rteSpinner.destroy();e.css("position","static");e.show("fast",c)};this.initRTE=function(u,q,p){var k=q.idPostfix,r={},t=this,m=null,l=null,w=null,n=null,d=null,x=null,g=null,o=null,h=null,j=null,i=null,s=false;u.css({zIndex:"5"});t.resetRTE(u);g=(q.parent.jiveObject.typeThread?"discussionReply":"inlineComment");if(q.type=="sub"){m=q.activity.containerObjectType;l=q.activity.containerObjectID;if(g=="discussionReply"){n=jive.util.unescapeHTML(q.activity.content.subject);x=q.parent.jiveObject.threadID;d=q.activity.content.id;s=q.parent.jiveObject.imagesEnabled}else{if(q.parent.jiveObject.typeExternalActivity&&!q.activity.content.typeComment){o=q.objectID;w=q.objectType;s=t.rteOptions.hasImagePerms}else{o=q.parent.jiveObject.id;w=q.parent.jiveObject.objectType;s=t.rteOptions.hasImagePerms;if(q.activity.content.id!=q.parent.jiveObject.id||q.activity.content.objectType!=q.parent.jiveObject.objectType){h=q.activity.content.id}if(q.parent.jiveObject.versionNumber){j=q.parent.jiveObject.versionNumber}}}i=q.activity.activityUser;u.find("div.j-js-reply-to").html(jive.eae.common.replyingToText({type:"user",object:i,visible:(q.objectVisibility=="true")}))}else{m=q.parent.container.type;l=q.parent.container.id;if(g=="discussionReply"){n=jive.util.unescapeHTML(q.parent.jiveObject.subject);x=q.parent.jiveObject.threadID;d=q.parent.jiveObject.id;i=q.parent.originalAuthor;s=q.parent.jiveObject.imagesEnabled;u.find("div.j-js-reply-to").html(jive.eae.common.replyingToText({type:"user",object:i,visible:(q.objectVisibility=="true")}))}else{if(q.parent.jiveObject.typeExternalActivity){o=q.objectID;w=q.objectType;s=t.rteOptions.hasImagePerms;u.find("div.j-js-reply-to").html(jive.eae.common.replyingToText({type:"content",object:{},visible:(q.objectVisibility=="true")}))}else{o=q.parent.jiveObject.id;w=q.parent.jiveObject.objectType;if(q.parent.jiveObject.versionNumber){j=q.parent.jiveObject.versionNumber}s=t.rteOptions.hasImagePerms;u.find("div.j-js-reply-to").html(jive.eae.common.replyingToText({type:"content",object:q.parent.jiveObject,visible:(q.objectVisibility=="true")}))}}i=q.parent.originalAuthor}if(q.htmlContent){window._jive_gui_quote_text=jive.DiscussionApp.soy.rteMsgQuote({i18n:{postGuestWroteLabel:jive.i18n.getMsg("post.guest_wrote.label"),postUserWroteLabel:jive.i18n.getMsg("post.user_wrote.label")},userName:typeof((window._jive_current_user))!="undefined"&&(window._jive_current_user.ID==i.id)?i.username:i.displayName,isAnonymous:i.anonymous,msgBody:q.htmlContent})}else{window._jive_gui_quote_text=""}window._jive_video_picker__url="?container="+l+"&containerType="+m;jive.rte.multiRTE=new Array();window.editor=new jive.ext.y.HashTable();var c=null,f=null,e=null,v=null;define(["jive.model.Controller","jive.rte.EntitlementService","jive.rte.ImageService","jive.rte.FormService"],function(A,y,z,C){c=new A();e=new y({objectID:(t.data.jiveObject.typeThread?t.data.jiveObject.threadID:t.data.jiveObject.id),objectType:(t.data.jiveObject.typeThread?1:t.data.jiveObject.objectType),entitlement:"VIEW"});f=new z({objectId:-1,objectType:-1,containerId:l,containerType:m});v=new C({$form:u.find("form.j-panel-rte-view"),formSubmitHandler:function(){$j(this).find("input[type=submit]").prop("disabled",true);r.body=t.rteView.getHTML();r.name="";r.email="";var F=u.find(".replyGuestName"),G=u.find(".replyGuestEmail"),E=u.find(".replyGuestUrl"),D=u.find(".jive-comment-error");if(!r.body.length){D.html(jive.eae.common.jsI18nHelper({key:"cmnt.cannot_be_empty.text"})).show();$j(this).find("input[type=submit]").prop("disabled",false);return}else{if(F.length&&!F.val()){if(g=="discussionReply"){D.html(jive.eae.common.jsI18nHelper({key:"forum.thrd.name_required.text"})).show()}else{D.html(jive.eae.common.jsI18nHelper({key:"cmnt.name_required.text"})).show()}$j(this).find("input[type=submit]").prop("disabled",false);return}else{if(G.length&&!G.val()){if(g=="discussionReply"){D.html(jive.eae.common.jsI18nHelper({key:"forum.thrd.email_required.text"})).show()}else{D.html(jive.eae.common.jsI18nHelper({key:"cmnt.email_required.text"})).show()}$j(this).find("input[type=submit]").prop("disabled",false);return}else{D.hide()}}}if(F.length){r.name=F.val();r.email=G.val()}if(g=="discussionReply"){r.subject=n;r.forumThreadID=x;r.ID=d;t.emit("replySubmit",r,function(H){u.css("z-index",0);u.find(".j-act-replyto").show();u.find("div.j-panel-rte").toggle(function(){if(t.rteView){t.resetRTE(u)}});t.renderReply(k,H,g)},function(I,H){D.html(I).show()})}else{r.ID=o;r.typeID=w;if(F.length){r.url=E.val()}if(t.data.activityList.length&&t.data.activityList[0].content.commentContentResource&&t.data.activityList[0].content.commentContentResource.objectType==129){r.isBackChannelComment=true}if(h){r.parentCommentID=h}if(j){r.version=j}t.emit("commentSubmit",r,function(H){u.css("z-index",0);u.find(".j-act-replyto").show();u.find("div.j-panel-rte").toggle(function(){if(t.rteView){t.resetRTE(u)}});t.renderReply(k,H,g)},function(I,H){D.html(I).show()})}}});var B={$element:u.find("textarea.wysiwygtext"),controller:c,preset:"stream-narrow",preferredMode:t.rteOptions.preferredMode,startMode:t.rteOptions.startMode,mobileUI:t.rteOptions.mobileUI,isEditing:t.rteOptions.isEditing,toggleText:jive.eae.common.jsI18nHelper({key:"rte.toggle_display"}),alwaysUseTabText:jive.eae.common.jsI18nHelper({key:"post.alwaysUseThisEditor.tab"}),editDisabledText:jive.eae.common.jsI18nHelper({key:"rte.edit.disabled"}),editDisabledSummary:jive.eae.common.jsI18nHelper({key:"rte.edit.disabled.desc"}),communityName:t.rteOptions.communityName,images_enabled:s,theme_advanced_resizing:false,height:175,onReady:function(){t.slideOpenRTE(function(){t.rteView.focus();t.rteView.autoReposition();p.emitSuccess()})},services:{imageService:f,formService:v,entitlementService:e}};t.rteLocation=u.attr("id");t.rteView=new jive.rte.RTEWrap(B)});u.find("a.j-panel-hide-rte-link").unbind();u.find("a.j-panel-hide-rte-link").click(function(y){u.find(".jive-comment-error").hide();u.css("z-index",0);u.find(".j-act-replyto").show();t.resetRTE(u);y.preventDefault()})};this.showMicroInput=function(d){var e=this,i=d.attr("id"),j=i.split("_")[i.split("_").length-1],h=d.closest("div.j-js-microrte-replyable"),g=$j("#microRTEContainer_"+j),f=d.closest(".j-act-parent-reply-view");if(f.length){f.find(".j-act-replyto").hide()}if(!g.length){g=$j(jive.eae.common.microRTEContainer({object:e.data.jiveObject,activityContainer:e.data,user:window._jive_current_user,canAtMention:!e.mobileUI}));h.after(g)}var c=e.initMicroRTEView(j,g);if(g.is(":visible")){e.hideMicroRTEInput(j);if(!h.next().hasClass("j-act-micro-rte")){g.detach();h.after(g);g.show();c.focus()}}else{g.detach();h.after(g);g.show();c.focus()}};this.resetRTE=function(c){c.find("div.j-panel-rte").hide();if(this.rteView){this.rteView.destroy();this.rteView=null}if($j("textarea.wysiwygtext",c).length){$j("textarea.wysiwygtext",c).remove()}if(c.find(".replyGuestName").length){c.find(".replyGuestName").val("");c.find(".replyGuestEmail").val("");c.find(".replyGuestUrl").val("")}c.find("div.j-js-reply-to").empty();c.find("form[name=jive-comment-post-form] input[type=submit]").prop("disabled",false);c.find("form[name=jive-comment-post-form]").prepend(jive.eae.common.rteTextArea())};this.renderReply=function(i,v,f){var p=this,h=p.getContent(),j;if(f=="mbComment"){u=p.data.originalAuthor;j=p.convertDataToActivity(v,{content:{typeWallEntryComment:(p.data.jiveObject.typeWallEntry)?true:false,typeComment:true,parentAuthor:u,domIDPostfix:jive.soy.func.randomString()},activityData:{domIDPostfix:jive.soy.func.randomString()}});p.hideMicroRTEInput(i)}else{if(f=="discussionReply"){j=v;j.likable=true;j.current=true}else{var u,q={},n=p.subActivitiesByDomID[i];if(n){u=n.activityUser;if(n.content.objectType==1501){q.id=n.content.id;q.objectType=n.content.objectType}}else{u=p.data.author}j=p.convertDataToActivity(v,{content:{domIDPostfix:jive.soy.func.randomString(),parentAuthor:u,jsAppActivityRepliedToData:q,typeComment:true},activityData:{domIDPostfix:jive.soy.func.randomString()}})}}j.content.html=p.shiv("<div class='jive-rendered-content'>"+j.content.html+"</div>");j.content.html=$j("<div>").append($j(j.content.html).clone()).remove().html();var g=p.data;g.replyCount=p.data.replyCount+1;g.numCurrent=p.data.numCurrent+1;g.numCurrentSubActivities=p.data.numCurrentSubActivities+1;g.activityList.push(j);var k=h.find(".j-sub-activity-items"),e=h.find(".j-expand-comments"),c=$j(jive.eae.common.subactivity({activity:j,activityContainer:g,isHidden:false,user:p.viewingUserData,streamType:p.streamType,addedInline:true,hideStub:true,forceCurrent:false,canCreateMbImage:false,canCreateMbVideo:false,mbCreationModerated:false}));if(j.moderated&&!k.length){var d=p.buildExpandedView(g);h.find(".j-act-exp-view").replaceWith(d);k=h.find(".j-sub-activity-items")}if(k.length){k.append(c);jive.rte.renderedContent.emit("renderedContent",c)}var o=h.find(".j-act-expand-bar");if(!e.length){var r=$j(jive.eae.activitystream.activityStreamExpandContent({activityContainer:g,streamType:p.streamType,filterType:p.filterType}));o.append(r)}o.show();p.subActivitiesByDomID[j.content.domIDPostfix]=j;var t=$j(jive.eae.activitystream.collapsedActivityStreamExcerpt({activityContainer:g,activity:j,streamType:p.streamType,filterType:p.filterType,hidden:false,user:p.viewingUserData,hideStub:false,canCreateMbImage:false,canCreateMbVideo:false,mbCreationModerated:false,time:j.creationTime}));t.hide();var m=h.find("div.j-act-coll-view"),s=m.children(".j-act-node");m.append(t);if(s.length){s.remove()}t.show();var l=p.getContent().find(".j-act-replycount");h.find(".j-new-count").remove();l.each(function(){$j(this).replaceWith(jive.eae.common.replyCountText({activityContainer:p.data,streamType:p.streamType,showCurrentCount:(p.streamType=="user"||p.streamType=="all")&&$j.inArray("all",p.filterType)!=-1}))});h.addClass("j-replied-to");p.postRender()};this.hideMe=function(g,f){var e=this,d=e.getContent();if(f){var c=d.find("div.j-act-hidden");c.attr("data-hidBy",g);c.html(jive.eae.activitystream.hiddenActivityView({activityContainer:e.data,type:g}));c.find("a.j-js-unhide").unbind().click(function(i){var h=$j(this).closest(".j-act-hidden").attr("data-hidBy");e.emit("hide",h,e.hideData,false);i.preventDefault()});c.find("a.j-js-dismiss").unbind().click(function(h){c.hide();h.preventDefault()});c.show()}else{var c=d.find("div.j-act-hidden");c.attr("data-hidBy","");c.hide()}};this.hideMicroRTEInput=function(f,g){var c=$j("#microRTEContainer_"+f),d=this.initMicroRTEView(f,c),e=c.closest("div.j-act-entry");if(d){c.hide();d.resetStatusInput();e.find(".j-act-replyto").show();if(g){g()}}else{if(g){g()}}};this.buildExpandedView=function(e){var c=this,d=$j(jive.eae.activitystream.expandedActivityStreamItemView({activityContainer:e,user:c.viewingUserData,streamType:c.streamType,canCreateMbImage:c.canCreateMbImage,canCreateMbVideo:c.canCreateMbVideo,mbCreationModerated:c.mbCreationModerated}));jive.rte.renderedContent.emit("renderedContent",d);return d}});