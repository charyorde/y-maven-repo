jive.namespace("ActivityStream");jive.ActivityStream.StreamItemCommonView=jive.AbstractView.extend(function(a,b){this.init=function(c){b.init.call(this,c);this.replyViews={};this.mbCommentControllers={};this.articleID=c.id;this.hideDataArr=c.id.split("_");this.unhideData={itemHidden:false,contextHidden:false,contextTypeHidden:false};this.repostController=null;this.isLikeDataPopulated=false;this.data=c.data;this.viewingUserData=c.viewingUserData;this.streamType=c.streamType;this.filterType=c.filterType;this.rteOptions=c.rteOptions;this.gapTimestamp=0;this.canCreateMbImage=c.canCreateMbImage;this.canCreateMbVideo=c.canCreateMbVideo;this.mobileUI=jive.rte.mobileUI;this.mbCreationModerated=c.mbCreationModerated};a.getSoyTemplate=jive.oo._abstract;a.expandClickHandler=jive.oo._abstract;a.handleClick=jive.oo._abstract;this.expandCollapseTargetCheck=function(c){return $j(c.target).is("a")};this.handleClickCommon=function(i,o,c,f){var j=this,n=false;if(!f){f=j.getContent()}if(i.hasClass("j-js-show-grouped-users")){var p=i,g=$j("div.j-js-grouped-users[data-linkedID="+p.attr("data-linkedID")+"]");g.popover({context:p,destroyOnClose:false});g.closest("div.js-pop").css({"z-index":1004})}else{if(i.hasClass("j-repost")){var k=j.data.jiveObject;var q=$j(jive.eae.common.repostModal({object:k,author:k.user,canCreateMbImage:j.canCreateMbImage,canCreateMbVideo:j.canCreateMbVideo,canAtMention:!jive.rte.mobileUI,mbCreationModerated:j.mbCreationModerated}));q=q.filter(".j-repost-modal");var l=$j(".j-act-reply-form > form",q),h=l.attr("id").split("-")[l.attr("id").split("-").length-1];q.lightbox_me({destroyOnClose:true,centered:true,onLoad:function(){j.repostController=new jive.MicroBlogging.RepostController({viewOptions:{selector:"#jive-js-repost-modal .j-eae-repost-form",idPostfix:h,atMentionBtn:q.find("a.jive-js-mention-button"),imgAttachmentBtn:q.find("a.jive-js-imgattach-button"),submitBtn:q.find("a.j-status-input-submit")},manuallyRenderView:true});j.repostController.renderView();j.repostController.getMicrobloggingView().focus();jive.bindLightboxMedia()}})}else{if(c.filter("[id^=showMicroRTE_]").length){var i=c.filter("[id^=showMicroRTE_]").first();j.showMicroInput(i)}else{if(c.filter(".j-attach-anchor").length&&c.filter(".j-attached-document").length){var i=c.filter(".j-attach-anchor").first(),m=i.attr("href").split("-")[i.attr("href").split("-").length-1],d=_jive_base_url+"/conversion-viewer-overlay.jspa?objectID="+m+"&objectType=102";showPreviewableBinary(d,"")}else{n=true}}}}return n};a.initMicroRTEView=function(c,h){var f=this;if(!f.replyViews[c]){var i=h.find(".j-act-reply-form > form"),j="mbComment",d=" #microRTEContainer_"+c,g=d+" .j-js-mb-comment",k=i.find("input[name=contentID]").val(),e=i.find("input[name=typeID]").val();if(!f.mbCommentControllers[c]){f.mbCommentControllers[c]=new jive.MicroBlogging.CommentController({viewOptions:{selector:g,idPostfix:c,atMentionBtn:i.find("a.jive-js-mention-button"),submitBtn:i.find("a.j-status-input-submit"),cancelBtn:i.find("a.j-status-input-cancel"),$guestUserName:h.find(".jive-reply-post-anonymous .replyGuestName"),$guestUserEmail:h.find(".jive-reply-post-anonymous .replyGuestEmail"),$guestUserURL:h.find(".jive-reply-post-anonymous .replyGuestUrl"),viewingUserData:f.viewingUserData,entitlementObjectID:k,entitlementObjectType:e}});f.mbCommentControllers[c].addListener("submitSuccess",function(l,m){f.renderReply(c,l,j);jive.switchboard.emit("activity.stream.comment.created")}).addListener("cancel",function(){f.hideMicroRTEInput(c)});f.replyViews[c]=f.mbCommentControllers[c].getMicrobloggingView()}}return f.replyViews[c]};a.convertDataToActivity=function(h,e){if(!e){e={}}if(!e.content){e.content={}}var g=$j(h.body)[1];var f="";var j="";j=$j(g).html();f=$j(g).text();var c=new Date();var i=$j.extend(true,{},this.viewingUserData);if(h.name&&i.anonymous){i.username=h.name;i.displayName=h.name}var d={activityUser:i,type:"created",content:$j.extend({commentContentResource:{id:this.data.jiveObject.id,jiveObjectURL:"",objectType:this.data.jiveObject.objectType,jiveObjectCSS:this.data.jiveObject.jiveObjectCSS,activityTemplate:null,groupedActivityTemplate:null,domIDPostfix:""},id:h.id,parentAuthor:null,subject:h.body,text:f,html:j,contentTypeFeatureName:jive.eae.common.jsI18nHelper({key:"eae.stream.comments"}),activityTemplate:null,groupedActivityTemplate:null},e.content),read:false,creationDate:c.getTime(),creationTime:jive.eae.common.jsI18nHelper({key:"global.less_than_a_minute_ago"}),targetObjectID:h.id,targetObjectType:105,containerObjectID:this.data.container.id,containerObjectType:this.data.container.type,current:true,domIDPostfix:"",likable:true,liked:false,likeCount:0,groupedModifiers:[],moderated:h.moderated};return $j.extend(d,e.activityData)};a.renderReply=jive.oo._abstract;this.determineHidden=function(d,e,c){if(e.interactedObjectID==this.hideData.objectID&&e.interactedObjectType==this.hideData.objectType){this.hideMe(d,c)}};this.getLikeData=function(d,f){var c=this,e=[];d.find("div[id^=node-collapsed-]").each(function(){var g=$j(this).attr("data-objectID"),h=$j(this).attr("data-objectType");e.push({id:g,type:h})});c.emit("getLikeData",e,function(g,i,h){$j("div[id^=node-][data-objectID="+i+"][data-objectType="+g+"]",d).each(function(){var j=$j(".j-js-liking-control",$j(this));if(j.length){var k=j.find(".js-acclaim-container");j.html(jive.eae.acclaim.likeControl({canLike:!!k.data("canLike"),liked:!!h.acclaim.vote,likeCount:h.acclaim.scoreDisplay,objectId:i,objectType:g,showIcon:!!k.data("showicon"),type:"mini"}))}})});if(f){f()}};this.initPollView=function(f,d){if(f){if($j.browser.msie){var e={containerType:f.containerType,containerID:f.containerID,widgetID:f.widgetID,moreUrl:f.moreUrl,createUrl:f.createUrl,canCreatePoll:f.canCreatePoll,pollID:f.poll.id,pollIndex:f.poll.index};new jive.PollWidget.Main(e)}if(f.poll.votesCount){var c=d.find(".j-act-poll-votect");c.html(jive.eae.poll.common.voteCount({numOfVotes:f.poll.votesCount}))}}};this.getID=function(){return this.articleID};this.getParentTimestamp=function(){return this.data.parentTimestamp}});