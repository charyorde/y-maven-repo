jive.namespace("Announcements");jive.Announcements.EditView=jive.AbstractView.extend(function(a){var b=jQuery;this.init=function(f,e){var c=this;this.rteOptions=e.rteOptions;this.$element=b(e.element);this.$modal=this.$element.closest(".jive-modal");this.$form=this.$element.find(".j-form-announcements");var d=this.$form;d.find(":submit").prop("disabled",false);d.bind("submit.announcements",function(h){var g=c.getAnnouncementFromForm(),i=b(this).find(":submit").prop("disabled",true);c.emitP("save",g).addErrback(function(j){b("<p/>",{text:j}).message({style:"error"});i.prop("disabled",false)});h.preventDefault()});d.find(".back").bind("click.announcements",function(g){c.emit("cancel");g.preventDefault()});d.find("#annActiveNow").bind("click.announcements",function(){d.find("#annPublishDate").val("")});d.find("#annExpireRelative").bind("click.announcements",function(){d.find("#annEndDate").val("")});d.find("#annExpiresDays").bind("click.announcements",function(){d.find("#annExpireRelative").prop("checked",true)});this.$modal.one("lightboxclose",function(){c.destroy()});this.content=b().add(this.$element.find(".jive-modal-title-"+(f.id?"edit":"add")+"-announcement")).add(this.$element.find(".jive-modal-create-announcement")).add(this.$element.find(".jive-modal-edit-announcement")).add(this.$element.find(".overflow"));this.populate(f)};a.populate=function(c){this.insertFormValues(c);this.initRTE(this.$element.find(".jive-rte"),{formActionContainer:"#jive-compose-buttons",bodyContent:c.body,subject:c.subject});if(!c.id){if(c.containerID=="1"){b("#minorAnnCheckbox").show();b("#jive-ann-minor-flag").prop("checked",true)}else{b("#minorAnnCheckbox").hide();b("#jive-ann-minor-flag").prop("checked",false)}b("#minorAnnCreateLabel").show();b("#minorAnnEditLabel").hide()}else{b("#minorAnnCreateLabel").hide();b("#minorAnnEditLabel").show();b("#minorAnnCheckbox").show()}b("#subject01").focus()};a.insertFormValues=function(c){b("#annID").val(c.id);b("#subject01").val(c.subject);b("#annPublishDate").val(c.publishDate);b("#annEndDate").val(c.endDate);if(c.minorCreateEdit){b("#jive-ann-minor-flag").val(c.minorCreateEdit);if(c.minorCreateEdit=="true"){b("#jive-ann-minor-flag").prop("checked",true)}else{b("#jive-ann-minor-flag").prop("checked",false)}}if(c.publishDate){b("#annActiveLater").prop("checked",true);b(".activeDatePicker").show()}else{b("#annActiveNow").prop("checked",true);b(".activeDatePicker").hide()}if(c.endDate){b("#annExpireLater").prop("checked",true);b(".expiresDatePicker").show();b("#annExpiresDays").hide()}else{b("#annExpireRelative").prop("checked",true);b(".expiresDatePicker").hide();b("#annExpiresDays").show()}b("#annExpiresDays").val(7)};a.getAnnouncementFromForm=function(j){var i=this;var f="";if(typeof(j)!="undefined"){f="#"+j+" "}var k=b(f+" input[name=activeMode]:checked").val();var e=b(f+" input[name=expiresMode]:checked").val();var h=b(f+"#annExpiresDays").val();var d=b(f+"#jive-ann-minor-flag").is(":checked");var g=b(f+"#annID").val();var c={subject:b(f+"#subject01").val(),body:i.rteView.getHTML(),mobileEditor:i.rteView.isMobileOnly(),publishDate:b(f+"#annPublishDate").val(),endDate:b(f+"#annEndDate").val(),activeMode:k,expiresMode:e,expiresDays:h,minorCreateEdit:d};if(g>0){c=b.extend(c,{id:g})}return c};a.initRTE=function(c,e){if(this.rteView){this.rteView.killYourself();this.rteView.destroy()}var d=b('<textarea id="wysiwygtext-announcement"></textarea>');if(c.find("#wysiwygtext-announcement").length<1){c.append(d)}d.val(e.bodyContent);c.closest("form").find("#subject01").val(e.subject);var f=b.extend({$element:d,isEditing:e.bodyContent.length>0},this.rteOptions);this.rteView=new jive.rte.RTEWrap(f)};a.killRTE=function(){if(this.rteView){this.rteView.killYourself();this.rteView.destroy()}};this.destroy=function(){this.$modal.unbind("lightboxclose");this.killRTE();this.$form.find("*").andSelf().unbind(".announcements");return this}});