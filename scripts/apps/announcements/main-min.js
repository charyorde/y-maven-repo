jive.namespace("Announcements");jive.Announcements.Main=jive.oo.Class.extend(function(a){var b=jive.Announcements;this.init=function(d){var c=this;this.containerID=d.containerID;this.containerType=d.containerType;this.element=d.element||"#jive-modal-announcements";this.rteOptions=d.rteOptions;this.source=new jive.Announcements.Source();this.listView=this.buildListView();this.pageSize=d.pageSize||15;this.modalView=new jive.Announcements.ModalView(this.element);this.updateList();if(d.editID>0){this.edit(d.editID)}};a.buildListView=function(){var d=new b.ListView({element:this.element}),c=this;d.addListener("create",function(){c.edit()}).addListener("edit",function(e){c.edit(e)}).addListener("expire",function(e){c.modalView.showSpinner();c.source.expire(e).addCallback(function(){c.source.get(e).addCallback(function(f){c.modalView.hideSpinner();d.expire(f)})})}).addListener("remove",function(e){c.modalView.showSpinner();c.source.destroy(e).addCallback(function(){c.modalView.hideSpinner();d.removeChild({id:e})})}).addListener("page",function(e){var f=(c.pageSize*e)+1;c.updateList({startIndex:f})});return d};a.buildEditView=function(e){var d=new b.EditView(e,{element:this.element,rteOptions:this.rteOptions}),c=this;d.addListener("save",function(f,g){c.source.save($j.extend({},f,{containerID:c.containerID,containerType:c.containerType})).addCallback(function(){g.emitSuccess();d.hide().destroy();c.listView.show();c.updateList({},true)}).addErrback(function(i,h){if(h==4001){g.emitError(i)}else{c.source.showGenericSaveError()}})}).addListener("cancel",function(){d.hide().destroy();c.listView.show()});return d};a.updateList=function(d,c){var e=this.source.findAll(jQuery.extend({containerType:this.containerType,containerID:this.containerID,startIndex:0,range:this.pageSize},d));if(c){this.listView.reload(e)}else{this.listView.update(e)}};a.edit=function(e){var c=this,d=this.modalView;d.showSpinner();this.getAnnouncement(e,function(f){var g=c.buildEditView(f);c.listView.hide();g.show();d.hideSpinner()})};a.getAnnouncement=function(d,c){if(d){this.source.get(d).addCallback(function(e){c(e)})}else{c({subject:"",body:"",containerID:this.containerID,containerType:this.containerType})}}});