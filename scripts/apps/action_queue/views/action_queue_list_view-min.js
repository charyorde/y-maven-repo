jive.namespace("ActionQueue");jive.ActionQueue.ListView=jive.AbstractView.extend(function(a,b){this.init=function(c){var d=this;b.init.call(this,c);d.archived=false;d.actionQueueItems=[]};this.postRender=function(){var c=this,d=c.getContent();c.actionQueueItems=[];d.delegate("a.j-js-load-more","click",function(h){var g=$j(this),f=c.actionQueueItems;this.spinner=new jive.loader.LoaderView({size:"small",showLabel:false});this.spinner.appendTo(g);g.find(".j-more-label").hide();g.addClass("j-append-active");c.emitP("loadMore",f[f.length-1].getCreationDate()).addCallback(function(e){var i=$j(jive.eae.actionqueue.actionQueueList({actionQueue:e}));i.hide();g.before(i);g.remove();i.fadeIn(2000);i.filter("div.j-aq-entry").each(function(j){c.initQueueItem($j(this),j,true)})});h.preventDefault()});$j("#j-action-queue div.j-aq-entry").each(function(e){c.initQueueItem($j(this),e,true)})};this.initQueueItem=function(e,h,f){var d=this,c=d.actionQueueItems,g=new jive.ActionQueue.ListItemView({selector:"#"+e.attr("id"),itemID:parseInt(e.attr("id").split("_")[2]),creationDate:e.attr("data-creationDate")});g.addListener("performAction",function(k,i,j){d.emit("performAction",k,i,j)}).addListener("actionCompleted",function(){var i=c[c.length-1].getCreationDate();d.emitP("actionCompleted",i).addCallback(function(j){var l=$j("#j-action-queue");if(j.actionQueueList.length){var k=l.find("a.j-js-load-more");k.addClass("j-append-active");k.remove();var m=$j(jive.eae.actionqueue.actionQueueList({actionQueue:j}));m.hide();l.append(m);m.fadeIn(2000);m.filter("div.j-aq-entry").each(function(n){d.initQueueItem($j(this),n,true)})}else{if(!l.find("div.j-aq-entry").length){l.prepend(jive.eae.actionqueue.noActionQueueResults({archived:d.archived}))}}})});g.postRender();if(f){c.push(g)}else{return g}};this.actionTaken=function(h,g){var e=this,c=e.actionQueueItems;for(var d=0;d<c.length;d++){var f=c[d];if(f.getID()==h){f.actionTaken(g)}}};this.reset=function(c){var e=this;var d=$j(jive.eae.actionqueue.actionQueue({actionQueue:c,archived:c.archived}));$j("#j-action-queue").html(d);e.actionQueueItems=[];$j("#j-action-queue div.j-aq-entry").each(function(f){e.initQueueItem($j(this),f,true)})};this.refresh=function(f){var d=this,g=$j("#j-action-queue"),e=g.find(".j-js-aq-noresults");e.remove();g.empty();d.actionQueueItems=[];var h=$j(jive.eae.actionqueue.actionQueueList({actionQueue:f}));g.prepend(h);h.show();var c=[];h.filter("div.j-aq-entry").each(function(j){c.push(d.initQueueItem($j(this),j,false))});d.actionQueueItems=c.concat(d.actionQueueItems)}});