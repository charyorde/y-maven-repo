jive.namespace("rte.ContentPicker");jive.rte.ContentPicker.ContentPickerController=function(){var c=this;function d(g,f,e){if(typeof(e)=="undefined"||e===null){e=""}if(e!==""){g.setAttribute(f.toLowerCase(),e);if(f=="style"){f="style.cssText"}if(f.substring(0,2)=="on"){e="return true;"+e}if(f=="class"){f="className"}g[f]=e}else{g.removeAttribute(f)}}function b(f,e,l,k){var j=tinyMCE.activeEditor,h,g;j.plugins.jivemacros.cache(f,e,l,k);function n(i){d(i,"___default_attr",f);d(i,"href","javascript:;");d(i,"data-mce-href","javascript:;");d(i,"title",l);d(i,"class","jive_macro jive_macro_"+k);d(i,"jivemacro",k);if(tinyMCE.isMSIE5){i.outerHTML=i.outerHTML}}if(j.selection.isCollapsed()){var m=j.getDoc().createElement("A");m.id="mceLinkInsert";m.appendChild(j.getDoc().createTextNode("---"));d(m,"href","#mce_temp_url#");d(m,"data-mce-href","#mce_temp_url#");j.selection.setNode(m);m=j.getDoc().getElementById("mceLinkInsert");n(m);$j(m).removeAttr("id");j.plugins.jivemacros.removeDuplicateMacros(j,false);j.selection.select(m)}else{tinyMCEPopup.execCommand("CreateLink",false,"#mce_temp_url#",{skip_undo:1});g=tinymce.grep(j.dom.select("a"),function(i){return j.dom.getAttrib(i,"href")=="#mce_temp_url#"});for(h=0;h<g.length;h++){n(g[h]);d(g[h],"_modifiedtitle","true")}}tinyMCEPopup.close();j.focus();j.selection.collapse();var o=j.selection.getNode();if(o.nodeName.toLowerCase()=="a"){$j(o).removeClass("active_link");j.selection.select(o);j.selection.collapse()}}function a(g){var e=/^[a-z][a-z0-9+\-.]+:/i;var f=/^[^\s]+@[^\s\/]+$/i;if(e.test(g)){return g}else{if(f.test(g)){return"mailto:"+g}else{return"http://"+g}}}this.addWebLink=function(g){var f=$j.trim(g);var h=a(f);if(f){if(!h){alert(f+" "+i18nStrings.contentpickerNotValidURLText);return false}else{var e=tinyMCE.activeEditor;setTimeout(function(j,k,i){return function(){var n=j.selection;if(!n.isCollapsed()){tinyMCEPopup.execCommand("CreateLink",false,k)}else{var m=j.getDoc().createElement("A");m.appendChild(j.getDoc().createTextNode(i));d(m,"href",k);d(m,"data-mce-href",k);try{j.focus();j.selection.setNode(m)}catch(o){}}tinyMCEPopup.close();j.focus();j.selection.collapse();var l=j.selection.getNode();if(l.nodeName.toLowerCase()=="a"){$j(l).removeClass("active_link");j.selection.select(l);j.selection.collapse()}}}(e,h,f),333);return}}alert(i18nStrings.contentpickerValidURLReqdText);return false};this.addContentMacro=function(i,h){var f,e,g=true;if(i&&h){URLLookup.retrieveURLAndSubject(i,h,{callback:function(j){if(j!==null){b(j[0],j[1],j[2],j[3])}else{g=false}},timeout:20000,async:false});if(!g){alert(i18nStrings.contentpickerTypeNotValidText);return false}else{return true}}else{alert(i18nStrings.contentpickerSlctCtToLinkText);return false}}};