jive.namespace("places.Manage");jive.places.Manage.CategoryControls=jive.places.Manage.AbstractControls.extend(function(a,b){a.modalContent="#categories-modal";a.modal="#jive-modal-categories";a.activationLink="#jive-link-manageCategories";a.init=function(){var d=this,i=["cancelTagSet","editTagSet","editTagSetById","removeCategoryById"],f,g=[],e;var c=function(){return{ID:f.containerId,objectType:f.containerType}},h=function(k){$j("#category-message").html(k||"")};function j(k){alert(jive.tags.soy.globalErrorMessage({message:k||""}))}b.init.call(this);this.addListener("load.after",function(k){e=k.$modal;f=jive.util.extractDataAttributes(e.find(".jive-modal-content-categories")[0]);d.attachEvents();d.cancelTagSet();d.loadTagSets();d.loadPopularTags()});this.attachEvents=function(){e.delegate("[data-event]","click",function(l){l.preventDefault();var k=jive.util.extractDataAttributes(this);i.indexOf(k.event)>-1&&d[k.event].call(d,k)});$j("#jive-category-form").unbind("submit").submit(function(k){k.preventDefault();d.saveTagSet($j("#jive-modal-categories"))})};this.cancelTagSet=function(){e.find(".jive-modal-title-add-category, .jive-modal-add-category, .jive-modal-title-edit-category, .jive-modal-edit-category").hide();e.find(".jive-modal-title-manage-categories, .jive-modal-categories-listing").show()};this.loadPopularTags=function(){ManageTagSet.popularTags(c(),{errorHandler:j,timeout:5000,callback:function(l){var k=$j("<div />"),m=jive.namespace.call(window,"Community.feed");g=l.map(function(n,o){m[o]=1;return{name:k.text(n).html(),text:n}})}})};this.loadTagSets=function(){ManageTagSet.list(c(),{errorHandler:j,timeout:5000,callback:d.populateTagSets})};this.populateTagSet=function(k){h(k.usageMessage);$j("#categoryID").val(k.ID);$j("#categoryName").val(k.name);$j("#jive-tags").val(k.tags.join(" "));var l=$j("<ul />");$j.each(g,function(){l.append(jive.tags.soy.renderPopulateTagsetListItem(this))});$j("#jive-category-recommendedtags-container ul").replaceWith(l)};this.populateTagSets=function(m){var k=f.maxTagSetCount,l=m.length;e.find(".jive-modal-category-list").html(jive.tags.soy.buildCategoryDisplay({categories:m})).end().find(".add").toggle(l<k).end().find(".overflow").toggle(!(l<k));if(l<k){$j(".jive-category-remaining").text(jive.tags.soy.remainingMessage({count:l}))}else{$j(".jive-category-overflow").text(l-k);$j(".jive-category-max").text(k)}};this.removeCategoryById=function(l){var k={ID:l.id,containerID:c().ID,containerType:c().objectType};confirm(jive.tags.soy.confirmDeletion())&&ManageTagSet.remove(k,{errorHandler:j,timeout:5000,callback:d.populateTagSets})};this.saveTagSet=function(l){var k={ID:$j("#categoryID").val(),name:$j("#categoryName").val(),tags:($j("#jive-tags").val()||"").split(" "),autoCategorize:!!$j("#autoCategorize").prop("checked"),containerID:c().ID,containerType:c().objectType};ManageTagSet.add(k,{errorHandler:j,timeout:5000,callback:d.populateTagSets});l=l.length?l:e;l.find(".jive-modal-title-add-category, .jive-modal-add-category, .jive-modal-title-edit-category, .jive-modal-edit-category").hide();l.find(".jive-modal-title-manage-categories, .jive-modal-categories-listing").show()};this.editTagSet=function(k){e.find(".jive-modal-title-manage-categories, .jive-modal-categories-listing").hide();$j("#autoCategorize-container, .jive-modal-add-category, .jive-modal-title-add-category").show();h(jive.tags.soy.introTextAdd());this.populateTagSet({ID:"-1",name:"",tags:[],autoCategorize:$j("#autoCategorize").prop("checked"),containerID:k.id,containerType:k.objectType})};this.editTagSetById=function(k){ManageTagSet.tagSet(k.id,{errorHandler:j,timeout:5000,callback:function(l){d.populateTagSet(l);h(jive.tags.soy.introTextEdit({count:l.count}))}});$j("#autoCategorize-container, .jive-modal-title-manage-categories, .jive-modal-categories-listing").hide();$j(".jive-modal-title-edit-category, .jive-modal-add-category").show()}}});