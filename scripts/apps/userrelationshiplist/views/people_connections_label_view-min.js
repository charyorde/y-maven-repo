jive.namespace("UserRelationshipList");jive.UserRelationshipList.PeopleConnectionsLabelView=jive.AbstractView.extend(function(a){var b=jQuery;this.init=function(c,e,g){var d=this;this.active=true;d.bidirectionalConnections=e;var f=$j("#j-relationship-label-list li.js-label-create-item");f.find("a").click(function(h){var i=$j("#j-relationship-label-list li.js-label-input-item");if(i.length==0){f.before(jive.people.relationshipLabelInput({}));d.attachColorPicker()}f.prev().find("input:text").select();f.hide();h.preventDefault()});b("#j-relationship-label-list").delegate("li.j-label-item","mouseover mouseout",function(h){if(h.type=="mouseover"){$j(this).find(".j-label-actions").show()}else{$j(this).find(".j-label-actions").hide()}h.preventDefault()});b("#j-relationship-label-list").delegate("a.js-edit-link","click",function(j){d.cancelEdit($j("#j-relationship-label-list li.js-label-input-item"));var i=$j(this).parents("li:first");var h={listID:i.attr("data-list-id"),filterID:i.attr("data-filter-id"),memberCount:i.data("member-count"),css:d.colorToHexString(i.find(".j-label-css").css("background-color")),name:i.find(".j-label-name").text()};i.replaceWith(jive.people.relationshipLabelInput(h));d.attachColorPicker();b("#j-relationship-label-list li.js-label-input-item").find(".js-color-sample").css("background-color","#"+h.css);b("#js-create-label-input").focus();j.preventDefault()});b("#j-relationship-label-list").delegate("li.js-label-input-item form","submit",function(h){var n=b(this).closest("li");var r=n.attr("data-list-id");var o=n.attr("data-filter-id");var l=n.data("member-count");var i=n.find("input[name='labelName']").val();var k=d.colorToHexString(n.find("input[name='css']").val());if(!i||!k){$j("<p/>").html(g.errMsg).message({style:"error"})}else{var p={name:i,css:k};if(!o){var j=$j("#j-relationship-label-list");var q=j.closest("li").attr("data-filter-id");var m=j.attr("data-child-id-pattern");d.emitP("labelCreated",p,q,m).addCallback(function(s){p=s;n.replaceWith(jive.people.relationshipLabel(p))})}else{p=$j.extend({},p,{id:r,listID:r});d.emitP("labelUpdated",p).addCallback(function(){p=$j.extend({},p,{filterID:o,memberCount:l});n.replaceWith(jive.people.relationshipLabel(p))})}f.show()}h.preventDefault()});b("#j-relationship-label-list").delegate("li.js-label-input-item input.js-cancel-link","click",function(){d.cancelEdit($j(this).parents("li:first"));f.show()});b("#j-relationship-label-list").delegate("a.js-del-link","click",function(l){if(confirm(g.delMsg)){var h=$j(this).parents("li:first");var k=$j(h);var j=k.attr("data-list-id");var i=k.attr("data-filter-id");var m=k.closest("li.j-browse-filter-group-item").attr("data-filter-id");if(j!=null){d.emitP("labelRemoved",j,i,m).addCallback(function(){h.remove()})}}l.preventDefault()});b("#j-relationship-label-list").delegate("li.j-label-item a.js-select-link","click",function(){var i=$j(this).closest("li");var h=i.attr("data-list-id");d.refreshFeedLink({listID:h,bidirectionalConnections:this.bidirectionalConnections})});$j("li.j-browse-filter-group-item").click(function(){d.refreshFeedLink({bidirectionalConnections:this.bidirectionalConnections})})};this.cancelEdit=function(f){var e=f.attr("data-list-id");var c=f.data("member-count");if(e){var d={listID:e,filterID:f.attr("data-filter-id"),name:f.attr("data-name"),css:f.attr("data-css"),memberCount:c};f.replaceWith(jive.people.relationshipLabel(d))}else{f.remove()}};this.attachColorPicker=function(){var d=$j("#j-relationship-label-list li.js-label-input-item");var c=d.find("input[name='css']");this.createColorInput(c)};this.activate=function(){$j("#j-relationship-label-list").show();$j("#j-friend-feed-link").show();this.active=true};this.passivate=function(){$j("#j-relationship-label-list").hide();$j("#j-friend-feed-link").hide();this.active=false};this.isActive=function(){return this.active};this.incrementLabelCount=function(e){var c=$j("#j-relationship-label-list li.j-label-item[data-list-id='"+e+"']");c.removeClass("empty");var d=c.data("member-count")+1;c.data("member-count",d);c.find(".js-member-count").text(d)};this.decrementLabelCount=function(e){var c=$j("#j-relationship-label-list li.j-label-item[data-list-id='"+e+"']");var d=c.data("member-count")-1;d=d>=0?d:0;c.data("member-count",d);c.find(".js-member-count").text(d);if(!d){c.addClass("empty")}};this.refreshFeedLink=function(c){$j("#j-friend-feed-link").replaceWith(jive.people.friendFeedLink(c))};a.rgb=/rgb\(\s*(\d+),\s*(\d+),\s*(\d+)\s*\)/;a.hash=/^#/;a.colorToHexString=function(c){var d=c.match(this.rgb);if(d){return d.slice(1).map(function(f){var e=parseInt(f,10).toString(16);return e.length>1?e:"0"+e}).join("")}else{return c.replace(this.hash,"")}};this.createColorInput=function(f){var c="ba0101,f2839d,fa8101,fef002,1ebb00,005ebb,9e13aa,9b9b9b,000000",h=$j("<div class='j-color-sample js-color-sample'><a href='#' class='j-ui-elem'></a></div>"),e=$j("<div id='js-color-picker' class='j-color-picker'></div>");b.each(c.split(","),function(i,j){e.append(b("<a href='javascript:;' class='j-rc3'></a>").css({backgroundColor:"#"+j}).click(function(k){f.val("#"+j);g();e.trigger("close");$j("#js-create-label-input").select();k.preventDefault()}))});if(!f.val()){f.val("#"+c.split(",")[Math.floor(Math.random()*c.split(",").length)])}g();f.click(function(i){d($j(this));i.preventDefault()}).change(g).keyup(g);h.click(function(i){d($j(this));i.preventDefault()});f.after(e.hide()).after(h);f.parents(".properties").click(function(i){e.trigger("close");i.preventDefault()});function g(){h.css("background-color",f.val())}function d(i){if(!e.is(":visible")){e.find("a").show();e.popover({context:i,darkPopover:true,destroyOnClose:false,putBack:true,beforeClose:function(){e.find("a").css("left","8px");e.width(e.find("a:first").outerWidth()+"px")},onLoad:function(){var n=e.find("a:first"),j=n.outerWidth(),l=parseInt(n.css("margin-right"),10),k=e.find("a").length,m=parseInt(n.css("left"),10);e.find("a").each(function(){$j(this).animate({left:m+($j(this).index()*(j+l))},200)});e.animate({width:k*(j+l)},200)}}).closest(".js-pop").addClass("j-popme-small")}}}});