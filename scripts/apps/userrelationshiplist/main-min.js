jive.namespace("UserRelationshipList");jive.UserRelationshipList.Main=jive.Filters.Main.extend(function(a,b){this.init=function(d){b.init.call(this,d);var c=this;c.labelSource=new jive.UserRelationshipListSource();c.peopleLabelView=new jive.UserRelationshipList.PeopleConnectionsLabelView(d.labelLists,d.bidirectionalConnections,d.i18n);this.manageLabelView(this.filterGroup.applied(this.getState().filterID).getIDs());this.peopleLabelView.addListener("labelCreated",function(e,h,f,g){c.labelSource.save(e).addCallback(function(i){i.filterID=f.replace(/\\/g,"").replace(/\(\.\*\)/g,i.listID);var j=c.filterGroup.get(h);j.children.push({id:i.filterID,parentID:h,description:e.name,css:e.css,type:"simple",nested:true,listID:i.listID,memberCount:0,searchable:true,objectTypes:[],sorts:[],descriptionArgs:null,exclusive:true});jive.switchboard.emit("userlabel.created",jQuery.extend({},e,{listID:i.listID}));g.emitSuccess(i)})});this.peopleLabelView.addListener("labelUpdated",function(e,f){c.labelSource.save(jQuery.extend(e,{id:e.listID})).addCallback(function(g){jive.switchboard.emit("userlabel.updated",jQuery.extend({},e,g));f.emitSuccess(g);c.loadPage(c.getState(),true)})});this.peopleLabelView.addListener("labelRemoved",function(f,e,h,g){c.labelSource.destroy(f).addCallback(function(i){jive.switchboard.emit("userlabel.removed",{id:f});g.emitSuccess(i);c.loadPage(c.getState(),true)});if(e==c.getState().filterID){c.pushState({filterID:c.mergeFilters({remove:e})})}});jive.switchboard.addListener("userlabel.applied",function(f,e){c.peopleLabelView.incrementLabelCount(f.id)});jive.switchboard.addListener("userlabel.unapplied",function(g,f){c.peopleLabelView.decrementLabelCount(g.id);var e=c.getState().filterID;if(e.length>0&&e[0].indexOf("following~label["+g.id+"]")===0){c.removeGridItem({id:f,type:3})}});jive.switchboard.addListener("unfollow.user",function(e){if(c.peopleLabelView.isActive()){if(e.labelIDs){e.labelIDs.forEach(function(f){c.peopleLabelView.decrementLabelCount(f)})}}c.loadPage(c.getState(),false)})};a.loadPage=function(c,d){this.manageLabelView(c.filterID);return b.loadPage.apply(this,arguments)};a.manageLabelView=function(c){if(c.some(function(d){return d.indexOf("following")>=0})){this.peopleLabelView.activate()}else{this.peopleLabelView.passivate()}}});