jive.namespace("Moderation");jive.Moderation.InboxView=jive.AbstractView.extend(function(a){var b=jQuery;a.init=function(d){var c=this;c.currentRow=null;c.processKey=true;this.$moderationContainer=$j("#jive-inbox-moderation-container");this.$moderationContainer.delegate(".js-pagination a","click",function(f){c.showSpinner();var e=$j(this).attr("href");c.emitP("paginate",e).addCallback(function(g){c.update(g)});f.preventDefault()});this.$moderationContainer.delegate("#filterForm input[type=submit]","click",function(f){var e=$j(this).closest("form");c.emit("filter",e);f.preventDefault()});this.$moderationContainer.delegate("td.j-td-icon, td.j-td-title, td.j-td-date, td.j-td-mod-abuse, td.j-td-mod-action","click",function(g){var h=$j(this).closest("tr").data("message-index");c.setCurrentRow(h);var f=$j(g.target).attr("href");if(typeof(f)=="undefined"||f=="#"||f.substring(0,12)=="javascript:"){g.preventDefault()}});this.$moderationContainer.delegate("a.js-mod-type, a.js-mod-subject","click",function(f){var g=$j(this).closest("tr").data("message-index");c.toggleBody(g);f.preventDefault()});this.$moderationContainer.delegate("a.j-mod-kbd-commands","click",function(g){var f=$j(this),h=c.$moderationContainer.find(".js-keyboard-tips");h.popover({context:f,darkPopover:false,destroyOnClose:false,putBack:true});g.preventDefault()});$j(document).keyup(function(e){c.handleEvent(e.keyCode)})};this.update=function(c){this.$moderationContainer.html(c);this.hideSpinner();this.setCurrentRow(1);this.setDDState();this.bindHandlers()};a.bindHandlers=function(){var c=this;c.globalToggle=$j("#js-mod-dd-messages");c.globalToggle.change(function(d){c.toggleAll($j(this).val())});c.globalToggle.focus(function(d){c.processKey=false});c.globalToggle.blur(function(d){c.processKey=true});$j(".js-mod-dd-message").change(function(d){var f=$j(this).closest("tr").data("message-index");c.toggleHighlight(this,f)});$j(".jive-mod-showtext").click(function(d){c.showAll();d.preventDefault()});$j(".jive-mod-hidetext").click(function(d){c.hideAll();d.preventDefault()});$j("input[name='modnote'], #filterForm input[type='text']").focus(function(d){c.processKey=false});$j("input[name='modnote'], #filterForm input[type='text']").blur(function(d){c.processKey=true});$j(".jive-table-mod-editNote").click(function(g){var d=$j(this);var f=d.closest(".jive-table-mod-notebody").find("span.notevalue").first().text();c.editNote(d.data("workflow-id"),d.data("user-id"),f);g.preventDefault()});$j(".js-save-note").click(function(f){var d=$j(this);c.saveNote(d.data("workflow-id"),d.data("user-id"));f.preventDefault()});$j("#messageForm").bind("submit.confirmModal",function(d){if($j("#showAgain").val()=="true"){d.preventDefault();c.confirmForm()}})};a.handleEvent=function(d){if(this.processKey){if(d==40){this.setNextRow(this.currentRow)}else{if(d==38){this.setPreviousRow(this.currentRow)}else{if(d==83){this.toggleBody(this.currentRow.index)}else{if(d==65){var c=$j("#mod-dd-message-"+this.currentRow.index);c.value=1;this.toggleHighlight(c,this.currentRow.index)}else{if(d==82){var c=$j("#mod-dd-message-"+this.currentRow.index);c.value=3;this.toggleHighlight(c,this.currentRow.index)}else{if(d==69){var c=$j("#mod-dd-message-"+this.currentRow.index);c.value=2;this.toggleHighlight(c,this.currentRow.index)}else{if(d==68){var c=$j("#mod-dd-message-"+this.currentRow.index);c.value=0;this.toggleHighlight(c,this.currentRow.index)}}}}}}}}};a.setNextRow=function(d){var c=$j(d).data("message-index");if(c){this.setCurrentRow(parseInt(++c))}};a.setPreviousRow=function(d){var c=$j(d).data("message-index");if(c){this.setCurrentRow(parseInt(--c))}};a.setCurrentRow=function(c){if(this.currentRow!=null&&this.currentRow.index!=c){$j("#mod-row-img-"+this.currentRow.index).hide();$j("#mod-subject-"+this.currentRow.index).blur()}if(this.rowExists(c)){this.currentRow=$j("#mod-message-row-"+c);$j("#mod-row-img-"+c).show();this.currentRow.index=c}else{if(this.rowExists(1)){this.setCurrentRow(1)}}};a.rowExists=function(c){return $j("#mod-message-row-"+c).length>0};a.setDDState=function(d){var c=this;$j("#mod-message-tbody [id^=mod-dd-message-]").each(function(){var f=this;var e=f.id.split("-").last();c.toggleHighlight(f,e)})};a.toggleAll=function(d){var c=this;$j("#mod-message-tbody [id^=mod-dd-message-]").each(function(){var f=this;var e=f.id.split("-").last();f.value=d;c.toggleHighlight(f,e)})};a.toggleHighlight=function(e,c){var f=null;var d=$j(e);if(d.parent().length>0&&d.parent().parent().length>0){f=d.parent().parent()}if(f&&f.length>0){if(e.value==1){$j("#jive-table-mod-view-"+c).removeClass().addClass("jive-table-mod-view-approve");$j(f).removeClass().addClass("jive-mod-msg-row-app");$j(e).val("1")}else{if(e.value==3){$j("#jive-table-mod-view-"+c).removeClass().addClass("jive-table-mod-view-reject");$j(f).removeClass().addClass("jive-mod-msg-row-rej");$j(e).val("3")}else{this.viewBody(c);$j("#jive-table-mod-view-"+c).removeClass().addClass("jive-table-mod-view");$j(f).removeClass().addClass("jive-mod-msg-row");$j(e).val("")}}}};a.viewBody=function(c){$j("#mod-view-message-"+c).show()};a.showBody=function(c){$j("#mod-message-body-"+c).show()};a.hideBody=function(c){$j("#mod-message-body-"+c).hide()};a.toggleBody=function(c){$j("#mod-message-body-"+c).toggle()};a.showAll=function(){$j("#mod-message-tbody [id^=mod-message-body-]").show()};a.hideAll=function(){$j("#mod-message-tbody [id^=mod-message-body-]").hide()};a.decrementCount=function(c,h){var g=$j("#pendingCount"+c+"-"+h);var f=$j("#totalCount");var e=g.text();var d=f.text();if(e&&d){e=parseInt(e,10)-1;d=parseInt(d,10)-1;g.text(e);f.text(d)}};a.editNote=function(h,e,f){var c=this;$j("#modnote01-"+h+"-"+e).val(f);var d=$j("#noteBox-"+h+"-"+e);d.show();var g=$j("#jive-mod-noteform-"+h+"-"+e);$j("#jive-table-mod-notesubmit-"+h).one("click",function(){c.saveNote(h,e)});g.show()};a.saveNote=function(j,e){var g=$j("#jive-table-mod-note-"+j);var k=new Date();var h=$j("#modnote01-"+j+"-"+e).val();var f=$j("#noteBox-"+j+"-"+e);f.show();var c=$j("#noteBox-"+j+"-"+e+" .notevalue");c.text(h);var i=$j("#jive-mod-noteform-"+j+"-"+e);i.hide();$j("#mod_note-"+j).val(h);this.emit("note",j,e,h)};a.confirmForm=function(){var c=$j("#jive-modal-confirm");c.lightbox_me({destroyOnClose:false,onLoad:function(){c.on("click","#jive-approve-button",function(d){$j("#showAgain").val($j("#dontShowAgainModal").is(":checked")?"false":"true");$j("#messageForm").unbind("submit.confirmModal");d.preventDefault();$j("#messageForm").submit()})},closeSelector:".j-modal-close-top, .close"})}});