$j(document).ready(function(){var l=[];var f=[];var g=null;function j(){if(g===null){g=window.setTimeout(function(){g=null;$j("#js-proxy-server-messages").remove();var n=null;if(l.length){n=jive.admin.network.proxy.renderErrorMessages({messages:l});l.length=0;f.length=0}else{if(f.length){n=jive.admin.network.proxy.renderSuccessMessages({messages:f});f.length=0;g=window.setTimeout(arguments.callee,10000)}}if(n){var m=$j("<div/>").attr("id","js-proxy-server-messages");m.html(n);m.prependTo(".jive-body-contentBox");window.scrollTo(0,0)}},1)}}function d(m){if(m){l.push(m);j()}}function h(m){if(m){f.push(m);j()}}function k(){var n=Boolean($j("#enabled:checked").val());var m=Boolean($j("#useAuth:checked").val());if(n&&m){$j("#js-proxy-server-settings").removeClass("block-disabled").find(".js-proxy-server-settings input").removeAttr("disabled");$j("#js-proxy-auth-settings").removeClass("block-disabled").find(".js-proxy-auth-settings input").removeAttr("disabled")}else{if(n){$j("#js-proxy-server-settings").removeClass("block-disabled").find(".js-proxy-server-settings input").removeAttr("disabled");$j("#js-proxy-auth-settings").addClass("block-disabled").find(".js-proxy-auth-settings input").attr("disabled","disabled")}else{$j("#js-proxy-server-settings").addClass("block-disabled").find(".js-proxy-server-settings input").attr("disabled","disabled");$j("#js-proxy-auth-settings").addClass("block-disabled").find(".js-proxy-auth-settings input").attr("disabled","disabled")}}if(a().toString()==i.toString()){$j("#js-proxy-server-settings-submit").attr("disabled","disabled")}else{$j("#js-proxy-server-settings-submit").removeAttr("disabled")}}function c(n){var m=jive.admin.network.proxy.renderNonProxyHostsTable({nonProxyHosts:n});$j("#js-non-proxy-hosts").html(m)}function a(){var m={enabled:Boolean($j("#enabled:checked").val()),host:$j("#proxyHost").val(),port:$j("#proxyPort").val(),nonProxyHosts:$j("#nonProxyHosts").val(),useAuth:Boolean($j("#useAuth:checked").val()),username:$j("#proxyUsername").val(),password:$j("#proxyPassword").val(),toString:function(){var n=[];if(this.enabled){n.push("enabled");n.push(this.host);n.push(String(this.port));n.push(this.nonProxyHosts);if(this.useAuth){n.push(this.username);n.push(this.password||b)}}else{n.push("disabled")}return n.join("\n")}};if(m.password==b){delete m.password}return m}function e(){var q="";if($j("#proxyPassword").val()){var m=[];var p="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789`-=[]\\;',./~!@#$%^&*()_+{}|:\"<>?";for(var n=0;n<16;n++){var o=Math.floor(Math.random()*p.length);m.push(p.charAt(o))}q=m.join("");$j("#proxyPassword").val(q)}return q}var i=a();var b=e();$j("#enabled, #useAuth").bind("click change",k);$j("#proxyHost, #proxyPort, #proxyUsername, #proxyPassword").keyup(k);$j("#js-proxy-server-settings-submit").click(function(n){var m=a();if(m.enabled){if(typeof m.port=="string"&&!m.port.match(/^\d+$/)){d("The proxy port must be a number from 1 to 65535.")}if(m.port<=0||m.port>=65536){d("The proxy port must be a number from 1 to 65535.")}if(!(/^([-0-9a-z]+|\*)(\.[-0-9a-z]+)*$/i.test(m.host))){d("The proxy host does not appear to be valid.")}if(m.useAuth){if(!m.username){d("Username is not specified.")}if(!b&&!m.password){d("Password is not specified.")}}}if(l.length){return}n.preventDefault();$j("#js-proxy-server-settings-submit").attr("disabled","disabled");$j.ajax({type:"POST",url:_jive_base_url+"/__services/v2/rest/admin/network/proxy",data:JSON.stringify(m),contentType:"application/json",success:function(){h("Proxy settings successfully updated. Settings will take 30 seconds to become active.");b=e();i=a();k()},error:function(r){$j("#js-proxy-server-settings-submit").removeAttr("disabled");var q=$j.parseJSON(r.responseText||"[]").messages||[];for(var p=0,o=q.length;p<o;p++){d(q[p])}}});j()});$j("#js-non-proxy-hosts").delegate(".js-add-host","click",function(q){var p=$j("#newNonProxyHost").val();var r=$j("#nonProxyHosts").val();r=r?r.split("|"):[];for(var o=0,m=r.length;o<m;o++){var n=r[o];if(n==p){d("This host is already present in the list of non-proxy hosts.");return}}r.push(p);$j("#nonProxyHosts").val(r.join("|"));c(r);k();q.preventDefault()});$j("#js-non-proxy-hosts").delegate(".js-delete-host","click",function(r){var o=$j(this);var q=o.attr("data-host");var s=$j("#nonProxyHosts").val();s=s?s.split("|"):[];for(var p=0,m=s.length;p<m;p++){var n=s[p];if(n==q){s.splice(p,1);o.closest("tr").remove();break}}$j("#nonProxyHosts").val(s.join("|"));c(s);k();r.preventDefault()});$j(window).bind("beforeunload",function(m){if(a().toString()!=i.toString()){return $j("#js-proxy-server-unsaved-changes").text()}})});