module("Jive Blackout Plugin",{autostart:false});test("blackout a paragraph",function(){ed.setContent("<p>first</p>");var d=ed.getBody().firstChild;var c=ed.plugins.jiveblackout.showBlackout(ed,d);var b=editor.get("wysiwygtext");var a=b.getPopOverContainer().find(".blackout");equals(ed.getContent(),"<p>first</p>");equals(a.length,4,"there are 4 blackouts");near(a.filter(".b").position().top,8+$j(d).height(),2,"blackout is positioned correctly");near(a.filter(".l").position().top,0,2,"blackout is positioned correctly");near(a.filter(".t").position().top,0,2,"blackout is positioned correctly");near(a.filter(".r").position().top,0,2,"blackout is positioned correctly");near(a.filter(".b").position().left,8,2,"blackout is positioned correctly");near(a.filter(".l").position().left,0,2,"blackout is positioned correctly");near(a.filter(".t").position().left,8,2,"blackout is positioned correctly");near(a.filter(".r").position().left,8+$j(d).width(),2,"blackout is positioned correctly");equals(a.filter(".b").width()+a.filter(".l").width()+a.filter(".r").width(),b.getContentAreaWidth(),"width is correct");equals(a.filter(".t").width()+a.filter(".l").width()+a.filter(".r").width(),b.getContentAreaWidth(),"width is correct");equals(a.filter(".l").height(),b.getContentAreaHeight(),"height is correct");equals(a.filter(".r").height(),b.getContentAreaHeight(),"height is correct");equals(a.filter(".t").height(),$j(d).position().top,"height is correct");equals(a.filter(".b").height(),b.getContentAreaHeight()-($j(d).position().top+$j(d).height()),"height is correct")});test("blackout an image",function(){ed.setContent('<p><img src="slickspeed/logo.png" width=200 height=200></p>');var b=ed.getBody().firstChild.firstChild;var d=ed.plugins.jiveblackout.showBlackout(ed,b);var c=editor.get("wysiwygtext");var a=c.getPopOverContainer().find(".blackout");equals(a.length,4,"there are 4 blackouts");near(a.filter(".b").position().top,$j(b).position().top+$j(b).height(),2,"blackout is positioned correctly");near(a.filter(".l").position().top,0,2,"blackout is positioned correctly");near(a.filter(".t").position().top,0,2,"blackout is positioned correctly");near(a.filter(".r").position().top,0,2,"blackout is positioned correctly");near(a.filter(".b").position().left,8,2,"blackout is positioned correctly");near(a.filter(".l").position().left,0,2,"blackout is positioned correctly");near(a.filter(".t").position().left,8,2,"blackout is positioned correctly");near(a.filter(".r").position().left,8+$j(b).width(),2,"blackout is positioned correctly");equals(a.filter(".b").width()+a.filter(".l").width()+a.filter(".r").width(),c.getContentAreaWidth(),"width is correct");equals(a.filter(".t").width()+a.filter(".l").width()+a.filter(".r").width(),c.getContentAreaWidth(),"width is correct");equals(a.filter(".l").height(),c.getContentAreaHeight(),"height is correct");equals(a.filter(".r").height(),c.getContentAreaHeight(),"height is correct");near(a.filter(".t").height(),$j(b).position().top,1,"height is correct");near(a.filter(".b").height(),c.getContentAreaHeight()-($j(b).position().top+$j(b).height()),1,"height is correct")});test("blackout a tall 1",function(){ed.setContent('<p><img src="slickspeed/logo.png" width=200 height=1000></p>');var b=ed.getBody().firstChild.firstChild;var d=ed.plugins.jiveblackout.showBlackout(ed,b);var c=editor.get("wysiwygtext");var a=c.getPopOverContainer().find(".blackout");equals(a.length,3,"there are 3 blackouts");near(a.filter(".l").position().top,0,2,"blackout is positioned correctly");near(a.filter(".t").position().top,0,2,"blackout is positioned correctly");near(a.filter(".r").position().top,0,2,"blackout is positioned correctly");near(a.filter(".l").position().left,0,2,"blackout is positioned correctly");near(a.filter(".t").position().left,8,2,"blackout is positioned correctly");near(a.filter(".r").position().left,8+$j(b).width(),2,"blackout is positioned correctly");equals(a.filter(".b").length,0,"the bottom blackout isn't there");equals(a.filter(".t").width()+a.filter(".l").width()+a.filter(".r").width(),c.getContentAreaWidth(),"width is correct");equals(a.filter(".l").height(),c.getContentAreaHeight(),"height is correct");equals(a.filter(".r").height(),c.getContentAreaHeight(),"height is correct");near(a.filter(".t").height(),$j(b).position().top,1,"height is correct")});asyncTest("blackout a tall scrolled 1",function(){ed.setContent('<p><img src="slickspeed/logo.png" width=200 height=1000></p>');var a=ed.getBody().firstChild.firstChild;var c=ed.plugins.jiveblackout.showBlackout(ed,a);var b=editor.get("wysiwygtext");setTimeout(function(){var d=b.getPopOverContainer().find(".blackout");equals(d.length,2,"there are 2 blackouts");equals($j(ed.getWin()).scrollTop(),100,"the window has scrolled");near(d.filter(".l").position().top,100,2,"blackout is positioned correctly");near(d.filter(".r").position().top,100,2,"blackout is positioned correctly");near(d.filter(".l").position().left,0,2,"blackout is positioned correctly");near(d.filter(".r").position().left,8+$j(a).width(),2,"blackout is positioned correctly");equals(d.filter(".t, .b").length,0,"the top & bottom blackout aren't there");equals(d.filter(".l").width(),$j(a).position().left,"height is correct");equals(d.filter(".r").width(),b.getContentAreaWidth()-($j(a).position().left+$j(a).width()),"width is correct");equals(d.filter(".l").height(),b.getContentAreaHeight(),"height is correct");equals(d.filter(".r").height(),b.getContentAreaHeight(),"height is correct");start()},1500);setTimeout(function(){$j(ed.getWin()).scrollTop(100);$j(ed.getBody()).parents("html").andSelf().scrollTop(100)},600)});asyncTest("blackout a tall scrolled 2",function(){ed.setContent('<p><img src="slickspeed/logo.png" width=200 height=1000></p>');var a=ed.getBody().firstChild.firstChild;var c=ed.plugins.jiveblackout.showBlackout(ed,a);var b=editor.get("wysiwygtext");setTimeout(function(){var d=b.getPopOverContainer().find(".blackout");equals(d.length,3,"there are 3 blackouts");equals($j(ed.getWin()).scrollTop(),1000-b.getContentAreaHeight()+16,"the window has scrolled");near(d.filter(".b").position().top,8+$j(a).height(),2,"blackout is positioned correctly");near(d.filter(".l").position().top,$j(ed.getWin()).scrollTop(),2,"blackout is positioned correctly");near(d.filter(".r").position().top,$j(ed.getWin()).scrollTop(),2,"blackout is positioned correctly");near(d.filter(".b").position().left,8,2,"blackout is positioned correctly");near(d.filter(".l").position().left,0,2,"blackout is positioned correctly");near(d.filter(".r").position().left,8+$j(a).width(),2,"blackout is positioned correctly");equals(d.filter(".t").length,0,"the top blackout isn't there");equals(d.filter(".b").width()+d.filter(".l").width()+d.filter(".r").width(),b.getContentAreaWidth(),"width is correct");equals(d.filter(".l").width(),$j(a).position().left,"height is correct");equals(d.filter(".r").width(),b.getContentAreaWidth()-($j(a).position().left+$j(a).width()),"width is correct");equals(d.filter(".l").height(),b.getContentAreaHeight(),"height is correct");equals(d.filter(".r").height(),b.getContentAreaHeight(),"height is correct");start()},1500);setTimeout(function(){$j(ed.getWin()).scrollTop(1000)},600)});test("blackout a wide 1",function(){var c=editor.get("wysiwygtext");var d=c.getContentAreaWidth()+100;ed.setContent('<p><img src="slickspeed/logo.png" width='+d+" height=200></p>");var b=ed.getBody().firstChild.firstChild;var e=ed.plugins.jiveblackout.showBlackout(ed,b);var a=c.getPopOverContainer().find(".blackout");equals(a.length,3,"there are 3 blackouts");near(a.filter(".b").position().top,$j(b).position().top+$j(b).height(),2,"blackout is positioned correctly");near(a.filter(".l").position().top,0,2,"blackout is positioned correctly");near(a.filter(".t").position().top,0,2,"blackout is positioned correctly");near(a.filter(".b").position().left,$j(b).position().left,2,"blackout is positioned correctly");near(a.filter(".l").position().left,0,2,"blackout is positioned correctly");near(a.filter(".t").position().left,$j(b).position().left,2,"blackout is positioned correctly");equals(a.filter(".r").length,0,"the right blackout isn't there");equals(a.filter(".b").width()+a.filter(".l").width(),c.getContentAreaWidth(),"width is correct");equals(a.filter(".t").width()+a.filter(".l").width(),c.getContentAreaWidth(),"width is correct");equals(a.filter(".l").height(),c.getContentAreaHeight(),"height is correct");equals(a.filter(".t").height(),$j(b).position().top,"height is correct");equals(a.filter(".b").height(),c.getContentAreaHeight()-($j(b).position().top+$j(b).height()),"height is correct")});if(tinymce.isIE){asyncTest("blackout a wide scrolled 1",function(){var b=editor.get("wysiwygtext");var c=b.getContentAreaWidth()+100;ed.setContent('<p><img src="slickspeed/logo.png" width='+c+" height=200></p>");var a=ed.getBody().firstChild.firstChild;var d=ed.plugins.jiveblackout.showBlackout(ed,a);setTimeout(function(){var e=b.getPopOverContainer().find(".blackout");equals(e.length,3,"there are 2 blackouts");near($j(ed.getWin()).scrollLeft(),c-b.getContentAreaWidth()+16,2,"the window has scrolled");near(e.filter(".b").position().top,$j(a).position().top+$j(a).height(),2,"blackout is positioned correctly");near(e.filter(".t").position().top,0,2,"blackout is positioned correctly");near(e.filter(".r").position().top,$j(ed.getWin()).scrollTop(),2,"blackout is positioned correctly");near(e.filter(".b").position().left,$j(ed.getWin()).scrollLeft(),2,"blackout is positioned correctly");near(e.filter(".t").position().left,$j(ed.getWin()).scrollLeft(),2,"blackout is positioned correctly");near(e.filter(".r").position().left,8+$j(a).width(),2,"blackout is positioned correctly");equals(e.filter(".l").length,0,"the left & right blackout aren't there");near(e.filter(".b").width(),b.getContentAreaWidth()-8,2,"width is correct");near(e.filter(".t").width(),b.getContentAreaWidth()-8,2,"width is correct");equals(e.filter(".b").height(),b.getContentAreaHeight()-($j(a).position().top+$j(a).height()),"height is correct");equals(e.filter(".t").height(),$j(a).position().top,"height is correct");equals(e.filter(".r").width(),b.getContentAreaWidth()-(e.filter(".t").width()),"width is correct");equals(e.filter(".r").height(),b.getContentAreaHeight(),"height is correct");start()},1500);setTimeout(function(){$j(ed.getWin()).scrollLeft(1000)},600)})}if(!tinymce.isIE){asyncTest("blackout a wide scrolled 1",function(){var b=editor.get("wysiwygtext");var c=b.getContentAreaWidth()+100;ed.setContent('<p><img src="slickspeed/logo.png" width='+c+" height=200></p>");var a=ed.getBody().firstChild.firstChild;var d=ed.plugins.jiveblackout.showBlackout(ed,a);setTimeout(function(){var e=b.getPopOverContainer().find(".blackout");equals(e.length,2,"there are 2 blackouts");equals($j(ed.getWin()).scrollLeft(),c-b.getContentAreaWidth()+8,"the window has scrolled");near(e.filter(".b").position().top,$j(a).position().top+$j(a).height(),2,"blackout is positioned correctly");near(e.filter(".t").position().top,0,2,"blackout is positioned correctly");near(e.filter(".b").position().left,$j(ed.getWin()).scrollLeft(),2,"blackout is positioned correctly");near(e.filter(".t").position().left,$j(ed.getWin()).scrollLeft(),2,"blackout is positioned correctly");equals(e.filter(".l, .r").length,0,"the left & right blackout aren't there");equals(e.filter(".b").width(),b.getContentAreaWidth(),"width is correct");equals(e.filter(".t").width(),b.getContentAreaWidth(),"width is correct");equals(e.filter(".b").height(),b.getContentAreaHeight()-($j(a).position().top+$j(a).height()),"height is correct");equals(e.filter(".t").height(),$j(a).position().top,"height is correct");start()},1500);setTimeout(function(){$j(ed.getWin()).scrollLeft(1000)},600)})}asyncTest("blackout a wide scrolled 2",function(){var b=editor.get("wysiwygtext");var c=b.getContentAreaWidth()+100;ed.setContent('<p><img src="slickspeed/logo.png" width='+c+" height=200></p>");var a=ed.getBody().firstChild.firstChild;var d=ed.plugins.jiveblackout.showBlackout(ed,a);setTimeout(function(){var e=b.getPopOverContainer().find(".blackout");equals(e.length,2,"there are 2 blackouts");equals($j(ed.getWin()).scrollLeft(),50,"the window has scrolled");near(e.filter(".b").position().top,$j(a).position().top+$j(a).height(),2,"blackout is positioned correctly");near(e.filter(".t").position().top,0,2,"blackout is positioned correctly");near(e.filter(".b").position().left,$j(ed.getWin()).scrollLeft(),2,"blackout is positioned correctly");near(e.filter(".t").position().left,$j(ed.getWin()).scrollLeft(),2,"blackout is positioned correctly");equals(e.filter(".l, .r").length,0,"the left & right blackout aren't there");equals(e.filter(".b").width(),b.getContentAreaWidth(),"width is correct");equals(e.filter(".t").width(),b.getContentAreaWidth(),"width is correct");equals(e.filter(".t").height(),$j(a).position().top,"height is correct");equals(e.filter(".b").height(),b.getContentAreaHeight()-($j(a).position().top+$j(a).height()),"height is correct");start()},1500);setTimeout(function(){$j(ed.getWin()).scrollLeft(50)},600)});