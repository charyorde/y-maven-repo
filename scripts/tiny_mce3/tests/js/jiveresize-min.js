module("Jive Resize Plugin",{autostart:false});if(tinymce.isWebKit){test("resize an image",function(){ed.setContent('<p><img src="slickspeed/logo.png" width=200 height=200></p>');var b=ed.getBody().firstChild.firstChild;var d=ed.plugins.jiveresize.showCorners(ed,$j(b));var c=editor.get("wysiwygtext");var a=c.getPopOverContainer().find(".handle");equals(a.length,4,"there are 4 handles");near(a.filter(".br").position().top,$j(b).position().top+$j(b).height(),4,"blackout is positioned correctly");near(a.filter(".bl").position().top,$j(b).position().top+$j(b).height(),4,"blackout is positioned correctly");near(a.filter(".tr").position().top,$j(b).position().top,4,"blackout is positioned correctly");near(a.filter(".tl").position().top,$j(b).position().top,4,"blackout is positioned correctly");near(a.filter(".br").position().left,$j(b).position().left+$j(b).width(),4,"blackout is positioned correctly");near(a.filter(".bl").position().left,$j(b).position().left,4,"blackout is positioned correctly");near(a.filter(".tr").position().left,$j(b).position().left+$j(b).width(),4,"blackout is positioned correctly");near(a.filter(".tl").position().left,$j(b).position().left,4,"blackout is positioned correctly")});test("resize a wide image",function(){var c=editor.get("wysiwygtext");var d=c.getContentAreaWidth()+100;ed.setContent('<p><img src="slickspeed/logo.png" width='+d+" height=200></p>");var b=ed.getBody().firstChild.firstChild;var e=ed.plugins.jiveresize.showCorners(ed,$j(b));var a=c.getPopOverContainer().find(".handle");equals(a.length,2,"there are 2 handles");equals(a.filter(".tr, .br").length,0,"the right handles aren't there");near(a.filter(".bl").position().top,$j(b).position().top+$j(b).height(),4,"blackout is positioned correctly");near(a.filter(".tl").position().top,$j(b).position().top,4,"blackout is positioned correctly");near(a.filter(".bl").position().left,$j(b).position().left,4,"blackout is positioned correctly");near(a.filter(".tl").position().left,$j(b).position().left,4,"blackout is positioned correctly")});test("resize an image",function(){ed.setContent('<p><img src="slickspeed/logo.png" width=200 height=2000></p>');var b=ed.getBody().firstChild.firstChild;var d=ed.plugins.jiveresize.showCorners(ed,$j(b));var c=editor.get("wysiwygtext");var a=c.getPopOverContainer().find(".handle");equals(a.length,2,"there are 2 handles");equals(a.filter(".bl, .br").length,0,"the bottom handles aren't there");near(a.filter(".tr").position().top,$j(b).position().top,4,"blackout is positioned correctly");near(a.filter(".tl").position().top,$j(b).position().top,4,"blackout is positioned correctly");near(a.filter(".tr").position().left,$j(b).position().left+$j(b).width(),4,"blackout is positioned correctly");near(a.filter(".tl").position().left,$j(b).position().left,4,"blackout is positioned correctly")});asyncTest("resize a wide scrolled 1",function(){var b=editor.get("wysiwygtext");var c=b.getContentAreaWidth()+100;ed.setContent('<p><img src="slickspeed/logo.png" width='+c+" height=200></p>");var a=ed.getBody().firstChild.firstChild;setTimeout(function(){var e=ed.plugins.jiveresize.showCorners(ed,$j(a));var d=b.getPopOverContainer().find(".handle");equals(d.length,2,"there are 2 handles");equals(d.filter(".tl, .bl").length,0,"the left handles aren't there");near(d.filter(".br").position().top,$j(a).position().top+$j(a).height(),4,"blackout is positioned correctly");near(d.filter(".tr").position().top,$j(a).position().top,4,"blackout is positioned correctly");near(d.filter(".br").position().left,$j(a).position().left+$j(a).width(),4,"blackout is positioned correctly");near(d.filter(".tr").position().left,$j(a).position().left+$j(a).width(),4,"blackout is positioned correctly");start()},1500);setTimeout(function(){$j(ed.getWin()).scrollLeft(1000)},600)});asyncTest("resize wide scrolled 2",function(){var b=editor.get("wysiwygtext");var c=b.getContentAreaWidth()+100;ed.setContent('<p><img src="slickspeed/logo.png" width='+c+" height=200></p>");var a=ed.getBody().firstChild.firstChild;setTimeout(function(){var e=ed.plugins.jiveresize.showCorners(ed,$j(a));var d=b.getPopOverContainer().find(".handle");equals(d.length,0,"there are 0 handles");start()},1500);setTimeout(function(){$j(ed.getWin()).scrollLeft(50)},600)});asyncTest("resize a tall scrolled 3",function(){var b=editor.get("wysiwygtext");ed.setContent('<p><img src="slickspeed/logo.png" width=200 height=2000></p>');var a=ed.getBody().firstChild.firstChild;setTimeout(function(){var d=ed.plugins.jiveresize.showCorners(ed,$j(a));var c=b.getPopOverContainer().find(".handle");equals(c.length,2,"there are 2 handles");equals(c.filter(".tl, .tr").length,0,"the top handles aren't there");near(c.filter(".br").position().top,$j(a).position().top+$j(a).height(),4,"blackout is positioned correctly");near(c.filter(".bl").position().top,$j(a).position().top+$j(a).height(),4,"blackout is positioned correctly");near(c.filter(".br").position().left,$j(a).position().left+$j(a).width(),4,"blackout is positioned correctly");near(c.filter(".bl").position().left,$j(a).position().left,4,"blackout is positioned correctly");start()},1500);setTimeout(function(){$j(ed.getWin()).scrollTop(2000)},600)});asyncTest("resize tall scrolled 4",function(){var b=editor.get("wysiwygtext");ed.setContent('<p><img src="slickspeed/logo.png" width=200 height=2000></p>');var a=ed.getBody().firstChild.firstChild;setTimeout(function(){var d=ed.plugins.jiveresize.showCorners(ed,$j(a));var c=b.getPopOverContainer().find(".handle");equals(c.length,0,"there are 0 handles");start()},1500);setTimeout(function(){$j(ed.getWin()).scrollTop(50)},600)});asyncTest("test can't resize emoticon",function(){setTimeout(function(){var b=editor.get("wysiwygtext");ed.setContent("<p>first </p>",{format:"raw"});var a=ed.dom.createRng();a.setStart(ed.getBody().firstChild.firstChild,6);a.setEnd(ed.getBody().firstChild.firstChild,6);ed.selection.setRng(a);ed.selection.setContent(":");ed.selection.setContent(") ab");type(ed,41);equals(ed.getContent().replace(/[\r\n]+/g,""),'<p>first <img class="jive_macro jive_emote" src="'+CS_RESOURCE_BASE_URL+'/images/emoticons/happy.png" jivemacro="emoticon" ___jive_emoticon_name="happy" /> ab</p>');setTimeout(function(){var d=$j(ed.getBody()).find("img");var e=ed.plugins.jiveresize.showCorners(ed,d);var c=b.getPopOverContainer().find(".handle");equals(c.length,0,"there are 0 handles");start()},300)},300)});asyncTest("test resize table",function(){var c=editor.get("wysiwygtext");ed.setContent("<table width=100 height=100><tr><td>asdf</td><td></td></tr><tr><td></td><td></td></tr></table>");var d=$j(ed.getBody()).find("td");var b=$j(ed.getBody()).find("table");var a=ed.dom.createRng();a.setStart(d.get(0).firstChild,0);a.setEnd(d.get(0).firstChild,0);ed.selection.setRng(a);ed.nodeChanged();setTimeout(function(){var e=c.getPopOverContainer().find(".handle");equals(e.length,4,"there are 4 handles");near(e.filter(".br").position().top,b.position().top+b.height(),4,"blackout is positioned correctly");near(e.filter(".bl").position().top,b.position().top+b.height(),4,"blackout is positioned correctly");near(e.filter(".tr").position().top,b.position().top,4,"blackout is positioned correctly");near(e.filter(".tl").position().top,b.position().top,4,"blackout is positioned correctly");near(e.filter(".tr").position().left,b.position().left+b.width(),4,"blackout is positioned correctly");near(e.filter(".tl").position().left,b.position().left,4,"blackout is positioned correctly");near(e.filter(".br").position().left,b.position().left+b.width(),4,"blackout is positioned correctly");near(e.filter(".bl").position().left,b.position().left,4,"blackout is positioned correctly");start()},600)});test("test nested table",function(){var d=editor.get("wysiwygtext");ed.setContent("<table width=200 height=200><tr><td>asdf</td><td></td></tr><tr><td></td><td><table width=100 height=100><tr><td>asdf</td><td></td></tr><tr><td></td><td></td></tr></table></td></tr></table>");var e=$j(ed.getBody()).find("table:nth(1) td");var c=$j(ed.getBody()).find("table:nth(1)");var b=ed.dom.createRng();b.setStart(e.get(0).firstChild,0);b.setEnd(e.get(0).firstChild,0);ed.selection.setRng(b);ed.nodeChanged();var a=d.getPopOverContainer().find(".handle");equals(a.length,4,"there are 4 handles");near(a.filter(".br").position().top,c.position().top+c.height(),4,"blackout is positioned correctly");near(a.filter(".bl").position().top,c.position().top+c.height(),4,"blackout is positioned correctly");near(a.filter(".tr").position().top,c.position().top,4,"blackout is positioned correctly");near(a.filter(".tl").position().top,c.position().top,4,"blackout is positioned correctly");near(a.filter(".tr").position().left,c.position().left+c.width(),4,"blackout is positioned correctly");near(a.filter(".tl").position().left,c.position().left,4,"blackout is positioned correctly");near(a.filter(".br").position().left,c.position().left+c.width(),4,"blackout is positioned correctly");near(a.filter(".bl").position().left,c.position().left,4,"blackout is positioned correctly")});test("test nested image",function(){var d=editor.get("wysiwygtext");ed.setContent('<table width=200 height=200><tr><td>asdf</td><td></td></tr><tr><td></td><td><img src="slickspeed/logo.png" width=100 height=100></td></tr></table>');var e=$j(ed.getBody()).find("td");var c=$j(ed.getBody()).find("img");var b=ed.dom.createRng();b.setStart(c.get(0),0);b.setEnd(c.get(0),0);ed.selection.setRng(b);ed.nodeChanged();var a=d.getPopOverContainer().find(".handle");equals(a.length,4,"there are 4 handles");near(a.filter(".br").position().top,c.position().top+c.height(),4,"blackout is positioned correctly");near(a.filter(".bl").position().top,c.position().top+c.height(),4,"blackout is positioned correctly");near(a.filter(".tr").position().top,c.position().top,4,"blackout is positioned correctly");near(a.filter(".tl").position().top,c.position().top,4,"blackout is positioned correctly");near(a.filter(".tr").position().left,c.position().left+c.width(),4,"blackout is positioned correctly");near(a.filter(".tl").position().left,c.position().left,4,"blackout is positioned correctly");near(a.filter(".br").position().left,c.position().left+c.width(),4,"blackout is positioned correctly");near(a.filter(".bl").position().left,c.position().left,4,"blackout is positioned correctly")});asyncTest("resize image with mouse events",function(){ed.setContent('<p><img src="slickspeed/logo.png" width="200" height="200"></p>');var b=ed.getBody().firstChild.firstChild;var e=$j(b);var h=ed.plugins.jiveresize.showCorners(ed,$j(b),true);var d=editor.get("wysiwygtext");var a=d.getPopOverContainer().find(".handle");equals(a.length,4,"there are 4 handles");var c=a.filter(".br");var g=0;var f=function(){g++};ed.onResizingNode.add(f);ed.onResizedNode.add(f);e.load(function(){mouseSequence(c.get(0),[{type:"mousedown",clientY:c.offset().top,clientX:c.offset().left},{type:"mousemove",clientY:c.offset().top-60,clientX:c.offset().left-60},"mouseup"],function(){equals(e.width(),140,"width");equals(e.height(),140,"height");equals(g,3,"3 events fired");ed.onResizingNode.remove(f);ed.onResizedNode.remove(f);start()})})});asyncTest("resize table with mouse events",function(){var b=editor.get("wysiwygtext");ed.setContent('<body><table border="1" class="jiveBorder" style="border: 1px solid #000000;" width="200">\n<tbody>\n<tr>\n<th style="text-align: center; background-color: #6690bc; color: #ffffff; padding: 2px;" valign="middle"><strong>Header 1</strong></th><th style="text-align: center; background-color: #6690bc; color: #ffffff; padding: 2px;" valign="middle"><strong>Header 2</strong></th>\n</tr>\n<tr>\n<td style="padding: 2px;"><br /></td>\n<td style="padding: 2px;"><br /></td>\n</tr>\n<tr>\n<td style="padding: 2px;"><br /></td>\n<td style="padding: 2px;"><br /></td>\n</tr>\n</tbody>\n</table>\n<p> </p></body>');var j=$j("table",ed.getBody()).get(0);var h=$j("td:first",ed.getBody()).get(0);var c=ed.dom.createRng();c.setStart(h,0);c.collapse(true);ed.selection.setRng(c);var i=0;ed.nodeChanged();setTimeout(function(){b.getPopOverContainer().find(".resizeRowHandle a.settings").mousedown();ok(ed.plugins.jivetablecontrols.$rowPopover.is(":visible"),"popup is visible")},500);setTimeout(function(){ed.plugins.jivetablecontrols.$rowPopover.find("a:nth(0)").click();equals(ed.selection.getNode(),$j(ed.getBody()).find("tr:nth(2) td:first").get(0),"row was added above");equals(4,$j(ed.getBody()).find("tr").length,"row was added above");i=$j(j).outerHeight()},700);var d=ed.plugins.jiveresize.showCorners(ed,$j(j),false);var b=editor.get("wysiwygtext");var e=b.getPopOverContainer().find(".handle");equals(e.length,4,"there are 4 handles");var g=e.filter(".br");var a=0;var f=function(){a++};ed.onResizingNode.add(f);ed.onResizedNode.add(f);setTimeout(function(){var k=new jQuery.Event("mousedown");k.pageY=g.offset().top;k.pageX=g.offset().left;g.trigger(k);var k=new jQuery.Event("mousemove");k.pageY=g.offset().top+60;k.pageX=g.offset().left+60;g.trigger(k);var k=new jQuery.Event("mouseup");g.trigger(k);near($j(j).outerWidth(),260,3,"width is 260");near($j(j).outerHeight(),i+60,3,"height is "+(i+60));equals(a,3,"3 events fired");ed.onResizingNode.remove(f);ed.onResizedNode.remove(f);start()},1000)})}else{test("resize only available in webkit",function(){var d=editor.get("wysiwygtext");ed.setContent("<table width=200 height=200><tr><td>asdf</td><td></td></tr><tr><td></td><td><table width=100 height=100><tr><td>asdf</td><td></td></tr><tr><td></td><td></td></tr></table></td></tr></table>");var e=$j(ed.getBody()).find("table:nth(1) td");var c=$j(ed.getBody()).find("table:nth(1)");var b=ed.dom.createRng();b.setStart(e.get(0).firstChild,0);b.setEnd(e.get(0).firstChild,0);ed.selection.setRng(b);ed.nodeChanged();var a=d.getPopOverContainer().find(".handle");equals(a.length,0,"there are no handles")})};