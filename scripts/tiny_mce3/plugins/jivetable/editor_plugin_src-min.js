(function(){function e(q){q=$j.trim(q);var p=/([\d\.])%$/.exec(q);if(p){return(parseFloat(p[1])/100)}return parseFloat(q)/255}var k=/rgb\s*\(([^,\)]+,[^,\)]+,[^,\)]+)\)/;var n=/rgba\s*\(([^,\)]+,[^,\)]+,[^,\)]+,[^,\)]+)\)/;var j=/#[a-fA-F0-9]{6}/;var g=/transparent|rgba\(0,\s*0,\s*0,\s*0\)/;function o(w,x){if(!w){return""}if(j.test(w)){return w}var u=k.exec(w);if(u){return tinymce.activeEditor.plugins.jiveutil.convertRGBToHex(w)}u=g.exec(w);if(u){if(x){return"transparent"}else{return"#FFFFFF"}}u=n.exec(w);if(u){function t(y,z){return y*z+1-z}var s=u[1].split(/\s*,\s*/);var q=e(s[3]);var p=Math.round(t(e(s[0]),q)*255);var r=Math.round(t(e(s[1]),q)*255);var v=Math.round(t(e(s[2]),q)*255);return tinymce.activeEditor.plugins.jiveutil.convertRGBToHex("rgb("+p+", "+r+", "+v+")")}return""}function a(r,p){if(!r.attr("style")){return null}var q=r.attr("style").toLowerCase();q=q.replace(new RegExp("-"+p,"gi"),"nomatch");if(q.indexOf(p+":")>=0){q=q.substr(q.indexOf(p+":"));if(q.indexOf(";")){q=q.substr(0,q.indexOf(";"))}return $j.trim(q.substr(p.length+1))}return null}function f(p){return p.replace(/'/g,"").replace(/, /g,",")}function h(r){r=tinymce.trim(r);if(r=="auto"||r=="inherit"){return{unit:r,magnitude:null}}var q=parseFloat(r);var p=r.substr(String(q).length);if(p=="%"){p="per"}return{unit:p,magnitude:q}}var i=(function(){var p=["000000","993300","333300","003300","003366","000080","333399","333333","800000","FF6600","808000","008000","008080","0000FF","666699","808080","FF0000","FF9900","99CC00","339966","33CCCC","3366FF","800080","999999","FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0","FF99CC","FFCC99","FFFF99","CCFFCC","CCFFFF","99CCFF","CC99FF","FFFFFF"];var q=[];q.push("<div class='colorPicker'>");$j.each(p,function(s,r){q.push("<a href='javascript:;' style='background-color: #");q.push(r);q.push("'></a>")});q.push("</div>");return q.join("")})();function l(p,q,r){p.attr("jive-data-header",$j.JSON.encode(q));p.attr("jive-data-cell",$j.JSON.encode(r))}function m(){for(var p=0;p<arguments.length;++p){if(arguments[p]!=null){if(typeof(arguments[p])=="function"){var q=arguments[p]();if(q!=null){return q}}else{return arguments[p]}}}return null}function c(B,v,x,D,A){var E={headerStyle:v.attr("jive-data-header"),cellStyle:v.attr("jive-data-cell"),tableBorderWidth:0,tableAlign:B.attr("align"),tableBorderColor:B.css("border-color"),contextWidthType:"auto",contextWidth:0,contextHeightType:"auto",contextHeight:0};E.tableAlign=E.tableAlign?E.tableAlign.toLowerCase():"none";if(!E.tableBorderColor){E.tableBorderColor=B.css("border-top-color")}E.tableBorderColor=o(E.tableBorderColor);E.tableBorderWidth=m(function(){var F=B.css("border-width");if(F){return parseFloat(F)}},function(){var G=B.css("border");if(G){var F=G.indexOf(" ");if(F){return parseFloat(G.substring(0,F))}}},function(){return B.attr("border")||null},E.tableBorderWidth);var r=h(m(function(){return a(v,"width")},function(){return v.attr("width")||null},function(){return v.width()+"px"}));E.contextWidth=r.magnitude;E.contextWidthType=r.unit;var C=h(m(function(){return a(v,"height")},function(){return v.attr("height")||null},function(){return v.height()+"px"}));E.contextHeight=C.magnitude;E.contextHeightType=C.unit;var z=o(m(function(){return v.attr("bgColor")||null},function(){return x.attr("bgColor")||null},function(){return x.css("background-color")}),true);var y="2";try{y=parseInt(x.get(0).style.padding)+""}catch(u){}var w=f(x.css("fontFamily"));var t=x.css("color");t=o(t);var q=x.css("textAlign");if(q=="justify"){q="full"}var s=v.css("verticalAlign");E.headerStyle=m(function(){if(E.headerStyle){try{return $j.JSON.decode(jive.util.unescapeHTML(E.headerStyle))}catch(F){}}},function(){return $j.extend({},D)});E.cellStyle=m(function(){if(E.cellStyle){try{return $j.JSON.decode(jive.util.unescapeHTML(E.cellStyle))}catch(F){}}},function(){return $j.extend({},A)});var p=x.is("th")?E.headerStyle:E.cellStyle;p.backgroundColor=z;p.padding=y;if(w){p.fontFamily=w}if(t){p.color=t}if(q){p.textAlign=q}if(s){p.verticalAlign=s}return E}function b(q,p){if(q&&q.length){if(p){if(q.is("table")){if(p.tableAlign!=null){if(p.tableAlign=="none"){q.removeAttr("align")}else{q.attr("align",p.tableAlign)}delete p.tableAlign}if(p["border-width"]!=null){q.attr("border",p["border-width"])}if(p.width!=null){q.removeAttr("width")}if(p.height!=null){q.removeAttr("height")}q.find("td,th").css("border-width","").css("border-style","").css("border-top-color","").css("border-left-color","").css("border-bottom-color","").css("border-right-color","")}q.css(p)}q.removeAttr("data-mce-style").removeAttr("bgcolor");if(!q.is("table")){q.closest("table").removeAttr("data-mce-style")}}tinymce.activeEditor.scheduleNodeChanged()}function d(r,q){var p=parseFloat(r);if(isNaN(p)){return q||0}return p}tinymce.create("tinymce.plugins.JiveTablePlugin",{fullPopOverWidth:230,fullPopOverHeight:400,editTableProperties:null,$table:null,$column:null,$row:null,$cell:null,propertyChooserMenu:null,resetTableProperties:null,resetColumnProperties:null,resetRowProperties:null,resetCellProperties:null,minY:0,minX:0,resetMinMaxY:function(p){this.minY=p.plugins.jivescroll.lastScrollY;this.minX=p.plugins.jivescroll.lastScrollX},defaultHeaderStyle:function(){return{color:"#FFFFFF",backgroundColor:"#6690BC",textAlign:"center",padding:"2"}},defaultCellStyle:function(){return{color:"#000000",textAlign:"left",padding:"2"}},forceCellType:function(p,t,r){if(!t.is(r)){var s=$j("<"+r+"></"+r+">",p.getDoc());s.append(t.contents());if(t.get(0)==this.$cell.get(0)){this.$cell=s}t.before(s);t.remove();var q=a(t,"width");if(q){s.css("width",q)}return s}return t},styleAsTH:function(q,r){var s=parseInt(r.padding);if(isNaN(s)){s=0}var t=r.textAlign;q.css($j.extend({},this.defaultHeaderStyle(),r,{padding:s+"px",textAlign:(t=="full"?"justify":t),backgroundColor:(r.backgroundColor?r.backgroundColor:"transparent")}));q.removeAttr("data-mce-style");q.removeAttr("align");q.removeAttr("valign")},styleAsTD:function(q,r){var s=parseInt(r.padding);if(isNaN(s)){s=0}var t=r.textAlign;q.css($j.extend({},this.defaultCellStyle(),r,{padding:s+"px",textAlign:(t=="full"?"justify":t),backgroundColor:(r.backgroundColor?r.backgroundColor:"transparent")}));q.removeAttr("data-mce-style");q.removeAttr("align");q.removeAttr("valign")},createSpinnerInput:function(t,q,p,s,r){t.SpinButton({min:q,max:p,step:s,spinClass:"spin-button",upClass:"up",downClass:"down"});t.keyup(r).change(r).mouseup(r).click(function(){return false})},defaultFont:function(){var q=this.ed.settings.theme_advanced_fonts;var r=q.split(";");var p=r[1].split("=");return p[1]},fontName:function(r){var p=this.ed.settings.theme_advanced_fonts;var q="";$j.each(p.split(";"),function(u,t){var s=t.split("=");if(s[1]==r){q=s[0]}});return q},createFontInput:function(q,r){var p=$j(this.FONT_MENU);function s(){var u=$j(this);var t=u.attr("data-font-info");q.text(u.text()).css("font-family",t).data("font-family",t);r();p.hide()}p.delegate("a","click",s);q.click(function(){p.show();return false}).change(r).keyup(r);q.after(p);q.parents(".properties").click(function(){p.hide()})},createColorInput:function(v,s,u){var q=this.ed;var p=$j("<span style='position:relative;line-height:18px;position: absolute;'></span>");var w=$j("<div class='transparentGridBg'><div class='colorSample'></div></div>");function r(){var x=$j(this).css("background-color");v.val(o(x,u));s();t.hide();return false}var t=$j(i);if(u){t.addClass("transparentAllowed");t.append($j("<a href='javascript:;' class='transparentButton'>"+q.getLang("jivetable.transparent")+"</a>"))}t.delegate("a","click",r);v.click(function(){t.show();return false}).change(s).keyup(s);w.click(function(){t.show();return false});v.after(t).after(w).after(p);p.append(v).append(w);v.parents(".properties").click(function(){t.hide()})},changeHeaderStyle:function(s,r,q,t){var u=this;var p=s.selection.getBookmark(BOOKMARKTYPE);if(q){r.find(q).each(function(v,w){u.forceCellType(s,$j(w),"th")})}if(t){r.find(t).each(function(v,w){u.forceCellType(s,$j(w),"td")})}s.selection.moveToBookmark(p)},resetPropertiesTabs:function(p){p.find("li:not(:first)").removeClass("j-tab-selected");p.find("li:first").addClass("j-tab-selected");p.children("div:not(:first)").hide();p.children("div:first").show();p.find("a:nth(0)").click(function(){p.find("li:not(:nth(0))").removeClass("j-tab-selected");p.find("li:nth(0)").addClass("j-tab-selected");p.find("form").children("div:not(.tableStyle)").hide();p.find("form").children("div:nth(0)").show();return false}).click();p.find("a:nth(1)").click(function(){p.find("li:not(:nth(1))").removeClass("j-tab-selected");p.find("li:nth(1)").addClass("j-tab-selected");p.find("form").children("div:not(.tableHeader)").hide();p.find("form").children("div:nth(1)").show();return false});p.find("a:nth(2)").click(function(){p.find("li:not(:nth(2))").removeClass("j-tab-selected");p.find("li:nth(2)").addClass("j-tab-selected");p.find("form").children("div:not(.tableCell)").hide();p.find("form").children("div:nth(2)").show();return false})},_buildTableProperties:function(q){var r=this;var s=null;function p(){l(r.$table,s.headerStyle,s.cellStyle);var t=r.editTableProperties.find(".tableStyle .formFields");if(s.contextWidthType=="px"){t.find(".widthPer").hide();t.find(".widthPx").show().val(s.contextWidth);t.find(".chooseWidthPer").prop("checked",false);t.find(".chooseWidthPx").prop("checked",true)}else{t.find(".widthPer").show().val(s.contextWidth);t.find(".widthPx").hide();t.find(".chooseWidthPx").prop("checked",false);t.find(".chooseWidthPer").prop("checked",true)}t.find(".heightPx").val(s.contextHeight);if(s.contextHeightType=="px"){t.find(".chooseHeightAuto").prop("checked",false);t.find(".chooseHeightPx").prop("checked",true)}else{t.find(".chooseHeightPx").prop("checked",false);t.find(".chooseHeightAuto").prop("checked",true)}r.editTableProperties.find(".tableStyle input.borderWidth").val(s.tableBorderWidth);t.find(".borderColor").val(s.tableBorderColor);t.find(".colorSample").css("background-color",s.tableBorderColor);r.editTableProperties.find(".tableStyle .formFields:last a.mceButton.mce_justifytable"+s.tableAlign).addClass("mceButtonSelected");r.editTableProperties.find(".tableStyle .formFields:last a.mceButton:not(.mce_justifytable"+s.tableAlign+")").removeClass("mceButtonSelected");r.updateCellInputs(r.editTableProperties.find(".tableHeader"),s.headerStyle,s.tableBorderWidth,s.tableBorderColor,r.styleAsTH);r.updateCellInputs(r.editTableProperties.find(".tableCell"),s.cellStyle,s.tableBorderWidth,s.tableBorderColor,r.styleAsTD)}this.resetPropertiesTabs(this.editTableProperties);(function(){var z=r.editTableProperties.find(".tableStyle .formFields:first");z.find("a.th-t").click(function(){r.changeHeaderStyle(q,r.$table,"tr:first td","tr:not(:first) th");p();r.onTableStyleChange.dispatch(r.$table.find("th"),s.headerStyle);r.onTableStyleChange.dispatch(r.$table.find("td"),s.cellStyle);return false});z.find("a.th-tb").click(function(){r.changeHeaderStyle(q,r.$table,"tr:first td, tr:last td","tr:not(:first,:last) th");p();r.onTableStyleChange.dispatch(r.$table.find("th"),s.headerStyle);r.onTableStyleChange.dispatch(r.$table.find("td"),s.cellStyle);return false});z.find("a.th-tl").click(function(){r.changeHeaderStyle(q,r.$table,"tr:first td, tr td:first-child","tr:not(:first) th:not(:first-child)");p();r.onTableStyleChange.dispatch(r.$table.find("th"),s.headerStyle);r.onTableStyleChange.dispatch(r.$table.find("td"),s.cellStyle);return false});z.find("a.th-n").click(function(){r.changeHeaderStyle(q,r.$table,false,"th");p();r.onTableStyleChange.dispatch(r.$table.find("th"),s.headerStyle);r.onTableStyleChange.dispatch(r.$table.find("td"),s.cellStyle);return false});var u=r.editTableProperties.find(".tableStyle input.borderWidth");r.createSpinnerInput(u,0,100,1,function(){var A=u.val();if(s.tableBorderWidth!=A){s.tableBorderWidth=A;p();r.onTableStyleChange.dispatch(r.$table,{"border-width":d(A)+"px","border-style":"solid"})}});var t=r.editTableProperties.find(".tableStyle input.borderColor");r.createColorInput(t,function(){var A=t.val();if(s.tableBorderColor!=A){s.tableBorderColor=A;p();r.onTableStyleChange.dispatch(r.$table,{"border-top-color":A,"border-left-color":A,"border-bottom-color":A,"border-right-color":A,"border-style":"solid"})}});r.editTableProperties.find(".tableStyle .formFields:last a.mceButton").click(function(){var A=$j(this);if(A.hasClass("mce_justifytablenone")){s.tableAlign="none"}if(A.hasClass("mce_justifytableleft")){s.tableAlign="left"}if(A.hasClass("mce_justifytableright")){s.tableAlign="right"}r.onTableStyleChange.dispatch(r.$table,{tableAlign:s.tableAlign});r.editTableProperties.find(".tableStyle .formFields:last a.mceButton").not(this).removeClass("mceButtonSelected");A.addClass("mceButtonSelected");return false});var w=r.editTableProperties.find(".tableStyle .formFields");var y=w.find(".widthPer");r.createSpinnerInput(y,0,100,1,function(){var A=y.val();if(s.contextWidth!=A){s.contextWidth=A;p();r.onTableStyleChange.dispatch(r.$table,{width:d(A)+"%"})}});var x=w.find(".widthPx");r.createSpinnerInput(x,0,9999,10,function(){var A=x.val();if(s.contextWidth!=A){s.contextWidth=A;p();r.onTableStyleChange.dispatch(r.$table,{width:d(A)+"px"})}});w.find(".chooseWidthPer").click(function(A){if(s.contextWidthType!="per"){s.contextWidth=Math.round(r.$table.width()/r.$table.parents("body").width()*100);s.contextWidthType="per";p();r.onTableStyleChange.dispatch(r.$table,{width:s.contextWidth+"%"});A.stopPropagation()}});w.find(".chooseWidthPx").click(function(A){if(s.contextWidthType!="px"){s.contextWidth=r.$table.width();s.contextWidthType="px";p();r.onTableStyleChange.dispatch(r.$table,{width:s.contextWidth+"px"});A.stopPropagation()}});var v=w.find(".heightPx");r.createSpinnerInput(v,0,9999,10,function(){r.editTableProperties.find(".tableStyle .formFields .chooseHeightAuto").prop("checked",false);r.editTableProperties.find(".tableStyle .formFields .chooseHeightPx").prop("checked",true).click();var A=v.val();if(s.contextHeight!=A){s.contextHeight=A;p();r.onTableStyleChange.dispatch(r.$table,{height:d(A)+"px"})}});w.find(".chooseHeightAuto").click(function(A){if(s.contextHeightType!="auto"){s.contextHeightType="auto";s.contextHeight=r.$table.height();p();r.onTableStyleChange.dispatch(r.$table,{height:""});A.stopPropagation()}});w.find(".chooseHeightPx").click(function(A){if(s.contextHeightType!="px"){s.contextHeight=r.$table.height();s.contextHeightType="px";p();r.onTableStyleChange.dispatch(r.$table,{height:d(s.contextHeight)+"px"});A.stopPropagation()}})}());this.setupCellForm(this.editTableProperties.find(".tableHeader"),function(){return s.headerStyle},function(t){p();r.onTableStyleChange.dispatch(r.$table.find("th"),t)});this.setupCellForm(this.editTableProperties.find(".tableCell"),function(){return s.cellStyle},function(t){p();r.onTableStyleChange.dispatch(r.$table.find("td"),t)});return function(){s=c(r.$table,r.$table,r.$cell,r.defaultHeaderStyle(),r.defaultCellStyle());p()}},_buildColumnProperties:function(q){var s=this;var r=null;function p(){l(s.$column,r.headerStyle,r.cellStyle);var t=s.editColumnProperties.find(".columnStyle .formFields");if(r.contextWidthType=="px"){t.find(".widthPx").val(r.contextWidth);t.find(".widthPer").val(Math.round(s.$column.outerWidth()/s.$table.outerWidth()*100));t.find(".chooseWidthAuto").prop("checked",false);t.find(".chooseWidthPer").prop("checked",false);t.find(".chooseWidthPx").prop("checked",true)}else{if(r.contextWidthType=="per"){t.find(".widthPx").val(s.$column.width());t.find(".widthPer").val(r.contextWidth);t.find(".chooseWidthAuto").prop("checked",false);t.find(".chooseWidthPx").prop("checked",false);t.find(".chooseWidthPer").prop("checked",true)}else{t.find(".widthPx").val(s.$column.width());t.find(".widthPer").val(Math.round(s.$column.outerWidth()/s.$table.outerWidth()*100));t.find(".chooseWidthPer").prop("checked",false);t.find(".chooseWidthPx").prop("checked",false);t.find(".chooseWidthAuto").prop("checked",true)}}s.updateCellInputs(s.editColumnProperties.find(".columnHeader"),r.headerStyle,r.tableBorderWidth,r.tableBorderColor,s.styleAsTH);s.updateCellInputs(s.editColumnProperties.find(".columnCell"),r.cellStyle,r.tableBorderWidth,r.tableBorderColor,s.styleAsTD)}this.resetPropertiesTabs(this.editColumnProperties);(function(){function v(z,y){return function(){var B=q.selection.getBookmark(BOOKMARKTYPE);var D=s.$column.filter(z);var E=s.$column.filter(y);D.each(function(F,G){s.forceCellType(q,$j(G),"th")});E.each(function(F,G){s.forceCellType(q,$j(G),"td")});s.$column=q.plugins.jiveutil.findColumnBoundsForCell(s.$cell);var C=s.$column.first();var A=s.$column.last();if(C.length&&A.length){q.plugins.jiveblackout.showBlackout(q,C,A)}q.selection.moveToBookmark(B);p();s.onTableStyleChange.dispatch(s.$column.filter("th"),r.headerStyle);s.onTableStyleChange.dispatch(s.$column.filter("td"),r.cellStyle);return false}}var u=s.editColumnProperties.find(".columnStyle .formFields");var t=u.filter(":first");t.find("a.th-t").click(v(":first",":not(:first)"));t.find("a.th-tb").click(v(":first, :last",":not(:first, :last)"));t.find("a.th-tl").click(v("td, th",false));t.find("a.th-n").click(v(false,"td, th"));var x=u.find(".widthPer");s.createSpinnerInput(x,0,100,1,function(){var y=x.val();r.contextWidthType="per";if(r.contextWidth!=y){r.contextWidth=y;s.onTableStyleChange.dispatch(s.$column.first(),{width:d(y)+"%"});s.onTableStyleChange.dispatch(s.$column.slice(1),{width:""});p()}});var w=u.find(".widthPx");s.createSpinnerInput(w,0,9999,10,function(){var y=w.val();r.contextWidthType="px";if(r.contextWidth!=y){r.contextWidth=y;s.onTableStyleChange.dispatch(s.$column.first(),{width:d(y)+"px"});s.onTableStyleChange.dispatch(s.$column.slice(1),{width:""});p()}});u.find(".chooseWidthAuto").click(function(y){if(r.contextWidthType!="auto"){r.contextWidth=0;r.contextWidthType="auto";s.onTableStyleChange.dispatch(s.$column.first(),{width:""});p();y.stopPropagation()}});u.find(".chooseWidthPer").click(function(y){if(r.contextWidthType!="per"){r.contextWidth=x.val();r.contextWidthType="per";s.onTableStyleChange.dispatch(s.$column.first(),{width:d(r.contextWidth)+"%"});s.onTableStyleChange.dispatch(s.$column.slice(1),{width:""});p();y.stopPropagation()}});u.find(".chooseWidthPx").click(function(y){if(r.contextWidthType!="px"){r.contextWidth=w.val();r.contextWidthType="px";s.onTableStyleChange.dispatch(s.$column.first(),{width:d(r.contextWidth)+"px"});s.onTableStyleChange.dispatch(s.$column.slice(1),{width:""});p();y.stopPropagation()}})}());this.setupCellForm(this.editColumnProperties.find(".columnHeader"),function(){return r.headerStyle},function(t){p();s.onTableStyleChange.dispatch(s.$column.filter("th"),t)});this.setupCellForm(this.editColumnProperties.find(".columnCell"),function(){return r.cellStyle},function(t){p();s.onTableStyleChange.dispatch(s.$column.filter("td"),t)});return function(){r=c(s.$table,s.$column,s.$cell,s.defaultHeaderStyle(),s.defaultCellStyle());p()}},_buildRowProperties:function(r){var s=this;var q=null;function p(){l(s.$row,q.headerStyle,q.cellStyle);var t=s.editRowProperties.find(".rowStyle .formFields");if(q.contextHeightType=="px"){t.find(".heightPx").val(q.contextHeight);t.find(".chooseHeightAuto").prop("checked",false);t.find(".chooseHeightPx").prop("checked",true)}else{t.find(".heightPx").val(s.$row.outerHeight());t.find(".chooseHeightPx").prop("checked",false);t.find(".chooseHeightAuto").prop("checked",true)}s.updateCellInputs(s.editRowProperties.find(".rowHeader"),q.headerStyle,q.tableBorderWidth,q.tableBorderColor,s.styleAsTH);s.updateCellInputs(s.editRowProperties.find(".rowCell"),q.cellStyle,q.tableBorderWidth,q.tableBorderColor,s.styleAsTD)}this.resetPropertiesTabs(this.editRowProperties);(function(){var v=s.editRowProperties.find(".rowStyle .formFields");var u=v.filter(":first");u.find("a.th-a").click(function(){s.changeHeaderStyle(r,s.$row,"td","tr:not(:first) th");p();s.onTableStyleChange.dispatch(s.$row.find("td"),q.cellStyle);s.onTableStyleChange.dispatch(s.$row.find("th"),q.headerStyle);return false});u.find("a.th-l").click(function(){s.changeHeaderStyle(r,s.$row,"td:first-child","th:not(:first-child)");p();s.onTableStyleChange.dispatch(s.$row.find("td"),q.cellStyle);s.onTableStyleChange.dispatch(s.$row.find("th"),q.headerStyle);return false});u.find("a.th-n").click(function(){s.changeHeaderStyle(r,s.$row,false,"th");p();s.onTableStyleChange.dispatch(s.$row.find("td"),q.cellStyle);s.onTableStyleChange.dispatch(s.$row.find("th"),q.headerStyle);return false});var t=v.find(".heightPx");s.createSpinnerInput(t,0,9999,10,function(){var w=t.val();q.contextHeightType="px";if(q.contextHeight!=w){q.contextHeight=w;s.onTableStyleChange.dispatch(s.$row,{height:d(w)+"px"});p()}});v.find(".chooseHeightAuto").click(function(w){if(q.contextHeightType!="auto"){q.contextHeight=0;q.contextHeightType="auto";s.onTableStyleChange.dispatch(s.$row,{height:""});p();w.stopPropagation()}});v.find(".chooseHeightPx").click(function(x){var w=t.val();if(q.contextHeightType!="px"){q.contextHeight=w;q.contextHeightType="px";s.onTableStyleChange.dispatch(s.$row,{height:d(w)+"px"});p();x.stopPropagation()}})}());this.setupCellForm(this.editRowProperties.find(".rowHeader"),function(){return q.headerStyle},function(t){p();s.onTableStyleChange.dispatch(s.$row.find("th"),t)});this.setupCellForm(this.editRowProperties.find(".rowCell"),function(){return q.cellStyle},function(t){p();s.onTableStyleChange.dispatch(s.$row.find("td"),t)});return function(){q=c(s.$table,s.$row,s.$cell,s.defaultHeaderStyle(),s.defaultCellStyle());p()}},_buildCellProperties:function(q){var t=this;var s=null;function p(){l(t.$cell,s.headerStyle,s.cellStyle);t.updateCellInputs(t.editCellProperties.find(".cellHeader"),s.headerStyle,s.tableBorderWidth,s.tableBorderColor,t.styleAsTH);t.updateCellInputs(t.editCellProperties.find(".cellCell"),s.cellStyle,s.tableBorderWidth,s.tableBorderColor,t.styleAsTD)}function r(){t.editCellProperties.children("div").hide();t.editCellProperties.children("div:first").show();t.editCellProperties.children("div:nth(1)").show();t.editCellProperties.find("div:first input:first").click(function(w){var v=t.editCellProperties.find("form");v.children("div:not(nth(1))").hide();v.children("div:nth(1)").show();v.children("div:first").show();t.editCellProperties.find("div:first input:last").prop("checked",false);t.editCellProperties.find("div:first input:first").prop("checked",true);if(!t.$cell.is("th")){var u=q.selection.getBookmark(BOOKMARKTYPE);t.$cell=t.forceCellType(q,t.$cell,"th");q.plugins.jiveblackout.showBlackout(q,t.$cell);q.selection.moveToBookmark(u);p();t.onTableStyleChange.dispatch(t.$cell,s.headerStyle);w.stopPropagation()}});t.editCellProperties.find("div:first input:last").click(function(w){var v=t.editCellProperties.find("form");v.children("div:not(nth(2))").hide();v.children("div:nth(2)").show();v.children("div:first").show();t.editCellProperties.find("div:first input:first").prop("checked",false);t.editCellProperties.find("div:first input:last").prop("checked",true);if(!t.$cell.is("td")){var u=q.selection.getBookmark(BOOKMARKTYPE);t.$cell=t.forceCellType(q,t.$cell,"td");q.plugins.jiveblackout.showBlackout(q,t.$cell);q.selection.moveToBookmark(u);p();t.onTableStyleChange.dispatch(t.$cell,s.cellStyle);w.stopPropagation()}});if(t.editCellProperties.parents("body").length){if(t.$cell.is("th")){t.editCellProperties.find("div:first input:first").click()}else{t.editCellProperties.find("div:first input:last").click()}}}this.setupCellForm(this.editCellProperties.find(".cellHeader"),function(){return s.headerStyle},function(u){p();t.onTableStyleChange.dispatch(t.$cell.filter("th"),u)});this.setupCellForm(this.editCellProperties.find(".cellCell"),function(){return s.cellStyle},function(u){p();t.onTableStyleChange.dispatch(t.$cell.filter("td"),u)});return function(){s=c(t.$table,t.$cell,t.$cell,t.defaultHeaderStyle(),t.defaultCellStyle());r();p()}},_buildCellMerge:function(s){var u=this;var w=0;var v=0;var r=u.mergeCellProperties.find(".content");function t(){v=u.$cell.attr("rowspan")?u.$cell.attr("rowspan"):1;w=u.$cell.attr("colspan")?u.$cell.attr("colspan"):1}function q(){var y=[];y.cell=u.$cell.get(0);y.numcols=w;y.numrows=v;s.focus();var x=s.selection.getBookmark();s.execCommand("mceTableSplitCells",false,y);s.execCommand("mceTableMergeCells",false,y);s.plugins.jiveblackout.showBlackout(s,u.$cell);s.nodeChanged();s.selection.moveToBookmark(x);s.focus()}function p(){r.find("input.rowspan").val(v);r.find("input.colspan").val(w)}this.createSpinnerInput(r.find("input.rowspan"),1,100,1,function(){var x=r.find("input.rowspan").val();if(v!=x){v=x;p();q()}});this.createSpinnerInput(r.find("input.colspan"),1,100,1,function(){var x=r.find("input.colspan").val();if(w!=x){w=x;p();q()}});return function(){t();p()}},updateCellInputs:function(r,t,x,v,s){var w=parseInt(t.padding);w=isNaN(w)?0:w;r.find(".formFields .padding").val(w);r.find(".formFields:nth(1) .backgroundColor").val(t.backgroundColor);r.find(".formFields:nth(1) .colorSample").css("background-color",t.backgroundColor?t.backgroundColor:"white");r.find(".formFields:last a.mceButton.mce_justify.mce_justify"+t.textAlign).addClass("mceButtonSelected");r.find(".formFields:last a.mceButton.mce_justify:not(.mce_justify"+t.textAlign+")").removeClass("mceButtonSelected");r.find(".formFields:last a.mceButton.mce_valign.mce_valign"+t.verticalAlign).addClass("mceButtonSelected");r.find(".formFields:last a.mceButton.mce_valign:not(.mce_valign"+t.verticalAlign+")").removeClass("mceButtonSelected");s.call(this,r.find(".sampleHeader th"),t);var u=r.find(".sampleHeader");u.find("th").css("padding",Math.min(w,5)+"px");u.css("border-width",Math.min(x,5)+"px");u.css("border-color",v);u.css("border-style","solid");u.attr("border",Math.min(x,10));var q=t.fontFamily?t.fontFamily:this.defaultFont();r.find(".formFields:nth(2) .family").css("font-family",t.fontFamily).text(this.fontName(q));r.find(".formFields:nth(2) .fontColor").val(t.color);r.find(".formFields:nth(2) .colorSample").css("background-color",t.color)},setupCellForm:function(q,s,p){var r=this;r.createSpinnerInput(q.find("input.padding"),0,100,1,function(){var u=s();var t=q.find("input.padding").val();if(u.padding!=t){u.padding=t;p({padding:t+"px"})}});r.createColorInput(q.find("input.backgroundColor"),function(){var u=s();var t=q.find("input.backgroundColor").val();if(u.backgroundColor!=t){u.backgroundColor=t;p({"background-color":t})}},true);r.createFontInput(q.find("a.family"),function(){var u=s();var t=q.find("a.family").data("font-family");if(u.fontFamily!=t){u.fontFamily=t;p({"font-family":t})}});q.find(".formFields:last a.mceButton").click(function(){var t=s();var u=$j(this);if(u.hasClass("mce_justifyleft")){t.textAlign="left"}if(u.hasClass("mce_justifycenter")){t.textAlign="center"}if(u.hasClass("mce_justifyright")){t.textAlign="right"}if(u.hasClass("mce_justifyfull")){t.textAlign="full"}if(u.hasClass("mce_valigntop")){t.verticalAlign="top"}if(u.hasClass("mce_valignmiddle")){t.verticalAlign="middle"}if(u.hasClass("mce_valignbottom")){t.verticalAlign="bottom"}if(u.hasClass("mce_justifyleft")){q.find(".formFields:last a.mceButton.mce_justify").not(this).removeClass("mceButtonSelected")}else{q.find(".formFields:last a.mceButton.mce_valign").not(this).removeClass("mceButtonSelected")}u.addClass("mceButtonSelected");p({"text-align":t.textAlign,"vertical-align":t.verticalAlign});return false});r.createColorInput(q.find("input.fontColor"),function(){var u=s();var t=q.find("input.fontColor").val();if(u.color!=t){u.color=t;p({color:t})}})},buildPopover:function(v){var w=this;var x=v.plugins.jivecontextmenu;this.editTableProperties=$j(jive.rte.table.allTableProperties());this.editColumnProperties=$j(jive.rte.table.allColumnProperties());this.editRowProperties=$j(jive.rte.table.allRowProperties());this.editCellProperties=$j(jive.rte.table.allCellProperties());this.mergeCellProperties=$j(jive.rte.table.mergeCellProperties());this.resetTableProperties=this._buildTableProperties(v);this.resetColumnProperties=this._buildColumnProperties(v);this.resetRowProperties=this._buildRowProperties(v);this.resetCellProperties=this._buildCellProperties(v);this.resetCellMerge=this._buildCellMerge(v);function z(){v.plugins.jiveblackout.hideBlackout()}function B(){x.hideMenu()}function s(F){var H=$j(F);w.$table=H.parents("table");w.$row=H.parents("tr");w.$column=v.plugins.jiveutil.findColumnBoundsForCell(H);w.$cell=H;w.resetTableProperties(v);w.resetColumnProperties(v);w.resetRowProperties(v);w.resetCellProperties(v);w.resetCellMerge(v);function E(){x.onHideMenu.remove(G);B()}function G(){v.onHideBlackout.remove(E);z()}if(x){x.onHideMenu.add(G)}if(v.onHideBlackout){v.onHideBlackout.add(E)}}var r=/^td|th$/i;if(x){function t(J,F,E,H){function G(){return F.get(0)}var I=new x.MenuItem(J,r,null,G,$j.noop,{width:E?E:232,height:H?H:371},null,null,s);return new x.Menu([I],true,true)}function D(){var E=this.findContextNode(v.selection.getRng(true));v.plugins.jiveblackout.showBlackout(v,$j(E).parents("table"))}var A=new x.MenuItem("tableItem",r,jive.rte.table.propertiesChooserTable(),{url:CS_RESOURCE_BASE_URL+"/images/tiny_mce3/themes/advanced/img/icons.gif",xOffset:580,yOffset:20,width:20,height:20},t("tableProps",this.editTableProperties),null,D);var q=new x.MenuItem("columnItem",r,jive.rte.table.propertiesChooserColumn(),{url:CS_RESOURCE_BASE_URL+"/images/tiny_mce3/themes/advanced/img/icons.gif",xOffset:600,yOffset:40,width:20,height:20},t("columnProps",this.editColumnProperties),null,function(){var G=$j(this.findContextNode(v.selection.getRng(true)));var F=v.plugins.jiveutil.findColumnFirstCell(G);var E=v.plugins.jiveutil.findColumnLastCell(G);if(F.length&&E.length){v.plugins.jiveblackout.showBlackout(v,F,E)}});var C=new x.MenuItem("rowItem",r,jive.rte.table.propertiesChooserRow(),{url:CS_RESOURCE_BASE_URL+"/images/tiny_mce3/themes/advanced/img/icons.gif",xOffset:780,yOffset:20,width:20,height:20},t("rowProps",this.editRowProperties),null,function(){var E=this.findContextNode(v.selection.getRng(true));v.plugins.jiveblackout.showBlackout(v,$j(E).parents("tr"))});var p=new x.MenuItem("cellItem",r,jive.rte.table.propertiesChooserCell(),{url:CS_RESOURCE_BASE_URL+"/images/tiny_mce3/themes/advanced/img/icons.gif",xOffset:600,yOffset:20,width:20,height:20},t("cellProps",this.editCellProperties),null,function(){var E=this.findContextNode(v.selection.getRng(true));v.plugins.jiveblackout.showBlackout(v,$j(E))});var u=new x.MenuItem("mergeCellItem",r,jive.rte.table.propertiesChooserMergeCells(),{url:CS_RESOURCE_BASE_URL+"/images/tiny_mce3/themes/advanced/img/icons.gif",xOffset:760,yOffset:20,width:20,height:20},t("mergeCellProps",this.mergeCellProperties,156,110),null,function(){var E=this.findContextNode(v.selection.getRng(true));v.plugins.jiveblackout.showBlackout(v,$j(E))});var y=new x.MenuItem("deleteTableItem",r,jive.rte.table.deleteText(),{url:CS_RESOURCE_BASE_URL+"/images/tiny_mce3/themes/advanced/img/icons.gif",xOffset:620,yOffset:20,width:20,height:20},function(E){var F=$j(E).closest("table");if(F.length){v.execCommand("mceTableDelete");v.plugins.jiveblackout.hideBlackout()}return true},null,D);this.propertyChooserMenu=new x.Menu([A,q,C,p,u,y],true,false,jive.rte.table.editText(),null,z);return new x.MenuItem("tablePropsItem",r,null,{url:CS_RESOURCE_BASE_URL+"/images/tiny_mce3/themes/advanced/img/icons.gif",xOffset:580,yOffset:20,width:20,height:20},this.propertyChooserMenu)}return null},init:function(p){this.ed=p;this.FONT_MENU=(function(){var q=p.settings.theme_advanced_fonts;var r=[];r.push("<div class='fontPicker'>");$j.each(q.split(";"),function(u,t){var s=t.split("=");r.push("<a href='javascript:;' style='font-family: ");r.push(s[1]);r.push("' data-font-info='");r.push(s[1]);r.push("'>");r.push(s[0]);r.push("</a>")});r.push("</div>");return r.join("")})();p.onInit.add(function(){var r=this;function q(){if(!q.hasRun){q.hasRun=true;r.onTableStyleChange=new tinymce.util.Dispatcher();r.onTableStyleChange.add(b);var s=r.buildPopover(p);if(p.plugins.jivecontextmenu){p.plugins.jivecontextmenu.addRootItem(s)}}}if(tinymce.isIE7){p.onNodeChange.add(function(){if(!q.hasRun){if(p.dom.select("table").length>0){q()}}})}else{q()}},this)},getInfo:function(){return{longname:"Jive Table",author:"Jive Software",authorurl:"http://jivesoftware.com",infourl:"http://jivesoftware.com",version:tinyMCE.majorVersion+"."+tinyMCE.minorVersion}}});tinymce.PluginManager.add("jivetable",tinymce.plugins.JiveTablePlugin)})();