(function(){tinymce.create("tinymce.plugins.JiveEmoticonsPlugin",{before:null,encodeSmileys:function(c,b){var d=this;var h=c.getDoc();var e=null;function g(m){var n=h.createElement("IMG");n.setAttribute("class","jive_macro jive_emote");n.setAttribute("jivemacro","emoticon");n.setAttribute("___jive_emoticon_name",m);n.setAttribute("src",window.CS_RESOURCE_BASE_URL+"/images/emoticons/"+m+".png");n.setAttribute("data-mce-src",window.CS_RESOURCE_BASE_URL+"/images/emoticons/"+m+".png");n.removeAttribute("width");n.removeAttribute("height");return n}var j=new RegExp("^(?:[^\\S]|\\xA0)?$");function l(n){function m(u,t,p){var o=u.length;if(j.test(p.substring(t-1,t))&&j.test(p.substring(t+o,t+o+1))){var q=d.emoticonMap[u];var r=p.substring(m.lastIndex,t);m.lastIndex=t+o;n.appendChild(h.createTextNode(r));n.appendChild(g(q[1]));return""}return u}m.lastIndex=0;return m}var k=false;function a(t){var s=c.plugins.jivemacros.isMacro(t);if(s&&$j(s).attr("jivemacro")=="code"){return 1}if(t.nodeType==1){for(var p=0;p<t.childNodes.length;){p+=a(t.childNodes[p])}}else{if(t.nodeType==3){var r=h.createDocumentFragment();d.testForAnyEmoticon.lastIndex=0;var o=l(r);t.nodeValue.replace(d.testForAnyEmoticon,o);if(r.childNodes.length>0){var q=t.nodeValue.substr(o.lastIndex);r.appendChild(h.createTextNode(q));var m=r.childNodes.length;t.parentNode.replaceChild(r,t);k=true;return m}}}return 1}if(b!=null&&this.testForAnyEmoticon.test(b.innerHTML)){var i=true;try{if(!tinymce.isIE||c.selection.isCollapsed()){i=c.selectionUtil.isForwardSelection();e=c.selection.getBookmark()}}catch(f){console.log("could not bookmark selection for emoticon",f)}c.selection.setRng(c.selectionUtil.safeNormalize(c.selection.getRng(true),b));a(b);if(e!=null){c.selection.moveToBookmark(e);if(!i){c.selectionUtil.setSelection(c.selection.getRng(true),i)}}}},nodeChanged:function(a){if(this.before==null){this.before=a.selection.getNode()}this.encodeSmileys(a,this.before);this.before=a.selection.getNode()},init:function(a,b){var d=[[":)","happy",":\\)"],[":^0","laugh",":^0"],[":0","laugh",":0"],[":p","silly",":p"],[":P","silly",":P"],[";)","wink",";\\)"],[":|","plain",":\\|"],["X-(","angry","X\\-\\("],[":8}","blush",":8}"],[":?","confused",":\\?"],["B-)","cool","B-\\)"],[":'(","cry",":'\\("],["]:)","devil","\\]:\\)"],[":D","grin",":D"],[":x","love",":x"],[";\\","mischief",";\\\\"],[":(","sad",":\\("],[":o","shocked",":o"],["(i)","info","\\(i\\)"],["(+)","plus","\\(\\+\\)"],["(-)","minus","\\(\\-\\)"],["(!)","alert","\\(!\\)"],["(/)","check","\\(/\\)"],["(x)","x","\\(x\\)"]];var e={};d.forEach(function(f){e[f[0]]=f});this.emoticonMap=e;var c=d.map(function(f){return f[f.length-1]}).join("|");this.testForAnyEmoticon=new RegExp("(?:"+c+")","g");if(tinymce.isOpera||/Firefox\/2/.test(navigator.userAgent)){a.onKeyDown.add(function(f,g){if(((tinymce.isMac?g.metaKey:g.ctrlKey)&&g.keyCode==86)||(g.shiftKey&&g.keyCode==45)){setTimeout(function(i,h){return function(){i.encodeSmileys(h,h.getBody())}}(this,f),33)}},this)}else{a.onPaste.addToTop(function(f,g){setTimeout(function(i,h){return function(){i.encodeSmileys(h,h.getBody())}}(this,f),33)},this)}},execCommand:function(e,d,f){if(e=="mceJiveEmoticon"){var a=tinyMCE.activeEditor.controlManager;var c=a.get("jiveemoticons");c.showMenu();return true}if(e=="insertHTML"||e=="mceInsertContent"){var b=tinyMCE.activeEditor;setTimeout(function(h,g){return function(){h.encodeSmileys(g,g.getBody())}}(this,b),0)}return false},getInfo:function(){return{longname:"Emoticons",author:"Jive Software",authorurl:"http://jivesoftware.com",infourl:"http://jivesoftware.com",version:tinyMCE.majorVersion+"."+tinyMCE.minorVersion}},createControl:function(d,a){switch(d){case"jiveemoticons":var b=a.createSplitButton("jiveemoticons",{title:"jiveemoticons.desc",cmd:"mceJiveEmoticon"});b.onRenderMenu.add(function(o,e){var f=tinyMCE.activeEditor;for(var g=0;g<jive.rte.macros.length;g++){var l=jive.rte.macros[g];if(l.isShowInMacroList()&&l.getName()=="emoticon"){var n=l.getParameterSets();for(var h=0;h<n.length;h++){var k=f.getLang("jivemacros.macro."+l.getName()+".preset."+n[h].name,n[h].name);e.add({title:k,cmd:"mceAddJiveMacro"+g+"_"+h,icon:"jiveMacro_"+l.getName()+"_"+n[h].name})}break}}});return b}return null}});tinymce.PluginManager.add("jiveemoticons",tinymce.plugins.JiveEmoticonsPlugin)})();