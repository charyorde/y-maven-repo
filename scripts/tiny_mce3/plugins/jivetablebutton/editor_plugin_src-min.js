(function(){tinymce.create("tinymce.plugins.JiveTableButtonPlugin",{$menu:null,cellWidth:0,cellHeight:0,maxWidth:0,maxHeight:0,insertTable:function(c,h,g){var d=1;var f="#000000";var e="";e+="<table ";e+='class="jiveBorder" ';e+='border="'+d+'" width="100%" ';e+='style="border: '+d+"px solid "+f+'" ';e+=">";e+="<tbody>";e+="<tr>";for(var b=0;b<h;b++){e+='<th valign="middle" style="text-align:center;background-color:#6690BC;color:#ffffff;padding:2px;"><strong>Header '+(b+1)+"</strong></th>"}e+="</tr>";for(var i=0;i<g;i++){e+="<tr>";for(var b=0;b<h;b++){if(!tinymce.isIE){e+='<td style="padding:2px;"><br mce_bogus="1"/></td>'}else{e+='<td style="padding:2px;"></td>'}}e+="</tr>"}e+="</tbody>";e+="</table>";c.focus();if(this.book){this.ed.selection.moveToBookmark(this.book)}c.undoManager.add();c.execCommand("mceInsertContent",false,e);this.book=null;c.addVisual();c.undoManager.add()},setMenuSize:function(d,f){var e=this.$menu.find(".mceMenu");if(!this.$menu.is(":visible")){e.children(":not(:nth(0))").remove()}for(var g=0;g<f;g++){var b=e.find(".row:nth("+g+")");if(!b.length){b=$j("<div class='row'></div>");e.append(b)}for(var j=b.children().length;j<d;j++){var i=$j("<div class='cell'><div class='cellInner'></div></div>");i.css({top:g*this.cellHeight,left:j*this.cellWidth});b.append(i);if(!this.cellHeight){this.cellHeight=i.outerHeight(true)}if(!this.cellWidth){this.cellWidth=i.outerWidth(true)}}b.width(d*this.cellWidth);b.height(this.cellHeight)}b=$j("<div class='row label'></div>");e.append(b);e.width(d*this.cellWidth).height(f*this.cellHeight+b.outerHeight(true));this.maxWidth=Math.max(this.maxWidth,d);this.maxHeight=Math.max(this.maxHeight,f)},hideMenu:function(){if(this.$menu){this.$menu.hide()}this.maxWidth=0;this.maxHeight=0;if(this.$menu){this.$menu.find(".blue").width(0).height(0)}},resetMenu:function(c){if(!this.$menu){var d=this;this.$menu=$j("<div class='defaultSkin'><a href='javascript:' class='tableMenuFocusTarget' tabindex='0' style='position: absolute;'>a</a><div class='mceMenu newTable'><div class='blue'></div></div></div>").css("position","absolute").appendTo(document.body);function b(e,f){f=Math.max(f,1);e=Math.max(e,1);if(f>=d.maxWidth-1||e>=d.maxHeight-1){d.setMenuSize(Math.max(f+1,d.maxWidth),Math.max(e+1,d.maxHeight))}d.$menu.find(".label").text(f+" x "+e);d.$menu.find(".blue").width(d.cellWidth*f);d.$menu.find(".blue").height(d.cellHeight*e)}this.$menu.mousemove(function(j){var i=j.pageY-d.$menu.offset().top;var h=j.pageX-d.$menu.offset().left;var f=Math.floor((i+d.cellHeight)/d.cellHeight);var g=Math.floor((h+d.cellWidth)/d.cellWidth);b(f,g);return false});this.$menu.click(function(j){var i=j.pageY-d.$menu.offset().top;var h=j.pageX-d.$menu.offset().left;var f=Math.floor((i+d.cellHeight)/d.cellHeight);var g=Math.floor((h+d.cellWidth)/d.cellWidth);d.hideMenu();d.insertTable(c,g,f);return false}).keydown(function(i){var g=d.$menu.find(".blue");var h=g.width()/d.cellWidth;var f=g.height()/d.cellHeight;if(i.keyCode==37){b(f,h-1);return false}else{if(i.keyCode==38){b(f-1,h);return false}else{if(i.keyCode==39){b(f,h+1);return false}else{if(i.keyCode==40){b(f+1,h);return false}else{if(i.keyCode==13){d.hideMenu();d.insertTable(c,h,f);return false}else{if(i.keyCode==27){d.hideMenu();d.ed.focus();if(d.book){d.ed.selection.moveToBookmark(d.book);d.book=null}return false}}}}}}})}this.$menu.show();this.setMenuSize(3,3)},init:function(b,c){var d=this;d.ed=b;d.book=null;b.onInit.add(function(){$j(b.getContainer()).find("a.mce_jivetablebutton").click(function(){return false}).keydown(function(e){if(e.keyCode==13){d.showTableMenu();d.$menu.find("a.tableMenuFocusTarget").focus();return false}})},this);$j(document.body).click(function(){d.hideMenu()});b.onClick.add(function(){this.hideMenu()},this)},mceJiveTableMenu:function(b,f,d,h){try{var c=$j(b.getContainer()).find("a.mce_jivetablebutton");this.resetMenu(b);var j=c.offset();j.top+=c.height();this.$menu.css($j.extend({zIndex:1000},j))}catch(g){for(var i in g){console.log(i+": "+g[i])}}},createControl:function(f,b){var d=this;switch(f){case"jivetablebutton":var e=b.createButton("jivetablebutton",{title:"tabletoolbar.title",onclick:function(){d.showTableMenu()}});return e}return null},showTableMenu:function a(){this.ed.focus();this.book=this.ed.selection.getBookmark(BOOKMARKTYPE);this.mceJiveTableMenu(this.ed)},getInfo:function(){return{longname:"Jive Table Button",author:"Adam Wulf",authorurl:"http://www.jivesoftware.com",infourl:"",version:"1.0"}}});tinymce.PluginManager.add("jivetablebutton",tinymce.plugins.JiveTableButtonPlugin)})();