(function(){tinymce.create("tinymce.plugins.JiveResizePlugin",{rte:null,$tl:$j("<div class='handle tl'></div>"),$tr:$j("<div class='handle tr'></div>"),$bl:$j("<div class='handle bl'></div>"),$br:$j("<div class='handle br'></div>"),minY:0,minX:0,$node:null,preserveRatio:false,dragging:false,resetMinMaxY:function(a){this.minY=a.plugins.jivescroll.lastScrollY;this.minX=a.plugins.jivescroll.lastScrollX},setRTE:function(a){this.rte=a;this.completeInit()},selectNode:function(b){if(tinymce.isWebKit){return $j(b.closest("img, table").andSelf().toArray().reverse()).filter("img, table")}else{var a=b.closest("table");if(a.length&&a.get(0)==b.get(0)){return $j([])}return a}},completeInit:function(){if(this.ed&&this.rte&&!this.initialized){this.initialized=true;var a=this.ed;var b=this.rte;var c=this;if(tinymce.isWebKit||tinymce.isIE){a.onNodeChange.add(function(e){var d=c.selectNode($j(e.selection.getNode()));if(d.is("img, table")){this.showCorners(e,d,d.is("img"))}else{this.hideCorners()}},this);a.onMouseDown.add(function(d){c.hideCorners()},this);a.onClick.add(function(e){var d=c.selectNode($j(e.selection.getNode()));if(d.is("img, table")){this.showCorners(e,d,d.is("img"))}else{this.hideCorners()}},this);c.resetMinMaxY(a);c.setupHandlers(a)}}},init:function(a){this.ed=a;a.onResizingNode=new tinymce.util.Dispatcher(this);a.onResizedNode=new tinymce.util.Dispatcher(this);if(tinymce.isWebKit||tinymce.isIE){var c=this;var b=(function(e,d){return function(g,f){e.minY=f;e.minX=g;if(e.$node){if(!e.dragging){e.showCorners(d,e.$node,e.preserveRatio)}}}})(this,a);a.onInit.add(this.completeInit,this);a.onScroll.add(b,this);a.theme.onResize.add(function(){c.resetMinMaxY(a);c.showCorners(a,c.$node,c.preserveRatio)},this);$j(window).resize(function(){c.resetMinMaxY(a);c.showCorners(a,c.$node,c.preserveRatio)})}},hideCorners:function(){this.$node=null;this.$tl.remove();this.$tr.remove();this.$br.remove();this.$bl.remove()},showCorners:function(b,a,c){var d=this;if(!a||!a.length){return}if(a.hasClass("jive_emote")){return}this.resetMinMaxY(b);this.$node=a;this.preserveRatio=c;this.showCornersHelper();function e(){d.dragging=$j(this);b.plugins.jivemouse.showMouseCatch()}this.$br.mousedown(e);this.$bl.mousedown(e);this.$tr.mousedown(e);this.$tl.mousedown(e)},setupHandlers:function(e){var g=this;this.resetMinMaxY(e);var a=this.rte.getPopOverContainer();var k=this.rte.getContentAreaHeight();var c=this.rte.getContentAreaWidth();function d(n,o){if(n.top<e.plugins.jivescroll.lastScrollY-3){o.remove()}else{if(n.top>e.plugins.jivescroll.lastScrollY+k){o.remove()}else{if(n.left<e.plugins.jivescroll.lastScrollX){o.remove()}else{if(n.left>e.plugins.jivescroll.lastScrollX+c){o.remove()}else{a.append(o)}}}}o.css("top",n.top);o.css("left",n.left);o.css("cursor",n.cursor)}var b=-3;var h=-3;function i(){var n=g.$node.offset();o={top:n.top+g.$node.outerHeight()+h,left:n.left+g.$node.outerWidth()+b,cursor:"se-resize"};d(o,g.$br);var o={top:n.top+g.$node.outerHeight()+h,left:n.left+b,cursor:"sw-resize"};d(o,g.$bl);o={top:n.top+h,left:n.left+b,cursor:"nw-resize"};d(o,g.$tl);o={top:n.top+h,left:n.left+g.$node.outerWidth()+b,cursor:"ne-resize"};d(o,g.$tr)}g.showCornersHelper=function(){k=g.rte.getContentAreaHeight();c=g.rte.getContentAreaWidth();i()};var l=0;var j=0;var m=0;var f=0;g.dragging=false;$j(e.getContainer()).find(".mceIframeContainer").mousedown(function(n){if(g.dragging&&g.$node){l=n.pageX;j=n.pageY;m=g.$node.width();f=g.$node.height();e.onResizingNode.dispatch(g.$node,m,f);return false}});$j(e.getContainer()).parents("body").mousemove(function(p){if(g.dragging&&g.$node){var n=(p.pageX-l);var o=(p.pageY-j);if(g.dragging.get(0)==g.$br.get(0)){if(n<o){g.$node.width(m+n);g.$node.height(f+(g.preserveRatio?(f/m*n):o))}else{g.$node.height(f+o);g.$node.width(m+(g.preserveRatio?(m/f*o):n))}}else{if(g.dragging.get(0)==g.$tr.get(0)){g.$node.width(m+n);g.$node.height(f+(g.preserveRatio?(f/m*n):-o))}else{if(g.dragging.get(0)==g.$tl.get(0)){g.$node.width(m-n);g.$node.height(f-(g.preserveRatio?(f/m*n):o))}else{if(g.dragging.get(0)==g.$bl.get(0)){if(Math.abs(n)<Math.abs(o)){if(n<0){g.$node.width(m-n);g.$node.height(f-(g.preserveRatio?(f/m*n):o))}else{g.$node.width(m+n);g.$node.height(f+(g.preserveRatio?(f/m*n):o))}}else{g.$node.height(f+o);g.$node.width(m+(g.preserveRatio?(m/f*o):n))}}}}}g.$node.removeAttr("data-mce-style");g.$node.attr("width",g.$node.width());g.$node.attr("height",g.$node.height());e.onResizingNode.dispatch(g.$node,g.$node.width(),g.$node.height());i();return false}});$j(e.getContainer()).parents("body").mouseup(function(){if(g.dragging){g.dragging=false;e.plugins.jivemouse.hideMouseCatch();if(g.$node){e.onResizedNode.dispatch(g.$node,g.$node.width(),g.$node.height())}e.nodeChanged()}})},getInfo:function(){return{longname:"Jive Resize",author:"Jive Software",authorurl:"http://jivesoftware.com",infourl:"http://jivesoftware.com",version:tinyMCE.majorVersion+"."+tinyMCE.minorVersion}}});tinymce.PluginManager.add("jiveresize",tinymce.plugins.JiveResizePlugin)})();