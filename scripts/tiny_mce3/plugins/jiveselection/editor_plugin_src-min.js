(function(){function a(l){return l&&l.nodeType==3}function f(l){return a(l.c)}function d(l){if(f(l)){return l.off==l.c.nodeValue.length}else{return l.off==l.c.childNodes.length}}function k(l){var m=c(l);return(f(l)&&!d(l))||(m&&m.nodeName.toLowerCase()=="br")}function j(l){l=l.toLowerCase();return function(m){var o=c(m);return o&&o.nodeName&&o.nodeName.toLowerCase()==l}}function b(l){l=l.toLowerCase();return function(m){return m&&m.c.nodeType==1&&m.c.nodeName.toLowerCase()==l}}function c(l){if(l.c&&l.off>=0&&l.c.childNodes&&l.c.childNodes.length>l.off){return l.c.childNodes[l.off]}return null}function g(l){if(l&&k(l)){return l.c.nodeValue.charAt(l.off)}return null}function e(l){var m=tinymce.activeEditor.dom;return{c:l.parentNode,off:m.nodeIndex(l)}}function i(l,m){l.setStart(m.c,m.off)}function h(l){return{c:l.startContainer,off:l.startOffset}}tinymce.create("tinymce.plugins.JiveSelectionPlugin",{init:function(r,o){this.ed=r;this.isSelectionFrozen=false;var t=this;function u(w){if(w>65535){w-=65536;return String.fromCharCode(55296+(w>>10),56320+(w&1023))}else{return String.fromCharCode(w)}}function p(x){var w=x.c.parentNode;return x.c.nodeType==3&&x.c.nodeValue.length==x.off&&w.nodeName.toLowerCase()=="a"&&x.c==w.lastChild}function v(w){return function(z,y){var x=z.selection.getRng();var D=h(x);if(x.collapsed&&y.charCode>31&&!y.ctrlKey&&!y.altKey&&!y.metaKey&&w(D)){var B=u(y.charCode);do{D=z.selectionUtil.dfsNext(D,false)}while(D&&!k(D));if(B==" "&&/[ \xa0]/.test(g(D))){B="\xa0"}var C=z.getDoc().createTextNode(B);var A=h(x);while(f(A)){A=z.selectionUtil.dfsNext(A,true)}A.c.insertBefore(C,c(A));x.setStart(C,B.length);x.collapse(true);z.selectionUtil.setSelection(x,true);y.preventDefault()}}}if(!tinymce.isIE||tinymce.isIE9){r.onFormatChange.add(function(x,w){if(x.inline&&!w){t.isSelectionFrozen=true}});r.onNodeChange.addToTop(function(x,w,y){if(!t.isSelectionFrozen){x.selectionUtil.normalizeSelection()}});function q(x,w){t.isSelectionFrozen=false}r.onKeyDown.add(q);r.onMouseDown.add(q);if(tinymce.isWebKit){function n(w){return w.c.nodeType==1}r.onKeyPress.add(v(n))}var l=j("a");var s=function(w){if(w.off>0){return l({c:w.c,off:w.off-1})}return false};var m=b("a");r.onKeyPress.add(v(p));r.onKeyDown.add(function(A,F){var I=F.keyCode;if(A.selection.isCollapsed()&&(I==37||I==39||I==8||I==46)){var w=A.selection.getRng(true);var D=h(w);var C=A.selectionUtil.dfsNext(D,true);var G=A.selectionUtil.dfsNext(D,false);var H=null;if(l(D)||(f(D)&&d(D)&&l(C))){var y=l(D)?D:C;if(I==39){H={c:c(y),off:0};F.preventDefault()}else{if(I==46){H={c:c(y),off:0}}}}else{if((m(D)&&D.off==0)||(D.off==0&&G.off==0&&m(G))){var B=m(D)?D:G;if(I==37){H=e(B.c);F.preventDefault()}else{if(I==8){H=e(B.c)}}}else{if((m(D)&&d(D))||(d(C)&&m(C))){var x=m(D)?D:C;if(I==39){H=e(x.c);H.off+=1;F.preventDefault()}else{if(I==46){H=e(x.c);H.off+=1}}}else{if(s(D)||(s(G))){var E=s(D)?D:G;if(I==37){var z=c({c:E.c,off:E.off-1});H={c:z,off:z.childNodes.length};F.preventDefault()}else{if(I==8){z=c({c:E.c,off:E.off-1});H={c:z,off:z.childNodes.length}}}}}}}if(H){i(w,H);w.collapse(true);A.selection.setRng(w)}}})}},getInfo:function(){return{longname:"Jive Selection",author:"Jive Software",authorurl:"http://jivesoftware.com",infourl:"http://jivesoftware.com",version:tinyMCE.majorVersion+"."+tinyMCE.minorVersion}}});tinymce.PluginManager.add("jiveselection",tinymce.plugins.JiveSelectionPlugin)})();