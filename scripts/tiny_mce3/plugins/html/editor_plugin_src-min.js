(function(){tinymce.create("tinymce.plugins.HTML",{thunks:new Array(),registerToggleFunction:function(a){this.thunks.push(a)},toggleHTML:function(a){var c=a.plugins.html.thunks;for(var b=0;b<c.length;b++){c[b](a.id)}},prepForTab:false,prepForDel:false,prepForLargeDel:false,init:function(a,b){var c=this;function d(e){if(e.ctrlKey||e.metaKey){return false}if(e.keyCode>=65&&e.keyCode<=90){return true}if(e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=111){return true}if(e.keyCode==13||e.keyCode==8||e.keyCode==46){return true}return false}c.editor=a;a.addCommand("mceToggleHTML",function(e,f){return function(){f.toggleHTML(e)}}(a,c));a.onBeforeSetContent.add(function(e,f){f.content=f.content.replace(/  /g,"&nbsp; ")});a.onGetContent.add(function(e,f){f.content=f.content.replace(/&nbsp;/g," ")});a.onKeyDown.add(function(f,e){this.prepForTab=false;this.prepForDel=false;this.prepForLargeDel=false;if(e.keyCode==9&&!e.ctrlKey&&!e.altKey&&!f.dom.getParent(f.selection.getNode(),"table")&&!f.dom.getParent(f.selection.getNode(),"ul,ol")){tinymce.dom.Event.cancel(e);this.prepForTab=true}if(tinymce.isGecko&&!f.selection.isCollapsed()){if(d(e)){this.prepForLargeDel=true;this.keyCode=e.keyCode;return false}}},this);a.onKeyPress.add(function(i,m){if(this.prepForDel){tinymce.dom.Event.cancel(m)}if(this.prepForLargeDel){var h=this.keyCode==8||this.keyCode==46;var e=i.selection.getRng(true);e=i.selectionUtil.getShrunkenBlockRange(e,"tr, td, th");var g=e.startContainer;var n=e.endContainer;e.deleteContents();function j(s){var p=s.parentNode;if(!p){return}var q=true;if(s.hasChildNodes()){for(var o=0;o<s.childNodes.length;++o){var r=s.childNodes[o];if(r.nodeType==1||(r.nodeType==3&&r.nodeValue.length>0)){q=false;break}}}else{if(s.nodeType==3&&s.nodeValue.length>0){q=false}else{if(i.dom.is(s,"body, td, th")||(!h&&i.dom.is(s,"a"))){q=false}}}if(q){p.removeChild(s);j(p)}}j(g);j(n);if(i.selectionUtil.isEffectivelyEmpty(i.getBody())){i.setContent("<p><br /></p>");e=i.dom.createRng();e.setStart(i.getBody().firstChild,0);e.collapse(true);i.selection.setRng(e)}var k=i.dom.getParent(i.selection.getNode(),"ol,ul");if(k){e=i.selection.getRng(true);var f=e.startContainer.nodeName.toLowerCase();if(f!="li"&&f!="#text"){if(i.selectionUtil.atEndOf(k,i.selectionUtil.startPos(e))){e.setStart(k.lastChild,k.childNodes.length)}else{e.setStart(k.childNodes[e.startOffset],0)}}e.collapse(true);var l=i.dom.getParent(i.selection.getNode(),"li");if(l){if(!l.lastChild||l.lastChild.nodeName.toLowerCase()!="br"){l.appendChild(i.dom.create("br"))}}}if(h){tinymce.dom.Event.cancel(m)}}else{if(m.keyCode==9&&!m.ctrlKey&&!m.altKey&&!i.dom.getParent(i.selection.getNode(),"table")&&!i.dom.getParent(i.selection.getNode(),"ul,ol")){tinymce.dom.Event.cancel(m)}}},this);a.onKeyUp.add(function(f,e){if(this.prepForDel){tinymce.dom.Event.cancel(e);var h=f.selection.getStart();var g=h.previousSibling;if(g){h.parentNode.removeChild(h);while(g.nodeName.toLowerCase()=="ol"||g.nodeName.toLowerCase()=="ul"){g=g.childNodes[g.childNodes.length-1]}if(g.childNodes.length>0){f.selection.select(g.childNodes[g.childNodes.length-1]);f.selection.collapse()}else{f.selection.select(g);f.selection.collapse()}}}else{if(this.prepForLargeDel){if(this.keyCode==8||this.keyCode==46){tinymce.dom.Event.cancel(e)}}}if(e.keyCode==9&&!e.ctrlKey&&!e.altKey&&this.prepForTab&&!f.dom.getParent(f.selection.getNode(),"table")&&!f.dom.getParent(f.selection.getNode(),"ul,ol")){tinymce.dom.Event.cancel(e);f.selection.setContent("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;")}},this);a.addButton("html",{title:"html.desc",cmd:"mceToggleHTML"});a.addShortcut("alt+q",a.getLang("advanced.toolbar_focus"),function(){var e=a.dom.select(".js-toolbarFocus",a.getContainer());if(e&&e.length){e[0].onclick()}})},getInfo:function(){return{longname:"HTML mode",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/fullpage",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("html",tinymce.plugins.HTML)})();