(function(){tinymce.create("tinymce.plugins.JiveBlackoutPlugin",{rte:null,$left:$j("<div class='blackout l'></div>"),$right:$j("<div class='blackout r'></div>"),$top:$j("<div class='blackout t'></div>"),$bottom:$j("<div class='blackout b'></div>"),minY:null,minX:null,nodeL:null,nodeR:null,ed:null,setRTE:function(a){this.rte=a},resetMinMaxY:function(a){var b=$j(a.getWin());this.minY=b.scrollTop();this.minX=b.scrollLeft()},init:function(a){var d=this;this.ed=a;a.onHideBlackout=new tinymce.util.Dispatcher(this);function c(){d.resetMinMaxY(a)}function b(){if(d.nodeL||d.nodeR){d.showBlackout(a,d.nodeL,d.nodeR)}}a.onNodeChange.add(b);a.onScroll.add(function(){c();b()});a.theme.onResize.add(function(){c();b()});$j(window).resize(function(){c();b()});$j(window.document.body).click(function(){d.hideBlackout()});a.onInit.add(c,this);setTimeout(c,300);setTimeout(c,500);setTimeout(c,800)},hideBlackout:function(){if(this.nodeL||this.nodeR){this.nodeL=null;this.nodeR=null;this.$left.remove();this.$right.remove();this.$top.remove();this.$bottom.remove();this.ed.onHideBlackout.dispatch()}},showBlackout:function(h,n,i){var j=this;if(!n){return}if(!i){i=n}this.resetMinMaxY(h);this.nodeL=n;this.nodeR=i;var m=$j(n);var g=$j(i);var c=m.offset();var p=g.offset();if(!p||!c){return}var b=this.rte.getPopOverContainer();var o=this.rte.getContentAreaHeight();var d=this.rte.getContentAreaWidth();function f(q,r){q.bottom=q.top+q.height;q.right=q.left+q.width;if(q.left<j.minX){q.width-=j.minX-q.left;q.left=j.minX}if(q.top<j.minY){q.height-=j.minY-q.top;q.top=j.minY}if(q.bottom>j.minY+o){q.height-=q.top+q.height-j.minY-o}if(q.left+q.width>j.minX+d){q.width-=q.left+q.width-j.minX-d}if(q.left>=j.minX+d){r.remove()}else{if(q.top>=j.minY+o){r.remove()}else{if(q.top>=q.bottom||q.left>=q.right){r.remove()}else{b.append(r)}}}delete q.bottom;delete q.right;r.css(q);r.click(function(){j.hideBlackout()})}var a=g.outerHeight();var e=g.outerWidth();var k=$j(h.getBody()).outerHeight();var l={top:p.top+a,left:c.left,width:p.left+e-c.left,height:Math.max(o,k)-p.top-a};f(l,this.$bottom);l={top:0,left:0,width:c.left,height:Math.max(o,k)};f(l,this.$left);l={top:0,left:c.left,width:p.left+e-c.left,height:c.top};f(l,this.$top);l={top:0,left:p.left+e,width:Math.max(d,$j(h.getDoc()).width())-e-p.left,height:Math.max(o,k)};f(l,this.$right)},getInfo:function(){return{longname:"Jive Blackout",author:"Jive Software",authorurl:"http://jivesoftware.com",infourl:"http://jivesoftware.com",version:tinyMCE.majorVersion+"."+tinyMCE.minorVersion}}});tinymce.PluginManager.add("jiveblackout",tinymce.plugins.JiveBlackoutPlugin)})();