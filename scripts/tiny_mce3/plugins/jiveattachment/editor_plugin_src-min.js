(function(){var b=tinymce.DOM;var a={pdf:"acrobat",zip:"compressed",tgz:"compressed",tar:"compressed",gz:"compressed",bz2:"compressed",jar:"compressed",doc:"document",docx:"document",htm:"document",html:"document",rtf:"document",odt:"document",png:"image",gif:"image",jpg:"image",tiff:"image",ppt:"presentation",pptx:"presentation",odp:"presentation",xls:"spreadsheet",xlsx:"spreadsheet",ods:"spreadsheet",txt:"text",swf:"video",wmv:"video",mov:"video"};tinymce.create("tinymce.plugins.JiveAttachmentPlugin",{rte:null,initialized:false,button:null,attachmentBlock:null,setRTE:function(c){this.rte=c;this.completeInit()},completeInit:function(){if(this.rte&&this.ed&&!this.initialized&&this.rte.getAttachmentService()){this.initialized=true;var c=this.ed,d=this;this.button=b.create("div",{"class":"gutterButton attachmentButton"});var e=b.create("label",null,c.getLang("jiveattachment.button_label"));e.insertBefore(b.create("span",{"class":"jive-icon-med jive-icon-attachment"}),e.firstChild);this.button.appendChild(e);this.attachmentBlock=b.create("div",{"class":"js-attachment-block jive-attachments"});this.rte.getGutter().appendChild(this.button);this.rte.getBelowEditorArea().appendChild(this.attachmentBlock);this._refresh()}},init:function(c){this.ed=c},_setHasAttachments:function(c){if(c){$j(".jive-icon-attachment",this.button).addClass("green");$j(this.attachmentBlock).show()}else{$j(".jive-icon-attachment",this.button).removeClass("green");$j(this.attachmentBlock).hide()}this.rte.autoReposition()},_refresh:function(){function c(e){if(e){var g=e.substr(e.lastIndexOf(".")+1).toLowerCase();var f=a[g]}return f||"generic"}var d=this;this.rte.getAttachmentService().getRestrictions().addCallback(function(e){d.getAttachments().addCallback(function(f){for(var g=0;g<f.length;++g){f[g].doctype=c(f[g].filename)}d.attachmentBlock.innerHTML=jive.rte.attachment.attachmentBlock({restrictions:e,attachments:f});d._setHasAttachments(f.length>0);$j("a.js-attachment-remove",d.attachmentBlock).each(function(i,h){$j(h).click(function(){d.removeAttachment(f[i]).addCallback(function(){d._refresh()});return false})});$j(".js-attachment-button-label",d.attachmentBlock).click(function(){$j(".js-attachment-list",d.attachmentBlock).toggle();return false});if(e.hasAttachPerms&&f.length<e.maxFiles){$j(d.button).show();d._initAttachmentButton()}else{$j(d.button).hide()}})})},_initAttachmentButton:function(){var d=this;var c=$j("input[type='file']",this.button);if(c.length==0){c=$j(this._createFileInput())}else{this.button.innerHTML=this.button.innerHTML;c=$j("input[type='file']",this.button)}var e=$j("label",this.button);e.append(c);c.unbind("change");c.css({position:"absolute",opacity:0,display:"block",top:0,left:0,width:"100%",height:"100%","z-index":1}).change(function(f){d.addAttachment({elem:this}).always(function(){d._refresh()})}).focus(function(){c.parent().addClass("focused")}).blur(function(){c.parent().removeClass("focused")});if(tinymce.isIE7){c.css({width:"60px",height:"19px"})}},_createFileInput:function(){return b.create("input",{type:"file"})},getAttachments:function(){return this.rte.getAttachmentService().findAll()},addAttachment:function(d){var c=this.rte.getAttachmentService();return c.save(d)},removeAttachment:function(d){var c=this.rte.getAttachmentService();return c.destroy(d)},getInfo:function(){return{longname:"Jive Attachment",author:"Jive Software",authorurl:"http://jivesoftware.com",infourl:"http://jivesoftware.com",version:tinyMCE.majorVersion+"."+tinyMCE.minorVersion}}});tinymce.PluginManager.add("jiveattachment",tinymce.plugins.JiveAttachmentPlugin)})();