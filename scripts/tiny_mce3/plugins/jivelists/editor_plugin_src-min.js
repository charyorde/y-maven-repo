(function(){function a(){var b=tinymce.activeEditor.dom;return b.create("br",{_moz_dirty:"",type:"_moz"})}tinymce.create("tinymce.plugins.JiveListsPlugin",{lastList:null,lastPrevSib:null,fixLists:function(d){var i,c,h,e,b;function g(){var j=tinymce.activeEditor.dom;return j.create("p",{},"<br _moz_dirty='' type='_moz' />")}this.onBeforeFixLists.dispatch(d);var f=this;d.undoManager.transparentChange(function(){i=d.selection.getNode();if(i.ownerDocument!==d.getDoc()){return}var k=d.dom.getParent(i,"ol,ul");if(k!=null&&k.nodeType==1&&(k.nodeName.toLowerCase()=="ul"||k.nodeName.toLowerCase()=="ol")){b=k.parentNode;if(b.nodeName.toLowerCase()=="li"){h=b.parentNode;h.insertBefore(k,b.nextSibling);if(d.selectionUtil.isEffectivelyEmpty(b)){h.removeChild(b)}d.selectionUtil.normalizeSelection();d.selection.select();d.selection.collapse(true)}f.mergeConsecutiveLists(k)}i=d.dom.getParent(i,"li");if(i!=null&&i.nodeType==1&&i.nodeName.toLowerCase()=="li"){c=d.dom.getParent(i,"ol,ul");if(c!=null){if(tinymce.isGecko){for(var j=0;j<c.childNodes.length;j++){b=c.childNodes[j];if(b.nodeType==1&&b.nodeName.toLowerCase()=="li"&&(!b.lastChild||b.lastChild.nodeName.toLowerCase()!="br")){b.appendChild(a())}}}if(c.parentNode.nodeName.toLowerCase()=="p"){h=c.parentNode;d.dom.split(h,c);d.selection.select(i).collapse(true)}}}if(f.lastList!=null&&f.lastList.parentNode!=null){i=f.lastList.nextSibling;if(i!=null){if(i.nodeType==1&&i.nodeName.toLowerCase()=="br"){h=g();i.parentNode.insertBefore(h,i);i.parentNode.removeChild(i);e=h.childNodes[h.childNodes.length-1];d.selection.select(e);d.selection.collapse(true)}}}else{if(f.lastPrevSib!=null){i=f.lastPrevSib.nextSibling;if(i!=null){if(i.nodeType==1&&i.nodeName.toLowerCase()=="br"){h=g();i.parentNode.insertBefore(h,i);i.parentNode.removeChild(i);e=h.childNodes[h.childNodes.length-1];d.selection.select(e);d.selection.collapse(true)}}}}f.fixListTypes()});this.onAfterFixLists.dispatch(d)},fixListTypes:function(){var b=this.ed;$j("ul[type], ol[type]",b.getBody()).each(function(){b.plugins.jivelists.listTypeToStyle(this)})},mergeConsecutiveLists:function(d){while(true){var b=d.previousSibling;while(b!=null&&b.nodeType!=1){b=b.previousSibling}if(b!=null&&b.nodeName==d.nodeName){d=b}else{break}}var e=null;while(true){b=d.nextSibling;while(b!=null&&b.nodeType!=1){b=b.nextSibling}if(b!=null&&b.nodeName==d.nodeName){if(!e){try{e=this.ed.selection.getBookmark()}catch(c){console.log("Failed to set bookmark before reparenting.  Hopefully it doesn't matter.",c)}}this.reparentChildren(d,b);b.parentNode.removeChild(b)}else{break}}if(e){this.ed.selection.moveToBookmark(e)}return d},reparentChildren:function(c,b){while(b.firstChild){c.appendChild(b.firstChild)}return c},indentSelectedItems:function(){var b=this.getExpandedLiRange(this.ed.selection.getRng(true));if(b){var d=this.ed.selection.getBookmark();var c=this.ed.getDoc().createElement(b.commonAncestorContainer.nodeName);b.surroundContents(c);this.ed.selection.moveToBookmark(d)}else{throw new Error("Unable to indent selection; probably not a list selection.")}},getExpandedLiRange:function(b){return this.ed.selectionUtil.getExpandedBlockRange(b,"li","ul,ol")},rangeSplit:function(d){var b=d.commonAncestorContainer;if(b.nodeType==3){b=b.parentNode}var f=d.extractContents();var e=[];for(var h=f.firstChild;h!=null;h=h.nextSibling){e.push(h)}var c=this.ed.getDoc().createElement("br");c.className="splitMarker";if(d.startContainer.nodeType==3){var g=d.startContainer.splitText(d.startOffset);g.parentNode.insertBefore(c,g)}else{d.insertNode(c)}this.ed.dom.split(b,c,f);return e},shimIfIE:function(b,c){if(tinymce.isIE){$j('<p class="ieShim"> </p>',b.getDoc()).insertBefore(c)}},removeIEShims:function(b){$j(b.getBody()).find(".ieShim").remove()},execCommand:function(g,p,f){var h=tinyMCE.activeEditor;var i=this;function s(t){var v=t.selection.getNode();v=t.dom.getParent(v,"ol,ul");var b=t.dom.getParent(v,"blockquote");if(b!=null){var u=t.getDoc().createElement(v.nodeName);b.parentNode.insertBefore(u,b);while(b.childNodes.length){u.appendChild(b.childNodes[0])}b.parentNode.removeChild(b);t.selection.select(v)}}var e=h.selection.getNode();var l=null;while(e!=null&&e.parentNode!=null&&(e=h.dom.getParent(e.parentNode,"ol,ul"))!=null){l=e}e=l;if(e!=null){this.lastList=e;this.lastPrevSib=e.previousSibling}else{this.lastList=null;this.lastPrevSib=null}function r(v,u){u=u||tinyMCE.activeEditor;var n=u.selection.getBookmark(),t=v();if(tinymce.isWebKit){window.focus();u.focus()}u.selection.moveToBookmark(n);return t}function q(v){v=v.toLowerCase();var b=parseInt(g.substr("mceOLListStyle".length));var w=h.plugins.jivelists[v+"_styles"];var u=w[b];var x=h.selection.getNode();var t=h.dom.getParent(x,v);h.dom.setStyle(t,"listStyleType",u[1])}function d(B,D,x){var b=h.selectionUtil.getExpandedBlockRange(h.selection.getRng(true).cloneRange(),D,x);var t;try{t=h.selection.getBookmark();function v(F){var I=h.dom.create(B);F.surroundContents(I);var H=[];for(var G=0;G<I.childNodes.length;++G){var J=I.childNodes[G];if(h.selectionUtil.isBookmark(J)){H.push(J)}else{var E=h.dom.create("li");if(h.dom.isBlock(J)){h.dom.replace(E,J,true);if($j(J).css("text-align")!="left"&&$j(J).css("text-align")!="start"){$j(E).css("text-align",$j(J).css("text-align"))}}else{F.setStart(I,G);F.setEnd(I,I.childNodes.length);F.surroundContents(E);G=I.childNodes.length}while(H.length>0){E.insertBefore(H.pop(),E.firstChild);--G}}}if(I.childNodes.length==0){I.appendChild(h.dom.create("li"))}I=i.mergeConsecutiveLists(I);return I}function y(G,F){var E=h.dom.createRng();var H=G;while(H!=null){G=H;if(G!=F){H=G.nextSibling}else{H=null}E.selectNodeContents(G);v(E)}}function C(E,F){var G=E;while(G){y(G.firstChild,G.lastChild);if(G==F){G=null}else{G=G.nextSibling}}}if(b.collapsed){var n=v(b);h.selectionUtil.removeBookmark(t);var A=h.dom.createRng();A.setStart(n.firstChild,0);A.collapse(true);h.selection.setRng(A)}else{var w=b.startContainer.childNodes[b.startOffset];var u=b.endContainer.childNodes[b.endOffset-1];if(w.nodeName.toLowerCase()=="td"){y(w,u)}else{if(w.nodeName.toLowerCase()=="tr"){C(w,u)}else{v(b)}}i.shimIfIE(h,w);h.selection.moveToBookmark(t)}}catch(z){console.log("failing over to execCommand",z);if(t){h.selectionUtil.removeBookmark(t)}B=B.toLowerCase();if(B=="ul"){h.execCommand("InsertUnorderedList")}else{h.execCommand("InsertOrderedList")}}i.fixLists(h);i.removeIEShims(h)}var l=this.getSelectionParent("ol,ul");if(g.indexOf("mceOLListStyle")==0){h.undoManager.add();q("ol");h.undoManager.add();return true}else{if(g.indexOf("mceULListStyle")==0){h.undoManager.add();q("ul");h.undoManager.add();return true}else{if(g=="mceOutdent"){h.undoManager.add();var c=h.selection;r(function(){try{var b=i.getExpandedLiRange(c.getRng(true));var v=i.rangeSplit(b);i.shimIfIE(h,v[0]);for(var u=0;u<v.length;++u){var x=v[u];if(x.parentNode.nodeName.toLowerCase()!="ul"&&x.parentNode.nodeName.toLowerCase()!="ol"){if(!h.selectionUtil.isBookmark(x)){var w=h.getDoc().createElement("p");x.parentNode.insertBefore(w,x);if($j(x).css("text-align")!="left"&&$j(x).css("text-align")!="start"){$j(w).css("text-align",$j(x).css("text-align"))}if(x.nodeType==1){i.reparentChildren(w,x);x.parentNode.removeChild(x)}else{w.appendChild(x)}if(tinymce.isIE&&!tinymce.isIE9){w.appendChild(h.getDoc().createTextNode("\ufeff"))}}}}}catch(t){console.log("failing over to execCommand('Outdent')");i.shimIfIE(h,c.getNode());h.execCommand("Outdent");try{h.execCommand("mceOutdentComplete")}catch(t){if(console&&console.log){console.log("Outdent Complete failed",t)}}}i.fixLists(h)},h);i.removeIEShims(h);h.undoManager.add();return true}else{if(g=="mceIndent"){h.undoManager.add();try{this.indentSelectedItems();this.fixLists(h)}catch(k){console.log("failing over to execCommand('Indent')");h.execCommand("Indent");this.fixLists(h);s(h)}h.execCommand("mceIndentComplete");h.undoManager.add();return true}else{if(g.indexOf("mceInsertUnorderedList")==0){h.undoManager.add();if($j(l).is("ul")){h.execCommand("mceOutdent")}else{if($j(l).is("ol")){var o=h.selection.getBookmark(BOOKMARKTYPE);var j=this.getSelectionParent("ol");var m=h.getDoc().createElement("ul");$j(m).append($j(j).contents());j.parentNode.insertBefore(m,j);j.parentNode.removeChild(j);h.selection.moveToBookmark(o)}else{d("ul")}}h.undoManager.add();return true}else{if(g.indexOf("mceInsertOrderedList")==0){h.undoManager.add();if($j(l).is("ol")){h.execCommand("mceOutdent")}else{if($j(l).is("ul")){var o=h.selection.getBookmark(BOOKMARKTYPE);var j=this.getSelectionParent("ul");var m=h.getDoc().createElement("ol");$j(m).append($j(j).contents());j.parentNode.insertBefore(m,j);j.parentNode.removeChild(j);h.selection.moveToBookmark(o)}else{d("ol")}}h.undoManager.add();return true}}}}}}return false},getRangeParent:function(c,b){return this.ed.dom.getParent(c.commonAncestorContainer,b)},getSelectionParent:function(b){return this.getRangeParent(this.ed.selection.getRng(true),b)},cleanList:function(b,d){var c=this;this._stripStyleAndMetaTags(b,d);this._wrapListChildren(b,d);if(d.nodeType!=1){return}$j.each(d.childNodes,function(){c.cleanList(b,this)})},_stripStyleAndMetaTags:function(b,c){if(c.nodeType!=1){return}$j.each(c.childNodes,function(){if(this.nodeType&&this.nodeType!=1&&this.nodeType!=3||this.nodeType==1&&(this.nodeName.toLowerCase()=="meta"||this.nodeName.toLowerCase()=="style")){c.removeChild(this)}})},_wrapListChildren:function(b,c){$j(c).filter("ul, ol").each(function(){var d=this;$j.each(this.childNodes,function(){var e;if(this.nodeType==3&&$j.trim(this.nodeValue)===""){d.removeChild(this)}else{if(this.nodeType==3||(this.nodeType==1&&!$j(this).is("li, ul, ol"))){e=b.getDoc().createElement("li");d.insertBefore(e,this);e.appendChild(this)}}})})},listTypeToStyle:function(b){if(!b||!b.nodeName||!/[uo]l/i.test(b.nodeName)){return}var c=tinyMCE.activeEditor;var e=b.getAttribute("type");var d=null;switch(e){case"1":d="decimal";break;case"A":d="upper-alpha";break;case"a":d="lower-alpha";break;case"I":d="upper-roman";break;case"i":d="lower-roman";break;default:if(e&&typeof(e)=="string"){e=e.toLowerCase();switch(e){case"circle":case"disc":case"square":d=e;break}}break}if(d){c.dom.setStyle(b,"listStyleType",d)}b.removeAttribute("type")},init:function(b,c){this.url=c;this.ed=b;var d=this;this.index=0;this.ol_styles=new Array();this.ol_styles.push(["default","",0]);this.ol_styles.push(["d","decimal",1]);if(!tinymce.isIE){this.ol_styles.push(["dz","decimal-leading-zero",2])}this.ol_styles.push(["ur","upper-roman",3]);this.ol_styles.push(["lr","lower-roman",4]);this.ol_styles.push(["ua","upper-alpha",5]);this.ol_styles.push(["la","lower-alpha",6]);if(!tinymce.isIE){this.ol_styles.push(["lg","lower-greek",7]);this.ol_styles.push(["ki","katakana-iroha",8]);this.ol_styles.push(["k","katakana",9]);this.ol_styles.push(["hii","hiragana-iroha",10]);this.ol_styles.push(["hi","hiragana",11]);this.ol_styles.push(["ci","cjk-ideographic",12]);this.ol_styles.push(["g","georgian",13]);this.ol_styles.push(["a","armenian",14]);this.ol_styles.push(["he","hebrew",15])}this.ul_styles=new Array();this.ul_styles.push(["default","",0]);this.ul_styles.push(["di","disc",1]);this.ul_styles.push(["c","circle",2]);this.ul_styles.push(["s","square",3]);b.onBeforeSetContent.add(function(e,f){if(tinymce.isIE){f.content=f.content.replace(/<br\/><\/li>/g,"</li>")}});b.onSetContent.add(function(){d.fixListTypes()});b.onNodeChange.add(function(e){if(this.initialized){var g=e.selection.getNode();var h=e.dom.getParent(g,"ul,ol");if(h){this.fixLists(e);var f=this;e.undoManager.transparentChange(function(){f.cleanList(e,h)})}}},this);this.onBeforeFixLists=new tinymce.util.Dispatcher();this.onAfterFixLists=new tinymce.util.Dispatcher();this.initialized=false;b.onBeforeGetContent.add(function(){if(this.initialized){this.fixLists(tinymce.activeEditor)}},this);b.onInit.add(function(){this.initialized=true;if(b.plugins.paste){b.plugins.paste.onPostProcess.add(function(){this.fixLists(b)},this)}if(b.plugins.jivecontextmenu){var h=b.plugins.jivecontextmenu;function f(w,v){v=v.toUpperCase();var q,p,r,n;if(v=="UL"){q=288;p=0;r=81;n=158}else{if(v=="OL"){q=260;p=0;r=81;n=135}}var s=[];for(var o=0;o<w.length;++o){var m=w[o][0];var u=o==0?q:r+(w[o][2]-1)*28;var t=o==0?p:n;s.push(new h.MenuItem(m+"ListStyle",null,b.getLang("jivelists."+m),{url:CS_RESOURCE_BASE_URL+"/images/tiny_mce3/themes/advanced/img/iconmaster.gif",xOffset:u,yOffset:t,width:28,height:23},"mce"+v+"ListStyle"+o))}return s}var l=f(this.ul_styles,"UL");var e=new h.Menu(l,true,true,b.getLang("jivelists.list_style_hdr"));var k=new h.MenuItem("ulItem",/ul/i,null,{url:CS_RESOURCE_BASE_URL+"/images/tiny_mce3/themes/advanced/img/iconmaster.gif",xOffset:288,yOffset:0,width:28,height:23},e);h.addRootItem(k);var j=f(this.ol_styles,"OL");var i=new h.Menu(j,true,true,b.getLang("jivelists.list_style_hdr"));var g=new h.MenuItem("olItem",/ol/i,null,{url:CS_RESOURCE_BASE_URL+"/images/tiny_mce3/themes/advanced/img/iconmaster.gif",xOffset:260,yOffset:0,width:28,height:23},i);h.addRootItem(g)}if(b.plugins.contextmenu){b.plugins.contextmenu.onContextMenu.add(function(n,p,r){var o,u,v,s,q,t;u=b.dom.getParent(r,"ol, ul");if(u&&u.nodeName.toLowerCase()=="ol"){v=b.dom.getParent(r,function(m){return $def(m.tagName)&&m.tagName.toLowerCase()=="ol"&&m!=u});p.addSeparator();o=p.addMenu({title:"jivelists.list_style",max_height:"200","class":"mceDropDown defaultSkin mceMacroMenu mceListBoxMenu"});s=b.plugins.jivelists.ol_styles;for(q=0;q<s.length;q++){if(v!=null||v==null&&s[q][0]!="inherit"){t="";if(u.style.listStyleType==s[q][1]){t="mceMenuItemSelected"}else{t=""}o.add({title:"jivelists."+s[q][0],cmd:"mceOLListStyle"+q,"class":t})}if(q==2){o.addSeparator()}}}else{if(u&&u.nodeName.toLowerCase()=="ul"){v=b.dom.getParent(r,function(m){return $def(m.tagName)&&m.tagName.toLowerCase()=="ul"&&m!=u});p.addSeparator();o=p.addMenu({title:"jivelists.list_style",max_height:"200","class":"mceDropDown defaultSkin mceMacroMenu mceListBoxMenu"});s=b.plugins.jivelists.ul_styles;for(q=0;q<s.length;q++){if(v!=null||v==null&&s[q][0]!="inherit"){t="";if(u.style.listStyleType==s[q][1]){t="mceMenuItemSelected"}else{t=""}o.add({title:"jivelists."+s[q][0],cmd:"mceULListStyle"+q,"class":t})}if(q==2){o.addSeparator()}}}}})}},this);this.prepForEnter=false;this.prepForDel=false;b.onKeyDown.addToTop(function(i,x){this.prepForEnter=false;this.prepForDel=false;this.prepForDelB=false;var j=i.selectionUtil.isEffectivelyEmpty;var k;var t=i.selection;var n=i.dom.getParent(t.getNode(),"li");var w=i.dom.getParent(t.getNode(),"ul,ol");if(x.keyCode==8&&t.isCollapsed()&&n){var q=i.selectionUtil.atStartOf(n)||j(n);if(n!=null&&n.nodeType==1&&w!=null&&q){this.prepForDel=true;i.execCommand("mceOutdent");if(w.parentNode&&!w.firstChild){w.parentNode.removeChild(w)}tinymce.dom.Event.cancel(x);return false}}else{if(x.keyCode==46&&t.isCollapsed()){function u(A){var p=A.nextSibling;while(p){var e=p.nodeName.toLowerCase();if(e=="ul"||e=="ol"){p=p.firstChild}else{if(e=="table"){return null}else{if(i.dom.isBlock(p)){return p}else{return null}}}}if(A.nodeName.toLowerCase()!="body"){return u(A.parentNode)}return null}function s(e){while(e.lastChild&&e.lastChild.nodeName.toLowerCase()=="br"){e.removeChild(e.lastChild)}}if(n!=null){var f=i.selectionUtil.atEndOf(n)||j(n);if(n.nodeType==1&&w!=null&&f){i.undoManager.add();var m=u(n);if(m){s(n);this.reparentChildren(n,m);m.parentNode.removeChild(m)}this.prepForDel=true;i.undoManager.add();tinymce.dom.Event.cancel(x);return false}}else{var y=i.dom.getParent(t.getNode(),function(e){return i.dom.isBlock(e)});if(y){m=u(y);if(m&&(i.selectionUtil.atEndOf(y)||j(y))){i.undoManager.add();var h=i.selection.getBookmark();s(y);this.reparentChildren(y,m);var o=m.parentNode;m.parentNode.removeChild(m);while(j(o)){var g=o;o=o.parentNode;o.removeChild(g)}this.prepForDel=true;i.selection.moveToBookmark(h);i.undoManager.add();tinymce.dom.Event.cancel(x);return false}}}}else{if(x.keyCode==13&&x.shiftKey){var l=n?n:i.dom.getParent(t.getNode(),function(e){return i.dom.isBlock(e)});k=t.getRng(true);if(k.collapsed){this.prepForEnter=true;i.undoManager.add();var z=i.getDoc().createElement("br");k.insertNode(z);k.setStart(l,i.dom.nodeIndex(z)+1);k.collapse(true);t.setRng(k);if(tinymce.isWebKit&&i.selectionUtil.atEndOf(l)){l.appendChild(i.getDoc().createElement("br"))}i.undoManager.add();tinymce.dom.Event.cancel(x);return false}}else{if(x.keyCode==9&&!x.ctrlKey&&!x.altKey){var r=i.dom.getParent(i.selection.getNode(),"table,ul,ol");if(r!=null&&r.nodeName.toLowerCase()!="table"){try{if(x.shiftKey){i.execCommand("mceOutdent")}else{i.execCommand("mceIndent")}}catch(v){}return tinymce.dom.Event.cancel(x)}}}}}},this);b.onKeyPress.add(function(f,h){if((h.keyCode==8||h.keyCode==46)&&this.prepForDel){tinymce.dom.Event.cancel(h);return false}if(h.keyCode==13&&this.prepForEnter){tinymce.dom.Event.cancel(h);return false}if(h.keyCode==9&&!h.ctrlKey&&!h.altKey){var g=f.dom.getParent(f.selection.getNode(),"table,ul,ol");if(g!=null&&g.nodeName.toLowerCase()!="table"){tinymce.dom.Event.cancel(h);return false}}},this);b.onKeyUp.add(function(f,g){if((g.keyCode==8||g.keyCode==46)&&this.prepForDel){tinymce.dom.Event.cancel(g);return false}if(g.keyCode==13&&this.prepForEnter){tinymce.dom.Event.cancel(g);return false}},this)},getInfo:function(){return{longname:"Jive Lists",author:"Jive Software",authorurl:"http://jivesoftware.com",infourl:"http://jivesoftware.com",version:tinyMCE.majorVersion+"."+tinyMCE.minorVersion}},createControl:function(c,b){return null}});tinymce.PluginManager.add("jivelists",tinymce.plugins.JiveListsPlugin)})();