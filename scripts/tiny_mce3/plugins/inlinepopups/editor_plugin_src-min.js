(function(){var e=tinymce.DOM,b=tinymce.dom.Element,a=tinymce.dom.Event,f=tinymce.each,c=tinymce.is;tinymce.create("tinymce.plugins.InlinePopups",{init:function(g,h){g.onBeforeRenderUI.add(function(){g.windowManager=new tinymce.InlineWindowManager(g)})},getInfo:function(){return{longname:"InlinePopups",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/inlinepopups",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.create("tinymce.InlineWindowManager:tinymce.WindowManager",{InlineWindowManager:function(g){var h=this;h.parent(g);h.zIndex=300000;h.count=0},doc:null,open:function(C,s){var r=this,v,g="",i=r.editor,q=0,B=0,z,x,h,j,l,m,o;var k=0,A=0;var m=window;try{while(m.parent&&m!=m.parent&&typeof(m.parent.jive)!="undefined"){if(m.frameElement){k+=jive.ext.x.xPageX(m.frameElement);A+=jive.ext.x.xPageY(m.frameElement)}m=m.parent;m.editor=window.editor;m.jiveRTE=window.jiveRTE;m.tinymce=window.tinymce;m.tinyMCE=window.tinyMCE}}catch(D){}i.plugins.inlinepopups.doc=m.document;var F=i.plugins.inlinepopups.doc;var y=new tinymce.dom.DOMUtils(F);if(!$def(i.plugins.inlinepopups.overlay)){var E=F.createElement("DIV");E.className="overlay";E.setAttribute("class","overlay");F.body.appendChild(E);i.plugins.inlinepopups.overlay=E;jive.ext.x.xAddEventListener(E,"click",function(){var t=window.editor.toArray(function(u){return $def(u.closeAllDialogs)});for(var p=0;p<t.length;p++){t[p].closeAllDialogs()}})}C=C||{};s=s||{};if(!C.inline){return r.parent(C,s)}if(!C.type){r.bookmark=i.selection.getBookmark("simple")}v=y.uniqueId()+Math.round(Math.random()*10000000);z=y.getViewPort();C.width=parseInt(C.width||320);C.height=parseInt(C.height||240);C.min_width=parseInt(C.min_width||150);C.min_height=parseInt(C.min_height||100);C.max_width=parseInt(C.max_width||2000);C.max_height=parseInt(C.max_height||2000);C.left=C.left||Math.round(Math.max(z.x,z.x+(z.w/2)-(C.width/2)));C.top=C.top||Math.round(Math.max(z.y,z.y+(z.h/2)-(C.height/2)));C.left+=k;C.top+=A;C.movable=C.resizable=true;s.mce_width=C.width;s.mce_height=C.height;s.mce_inline=true;s.mce_window_id=v;s.mce_auto_focus=C.auto_focus;r.features=C;r.params=s;r.onOpen.dispatch(r,C,s);if(C.type){g+=" mceModal";if(C.type){g+=" mce"+C.type.substring(0,1).toUpperCase()+C.type.substring(1)}C.resizable=false}if(C.statusbar){g+=" mceStatusbar"}if(C.resizable){g+=" mceResizable"}if(C.minimizable){g+=" mceMinimizable"}if(C.maximizable){g+=" mceMaximizable"}if(C.movable){g+=" mceMovable"}r._addAll(F.body,["div",{id:v,"class":i.settings.inlinepopups_skin||"clearlooks2",style:"width:100px;height:100px"},["div",{id:v+"_wrapper","class":"mceWrapper"+g},["div",{id:v+"_top","class":"mceTop"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:v+"_title"},C.title||""]],["div",{id:v+"_middle","class":"mceMiddle"},["div",{id:v+"_left","class":"mceLeft"}],["span",{id:v+"_content","class":"mceMessage j-rc3"}],["div",{id:v+"_right","class":"mceRight"}]],["div",{id:v+"_bottom","class":"mceBottom"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:v+"_status"},"Content"]],["a",{"class":"mceMove",tabindex:"-1",href:"javascript:;"}],["a",{"class":"mceMin",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMax",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMed",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceClose j-ui-elem",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{id:v+"_resize_n","class":"mceResize mceResizeN",tabindex:"-1",href:"javascript:;"}],["a",{id:v+"_resize_s","class":"mceResize mceResizeS",tabindex:"-1",href:"javascript:;"}],["a",{id:v+"_resize_w","class":"mceResize mceResizeW",tabindex:"-1",href:"javascript:;"}],["a",{id:v+"_resize_e","class":"mceResize mceResizeE",tabindex:"-1",href:"javascript:;"}],["a",{id:v+"_resize_nw","class":"mceResize mceResizeNW",tabindex:"-1",href:"javascript:;"}],["a",{id:v+"_resize_ne","class":"mceResize mceResizeNE",tabindex:"-1",href:"javascript:;"}],["a",{id:v+"_resize_sw","class":"mceResize mceResizeSW",tabindex:"-1",href:"javascript:;"}],["a",{id:v+"_resize_se","class":"mceResize mceResizeSE",tabindex:"-1",href:"javascript:;"}]]]);y.setStyles(v,{top:-10000,left:-10000});if(tinymce.isGecko){y.setStyle(v,"overflow","auto")}if(!C.type){q+=y.get(v+"_left").clientWidth;q+=y.get(v+"_right").clientWidth;B+=y.get(v+"_top").clientHeight;B+=y.get(v+"_bottom").clientHeight}y.setStyles(v,{top:C.top,left:C.left,width:C.width+q,height:C.height+B});o=C.url||C.file;if(o){if(tinymce.relaxedDomain){o+=(o.indexOf("?")==-1?"?":"&")+"mce_rdomain="+tinymce.relaxedDomain}o=tinymce._addVer(o)}if(!C.type){y.add(v+"_content","iframe",{id:v+"_ifr",src:'javascript:""',frameBorder:0,style:"border:0;width:10px;height:10px"});y.setStyles(v+"_ifr",{width:C.width,height:C.height});y.setAttrib(v+"_ifr","src",o)}else{var n=y.get(v+"_wrapper");r._addAll(n,["input",{id:v+"_ok","class":"mceOk",value:"OK",type:"button"}]);if(C.type=="confirm"){y.add(v+"_wrapper","input",{"class":"mceCancel",value:"Cancel",type:"button"})}y.add(v+"_middle","div",{"class":"mceIcon"});y.setHTML(v+"_content",C.content.replace("\n","<br />"))}h=a.add(v,"mousedown",function(u){var G=u.target,p,t;p=r.windows[v];r.focus(v);if(G.nodeName.toLowerCase()=="a"||G.nodeName.toLowerCase()=="input"){if(G.className=="mceClose j-ui-elem"){r.close(null,v);return a.cancel(u)}else{if(G.className=="mceOk"||G.className=="mceCancel"){C.button_func(G.className=="mceOk");return a.cancel(u)}else{if(G.className=="mceMax"){p.oldPos=p.element.getXY();p.oldSize=p.element.getSize();t=y.getViewPort();t.w-=2;t.h-=2;p.element.moveTo(t.x,t.y);p.element.resizeTo(t.w,t.h);y.setStyles(v+"_ifr",{width:t.w-p.deltaWidth,height:t.h-p.deltaHeight});y.addClass(v+"_wrapper","mceMaximized")}else{if(G.className=="mceMed"){p.element.moveTo(p.oldPos.x,p.oldPos.y);p.element.resizeTo(p.oldSize.w,p.oldSize.h);p.iframeElement.resizeTo(p.oldSize.w-p.deltaWidth,p.oldSize.h-p.deltaHeight);y.removeClass(v+"_wrapper","mceMaximized")}else{if(G.className=="mceMove"){return r._startDrag(v,u,G.className)}else{if(y.hasClass(G,"mceResize")){return r._startDrag(v,u,G.className.substring(13))}}}}}}}});j=function(u){var w=u.target||u.srcElement;if($def(w)&&w){r.focus(v);if(w.nodeName=="INPUT"||w.nodeName=="input"||w.nodeName=="A"||w.nodeName=="a"){switch(w.className){case"mceClose j-ui-elem":var t=window.editor.toArray(function(G){return $def(G.closeAllDialogs)});for(var p=0;p<t.length;p++){t[p].closeAllDialogs()}return a.cancel(u);case"mceOk":case"mceCancel":C.button_func(w.className=="mceOk");return a.cancel(u)}}}};y.bind(v,"click",j);r.windows=r.windows||{};m=r.windows[v]={id:v,mousedown_func:h,click_func:j,element:new b(v,{blocker:1,container:i.getContainer()}),iframeElement:new b(v+"_ifr"),features:C,deltaWidth:q,deltaHeight:B};m.iframeElement.on("focus",function(){r.focus(v)});if(r.count==0&&r.editor.getParam("dialog_type")=="modal"){y.add(y.doc.body,"div",{id:"mceModalBlocker","class":(r.editor.settings.inlinepopups_skin||"clearlooks2")+"_modalBlocker",style:{left:z.x,top:z.y,zIndex:r.zIndex-1}});y.show("mceModalBlocker")}else{y.setStyle("mceModalBlocker","z-index",r.zIndex-1)}r.focus(v);r._fixIELayout(v,1);if(y.get(v+"_ok")){y.get(v+"_ok").focus()}r.count++;i.plugins.inlinepopups.overlay.style.height=jive.ext.x.xDocHeight(F)+"px";i.plugins.inlinepopups.overlay.style.display="block";return m},focus:function(l){var h=tinyMCE.activeEditor;if(h.plugins.inlinepopups.doc==null){var g=window;while(g.parent&&g!=g.parent){g=g.parent;if(!$def(g.tinymce)){g.tinymce=window.tinymce;g.tinyMCE=window.tinyMCE}}h.plugins.inlinepopups.doc=g.document}var i=this,g=i.windows[l],j=tinyMCE.activeEditor.plugins.inlinepopups.doc,k=new tinymce.dom.DOMUtils(j);if($def(g)&&g){g.zIndex=this.zIndex++;g.element.setStyle("zIndex",g.zIndex);g.element.update()}l=l+"_wrapper";k.removeClass(i.lastId,"mceFocus");k.addClass(l,"mceFocus");i.lastId=l},_addAll:function(m,k){var h,o,g=this,j=tinyMCE.activeEditor.plugins.inlinepopups.doc,l=new tinymce.dom.DOMUtils(j);if(c(k,"string")){m.appendChild(l.doc.createTextNode(k))}else{if(k.length){m=m.appendChild(l.create(k[0],k[1]));for(h=2;h<k.length;h++){g._addAll(m,k[h])}}}},_startDrag:function(x,I,F){var q=this,v,B,H=tinyMCE.activeEditor.plugins.inlinepopups.doc,A=new tinymce.dom.DOMUtils(H);var g,m=q.windows[x],i=m.element,z=i.getXY(),y,r,G,h,C,u,s,k,j,n,l,o,D;h={x:0,y:0};C=A.getViewPort();C.w-=2;C.h-=2;k=I.screenX;j=I.screenY;n=l=o=D=0;v=a.add(H,"mouseup",function(p){a.remove(H,"mouseup",v);a.remove(H,"mousemove",B);if(g){g.remove()}i.moveBy(n,l);i.resizeBy(o,D);r=i.getSize();A.setStyles(x+"_ifr",{width:r.w-m.deltaWidth,height:r.h-m.deltaHeight});q._fixIELayout(x,1);return a.cancel(p)});if(F!="Move"){E()}function E(){var p=tinyMCE.activeEditor.plugins.inlinepopups.doc,t=new tinymce.dom.DOMUtils(p);if(g){return}q._fixIELayout(x,0);t.add(d.body,"div",{id:"mceEventBlocker","class":"mceEventBlocker "+(q.editor.settings.inlinepopups_skin||"clearlooks2"),style:{left:C.x,top:C.y,zIndex:q.zIndex+1}});g=new b("mceEventBlocker");g.update();y=i.getXY();r=i.getSize();u=h.x+y.x-C.x;s=h.y+y.y-C.y;t.add(g.get(),"div",{id:"mcePlaceHolder","class":"mcePlaceHolder",style:{left:u,top:s,width:r.w,height:r.h}});G=new b("mcePlaceHolder")}B=a.add(d,"mousemove",function(w){var p,J,t;E();p=w.screenX-k;J=w.screenY-j;switch(F){case"ResizeW":n=p;o=0-p;break;case"ResizeE":o=p;break;case"ResizeN":case"ResizeNW":case"ResizeNE":if(F=="ResizeNW"){n=p;o=0-p}else{if(F=="ResizeNE"){o=p}}l=J;D=0-J;break;case"ResizeS":case"ResizeSW":case"ResizeSE":if(F=="ResizeSW"){n=p;o=0-p}else{if(F=="ResizeSE"){o=p}}D=J;break;case"mceMove":n=p;l=J;break}if(o<(t=m.features.min_width-r.w)){if(n!==0){n+=o-t}o=t}if(D<(t=m.features.min_height-r.h)){if(l!==0){l+=D-t}D=t}o=Math.min(o,m.features.max_width-r.w);D=Math.min(D,m.features.max_height-r.h);n=Math.max(n,C.x-(u+C.x));l=Math.max(l,C.y-(s+C.y));n=Math.min(n,(C.w+C.x)-(u+r.w+C.x));l=Math.min(l,(C.h+C.y)-(s+r.h+C.y));if(n+l!==0){if(u+n<0){n=0}if(s+l<0){l=0}G.moveTo(u+n,s+l)}if(o+D!==0){G.resizeTo(r.w+o,r.h+D)}return a.cancel(w)});return a.cancel(I)},resizeBy:function(h,i,j){var g=this.windows[j];if(g){g.element.resizeBy(h,i);g.iframeElement.resizeBy(h,i)}},close:function(g,h){setTimeout(function(j,k,i){return function(){var q=tinyMCE.activeEditor.plugins.inlinepopups.doc,r=new tinymce.dom.DOMUtils(q);var m,l=0,o;i.count--;if(i.count==0){r.remove("mceModalBlocker")}if(!k&&j){i.parent(j);return}if(m=i.windows[k]){tinyMCE.activeEditor.plugins.inlinepopups.overlay.style.display="none";i.onClose.dispatch(i);a.remove(q,"mousedown",m.mousedownFunc);a.remove(q,"click",m.clickFunc);a.clear(k);a.clear(k+"_ifr");r.setAttrib(k+"_ifr","src",'javascript:""');var n=q.getElementById(m.id);try{m.element.remove();n.parentNode.removeChild(n)}catch(p){}delete i.windows[k]}else{}tinyMCE.activeEditor.focus();tinyMCE.activeEditor.undoManager.add()}}(g,h,this),33)},setTitle:function(g,k){var i=tinyMCE.activeEditor.plugins.inlinepopups.doc,j=new tinymce.dom.DOMUtils(i);var h;if(h=j.get(k+"_title")){h.innerHTML=j.encode(g)}},alert:function(h,g,l){var j=tinyMCE.activeEditor;if(j.plugins.inlinepopups.doc==null){var i=window;while(i.parent&&i!=i.parent){i=i.parent;if(!$def(i.tinymce)){i.tinymce=window.tinymce;i.tinyMCE=window.tinyMCE}}j.plugins.inlinepopups.doc=i.document}var m=tinyMCE.activeEditor.plugins.inlinepopups.doc,n=new tinymce.dom.DOMUtils(m);var k=this,i;i=k.open({title:k,type:"alert",button_func:function(o){if(g){g.call(o||k,o)}k.close(null,i.id)},content:n.encode(k.editor.getLang(h,h)),inline:1,width:400,height:130})},confirm:function(h,g,l){var j=tinyMCE.activeEditor;if(j.plugins.inlinepopups.doc==null){var i=window;while(i.parent&&i!=i.parent){i=i.parent;if(!$def(i.tinymce)){i.tinymce=window.tinymce;i.tinyMCE=window.tinyMCE}}j.plugins.inlinepopups.doc=i.document}var m=tinyMCE.activeEditor.plugins.inlinepopups.doc,n=new tinymce.dom.DOMUtils(m);var k=this,i;i=k.open({title:k,type:"confirm",button_func:function(o){if(g){g.call(o||k,o)}k.close(null,i.id)},content:n.encode(k.editor.getLang(h,h)),inline:1,width:400,height:130})},_fixIELayout:function(l,i){var j=tinyMCE.activeEditor.plugins.inlinepopups.doc,k=new tinymce.dom.DOMUtils(j);var g,h;if(!tinymce.isIE6){return}f(["n","s","w","e","nw","ne","sw","se"],function(m){var n=k.get(l+"_resize_"+m);k.setStyles(n,{width:i?n.clientWidth:"",height:i?n.clientHeight:"",cursor:k.getStyle(n,"cursor",1)});k.setStyle(l+"_bottom","bottom","-1px");n=0});if(g=this.windows[l]){g.element.hide();g.element.show();f(k.select("div,a",l),function(n,m){if(n.currentStyle.backgroundImage!="none"){h=new Image();h.src=n.currentStyle.backgroundImage.replace(/url\(\"(.+)\"\)/,"$1")}});k.get(l).style.filter=""}}});tinymce.PluginManager.add("inlinepopups",tinymce.plugins.InlinePopups)})();