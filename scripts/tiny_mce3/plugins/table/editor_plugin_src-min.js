(function(){var a=tinymce.each;tinymce.create("tinymce.plugins.TablePlugin",{putCursorInCell:function(b,f){var e=false;if(f.childNodes.length==0){if(f.childNodes.length==0){f.appendChild(b.plugins.jivemacros.createEmptyPara());e=true}}var d=f.childNodes[0];var c=f;while(d.nodeType==1&&d.childNodes.length){c=d;d=d.childNodes[0]}b.selection.select(tinymce.isIE?c:d);b.selection.collapse(true);if(e){f.removeChild(f.childNodes[0])}},tempTable:null,fixTable:function(){if(this.tempTable!=null&&$def(this.tempTable)&&this.tempTable.getAttribute("width")){var c=this.tempTable.getAttribute("width");if(c.indexOf("%")==-1){c+="px"}this.tempTable.style.width=c;this.tempTable.removeAttribute("width");this.tempTable.setAttribute("data-mce-style",this.tempTable.getAttribute("style"))}if(this.tempTable.childNodes.length){var d=this.tempTable.childNodes[0];if(d.childNodes.length){var b=d.childNodes[0];if(b.childNodes.length){var e=b.childNodes[0];if(b.nodeName==e.nodeName&&b.nodeName.toLowerCase()=="tr"){while(b.childNodes.length){d.appendChild(b.childNodes[0])}d.removeChild(b)}}}}},fixInvisibleTableBorders:function(b,d){if(d.nodeType==1&&d.nodeName.toLowerCase()=="table"){if(d.style.borderCollapse=="collapse"){d.style.borderCollapse="separate";setTimeout(function(){d.style.borderCollapse="collapse"},330)}}else{if(d.nodeType==1){for(var c=0;c<d.childNodes.length;c++){this.fixInvisibleTableBorders(b,d.childNodes[c])}}}},init:function(b,c){var d=this;d.editor=b;d.url=c;a([["table","table.props_desc","mceInsertTable",true],["delete_table","table.del","mceTableDelete"],["delete_col","table.delete_col_desc","mceTableDeleteCol"],["delete_row","table.delete_row_desc","mceTableDeleteRow"],["col_after","table.col_after_desc","mceTableInsertColAfter"],["col_before","table.col_before_desc","mceTableInsertColBefore"],["row_after","table.row_after_desc","mceTableInsertRowAfter"],["row_before","table.row_before_desc","mceTableInsertRowBefore"],["row_props","table.row_desc","mceTableRowProps",true],["cell_props","table.cell_desc","mceTableCellProps",true],["split_cells","table.split_cells_desc","mceTableSplitCells",true],["merge_cells","table.merge_cells_desc","mceTableMergeCells",true],["row_up","table.row_up","mceTableRowUp",true],["row_down","table.row_down","mceTableRowDown",true],["col_left","table.col_left","mceTableColLeft",true],["col_right","table.col_right","mceTableColRight",true]],function(e){b.addButton(e[0],{title:e[1],cmd:e[2],ui:e[3]})});b.onInit.add(function(){if(tinymce.isGecko){b.plugins.table.fixInvisibleTableBorders(b,b.getBody())}if(b&&b.plugins.contextmenu){b.plugins.contextmenu.onContextMenu.add(function(h,f,j){var k,i=b.selection,g=i.getNode()||b.getBody();if(b.dom.getParent(j,"td")||b.dom.getParent(j,"th")){f.removeAll();if(g.nodeName=="A"&&!b.dom.getAttrib(g,"name")){f.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"});f.addSeparator()}if(g.nodeName=="IMG"&&g.className.indexOf("mceItem")==-1){f.add({title:"advanced.image_desc",icon:"image",cmd:b.plugins.advimage?"mceAdvImage":"mceImage",ui:true});f.addSeparator()}f.add({title:"table.props_desc",icon:"table_props",cmd:"mceInsertTable",ui:true});f.add({title:"table.del",icon:"delete_table",cmd:"mceTableDelete",ui:true});f.addSeparator();k=f.addMenu({title:"table.cell"});k.add({title:"table.cell_desc",icon:"cell_props",cmd:"mceTableCellProps",ui:true});k.add({title:"table.split_cells_desc",icon:"split_cells",cmd:"mceTableSplitCells",ui:true});k.add({title:"table.merge_cells_desc",icon:"merge_cells",cmd:"mceTableMergeCells",ui:true});k=f.addMenu({title:"table.row"});k.add({title:"table.row_desc",icon:"row_props",cmd:"mceTableRowProps",ui:true});k.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"});k.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"});k.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"});k.addSeparator();k.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"});k.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"});if(b.tableRowClipboard){k.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"});k.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"})}k=f.addMenu({title:"table.col"});k.add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"});k.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"});k.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"})}else{if(b.dom.getParent(j,"img")==null){f.add({title:"table.desc",icon:"table",cmd:"mceInsertTable",ui:true,value:{action:"insert"}})}}})}});b.onKeyUp.add(function(f,h){if(h.keyCode==9&&!h.ctrlKey&&!h.altKey){var g=f.dom.getParent(f.selection.getNode(),"li,td,th,caption");if(g!=null&&g.nodeName.toLowerCase()!="li"){if(h.shiftKey){if(g.previousSibling!=null){this.putCursorInCell(f,g.previousSibling)}else{var i=f.dom.getParent(g,"tr");if(i.previousSibling){this.putCursorInCell(f,i.previousSibling.cells[i.previousSibling.childNodes.length-1])}else{this.putCursorInCell(f,g)}}}else{if(g.nextSibling!=null){this.putCursorInCell(f,g.nextSibling)}else{var i=f.dom.getParent(g,"tr");if(i.nextSibling){this.putCursorInCell(f,i.nextSibling.cells[0])}else{f.execCommand("mceTableInsertRowAfter");this.putCursorInCell(f,i.nextSibling.cells[0])}}}f.nodeChanged();tinymce.dom.Event.cancel(h)}}},this);b.onKeyDown.add(function(f,h){if(h.keyCode==9&&!h.ctrlKey&&!h.altKey&&f.dom.getParent(f.selection.getNode(),"TABLE")){f.undoManager.add()}if(h.keyCode==9&&!h.ctrlKey&&!h.altKey){var g=f.dom.getParent(f.selection.getNode(),"td,th,caption");if(g!=null){tinymce.dom.Event.cancel(h)}}});b.onKeyPress.add(function(f,h){if(h.keyCode==9&&!h.ctrlKey&&!h.altKey){var g=f.dom.getParent(f.selection.getNode(),"td,th,caption");if(g!=null){tinymce.dom.Event.cancel(h)}}});if(!tinymce.isIE){if(b.getParam("table_selection",true)){b.onClick.add(function(f,g){g=g.target;if(g.nodeName==="TABLE"){f.selection.select(g)}})}}b.onMouseUp.add(function(f,h){var i=f.selection.getNode();var g=f.dom.getParent(i,"table");if(g){f.plugins.table.tempTable=g;if(h.target.nodeName.toLowerCase()=="tr"||h.target.nodeName.toLowerCase()=="table"){f.plugins.table._doExecCommand("fixMissingCells",g)}jive.ext.x.xTimer.set("timeout",f.plugins.table,"fixTable",33)}});b.onNodeChange.add(function(g,f,k){var i=g.dom.getParent(k,"td,th,caption");var e=g.dom.getParent(k,"td,th");if(e&&g.selection.isCollapsed()){var j=g.dom.getAttrib(e,"colspan");var h=g.dom.getAttrib(e,"rowspan");j=j==""?1:parseInt(j);h=h==""?1:parseInt(h);f.setDisabled("split_cells",j==1&&h==1);f.setDisabled("merge_cells",!(j==1&&h==1))}else{if(e){f.setDisabled("split_cells",false);f.setDisabled("merge_cells",false)}else{f.setDisabled("split_cells",true);f.setDisabled("merge_cells",true)}}if(i&&i.nodeName==="CAPTION"){i=null}f.setDisabled("delete_table",!i);f.setDisabled("delete_col",!i);f.setDisabled("delete_table",!i);f.setDisabled("delete_row",!i);f.setDisabled("col_after",!i);f.setDisabled("col_before",!i);f.setDisabled("row_after",!i);f.setDisabled("row_before",!i);f.setDisabled("row_props",!i);f.setDisabled("cell_props",!i)});if(!tinymce.isIE){b.onBeforeSetContent.add(function(e,f){if(f.initial){f.content=f.content.replace(/<(td|th)([^>]+|)>\s*<\/(td|th)>/g,tinymce.isOpera?"<$1$2>&nbsp;</$1>":'<$1$2><br mce_bogus="1" /></$1>')}})}b.onKeyDown.addToTop(function(h,j){var e=h.selection.getRng(true);if(e.collapsed){if(j.keyCode==39||j.keyCode==40){var o=h.dom.getParent(e.startContainer,"p");if(o&&h.selectionUtil.isEffectivelyEmpty(o)&&this.isFirst(h.getBody(),o)){var g=o.nextSibling;while(g&&g.nodeType!=1){g=g.nextSibling}if(g&&g.nodeName.toLowerCase()=="p"){g=g.firstChild}if(g&&g.nodeName.toLowerCase()=="table"){setTimeout(function(){o.parentNode.removeChild(o)},0)}}}else{if(j.keyCode==38){var k=h.dom.getParent(e.startContainer,"td, th");if(k){var m=h.dom.getParent(k,"table");if(this.isFirst(h.getBody(),m)){var i=h.dom.getParent(k,"tr");if(this.isFirst(m,k)){var f=h.plugins.jivemacros.createEmptyPara();var l=m;while(l.parentNode.nodeName.toLowerCase()!="body"){l=l.parentNode}l.parentNode.insertBefore(f,l)}}}}}}},this)},isFirst:function(b,c){if(b.childNodes.length==0){return false}return(b.childNodes[0]==c||this.isFirst(b.childNodes[0],c))},execCommand:function(g,f,h){var d=this.editor,c;switch(g){case"mceInsertTable":case"mceTableRowProps":case"mceTableCellProps":case"mceTableSplitCells":case"mceTableMergeCells":case"mceTableInsertRowBefore":case"mceTableInsertRowAfter":case"mceTableDeleteRow":case"mceTableInsertColBefore":case"mceTableInsertColAfter":case"mceTableDeleteCol":case"mceTableCutRow":case"mceTableCopyRow":case"mceTablePasteRowBefore":case"mceTablePasteRowAfter":case"mceTableDelete":case"JustifyLeft":case"JustifyCenter":case"JustifyRight":case"JustifyFull":case"mceTableRowUp":case"mceTableRowDown":case"mceTableColLeft":case"mceTableColRight":d.execCommand("mceBeginUndoLevel");var e=this._doExecCommand(g,f,h);if(e==-1){return false}if(e){d.execCommand("mceEndUndoLevel");d.undoManager.add(false,true)}return true}return false},getInfo:function(){return{longname:"Tables",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/table",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_doExecCommand:function(ab,T,M){var b=this.editor,e=b,v=this.url;var aD=b.selection.getNode();if(typeof(M)!="undefined"&&typeof(M.cell)!="undefined"){aD=M.cell}var aA=b.dom.getParent(aD,"tr");var Z=b.dom.getParent(aD,"td,th");if(typeof(M)!="undefined"&&typeof(M.cell)!="undefined"){Z=M.cell}var m=b.dom.getParent(aD,"table");var D=b.contentWindow.document;var ar=m?m.getAttribute("border"):"";if(aA&&Z==null){Z=aA.cells[0]}function u(x,r){for(var y=0;y<x.length;y++){if(x[y].length>0&&u(x[y],r)){return true}if(x[y]==r){return true}}return false}function aG(r,i){var x;ae=Y(m);r=r||0;i=i||0;r=Math.max(V.cellindex+r,0);i=Math.max(V.rowindex+i,0);b.execCommand("mceRepaint");x=d(ae,i,r);if(x){b.selection.select(x.firstChild||x);b.selection.collapse(1)}}function H(){var i=D.createElement("td");if(!tinymce.isIE){i.innerHTML='<br mce_bogus="1"/>'}return i}function aJ(y){var x=1,r=1,i;if(i=y.getAttribute("colspan")){if(typeof(i.nodeValue)!="undefined"){x=i.nodeValue}else{x=i}}if(i=y.getAttribute("rowspan")){if(typeof(i.nodeValue)!="undefined"){r=i.nodeValue}else{r=i}}x=parseInt(x);r=parseInt(r);return{colspan:x,rowspan:r}}function k(r,aL){var i,aK;for(aK=0;aK<r.length;aK++){for(i=0;i<r[aK].length;i++){if(r[aK][i]==aL){return{cellindex:i,rowindex:aK}}}}return null}function d(r,x,i){if(r[x]&&r[x][i]){return r[x][i]}return null}function ac(x,y){if(x.nodeName.toLowerCase()=="br"){return y}if(x.childNodes.length==0){return x}for(var r=0;r<x.childNodes.length;r++){if(x.childNodes[r].nodeType==3){x.removeChild(x.childNodes[r]);r--}else{y=ac(x.childNodes[r],x)}}if(x.childNodes.length==0){return x}return y}function f(r,x){var i=ac(r,r);if(i.childNodes.length==0){i.appendChild(x)}else{i.insertBefore(x,i.childNodes[i.childNodes.length-1])}b.focus()}function Y(aQ){var i=[],aR=aQ.rows,aO,aN,aK,aL,aP,r,aM;for(aN=0;aN<aR.length;aN++){if(aR[aN].cells.length==0){aR[aN].parentNode.removeChild(aR[aN]);aN--;continue}for(aO=0;aO<aR[aN].cells.length;aO++){aK=aR[aN].cells[aO];aL=aJ(aK);for(aP=aO;i[aN]&&i[aN][aP];aP++){}for(aM=aN;aM<aN+aL.rowspan;aM++){if(!i[aM]){i[aM]=[]}for(r=aP;r<aP+aL.colspan;r++){i[aM][r]=aK}}}}return i}function aI(aS,aP,aK,y){var r=Y(aS),aR=k(r,aK);var aT,aO;if(y.cells.length!=aP.childNodes.length){aT=aP.childNodes;aO=null;for(var aQ=0;aK=d(r,aR.rowindex,aQ);aQ++){var aM=true;var aN=aJ(aK);if(u(aT,aK)){y.childNodes[aQ]._delete=true}else{if((aO==null||aK!=aO)&&aN.colspan>1){for(var aL=aQ;aL<aQ+aK.colSpan;aL++){y.childNodes[aL]._delete=true}}}if((aO==null||aK!=aO)&&aN.rowspan>1){aK.rowSpan=aN.rowspan+1}if(aK.rowSpan==1){aK.removeAttribute("rowspan")}aO=aK}ay(m)}}function al(r,i){while((r=r.previousSibling)!=null){if(r.nodeName==i){return r}}return null}function C(y,aK){var r=aK.split(",");while((y=y.nextSibling)!=null){for(var x=0;x<r.length;x++){if(y.nodeName.toLowerCase()==r[x].toLowerCase()){return y}}}return null}function ay(aK){if(aK.rows==0){return}var y=aK.rows[0];for(var x=0;x<aK.rows.length;x++){var y=aK.rows[x];if(y._delete){y.parentNode.removeChild(y);x--;continue}var aL=y.cells[0];if(aL.cells>1){do{var r=C(aL,"TD,TH");if(aL._delete){aL.parentNode.removeChild(aL)}}while((aL=r)!=null)}}}function p(y,aM,aL){y.rowspan=1;y.setAttribute("rowSpan","1");y.removeAttribute("rowSpan");var r=C(aM,"TR");for(var aK=1;aK<aL&&r;aK++){var x=D.createElement("td");if(!tinymce.isIE){x.innerHTML='<br mce_bogus="1"/>'}if(tinymce.isIE){if(tinymce.isIE9&&typeof r.cells(y.cellIndex)==="undefined"){r.appendChild(x)}else{r.insertBefore(x,r.cells(y.cellIndex))}}else{r.insertBefore(x,r.cells[y.cellIndex])}r=C(r,"TR")}}function X(aR,aT,aN){var r=Y(aT);var y=aN.cloneNode(false);var aS=k(r,aN.cells[0]);var aO=null;var aM=b.dom.getAttrib(aT,"border");var aL=null;for(var aQ=0;aL=d(r,aS.rowindex,aQ);aQ++){var aP=null;if(aO!=aL){for(var aK=0;aK<aN.cells.length;aK++){if(aL==aN.cells[aK]){aP=aL.cloneNode(true);break}}}if(aP==null){aP=aR.createElement("td");if(!tinymce.isIE){aP.innerHTML='<br mce_bogus="1"/>'}}aP.removeAttribute("colSpan");aP.removeAttribute("rowspan");y.appendChild(aP);aO=aL}return y}switch(ab){case"fixMissingCells":var ae=Y(T);var am=0;for(var O=0;O<ae.length;O++){if(ae[O].length>am){am=ae[O].length}}for(var O=0;O<ae.length;O++){if(ae[O].length<am){T.rows[O].appendChild(H())}}return false;case"mceTableRowUp":if(aA==null){return false}if(aA.previousSibling!=null){var P=b.selection.getNode();aA.parentNode.insertBefore(aA,aA.previousSibling);if(P.childNodes.length&&!tinymce.isIE){P=P.childNodes[0]}b.selection.select(P);b.selection.collapse(true);b.nodeChanged(false,true)}return true;case"mceTableRowDown":if(aA==null){return false}if(aA.nextSibling!=null){var P=b.selection.getNode();aA.parentNode.insertBefore(aA.nextSibling,aA);if(P.childNodes.length&&!tinymce.isIE){P=P.childNodes[0]}b.selection.select(P);b.selection.collapse(true);b.nodeChanged(false,true)}return true;case"mceTableColRight":if(!aA||!Z){return false}var ae=Y(m);var V=k(ae,Z);var q=null;var P=b.selection.getNode();for(var I=0;Z=d(ae,I,V.cellindex);I++){if(Z!=q){var an=$j(Z).next("td, th");if(an.length>0){Z.parentNode.insertBefore(an.get(0),Z)}q=Z}}if(P.childNodes.length&&!tinymce.isIE){P=P.childNodes[0]}b.selection.select(P);b.selection.collapse(true);b.nodeChanged(false,true);return true;case"mceTableColLeft":if(!aA||!Z){return false}var ae=Y(m);var V=k(ae,Z);var q=null;var P=b.selection.getNode();for(var I=0;Z=d(ae,I,V.cellindex);I++){if(Z!=q){var E=$j(Z).prev("td, th");if(E.length>0){Z.parentNode.insertBefore(Z,E.get(0))}q=Z}}if(P.childNodes.length&&!tinymce.isIE){P=P.childNodes[0]}b.selection.select(P);b.selection.collapse(true);b.nodeChanged(false,true);return true;case"mceTableRowProps":if(aA==null){return false}if(T){b.windowManager.open({url:CS_BASE_URL+"/resources/scripts/tiny_mce3/plugins/table/row.htm",width:400+parseInt(b.getLang("table.rowprops_delta_width",0)),height:245+parseInt(b.getLang("table.rowprops_delta_height",0)),inline:1},{plugin_url:v,cs_resource_base_url:CS_RESOURCE_BASE_URL})}return false;case"mceTableCellProps":if(Z==null){return false}if(T){b.windowManager.open({url:CS_BASE_URL+"/resources/scripts/tiny_mce3/plugins/table/cell.htm",width:400+parseInt(b.getLang("table.cellprops_delta_width",0)),height:275+parseInt(b.getLang("table.cellprops_delta_height",0)),inline:1},{plugin_url:v,cs_resource_base_url:CS_RESOURCE_BASE_URL})}return false;case"mceInsertTable":if(T){if(M&&M.action=="insert"){b.windowManager.open({url:CS_BASE_URL+"/resources/scripts/tiny_mce3/plugins/table/table.htm",width:420+parseInt(b.getLang("table.table_delta_width",0)),height:298+parseInt(b.getLang("table.table_delta_height",0)),inline:1},{plugin_url:v,action:M?M.action:0,cs_resource_base_url:CS_RESOURCE_BASE_URL})}else{b.windowManager.open({url:CS_BASE_URL+"/resources/scripts/tiny_mce3/plugins/table/table_edit.htm",width:420+parseInt(b.getLang("table.table_delta_width",0)),height:258+parseInt(b.getLang("table.table_delta_height",0)),inline:1},{plugin_url:v,action:M?M.action:0,cs_resource_base_url:CS_RESOURCE_BASE_URL})}}return false;case"mceTableDelete":var ad=b.dom.getParent(b.selection.getNode(),"table");if(ad){ad.parentNode.removeChild(ad);b.nodeChanged(false,true);b.execCommand("mceRepaint")}return true;case"mceTableSplitCells":case"mceTableMergeCells":case"mceTableInsertRowBefore":case"mceTableInsertRowAfter":case"mceTableDeleteRow":case"mceTableInsertColBefore":case"mceTableInsertColAfter":case"mceTableDeleteCol":case"mceTableCutRow":case"mceTableCopyRow":case"mceTablePasteRowBefore":case"mceTablePasteRowAfter":case"JustifyLeft":case"JustifyCenter":case"JustifyRight":case"JustifyFull":if(!m){switch(ab){case"JustifyLeft":case"JustifyCenter":case"JustifyRight":case"JustifyFull":return -1;default:return true}}if(aA&&m!=aA.parentNode){m=e.dom.getParent(aA,"table")}if(m&&(aA||tinymce.isIE||tinymce.isWebKit)){switch(ab){case"JustifyLeft":case"JustifyCenter":case"JustifyRight":case"JustifyFull":var ai=[];var P=b.selection.getSel();var ae=Y(m);if(tinymce.isIE||tinymce.isWebKit){var s=e.dom.getParent(b.selection.getStart(),"td,th");var S=e.dom.getParent(b.selection.getEnd(),"td,th");if(s&&S){b.plugins.jiveutil.walkDOMTree(s,S,function(r){if(r.nodeType==1&&(r.nodeName.toLowerCase()=="td"||r.nodeName.toLowerCase()=="th")){var i=r;if(ab=="JustifyLeft"){i.style.textAlign="left";i.setAttribute("data-mce-style",i.getAttribute("style"))}else{if(ab=="JustifyRight"){i.style.textAlign="right";i.setAttribute("data-mce-style",i.getAttribute("style"))}else{if(ab=="JustifyCenter"){i.style.textAlign="center";i.setAttribute("data-mce-style",i.getAttribute("style"))}else{if(ab=="JustifyFull"){i.style.textAlign="justify";i.setAttribute("data-mce-style",i.getAttribute("style"))}}}}}})}break}else{if(P.rangeCount==1){var V=k(ae,Z);var aE=m.rows;for(var I=V.rowindex;I<ae.length;I++){var N=[];for(var J=V.cellindex;J<ae[I].length;J++){var aq=d(ae,I,J);if(aq&&!u(ai,aq)&&!u(N,aq)){var F=k(ae,aq);if(F.cellindex<V.cellindex+1&&F.rowindex<V.rowindex+1){N[N.length]=aq}}}if(N.length>0){ai[ai.length]=N}}}else{var W=[];var P=b.selection.getSel();var aC=null;var l=null;var z=-1,h=-1,w,g;for(var R=0;R<P.rangeCount;R++){var c=P.getRangeAt(R);var Z=c.startContainer.childNodes[c.startOffset];if(!Z){break}if(Z.nodeName=="TD"||Z.nodeName=="TH"){W[W.length]=Z}}var aE=m.rows;for(var I=0;I<aE.length;I++){var N=[];for(var J=0;J<aE[I].cells.length;J++){var aq=aE[I].cells[J];for(var R=0;R<W.length;R++){if(aq==W[R]){N[N.length]=aq}}}if(N.length>0){ai[ai.length]=N}}}}for(var I=0;I<ai.length;I++){for(var J=0;J<ai[I].length;J++){var aq=ai[I][J];if(ab=="JustifyLeft"){aq.style.textAlign="left";aq.setAttribute("data-mce-style",aq.getAttribute("style"))}else{if(ab=="JustifyRight"){aq.style.textAlign="right";aq.setAttribute("data-mce-style",aq.getAttribute("style"))}else{if(ab=="JustifyCenter"){aq.style.textAlign="center";aq.setAttribute("data-mce-style",aq.getAttribute("style"))}else{if(ab=="JustifyFull"){aq.style.textAlign="justify";aq.setAttribute("data-mce-style",aq.getAttribute("style"))}}}}}}break;case"mceTableCutRow":if(!aA||!Z){return true}b.tableRowClipboard=X(D,m,aA);b.execCommand("mceTableDeleteRow");break;case"mceTableCopyRow":if(!aA||!Z){return true}b.tableRowClipboard=X(D,m,aA);break;case"mceTablePasteRowBefore":if(!aA||!Z){return true}var j=b.tableRowClipboard.cloneNode(true);var aB=al(aA,"TR");if(aB!=null){aI(m,aB,aB.cells[0],j)}aA.parentNode.insertBefore(j,aA);break;case"mceTablePasteRowAfter":if(!aA||!Z){return true}var af=C(aA,"TR");var j=b.tableRowClipboard.cloneNode(true);aI(m,aA,Z,j);if(af==null){aA.parentNode.appendChild(j)}else{af.parentNode.insertBefore(j,af)}break;case"mceTableInsertRowBefore":if(!aA||!Z){return true}var aa=e.selection.getBookmark();var ae=Y(m);var V=k(ae,Z);var j=D.createElement("tr");var q=null;V.rowindex--;if(V.rowindex<0){V.rowindex=0}for(var J=0;Z=d(ae,V.rowindex,J);J++){if(Z!=q){var ax=aJ(Z);if(ax.rowspan==1){var o=D.createElement("td");if(!tinymce.isIE){o.innerHTML='<br mce_bogus="1"/>'}o.colSpan=Z.colSpan;j.appendChild(o)}else{Z.rowSpan=ax.rowspan+1}if(Z.rowSpan==1){Z.removeAttribute("rowspan")}if(Z.colSpan==1){Z.removeAttribute("colSpan")}q=Z}}aA.parentNode.insertBefore(j,aA);e.selection.moveToBookmark(aa);break;case"mceTableInsertRowAfter":if(!aA||!Z){return true}var aa=e.selection.getBookmark();var ae=Y(m);var V=k(ae,Z);var j=D.createElement("tr");var q=null;for(var J=0;Z=d(ae,V.rowindex,J);J++){if(Z!=q){var ax=aJ(Z);if(ax.rowspan==1){var o=D.createElement("td");if(!tinymce.isIE){o.innerHTML='<br mce_bogus="1"/>'}o.colSpan=Z.colSpan;if(o.colSpan==1){o.removeAttribute("colSpan")}j.appendChild(o)}else{Z.rowSpan=ax.rowspan+1}if(Z.rowSpan==1){Z.removeAttribute("rowspan")}q=Z}}if(j.hasChildNodes()){var af=C(aA,"TR");if(af){af.parentNode.insertBefore(j,af)}else{var G;if(m.childNodes.length>0){G=m.childNodes[0]}else{G=m}if(G.nodeName.toLowerCase()=="tbody"){G.appendChild(j)}else{m.appendChild(j)}}}e.selection.moveToBookmark(aa);break;case"mceTableDeleteRow":if(!aA||!Z){return true}var ae=Y(m);var V=k(ae,Z);if(ae.length==1){b.dom.remove(b.dom.getParent(m,"table"));return true}var W=aA.cells;var af=C(aA,"TR");for(var J=0;J<W.length;J++){if(W[J].rowSpan>1){var o=W[J].cloneNode(true);var ax=aJ(W[J]);o.rowSpan=ax.rowspan-1;if(o.rowSpan==1){o.removeAttribute("rowspan")}var ap=af.cells[J];if(ap==null){af.appendChild(o)}else{af.insertBefore(o,ap)}}}var q=null;for(var J=0;Z=d(ae,V.rowindex,J);J++){if(Z!=q){var ax=aJ(Z);if(ax.rowspan>1){Z.rowSpan=ax.rowspan-1}else{aA=Z.parentNode;if(aA.parentNode){aA._delete=true}}if(aA.rowSpan==1){aA.removeAttribute("rowspan")}q=Z}}ay(m);aG(0,-1);break;case"mceTableInsertColBefore":if(!aA||!Z){return true}var aa=e.selection.getBookmark();var ae=Y(m);var V=k(ae,Z);var q=null;for(var I=0;Z=d(ae,I,V.cellindex);I++){if(Z!=q){var ax=aJ(Z);if(ax.colspan==1){var o=Z.cloneNode(true);if(o.nodeName.toLowerCase()=="th"){f(o,e.getDoc().createTextNode("Header "+(V.cellindex+I+1)))}else{if(!tinymce.isIE){o.innerHTML='<br mce_bogus="1"/>'}else{o.innerHTML=""}}o.rowSpan=Z.rowSpan;if(o.rowSpan==1){o.removeAttribute("rowspan")}Z.parentNode.insertBefore(o,Z)}else{Z.colSpan++}if(Z.colSpan==1){Z.removeAttribute("colSpan")}q=Z}}e.selection.moveToBookmark(aa);break;case"mceTableInsertColAfter":if(!aA||!Z){return true}var aa=e.selection.getBookmark();var ae=Y(m);var V=k(ae,Z);var q=null;for(var I=0;Z=d(ae,I,V.cellindex);I++){if(Z!=q){var ax=aJ(Z);if(ax.colspan==1){var o=Z.cloneNode(true);if(o.nodeName.toLowerCase()=="th"){f(o,e.getDoc().createTextNode("Header "+(V.cellindex+I+2)))}else{if(!tinymce.isIE){o.innerHTML='<br mce_bogus="1"/>'}else{o.innerHTML=""}}o.rowSpan=Z.rowSpan;if(o.rowSpan==1){o.removeAttribute("rowspan")}var ap=C(Z,"TD,TH");if(ap==null){Z.parentNode.appendChild(o)}else{ap.parentNode.insertBefore(o,ap)}}else{Z.colSpan++}if(Z.colSpan==1){Z.removeAttribute("colSpan")}q=Z}}e.selection.moveToBookmark(aa);break;case"mceTableDeleteCol":if(!aA||!Z){return true}var ae=Y(m);var V=k(ae,Z);var q=null;if(ae.length>1&&ae[0].length<=1){b.dom.remove(b.dom.getParent(m,"table"));return true}for(var I=0;Z=d(ae,I,V.cellindex);I++){if(Z!=q){var ax=aJ(Z);if(ax.colspan>1){Z.colSpan=ax.colspan-1}else{if(Z.parentNode){Z.parentNode.removeChild(Z)}}if(Z.colSpan==1){Z.removeAttribute("colSpan")}q=Z}}aG(-1);break;case"mceTableSplitCells":if(!aA||!Z){return true}var K=aJ(Z);var U=K.colspan;var at=K.rowspan;if(U>1||at>1){Z.colSpan=1;for(var R=1;R<U;R++){var o=D.createElement("td");if(!tinymce.isIE){o.innerHTML='<br mce_bogus="1"/>'}aA.insertBefore(o,C(Z,"TD,TH"));if(at>1){p(o,aA,at)}}if(Z.colSpan==1){Z.removeAttribute("colSpan")}p(Z,aA,at)}if(Z.childNodes.length==0){Z.innerHTML='<br mce_bogus="1"/>'}if(typeof(M)!="undefined"&&typeof(M.cell)=="undefined"){b.selection.select(Z.childNodes[0]);b.selection.collapse(true);m=b.dom.getParent(b.selection.getNode(),"table")}break;case"mceTableMergeCells":var ai=[];var P=b.selection.getSel();var ae=Y(m);if(tinymce.isIE||P.rangeCount<=1){if(T){var au=aJ(Z);var B=0;var aH=0;var aj=Z;while(aj&&aj.nextSibling){var aw=aJ(Z);B+=aw.colspan;aj=aj.nextSibling}var aj=aA;while(aj&&aj.nextSibling){aH+=1;aj=aj.nextSibling}b.windowManager.open({url:CS_BASE_URL+"/resources/scripts/tiny_mce3/plugins/table/merge_cells.htm",width:360+parseInt(b.getLang("table.merge_cells_delta_width",0)),height:140,inline:1},{action:"update",numcols:au.colspan,numrows:au.rowspan,maxcols:B,maxrows:aH,plugin_url:v,cs_resource_base_url:CS_RESOURCE_BASE_URL});return false}else{var av=parseInt(M.numrows);var n=parseInt(M.numcols);var V=k(ae,Z);if((""+av)=="NaN"){av=1}if((""+n)=="NaN"){n=1}var aE=m.rows;for(var I=V.rowindex;I<ae.length;I++){var N=[];for(var J=V.cellindex;J<ae[I].length;J++){var aq=d(ae,I,J);if(aq&&!u(ai,aq)&&!u(N,aq)){var F=k(ae,aq);if(F.cellindex<V.cellindex+n&&F.rowindex<V.rowindex+av){N[N.length]=aq}}}if(N.length>0){ai[ai.length]=N}var aq=d(ae,V.rowindex,V.cellindex);a(e.dom.select("br",aq),function(x,r){if(r>0&&e.dom.getAttrib("mce_bogus")){e.dom.remove(x)}})}}}else{var W=[];var P=b.selection.getSel();var aC=null;var l=null;var z=-1,h=-1,w,g;if(P.rangeCount<2){return true}for(var R=0;R<P.rangeCount;R++){var c=P.getRangeAt(R);var Z=c.startContainer.childNodes[c.startOffset];if(!Z){break}if(Z.nodeName=="TD"||Z.nodeName=="TH"){W[W.length]=Z}}var aE=m.rows;for(var I=0;I<aE.length;I++){var N=[];for(var J=0;J<aE[I].cells.length;J++){var aq=aE[I].cells[J];for(var R=0;R<W.length;R++){if(aq==W[R]){N[N.length]=aq}}}if(N.length>0){ai[ai.length]=N}}var l=[];var aC=null;for(var I=0;I<ae.length;I++){for(var J=0;J<ae[I].length;J++){ae[I][J]._selected=false;for(var R=0;R<W.length;R++){if(ae[I][J]==W[R]){if(z==-1){z=J;h=I}w=J;g=I;ae[I][J]._selected=true}}}}for(var I=h;I<=g;I++){for(var J=z;J<=w;J++){if(!ae[I][J]._selected){alert("Invalid selection for merge.");return true}}}}var aF=1,ak=1;var ag=-1;for(var I=0;I<ai.length;I++){var t=0;for(var J=0;J<ai[I].length;J++){var ax=aJ(ai[I][J]);t+=ax.colspan;if(ag!=-1&&ax.rowspan!=ag){alert("Invalid selection for merge.");return true}ag=ax.rowspan}if(t>ak){ak=t}ag=-1}var A=-1;for(var J=0;J<ai[0].length;J++){var L=0;for(var I=0;I<ai.length;I++){var ax=aJ(ai[I][J]);L+=ax.rowspan;if(A!=-1&&ax.colspan!=A){alert("Invalid selection for merge.");return true}A=ax.colspan}if(L>aF){aF=L}A=-1}Z=ai[0][0];Z.rowSpan=aF;Z.colSpan=ak;if(Z.rowSpan==1){Z.removeAttribute("rowspan")}if(Z.colSpan==1){Z.removeAttribute("colSpan")}for(var I=0;I<ai.length;I++){for(var J=0;J<ai[I].length;J++){var az=ai[I][J].innerHTML;var Q=az.replace(/[ \t\r\n]/g,"");if(Q!="<br/>"&&Q!="<br>"&&Q!='<br mce_bogus="1"/>'&&(J+I>0)){Z.innerHTML+=az}if(ai[I][J]!=Z&&!ai[I][J]._deleted){var V=k(ae,ai[I][J]);var ah=ai[I][J].parentNode;ah.removeChild(ai[I][J]);ai[I][J]._deleted=true;if(!ah.hasChildNodes()){ah.parentNode.removeChild(ah);var ao=null;for(var J=0;cellElm=d(ae,V.rowindex,J);J++){if(cellElm!=ao&&cellElm.rowSpan>1){cellElm.rowSpan--}ao=cellElm}if(Z.rowSpan>1){Z.rowSpan--}if(Z.rowSpan==1){Z.removeAttribute("rowspan")}}}}}a(e.dom.select("br",Z),function(x,r){if(r>0&&e.dom.getAttrib(x,"mce_bogus")){e.dom.remove(x)}});break}m=b.dom.getParent(b.selection.getNode(),"table");b.addVisual(m);b.nodeChanged(false,true)}return true}return false}});tinymce.PluginManager.add("table",tinymce.plugins.TablePlugin)})();