jive.namespace("ExternalImage");jive.ExternalImage.Main=jive.oo.Class.extend(function(a){this.init=function(){var b=this;this.dismissed=false;this.$banner=null;jive.rte.renderedContent.addListener("renderedContent",function(c){b.scanForUnwrappedExternalImages(c)});$j(function(){b.scanForUnwrappedExternalImages()})};this.scanForUnwrappedExternalImages=function(d){var b=this;d=d||window.document;var c=0;$j("img.jive-external-image",d).each(function(e,f){b.wrapImage(f);++c});$j("a.jive-external-image",d).each(function(e,f){b.wrapImageLink(f);++c});if(c>0){b.updateBanner();return true}return false};a.wrapImage=function(f){var c=this;var e=$j(f);var b=Math.max(30,e.height());var d=Math.max(250,e.width());var g=$j(jive.ExternalImage.soy.renderImageWrapper({image_width:d,image_height:b}));e.css("margin","0px").removeClass("jive-external-image").addClass("jive-external-image-wrapped").hide().replaceWith(g);g.append(e).click(function(){c.acceptImage(e);c.updateBanner()})};a.wrapImageLink=function(d){var b=this;var c=$j(d);var e=$j(jive.ExternalImage.soy.renderImageLinkWrapper());c.removeClass("jive-external-image").addClass("jive-external-image-wrapped").hide().replaceWith(e);e.append(c).click(function(){b.acceptImage(c);b.updateBanner()})};a.updateBanner=function(){var b=this;var c=$j("a.jive-external-image-wrapped, img.jive-external-image-wrapped").length;if(b.$banner&&(c==0||b.dismissed)){b.$banner.parent().find("button").click()}else{if(b.$banner||(c>0&&!b.dismissed)){b.displayBanner(c)}}};a.displayBanner=function(c){var b=this;var d=$j(jive.ExternalImage.soy.renderAcceptAllBanner({plural:c>1}));d.find("a.jive-external-image-banner-click").click(b.acceptAllImages.bind(b));if(this.$banner){this.$banner.replaceWith(d);this.$banner=d}else{this.$banner=d;this.$banner.message({dismissIn:0,dismissCallback:function(){b.dismissed=true;b.$banner=null}})}};a.acceptAllImages=function(){var b=this;$j("img.jive-external-image-wrapped").each(function(c,d){b.acceptImage($j(d))});$j("a.jive-external-image-wrapped").each(function(c,d){b.acceptImageLink($j(d))});b.updateBanner()};a.acceptImage=function(b){b.parent().replaceWith(b);b.attr("src",b.attr("alt")).removeClass("jive-external-image-wrapped").fadeIn()};a.acceptImageLink=function(b){b.parent().replaceWith(b);b.removeClass("jive-external-image-wrapped").fadeIn()}});externalImage=new jive.ExternalImage.Main();