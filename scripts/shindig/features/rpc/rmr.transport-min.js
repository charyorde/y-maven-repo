gadgets.rpctx=gadgets.rpctx||{};if(!gadgets.rpctx.rmr){gadgets.rpctx.rmr=function(){var h=500;var f=10;var i={};var a=gadgets.util.getUrlParameters()["parent"];var c;var j;function l(q,o,p,n){var r=function(){document.body.appendChild(q);q.src="about:blank";if(n){q.onload=function(){m(n)}}q.src=o+"#"+p};if(document.body){r()}else{gadgets.util.registerOnLoadHandler(function(){r()})}}function d(q){if(typeof i[q]==="object"){return}var r=document.createElement("iframe");var o=r.style;o.position="absolute";o.top="0px";o.border="0";o.opacity="0";o.width="10px";o.height="1px";r.id="rmrtransport-"+q;r.name=r.id;var p=gadgets.rpc.getRelayUrl(q);var n=gadgets.rpc.getOrigin(a);if(!p){p=n+"/robots.txt"}i[q]={frame:r,receiveWindow:null,relayUri:p,relayOrigin:n,searchCounter:0,width:10,waiting:true,queue:[],sendId:0,recvId:0,verifySendToken:String(Math.random()),verifyRecvToken:null,originVerified:false};if(q!==".."){l(r,p,b(q))}e(q)}function e(p){var r=null;i[p].searchCounter++;try{var o=gadgets.rpc._getTargetWin(p);if(p===".."){r=o.frames["rmrtransport-"+gadgets.rpc.RPC_ID]}else{r=o.frames["rmrtransport-.."]}}catch(q){}var n=false;if(r){n=g(p,r)}if(!n){if(i[p].searchCounter>f){return}window.setTimeout(function(){e(p)},h)}}function k(o,q,u,t){var p=null;if(u!==".."){p=i[".."]}else{p=i[o]}if(p){if(q!==gadgets.rpc.ACK){p.queue.push(t)}if(p.waiting||(p.queue.length===0&&!(q===gadgets.rpc.ACK&&t&&t.ackAlone===true))){return true}if(p.queue.length>0){p.waiting=true}var n=p.relayUri+"#"+b(o);try{p.frame.contentWindow.location=n;var r=p.width==10?20:10;p.frame.style.width=r+"px";p.width=r}catch(s){return false}}return true}function b(o){var p=i[o];var n={id:p.sendId};if(p){n.d=Array.prototype.slice.call(p.queue,0);var q={s:gadgets.rpc.ACK,id:p.recvId};if(!p.originVerified){q.sendToken=p.verifySendToken}if(p.verifyRecvToken){q.recvToken=p.verifyRecvToken}n.d.push(q)}return gadgets.json.stringify(n)}function m(y){var v=i[y];var r=v.receiveWindow.location.hash.substring(1);var z=gadgets.json.parse(decodeURIComponent(r))||{};var o=z.d||[];var p=false;var u=false;var w=0;var n=(v.recvId-z.id);for(var q=0;q<o.length;++q){var t=o[q];if(t.s===gadgets.rpc.ACK){j(y,true);v.verifyRecvToken=t.sendToken;if(!v.originVerified&&t.recvToken&&String(t.recvToken)==String(v.verifySendToken)){v.originVerified=true}if(v.waiting){u=true}v.waiting=false;var s=Math.max(0,t.id-v.sendId);v.queue.splice(0,s);v.sendId=Math.max(v.sendId,t.id||0);continue}p=true;if(++w<=n){continue}++v.recvId;c(t,v.originVerified?v.relayOrigin:undefined)}if(p||(u&&v.queue.length>0)){var x=(y==="..")?gadgets.rpc.RPC_ID:"..";k(y,gadgets.rpc.ACK,x,{ackAlone:p})}}function g(q,t){var p=i[q];try{var o=false;o="document" in t;if(!o){return false}o=typeof t.document=="object";if(!o){return false}var s=t.location.href;if(s==="about:blank"){return false}}catch(n){return false}p.receiveWindow=t;function r(){m(q)}if(typeof t.attachEvent==="undefined"){t.onresize=r}else{t.attachEvent("onresize",r)}if(q===".."){l(p.frame,p.relayUri,b(q),q)}else{m(q)}return true}return{getCode:function(){return"rmr"},isParentVerifiable:function(){return true},init:function(n,o){c=n;j=o;return true},setup:function(p,n){try{d(p)}catch(o){gadgets.warn("Caught exception setting up RMR: "+o);return false}return true},call:function(n,p,o){return k(n,o.s,p,o)}}}()};