if(!window.gadgets["rpc"]){gadgets.rpc=function(){var L="__cb";var U="";var V="__ack";var f=500;var F=10;var b="|";var t="callback";var g="origin";var r="referer";var q={};var Y={};var C={};var A={};var y=0;var l={};var m={};var S={};var d={};var n={};var D={};var e=null;var p=null;var z=!!gadgets.util.getUrlParameters().parent&&(window.top!==window.self);var u=window.name;var I=function(){};var P=0;var aa=1;var a=2;var w=window.console;var X=w&&w.log&&function(ag){w.log(ag)}||function(){};var T=(function(){function ag(ah){return function(){X(ah+": call ignored")}}return{getCode:function(){return"noop"},isParentVerifiable:function(){return true},init:ag("init"),setup:ag("setup"),call:ag("call")}})();if(gadgets.util){d=gadgets.util.getUrlParameters()}function J(){if(d.rpctx=="flash"){return gadgets.rpctx.flash}if(d.rpctx=="rmr"){return gadgets.rpctx.rmr}return typeof window.postMessage==="function"?gadgets.rpctx.wpm:typeof window.postMessage==="object"?gadgets.rpctx.wpm:window.ActiveXObject?(gadgets.rpctx.flash?gadgets.rpctx.flash:gadgets.rpctx.nix):navigator.userAgent.indexOf("WebKit")>0?gadgets.rpctx.rmr:navigator.product==="Gecko"?gadgets.rpctx.frameElement:gadgets.rpctx.ifpc}function k(al,aj){if(n[al]){return}var ah=G;if(!aj){ah=T}n[al]=ah;var ag=D[al]||[];for(var ai=0;ai<ag.length;++ai){var ak=ag[ai];ak.t=E(al);ah.call(al,ak.f,ak)}D[al]=[]}var H=false,W=false;function N(){if(W){return}function ag(){H=true}if(typeof window.addEventListener!="undefined"){window.addEventListener("unload",ag,false)}else{if(typeof window.attachEvent!="undefined"){window.attachEvent("onunload",ag)}}W=true}function j(ag,ak,ah,aj,ai){if(!A[ak]||A[ak]!==ah){gadgets.error("Invalid auth token. "+A[ak]+" vs "+ah);I(ak,a)}ai.onunload=function(){if(m[ak]&&!H){I(ak,aa);gadgets.rpc.removeReceiver(ak)}};N();aj=gadgets.json.parse(decodeURIComponent(aj))}function ab(ak,ah){if(ak&&typeof ak.s==="string"&&typeof ak.f==="string"&&ak.a instanceof Array){if(A[ak.f]){if(A[ak.f]!==ak.t){gadgets.error("Invalid auth token. "+A[ak.f]+" vs "+ak.t);I(ak.f,a)}}if(ak.s===V){window.setTimeout(function(){k(ak.f,true)},0);return}if(ak.c){ak[t]=function(al){gadgets.rpc.call(ak.f,L,null,ak.c,al)}}if(ah){var ai=s(ah);ak[g]=ah;var aj=ak.r;if(!aj||s(aj)!=ai){aj=ah}ak[r]=aj}var ag=(q[ak.s]||q[U]).apply(ak,ak.a);if(ak.c&&typeof ag!=="undefined"){gadgets.rpc.call(ak.f,L,null,ak.c,ag)}}}function s(ai){if(!ai){return""}ai=ai.toLowerCase();if(ai.indexOf("//")==0){ai=window.location.protocol+ai}if(ai.indexOf("://")==-1){ai=window.location.protocol+"//"+ai}var aj=ai.substring(ai.indexOf("://")+3);var ag=aj.indexOf("/");if(ag!=-1){aj=aj.substring(0,ag)}var al=ai.substring(0,ai.indexOf("://"));var ak="";var am=aj.indexOf(":");if(am!=-1){var ah=aj.substring(am+1);aj=aj.substring(0,am);if((al==="http"&&ah!=="80")||(al==="https"&&ah!=="443")){ak=":"+ah}}return al+"://"+aj+ak}function B(ah,ag){return"/"+ah+(ag?b+ag:"")}function x(aj){if(aj.charAt(0)=="/"){var ah=aj.indexOf(b);var ai=ah>0?aj.substring(1,ah):aj.substring(1);var ag=ah>0?aj.substring(ah+1):null;return{id:ai,origin:ag}}else{return null}}function af(ai){if(typeof ai==="undefined"||ai===".."){return window.parent}var ah=x(ai);if(ah){return window.frames[ah.id]}ai=String(ai);ag=document.getElementById(ai);if(ag&&ag.contentWindow){return ag.contentWindow}var ag=window.frames[ai];if(ag&&!ag.closed){return ag}return null}function K(aj){var ai=null;var ag=O(aj);if(ag){ai=ag}else{var ah=x(aj);if(ah){ai=ah.origin}else{if(aj==".."){ai=d.parent}else{ai=document.getElementById(aj).src}}}return s(ai)}var G=J();q[U]=function(){X("Unknown RPC service: "+this.s)};q[L]=function(ah,ag){var ai=l[ah];if(ai){delete l[ah];ai.call(this,ag)}};function Z(ai,ag){if(m[ai]===true){return}if(typeof m[ai]==="undefined"){m[ai]=0}var ah=af(ai);if(ai===".."||ah!=null){if(G.setup(ai,ag)===true){m[ai]=true;return}}if(m[ai]!==true&&m[ai]++<F){window.setTimeout(function(){Z(ai,ag)},f)}else{n[ai]=T;m[ai]=true}}var R={};function M(ah,ak){var aj=af(ah);if(!S[ah]||S[ah].sameDomain||(S[ah]!==R&&aj.Function.prototype!==S[ah].constructor.prototype)){var ai=O(ah);if(s(ai)!==s(window.location.href)){S[ah]=R;return false}try{var al=aj.gadgets;S[ah]=al.rpc.receiveSameDomain;S[ah].sameDomain=true}catch(ag){S[ah]=R;return false}}if(S[ah]&&S[ah]!==R){S[ah](ak);return true}return false}function O(ah){var ag=Y[ah];if(ag&&ag.substring(0,1)==="/"){if(ag.substring(1,2)==="/"){ag=document.location.protocol+ag}else{ag=document.location.protocol+"//"+document.location.host+ag}}return ag}function ae(ah,ag,ai){if(!/http(s)?:\/\/.+/.test(ag)){if(ag.indexOf("//")==0){ag=window.location.protocol+ag}else{if(ag.charAt(0)=="/"){ag=window.location.protocol+"//"+window.location.host+ag}else{if(ag.indexOf("://")==-1){ag=window.location.protocol+"//"+ag}}}}Y[ah]=ag;if(typeof ai!=="undefined"){C[ah]=!!ai}}function E(ag){return A[ag]}function c(ag,ah){ah=ah||"";A[ag]=String(ah);Z(ag,ah)}function ad(ah){var ag=ah.passReferrer||"";var ai=ag.split(":",2);e=ai[0]||"none";p=ai[1]||"origin"}function ac(ag){if(Q(ag)){G=gadgets.rpctx.ifpc;G.init(ab,k)}}function Q(ag){return String(ag.useLegacyProtocol)==="true"}function h(ah,ag){function ai(al){var ak=al?al.rpc:{};ad(ak);var aj=ak.parentRelayUrl||"";aj=s(d.parent||ag)+aj;ae("..",aj,Q(ak));ac(ak);c("..",ah)}if(!d.parent&&ag){ai({});return}gadgets.config.register("rpc",null,ai)}function o(ah,al,an){var ak=null;if(ah.charAt(0)!="/"){if(!gadgets.util){return}ak=document.getElementById(ah);if(!ak){throw new Error("Cannot set up gadgets.rpc receiver with ID: "+ah+", element not found.")}}var ag=ak&&ak.src;var ai=al||gadgets.rpc.getOrigin(ag);ae(ah,ai);var am=gadgets.util.getUrlParameters(ag);var aj=an||am.rpctoken;c(ah,aj)}function i(ag,ai,aj){if(ag===".."){var ah=aj||d.rpctoken||d.ifpctok||"";h(ah,ai)}else{o(ag,ai,aj)}}function v(ai){if(e==="bidir"||(e==="c2p"&&ai==="..")||(e==="p2c"&&ai!=="..")){var ah=window.location.href;var aj="?";if(p==="query"){aj="#"}else{if(p==="hash"){return ah}}var ag=ah.lastIndexOf(aj);ag=ag===-1?ah.length:ag;return ah.substring(0,ag)}return null}return{config:function(ag){if(typeof ag.securityCallback==="function"){I=ag.securityCallback}},register:function(ah,ag){if(ah===L||ah===V){throw new Error("Cannot overwrite callback/ack service")}if(ah===U){throw new Error("Cannot overwrite default service: use registerDefault")}q[ah]=ag},unregister:function(ag){if(ag===L||ag===V){throw new Error("Cannot delete callback/ack service")}if(ag===U){throw new Error("Cannot delete default service: use unregisterDefault")}delete q[ag]},registerDefault:function(ag){q[U]=ag},unregisterDefault:function(){delete q[U]},forceParentVerifiable:function(){if(!G.isParentVerifiable()){G=gadgets.rpctx.ifpc}},call:function(ag,ai,an,al){ag=ag||"..";var am="..";if(ag===".."){am=u}else{if(ag.charAt(0)=="/"){am=B(u,gadgets.rpc.getOrigin(window.location.href))}}++y;if(an){l[y]=an}var ak={s:ai,f:am,c:an?y:0,a:Array.prototype.slice.call(arguments,3),t:A[ag],l:!!C[ag]};var ah=v(ag);if(ah){ak.r=ah}if(ag!==".."&&x(ag)==null&&!document.getElementById(ag)){return}if(M(ag,ak)){return}var aj=n[ag];if(!aj&&x(ag)!==null){aj=G}if(!aj){if(!D[ag]){D[ag]=[ak]}else{D[ag].push(ak)}return}if(C[ag]){aj=gadgets.rpctx.ifpc}if(aj.call(ag,am,ak)===false){n[ag]=T;G.call(ag,am,ak)}},getRelayUrl:O,setRelayUrl:ae,setAuthToken:c,setupReceiver:i,getAuthToken:E,removeReceiver:function(ag){delete Y[ag];delete C[ag];delete A[ag];delete m[ag];delete S[ag];delete n[ag]},getRelayChannel:function(){return G.getCode()},receive:function(ah,ag){if(ah.length>4){G._receiveMessage(ah,ab)}else{j.apply(null,ah.concat(ag))}},receiveSameDomain:function(ag){ag.a=Array.prototype.slice.call(ag.a);window.setTimeout(function(){ab(ag)},0)},getOrigin:s,getTargetOrigin:K,init:function(){if(G.init(ab,k)===false){G=T}if(z){i("..")}else{gadgets.config.register("rpc",null,function(ah){var ag=ah.rpc||{};ad(ag);ac(ag)})}},_getTargetWin:af,_parseSiblingId:x,ACK:V,RPC_ID:u||"..",SEC_ERROR_LOAD_TIMEOUT:P,SEC_ERROR_FRAME_PHISH:aa,SEC_ERROR_FORGED_MSG:a}}();gadgets.rpc.init()};