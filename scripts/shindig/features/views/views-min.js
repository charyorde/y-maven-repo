gadgets.views=function(){var b={};var f=null;var c={};var e={};function a(i){if(!i){i=window.event}var h;if(i.target){h=i.target}else{if(i.srcElement){h=i.srcElement}}if(h.nodeType===3){h=h.parentNode}if(h.nodeName.toLowerCase()==="a"){var g=h.getAttribute("href");if(g&&g[0]!=="#"&&g.indexOf("://")===-1){gadgets.views.requestNavigateTo(f,g);if(i.stopPropagation){i.stopPropagation()}if(i.preventDefault){i.preventDefault()}i.returnValue=false;i.cancelBubble=true;return false}}return false}function d(k){var q=k.views||{};for(var t in q){if(q.hasOwnProperty(t)){if(t!="rewriteLinks"){var m=q[t];var l=t.toUpperCase();b[l]=l;if(!m){continue}c[t]=new gadgets.views.View(t,m.isOnlyVisible);var j=m.aliases||[];for(var n=0,o;(o=j[n]);++n){if(!c.hasOwnProperty(o)){c[o]=new gadgets.views.View(t,m.isOnlyVisible)}}}}}var h=gadgets.util.getUrlParameters();if(h["view-params"]){e=gadgets.json.parse(h["view-params"])||e}var r=h.view||"";if(r.split(".").length>1){var p=r.split(".")[0];if(c.hasOwnProperty(p)){var g=c[p];f=new gadgets.views.View(r,g.isOnlyVisibleGadget())}else{f=c["default"]}}else{f=c[r]||c["default"]}if(q.rewriteLinks){gadgets.util.attachBrowserEvent(document,"click",a,false)}}gadgets.config.register("views",null,d);return{bind:function(x,v){if(typeof x!=="string"){throw new Error("Invalid urlTemplate")}if(typeof v!=="object"){throw new Error("Invalid environment")}var s=/^([a-zA-Z0-9][a-zA-Z0-9_\.\-]*)(=([a-zA-Z0-9\-\._~]|(%[0-9a-fA-F]{2}))*)?$/,z=new RegExp("\\{([^}]*)\\}","g"),w=/^-([a-zA-Z]+)\|([^|]*)\|(.+)$/,n=[],r=0,l,k,i,q,m,h,o,t;function j(B,A){return v.hasOwnProperty(B)?v[B]:A}function g(A){if(!(k=A.match(s))){throw new Error("Invalid variable : "+A)}}function y(E,A,D){var B,C=E.split(",");for(B=0;B<C.length;++B){g(C[B]);if(D(A,j(k[1]),k[1])){break}}return A}function u(A){if((typeof A==="object")||(typeof A==="function")){for(var B in A){if(A.hasOwnProperty(B)){return false}}return true}return false}while((l=z.exec(x))){n.push(x.substring(r,l.index));r=z.lastIndex;if((k=l[1].match(s))){i=k[1];q=k[2]?k[2].substr(1):"";n.push(j(i,q))}else{if((k=l[1].match(w))){m=k[1];h=k[2];o=k[3];t=0;switch(m){case"neg":t=1;case"opt":if(y(o,{flag:t},function(B,A){if(typeof A!=="undefined"&&!u(A)){B.flag=!B.flag;return 1}return 0}).flag){n.push(h)}break;case"join":n.push(y(o,[],function(C,B,A){if(typeof B==="string"){C.push(A+"="+B)}else{if(typeof B==="object"){for(var D in B){if(B.hasOwnProperty(D)){C.push(D+"="+B[D])}}}}}).join(h));break;case"list":g(o);var p=j(k[1]);if(typeof p==="object"&&typeof p.join==="function"){n.push(p.join(h))}break;case"prefix":t=1;case"suffix":g(o);p=j(k[1],k[2]&&k[2].substr(1));if(typeof p==="string"){n.push(t?h+p:p+h)}else{if(typeof p==="object"&&typeof p.join==="function"){n.push(t?h+p.join(h):p.join(h)+h)}}break;default:throw new Error("Invalid operator : "+m)}}else{throw new Error("Invalid syntax : "+l[0])}}}n.push(x.substr(r));return n.join("")},requestNavigateTo:function(g,i,h){if(typeof g!=="string"){g=g.getName()}gadgets.rpc.call(null,"requestNavigateTo",null,g,i,h)},getCurrentView:function(){return f},getSupportedViews:function(){return c},getParams:function(){return e},ViewType:b}}();gadgets.views.View=function(a,b){this.name_=a;this.isOnlyVisible_=!!b};gadgets.views.View.prototype.getName=function(){return this.name_};gadgets.views.View.prototype.getUrlTemplate=function(){return gadgets.config&&gadgets.config.views&&gadgets.config.views[this.name_]&&gadgets.config.views[this.name_].urlTemplate};gadgets.views.View.prototype.bind=function(a){return gadgets.views.bind(this.getUrlTemplate(),a)};gadgets.views.View.prototype.isOnlyVisibleGadget=function(){return this.isOnlyVisible_};