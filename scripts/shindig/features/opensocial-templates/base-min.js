opensocial=opensocial||{};opensocial.template=opensocial.template||{};var os=opensocial.template;os.log=function(b){var a=window.console;if(a&&a.log){a.log(b)}};window.log=os.log;os.warn=function(a){os.log("WARNING: "+a)};os.isArray=function(a){return typeof(a)=="object"&&typeof(a.length)=="number"&&typeof(a.push)=="function"};os.ATT_customtag="customtag";os.VAR_my="$my";os.VAR_cur="$cur";os.VAR_node="$node";os.VAR_msg="Msg";os.VAR_parentnode="$parentnode";os.VAR_uniqueId="$uniqueId";os.VAR_identifierresolver="$_ir";os.VAR_emptyArray="$_ea";os.VAR_callbacks="$callbacks_";os.EMPTY_ARRAY=[];os.regExps_={ONLY_WHITESPACE:/^[ \t\n]*$/,VARIABLE_SUBSTITUTION:/^([\w\W]*?)(\$\{[^\}]*\})([\w\W]*)$/};os.compileTemplate=function(b,d){if(typeof(b)=="string"){return os.compileTemplateString(b,d)}d=d||b.name;var c=b.value||b.innerHTML;c=os.trim(c);var a=os.compileTemplateString(c,d,b);if(!b.name){b.name=a.id}return a};os.compileTemplateString=function(c,d,a){c=opensocial.xmlutil.prepareXML(c,a);var b=gadgets.jsondom.parse(c,d);return os.compileXMLDoc(b,d)};os.renderTemplateNode_=function(c,a){var b=domCloneElement(c);if(b.removeAttribute){b.removeAttribute(STRING_id)}jstProcess(a,b);return b};os.elementIdCounter_=0;os.createTemplateCustomTag=function(a){return function(d,e,c){c.setVariable(os.VAR_my,d);c.setVariable(os.VAR_node,d);c.setVariable(os.VAR_uniqueId,os.elementIdCounter_++);var b=a.render(e,c);os.markNodeToSkip(b);return b}};os.computeChildMap_=function(d){var f={};for(var b=0;b<d.childNodes.length;b++){var g=d.childNodes[b];if(!g.tagName){continue}var a=g.getAttribute(os.ATT_customtag);if(a){var e=a.split(":");e.length==2?a=e[1]:a=e[0]}else{a=g.tagName}a=a.toLowerCase();var c=f[a];if(!c){f[a]=g}else{if(os.isArray(c)){c.push(g)}else{f[a]=[];f[a].push(c);f[a].push(g)}}}return f};os.createNodeAccessor_=function(a){return function(b){return os.getValueFromNode_(a,b)}};os.gadgetPrefs_=null;os.getGadgetUserPrefs=function(){if(os.gadgetPrefs_!==null){return os.gadgetPrefs}if(window.gadgets&&window.gadgets["Prefs"]){os.gadgetPrefs_=new window.gadgets["Prefs"]()}else{return null}};os.getPrefMessage=function(b){var a=os.getGadgetUserPrefs();return a.getMsg(b)};os.customAttributes_={};os.registerAttribute_=function(b,a){os.customAttributes_[b]=a};os.doAttribute=function(c,b,d,a){if(!os.customAttributes_.hasOwnProperty(b)){return}var e=os.customAttributes_[b];e(c,c.getAttribute(b),d,a)};os.doTag=function(d,j,n,g,a){var e=os.getCustomTag(j,n);if(!e){os.warn("Custom tag <"+j+":"+n+"> not defined.");return}var l=null;for(var c=d.firstChild;c;c=c.nextSibling){if(c.nodeType==DOM_ELEMENT_NODE){if(l==null){var b=d[PROP_jstcache]?d[PROP_jstcache][ATT_innerselect]:null;if(b){var g=a.jsexec(b,d);l=a.clone(g,0,0)}else{l=a}}jstProcess(l,c);os.markNodeToSkip(c)}}l=a.clone({},0,0);var m=e.call(null,d,g,l);if(!m&&typeof(m)!="string"){throw Error("Custom tag <"+j+":"+n+"> failed to return anything.")}if(typeof(m)=="string"){d.innerHTML=m?m:""}else{if(os.isArray(m)){os.removeChildren(d);for(var f=0;f<m.length;f++){if(m[f].nodeType==DOM_ELEMENT_NODE||m[f].nodeType==DOM_TEXT_NODE){d.appendChild(m[f]);if(m[f].nodeType==DOM_ELEMENT_NODE){os.markNodeToSkip(m[f])}}}}else{var h=a.getVariable(os.VAR_callbacks);var k=null;if(m.nodeType==DOM_ELEMENT_NODE){k=m}else{if(m.root&&m.root.nodeType==DOM_ELEMENT_NODE){k=m.root}}if(k&&k!=d&&(!k.parentNode||k.parentNode.nodeType==DOM_DOCUMENT_FRAGMENT_NODE)){os.removeChildren(d);d.appendChild(k);os.markNodeToSkip(k)}if(m.onAttach){h.push(m)}}}};os.setContextNode_=function(b,a){if(b.nodeType==DOM_ELEMENT_NODE){a.setVariable(os.VAR_node,b)}};os.markNodeToSkip=function(a){a.setAttribute(ATT_skip,"true");a.removeAttribute(ATT_select);a.removeAttribute(ATT_eval);a.removeAttribute(ATT_values);a.removeAttribute(ATT_display);a[PROP_jstcache]=null;a.removeAttribute(ATT_jstcache)};