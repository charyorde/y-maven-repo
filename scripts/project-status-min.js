(function(){var l,k={},f={complete:{code:99,sliderValue:99,isComplete:true},high:{code:2,sliderValue:97,isComplete:false},low:{code:0,sliderValue:1,isComplete:false},med:{code:1,sliderValue:49,isComplete:false}};function c(){return e($j("#j-currentStatus").val())}function b(m){if(m>97){return f.complete}if(m<33){return f.low}if(m>65){return f.high}return f.med}function e(o){var n=parseInt(o,10),m=Object.keys(f).filter(function(p){return f[p].code===n}).shift();if(!m){throw new Error("Unexpected status code")}return f[m]}function j(n,p){var m=$j('<span class="jive-icon-big" />').addClass("jive-icon-project-status-"+n.cssKey),q=document.createTextNode(n.text),o=$j("#jive-widget-project-status-header").attr("class","j-js-edit-project-status proj-status proj-status-"+n.cssKey);o.html("");if(p){o=$j('<a href="#"><em class="font-color-normal" /></a>').appendTo(o);o.find("em").text(l.data("i18nUpdate")).prepend(" ")}o.prepend(q).prepend(m)}function i(){var m=c(),p=m.isComplete?"fadeIn":"fadeOut",n;if(!m.isComplete){n=f.complete}else{var o=$j("#jive-slider-track").data("value");n=isNaN(o)?e(o):f.high}$j("#jive-slider-track")[p]("fast");$j(this).toggleClass("complete incomplete");j(n);$j("#j-currentStatus").val(n.code)}function h(){var n=$j("#j-currentStatus").val($j("#j-persistedStatus").val()),m=e(n.val());j(m,true);$j("#jive-widget-project-status-body").fadeOut("fast",function(){$j("#status-description-small").val("");l.find(".j-project-status-description").show();var o=$j(this).find(".j-js-update-completion-status").removeClass("complete incomplete").addClass(m.isComplete?"complete":"incomplete");$j("#jive-slider-track").toggle(!m.isComplete)})}function g(){var m=c();$j("#jive-widget-project-status").toggleClass("locked unlocked");j(m,false);$j("#jive-widget-project-status-body").fadeIn("fast");$j("#status-description-small").focus();l.find(".j-project-status-description").hide();var n=$j("#jive-slider-track").data("value",null).slider({min:0,max:97,value:Math.min(m.sliderValue,97),slide:function(p,r){var q=parseInt(r.value,10);q=q>=0&&q<=100?q:0;var o=b(q);if(o.code!==n.data("value")){n.data("value",o.code);j(o,false);$j("#j-currentStatus").val(b(q).code)}}})}function d(){var n=$j.trim($j("#status-description-small").val()),m=$j("#j-currentStatus").val();$j("#j-persistedStatus").val(m);$j("#jive-current-project-status-body").text(n);projectControl.doStatus(n,m,l.data("projectId"));h()}function a(m){return function(n){n.preventDefault();m.apply(this,arguments)}}$j(function(){l=$j("#project-status-form");$j.each(f,function(m){this.cssKey=m;this.statusId=m;this.text=l.data("i18n-status-"+m)});l.find(".j-js-update-completion-status").click(a(i));l.on("click",".j-js-edit-project-status",a(g));l.find(".j-js-cancel").click(a(h));l.submit(a(d));$j("#jive-widget-project-status-header").hover(function(){var m=$j(this);if(m.find("a").length>0){m.addClass("j-stat-edit")}},function(){$j(this).removeClass("j-stat-edit")})})})();