var rangy=function(){function A(k,f){var e=typeof k[f];return e=="function"||!!(e=="object"&&k[f])||e=="unknown"}function b(f,e){return !!(typeof f[e]=="object"&&f[e])}function h(f,e){return typeof f[e]!="undefined"}function j(e){return function(k,f){for(var l=f.length;l--;){if(!e(k,f[l])){return false}}return true}}function c(e){window.alert("Rangy not supported in your browser. Reason: "+e);w.initialized=true;w.supported=false}function n(){if(!w.initialized){var l,f=false,e=false;if(A(document,"createRange")){l=document.createRange();if(d(l,C)&&r(l,a)){f=true}l.detach()}if((l=b(document,"body")?document.body:document.getElementsByTagName("body")[0])&&A(l,"createTextRange")){l=l.createTextRange();if(d(l,o)&&r(l,z)){e=true}}!f&&!e&&c("Neither Range nor TextRange are implemented");w.initialized=true;w.features={implementsDomRange:f,implementsTextRange:e};f=I.concat(J);e=0;for(l=f.length;e<l;++e){try{f[e](w)}catch(k){b(window,"console")&&A(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",k)}}}}function g(e){this.name=e;this.supported=this.initialized=false}var a=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],C=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],z=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],o=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint"],d=j(A),v=j(b),r=j(h),w={initialized:false,supported:true,util:{isHostMethod:A,isHostObject:b,isHostProperty:h,areHostMethods:d,areHostObjects:v,areHostProperties:r},features:{},modules:{},config:{alertOnWarn:false}};w.fail=c;w.warn=function(e){e="Rangy warning: "+e;if(w.config.alertOnWarn){window.alert(e)}else{typeof window.console!="undefined"&&typeof window.console.log!="undefined"&&window.console.log(e)}};var J=[],I=[];w.init=n;w.addInitListener=function(e){w.initialized?e(w):J.push(e)};var D=[];w.addCreateMissingNativeApiListener=function(e){D.push(e)};w.createMissingNativeApi=function(k){k=k||window;n();for(var f=0,e=D.length;f<e;++f){D[f](k)}};g.prototype.fail=function(e){this.initialized=true;this.supported=false;throw Error("Module '"+this.name+"' failed to load: "+e)};g.prototype.warn=function(e){w.warn("Module "+this.name+": "+e)};g.prototype.createError=function(e){return Error("Error in Rangy "+this.name+" module: "+e)};w.createModule=function(k,f){var e=new g(k);w.modules[k]=e;I.push(function(l){f(l,e);e.initialized=true;e.supported=true})};w.requireModules=function(m){for(var k=0,e=m.length,l,f;k<e;++k){f=m[k];l=w.modules[f];if(!l||!(l instanceof g)){throw Error("Module '"+f+"' not found")}if(!l.supported){throw Error("Module '"+f+"' not supported")}}};var i=false;v=function(){if(!i){i=true;w.initialized||n()}};if(typeof window=="undefined"){c("No window found")}else{if(typeof document=="undefined"){c("No document found")}else{A(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",v,false);if(A(window,"addEventListener")){window.addEventListener("load",v,false)}else{A(window,"attachEvent")?window.attachEvent("onload",v):c("Window does not have required addEventListener or attachEvent method")}return w}}}();rangy.createModule("DomUtil",function(d,g){function k(m){for(var l=0;m=m.previousSibling;){l++}return l}function o(q,p){var l=[],m;for(m=q;m;m=m.parentNode){l.push(m)}for(m=p;m;m=m.parentNode){if(a(l,m)){return m}}return null}function h(p,m,l){for(l=l?p:p.parentNode;l;){p=l.parentNode;if(p===m){return l}l=p}return null}function u(l){l=l.nodeType;return l==3||l==4||l==8}function j(q,p){var l=p.nextSibling,m=p.parentNode;l?m.insertBefore(q,l):m.appendChild(q);return q}function f(l){if(l.nodeType==9){return l}else{if(typeof l.ownerDocument!="undefined"){return l.ownerDocument}else{if(typeof l.document!="undefined"){return l.document}else{if(l.parentNode){return f(l.parentNode)}else{throw Error("getDocument: no document found for node")}}}}}function e(l){if(!l){return"[No node]"}return u(l)?'"'+l.data+'"':l.nodeType==1?"<"+l.nodeName+(l.id?' id="'+l.id+'"':"")+">["+l.childNodes.length+"]":l.nodeName}function c(l){this._next=this.root=l}function n(m,l){this.node=m;this.offset=l}function i(l){this.code=this[l];this.codeName=l;this.message="DOMException: "+this.codeName}var b=d.util;b.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||g.fail("document missing a Node creation method");b.isHostMethod(document,"getElementsByTagName")||g.fail("document missing getElementsByTagName method");var r=document.createElement("div");b.areHostMethods(r,["insertBefore","appendChild","cloneNode"])||g.fail("Incomplete Element implementation");r=document.createTextNode("test");b.areHostMethods(r,["splitText","deleteData","insertData","appendData","cloneNode"])||g.fail("Incomplete Text Node implementation");var a=function(p,m){for(var l=p.length;l--;){if(p[l]===m){return true}}return false};c.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){var m=this._current=this._next,l;if(this._current){if(l=m.firstChild){this._next=l}else{for(l=null;m!==this.root&&!(l=m.nextSibling);){m=m.parentNode}this._next=l}}return this._current},detach:function(){this._current=this._next=this.root=null}};n.prototype={equals:function(l){return this.node===l.node&this.offset==l.offset},inspect:function(){return"[DomPosition("+e(this.node)+":"+this.offset+")]"}};i.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};i.prototype.toString=function(){return this.message};d.dom={arrayContains:a,getNodeIndex:k,getCommonAncestor:o,isAncestorOf:function(p,m,l){for(m=l?m:m.parentNode;m;){if(m===p){return true}else{m=m.parentNode}}return false},getClosestAncestorIn:h,isCharacterDataNode:u,insertAfter:j,splitDataNode:function(p,m){var l;if(p.nodeType==3){l=p.splitText(m)}else{l=p.cloneNode();l.deleteData(0,m);p.deleteData(0,p.length-m);j(l,p)}return l},getDocument:f,getWindow:function(l){l=f(l);if(typeof l.defaultView!="undefined"){return l.defaultView}else{if(typeof l.parentWindow!="undefined"){return l.parentWindow}else{throw Error("Cannot get a window object for node")}}},getIframeWindow:function(l){if(typeof l.contentWindow!="undefined"){return l.contentWindow}else{if(typeof l.contentDocument!="undefined"){return l.contentDocument.defaultView}else{throw Error("getIframeWindow: No Window object found for iframe element")}}},getIframeDocument:function(l){if(typeof l.contentDocument!="undefined"){return l.contentDocument}else{if(typeof l.contentWindow!="undefined"){return l.contentWindow.document}else{throw Error("getIframeWindow: No Document object found for iframe element")}}},getBody:function(l){return b.isHostObject(l,"body")?l.body:l.getElementsByTagName("body")[0]},comparePoints:function(q,p,l,m){var s;if(q==l){return p===m?0:p<m?-1:1}else{if(s=h(l,q,true)){return p<=k(s)?-1:1}else{if(s=h(q,l,true)){return k(s)<m?-1:1}else{p=o(q,l);q=q===p?p:h(q,p,true);l=l===p?p:h(l,p,true);if(q===l){throw Error("comparePoints got to case 4 and childA and childB are the same!")}else{for(p=p.firstChild;p;){if(p===q){return -1}else{if(p===l){return 1}}p=p.nextSibling}throw Error("Should not be here!")}}}}},inspectNode:e,createIterator:function(l){return new c(l)},DomPosition:n};d.DOMException=i});rangy.createModule("DomRange",function(aG){function V(a,d){return a.nodeType!=3&&(aJ.isAncestorOf(a,d.startContainer,true)||aJ.isAncestorOf(a,d.endContainer,true))}function af(a){return aJ.getDocument(a.startContainer)}function ag(a,e,d){if(e=a._listeners[e]){for(var f=0,i=e.length;f<i;++f){e[f].call(a,{target:a,args:d})}}}function av(a){return new h(a.parentNode,aJ.getNodeIndex(a))}function ah(a){return new h(a.parentNode,aJ.getNodeIndex(a)+1)}function ae(a){return aJ.isCharacterDataNode(a)?a.length:a.childNodes?a.childNodes.length:0}function M(a,e,d){var f=a.nodeType==11?a.firstChild:a;if(aJ.isCharacterDataNode(e)){d==e.length?aJ.insertAfter(a,e):e.parentNode.insertBefore(a,d==0?e:aJ.splitDataNode(e,d))}else{d>=e.childNodes.length?e.appendChild(a):e.insertBefore(a,e.childNodes[d])}return f}function aH(a){for(var e,d,f=af(a.range).createDocumentFragment();d=a.next();){e=a.isPartiallySelectedSubtree();d=d.cloneNode(!e);if(e){e=a.getSubtreeIterator();d.appendChild(aH(e));e.detach(true)}if(d.nodeType==10){throw new L("HIERARCHY_REQUEST_ERR")}f.appendChild(d)}return f}function aE(a,e,d){var f,i;for(d=d||{stop:false};f=a.next();){if(a.isPartiallySelectedSubtree()){if(e(f)===false){d.stop=true;return}else{f=a.getSubtreeIterator();aE(f,e,d);f.detach(true);if(d.stop){return}}}else{for(f=aJ.createIterator(f);i=f.next();){if(e(i)===false){d.stop=true;return}}}}}function aA(a){for(var d;a.next();){if(a.isPartiallySelectedSubtree()){d=a.getSubtreeIterator();aA(d);d.detach(true)}else{a.remove()}}}function ax(a){for(var e,d=af(a.range).createDocumentFragment(),f;e=a.next();){if(a.isPartiallySelectedSubtree()){e=e.cloneNode(false);f=a.getSubtreeIterator();e.appendChild(ax(f));f.detach(true)}else{a.remove()}if(e.nodeType==10){throw new L("HIERARCHY_REQUEST_ERR")}d.appendChild(e)}return d}function ak(a,f,e){var i=!!(f&&f.length),k,d=!!e;if(i){k=RegExp("^("+f.join("|")+")$")}var j=[];aE(new aD(a,false),function(l){if((!i||k.test(l.nodeType))&&(!d||e(l))){j.push(l)}});return j}function aB(a){return"["+(typeof a.getName=="undefined"?"Range":a.getName())+"("+aJ.inspectNode(a.startContainer)+":"+a.startOffset+", "+aJ.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function aD(a,e){this.range=a;this.clonePartiallySelectedTextNodes=e;if(!a.collapsed){this.sc=a.startContainer;this.so=a.startOffset;this.ec=a.endContainer;this.eo=a.endOffset;var d=a.commonAncestorContainer;if(this.sc===this.ec&&aJ.isCharacterDataNode(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=this.sc===d&&!aJ.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:aJ.getClosestAncestorIn(this.sc,d,true);this._last=this.ec===d&&!aJ.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:aJ.getClosestAncestorIn(this.ec,d,true)}}}function aM(a){this.code=this[a];this.codeName=a;this.message="RangeException: "+this.codeName}function aL(a,e,d){this.nodes=ak(a,e,d);this._next=this.nodes[0];this._position=0}function aI(a){return function(e,d){for(var f,i=d?e:e.parentNode;i;){f=i.nodeType;if(aJ.arrayContains(a,f)){return i}i=i.parentNode}return null}}function az(a){for(var d;d=a.parentNode;){a=d}return a}function aF(a,d){if(aj(a,d)){throw new aM("INVALID_NODE_TYPE_ERR")}}function aC(a){if(!a.startContainer){throw new L("INVALID_STATE_ERR")}}function al(a,d){if(!aJ.arrayContains(d,a.nodeType)){throw new aM("INVALID_NODE_TYPE_ERR")}}function S(a,d){if(d<0||d>(aJ.isCharacterDataNode(a)?a.length:a.childNodes.length)){throw new L("INDEX_SIZE_ERR")}}function ad(a,d){if(aN(a,true)!==aN(d,true)){throw new L("WRONG_DOCUMENT_ERR")}}function z(a){if(aK(a,true)){throw new L("NO_MODIFICATION_ALLOWED_ERR")}}function c(a,d){if(!a){throw new L(d)}}function ac(a){if(!aN(a.startContainer,true)||!aN(a.endContainer,true)||!(a.startOffset<=(aJ.isCharacterDataNode(a.startContainer)?a.startContainer.length:a.startContainer.childNodes.length))||!(a.endOffset<=(aJ.isCharacterDataNode(a.endContainer)?a.endContainer.length:a.endContainer.childNodes.length))){throw Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")")}}function w(a){a.START_TO_START=R;a.START_TO_END=n;a.END_TO_END=g;a.END_TO_START=aw;a.NODE_BEFORE=aq;a.NODE_AFTER=v;a.NODE_BEFORE_AND_AFTER=ay;a.NODE_INSIDE=ap}function an(a){w(a);w(a.prototype)}function ao(a,i,f){function j(o,m){return function(p){aC(this);al(p,ar);al(az(p),au);p=(o?av:ah)(p);(m?l:e)(this,p.node,p.offset)}}function l(r,p,q){var o=r.endContainer,m=r.endOffset;if(p!==r.startContainer||q!==this.startOffset){if(az(p)!=az(o)||aJ.comparePoints(p,q,o,m)==1){o=p;m=q}i(r,p,q,o,m)}}function e(r,p,q){var o=r.startContainer,m=r.startOffset;if(p!==r.endContainer||q!==this.endOffset){if(az(p)!=az(o)||aJ.comparePoints(p,q,o,m)==-1){o=p;m=q}i(r,o,m,p,q)}}function k(p,m,o){if(m!==p.startContainer||o!==this.startOffset||m!==p.endContainer||o!==this.endOffset){i(p,m,o,m,o)}}function d(m){return function(){aC(this);ac(this);var q=this.startContainer,r=this.startOffset,p=this.commonAncestorContainer,o=new aD(this,true);if(q!==p){q=aJ.getClosestAncestorIn(q,p,true);r=ah(q);q=r.node;r=r.offset}aE(o,z);o.reset();p=m(o);o.detach();i(this,q,r,q,r);return p}}a.prototype={attachListener:function(o,m){this._listeners[o].push(m)},setStart:function(o,m){aC(this);aF(o,true);S(o,m);l(this,o,m)},setEnd:function(o,m){aC(this);aF(o,true);S(o,m);e(this,o,m)},setStartBefore:j(true,true),setStartAfter:j(false,true),setEndBefore:j(true,false),setEndAfter:j(false,false),collapse:function(m){aC(this);ac(this);m?i(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):i(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(m){aC(this);aF(m,true);i(this,m,0,m,ae(m))},selectNode:function(o){aC(this);aF(o,false);al(o,ar);var m=av(o);o=ah(o);i(this,m.node,m.offset,o.node,o.offset)},compareBoundaryPoints:function(q,o){aC(this);ac(this);ad(this.startContainer,o.startContainer);var p=q==aw||q==R?"start":"end",m=q==n||q==R?"start":"end";return aJ.comparePoints(this[p+"Container"],this[p+"Offset"],o[m+"Container"],o[m+"Offset"])},insertNode:function(m){aC(this);ac(this);al(m,am);z(this.startContainer);if(aJ.isAncestorOf(m,this.startContainer,true)){throw new L("HIERARCHY_REQUEST_ERR")}this.setStartBefore(M(m,this.startContainer,this.startOffset))},cloneContents:function(){aC(this);ac(this);var o,m;if(this.collapsed){return af(this).createDocumentFragment()}else{if(this.startContainer===this.endContainer&&aJ.isCharacterDataNode(this.startContainer)){o=this.startContainer.cloneNode(true);o.data=o.data.slice(this.startOffset,this.endOffset);m=af(this).createDocumentFragment();m.appendChild(o);return m}else{m=new aD(this,true);o=aH(m);m.detach()}return o}},extractContents:d(ax),deleteContents:d(aA),canSurroundContents:function(){aC(this);ac(this);z(this.startContainer);z(this.endContainer);var o=new aD(this,true),m=o._first&&V(o._first,this)||o._last&&V(o._last,this);o.detach();return !m},surroundContents:function(o){al(o,aO);if(!this.canSurroundContents()){throw new aM("BAD_BOUNDARYPOINTS_ERR")}var m=this.extractContents();if(o.hasChildNodes()){for(;o.lastChild;){o.removeChild(o.lastChild)}}M(o,this.startContainer,this.startOffset);o.appendChild(m);this.selectNode(o)},cloneRange:function(){aC(this);ac(this);for(var p=new ab(af(this)),m=ai.length,o;m--;){o=ai[m];p[o]=this[o]}return p},detach:function(){f(this)},toString:function(){aC(this);ac(this);var o=this.startContainer;if(o===this.endContainer&&aJ.isCharacterDataNode(o)){return o.nodeType==3||o.nodeType==4?o.data.slice(this.startOffset,this.endOffset):""}else{var m=[];o=new aD(this,true);aE(o,function(p){if(p.nodeType==3||p.nodeType==4){m.push(p.data)}});o.detach();return m.join("")}},compareNode:function(p){aC(this);ac(this);var m=p.parentNode,o=aJ.getNodeIndex(p);if(!m){throw new L("NOT_FOUND_ERR")}p=this.comparePoint(m,o);m=this.comparePoint(m,o+1);return p<0?m>0?ay:aq:m>0?v:ap},comparePoint:function(o,m){aC(this);ac(this);c(o,"HIERARCHY_REQUEST_ERR");ad(o,this.startContainer);if(aJ.comparePoints(o,m,this.startContainer,this.startOffset)<0){return -1}else{if(aJ.comparePoints(o,m,this.endContainer,this.endOffset)>0){return 1}}return 0},createContextualFragment:function(p){aC(this);var m=af(this),o=m.createElement("div");o.innerHTML=p;for(p=m.createDocumentFragment();m=o.firstChild;){p.appendChild(m)}return p},intersectsNode:function(r,p){aC(this);ac(this);c(r,"NOT_FOUND_ERR");if(aJ.getDocument(r)!==af(this)){return false}var q=r.parentNode,o=aJ.getNodeIndex(r);c(q,"NOT_FOUND_ERR");var m=aJ.comparePoints(q,o,this.endContainer,this.endOffset);q=aJ.comparePoints(q,o+1,this.startContainer,this.startOffset);return p?m<=0&&q>=0:m<0&&q>0},isPointInRange:function(o,m){aC(this);ac(this);c(o,"HIERARCHY_REQUEST_ERR");ad(o,this.startContainer);return aJ.comparePoints(o,m,this.startContainer,this.startOffset)>=0&&aJ.comparePoints(o,m,this.endContainer,this.endOffset)<=0},intersectsRange:function(m){aC(this);ac(this);if(af(m)!=af(this)){throw new L("WRONG_DOCUMENT_ERR")}return aJ.comparePoints(this.startContainer,this.startOffset,m.endContainer,m.endOffset)<0&&aJ.comparePoints(this.endContainer,this.endOffset,m.startContainer,m.startOffset)>0},intersection:function(q){if(this.intersectsRange(q)){var o=aJ.comparePoints(this.startContainer,this.startOffset,q.startContainer,q.startOffset),p=aJ.comparePoints(this.endContainer,this.endOffset,q.endContainer,q.endOffset),m=this.cloneRange();o==-1&&m.setStart(q.startContainer,q.startOffset);p==1&&m.setEnd(q.endContainer,q.endOffset);return m}return null},containsNode:function(o,m){return m?this.intersectsNode(o,false):this.compareNode(o)==ap},containsNodeContents:function(m){return this.comparePoint(m,0)>=0&&this.comparePoint(m,ae(m))<=0},splitBoundaries:function(){ac(this);var r=this.startContainer,p=this.startOffset,q=this.endContainer,o=this.endOffset,m=r===q;aJ.isCharacterDataNode(q)&&o>0&&o<q.length&&aJ.splitDataNode(q,o);if(aJ.isCharacterDataNode(r)&&p>0&&p<r.length){r=aJ.splitDataNode(r,p);if(m){o-=p;q=r}else{q==r.parentNode&&o>=aJ.getNodeIndex(r)&&o++}p=0}i(this,r,p,q,o)},normalizeBoundaries:function(){ac(this);var t=this.startContainer,r=this.startOffset,s=this.endContainer,p=this.endOffset,o=function(u){var x=u.nextSibling;if(x&&x.nodeType==u.nodeType){s=u;p=u.length;u.appendData(x.data);x.parentNode.removeChild(x)}},q=function(u){var x=u.previousSibling;if(x&&x.nodeType==u.nodeType){t=u;var y=u.length;r=x.length;u.insertData(0,x.data);x.parentNode.removeChild(x);if(t==s){p+=r;s=t}else{if(s==u.parentNode){x=aJ.getNodeIndex(u);if(p==x){s=u;p=y}else{p>x&&p--}}}}},m=true;if(aJ.isCharacterDataNode(s)){s.length==p&&o(s)}else{if(p>0){(m=s.childNodes[p-1])&&aJ.isCharacterDataNode(m)&&o(m)}m=!this.collapsed}if(m){if(aJ.isCharacterDataNode(t)){r==0&&q(t)}else{if(r<t.childNodes.length){(o=t.childNodes[r])&&aJ.isCharacterDataNode(o)&&q(o)}}}else{t=s;r=p}i(this,t,r,s,p)},createNodeIterator:function(o,m){aC(this);ac(this);return new aL(this,o,m)},getNodes:function(o,m){aC(this);ac(this);return ak(this,o,m)},collapseToPoint:function(o,m){aC(this);ac(this);aF(o,true);S(o,m);k(this,o,m)},collapseBefore:function(m){aC(this);this.setEndBefore(m);this.collapse(false)},collapseAfter:function(m){aC(this);this.setStartAfter(m);this.collapse(true)},getName:function(){return"DomRange"},equals:function(m){return ab.rangesEqual(this,m)},inspect:function(){return aB(this)}};an(a)}function b(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:aJ.getCommonAncestor(a.startContainer,a.endContainer)}function at(a,f,e,i,k){var d=a.startContainer!==f||a.startOffset!==e,j=a.endContainer!==i||a.endOffset!==k;a.startContainer=f;a.startOffset=e;a.endContainer=i;a.endOffset=k;b(a);ag(a,"boundarychange",{startMoved:d,endMoved:j})}function ab(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};b(this)}aG.requireModules(["DomUtil"]);var aJ=aG.dom,h=aJ.DomPosition,L=aG.DOMException;aD.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return !!this._next},next:function(){var a=this._current=this._next;if(a){this._next=a!==this._last?a.nextSibling:null;if(aJ.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes){if(a===this.ec){(a=a.cloneNode(true)).deleteData(this.eo,a.length-this.eo)}if(this._current===this.sc){(a=a.cloneNode(true)).deleteData(0,this.so)}}}return a},remove:function(){var a=this._current,e,d;if(aJ.isCharacterDataNode(a)&&(a===this.sc||a===this.ec)){e=a===this.sc?this.so:0;d=a===this.ec?this.eo:a.length;e!=d&&a.deleteData(e,d-e)}else{a.parentNode&&a.parentNode.removeChild(a)}},isPartiallySelectedSubtree:function(){return V(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode){a=this.range.cloneRange();a.collapse()}else{a=new ab(af(this.range));var f=this._current,e=f,i=0,j=f,d=ae(f);if(aJ.isAncestorOf(f,this.sc,true)){e=this.sc;i=this.so}if(aJ.isAncestorOf(f,this.ec,true)){j=this.ec;d=this.eo}at(a,e,i,j,d)}return new aD(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};aM.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};aM.prototype.toString=function(){return this.message};aL.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var ar=[1,3,4,5,7,8,10],au=[2,9,11],am=[1,3,4,5,7,8,10,11],aO=[1,3,4,5,7,8],aN=aI([9,11]),aK=aI([5,6,10,12]),aj=aI([6,10,12]),ai=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],R=0,n=1,g=2,aw=3,aq=0,v=1,ay=2,ap=3;ao(ab,at,function(a){aC(a);a.startContainer=a.startOffset=a.endContainer=a.endOffset=null;a.collapsed=a.commonAncestorContainer=null;ag(a,"detach",null);a._listeners=null});ab.fromRange=function(a){var d=new ab(af(a));at(d,a.startContainer,a.startOffset,a.endContainer,a.endOffset);return d};ab.rangeProperties=ai;ab.RangeIterator=aD;ab.copyComparisonConstants=an;ab.createPrototypeRange=ao;ab.inspect=aB;ab.getRangeDocument=af;ab.rangesEqual=function(a,d){return a.startContainer===d.startContainer&&a.startOffset===d.startOffset&&a.endContainer===d.endContainer&&a.endOffset===d.endOffset};ab.getEndOffset=ae;aG.DomRange=ab;aG.RangeException=aM});rangy.createModule("WrappedRange",function(a){function g(j,r,k,i){var u=j.duplicate();u.collapse(k);var m=u.parentElement();h.isAncestorOf(r,m,true)||(m=r);if(!m.canHaveHTML){return new f(m.parentNode,h.getNodeIndex(m))}r=h.getDocument(m).createElement("span");var n,o=k?"StartToStart":"StartToEnd";do{m.insertBefore(r,r.previousSibling);u.moveToElementText(r)}while((n=u.compareEndPoints(o,j))>0&&r.previousSibling);o=r.nextSibling;if(n==-1&&o&&h.isCharacterDataNode(o)){u.setEndPoint(k?"EndToStart":"EndToEnd",j);if(/[\r\n]/.test(o.data)){m=u.duplicate();k=m.text.replace(/\r\n/g,"\r").length;for(k=m.moveStart("character",k);m.compareEndPoints("StartToEnd",m)==-1;){k++;m.moveStart("character",1)}}else{k=u.text.length}m=new f(o,k)}else{o=(i||!k)&&r.previousSibling;m=(k=(i||k)&&r.nextSibling)&&h.isCharacterDataNode(k)?new f(k,0):o&&h.isCharacterDataNode(o)?new f(o,o.length):new f(m,h.getNodeIndex(r))}r.parentNode.removeChild(r);return m}function c(j,r){var k,i,u=j.offset,m=h.getDocument(j.node),n=m.body.createTextRange(),o=h.isCharacterDataNode(j.node);if(o){k=j.node;i=k.parentNode}else{k=j.node.childNodes;k=u<k.length?k[u]:null;i=j.node}m=m.createElement("span");m.innerHTML="&#feff;";k?i.insertBefore(m,k):i.appendChild(m);n.moveToElementText(m);n.collapse(!r);i.removeChild(m);if(o){n[r?"moveStart":"moveEnd"]("character",u)}return n}a.requireModules(["DomUtil","DomRange"]);var e,h=a.dom,f=h.DomPosition,b=a.DomRange;if(a.features.implementsDomRange){(function(){function j(q){for(var l=k.length,p;l--;){p=k[l];q[p]=q.nativeRange[p]}}var r,k=b.rangeProperties,i,u;e=function(l){if(!l){throw Error("Range must be specified")}this.nativeRange=l;j(this)};b.createPrototypeRange(e,function(t,p,q,v,s){var l=t.endContainer!==v||t.endOffset!=s;if(t.startContainer!==p||t.startOffset!=q||l){t.setEnd(v,s);t.setStart(p,q)}},function(q){q.nativeRange.detach();q.detached=true;for(var l=k.length,p;l--;){p=k[l];q[p]=null}});r=e.prototype;r.selectNode=function(l){this.nativeRange.selectNode(l);j(this)};r.deleteContents=function(){this.nativeRange.deleteContents();j(this)};r.extractContents=function(){var l=this.nativeRange.extractContents();j(this);return l};r.cloneContents=function(){return this.nativeRange.cloneContents()};r.surroundContents=function(l){this.nativeRange.surroundContents(l);j(this)};r.collapse=function(l){this.nativeRange.collapse(l);j(this)};r.cloneRange=function(){return new e(this.nativeRange.cloneRange())};r.refresh=function(){j(this)};r.toString=function(){return this.nativeRange.toString()};var m=document.createTextNode("test");h.getBody(document).appendChild(m);var n=document.createRange();n.setStart(m,0);n.setEnd(m,0);try{n.setStart(m,1);i=true;r.setStart=function(p,l){this.nativeRange.setStart(p,l);j(this)};r.setEnd=function(p,l){this.nativeRange.setEnd(p,l);j(this)};u=function(l){return function(p){this.nativeRange[l](p);j(this)}}}catch(o){i=false;r.setStart=function(q,l){try{this.nativeRange.setStart(q,l)}catch(p){this.nativeRange.setEnd(q,l);this.nativeRange.setStart(q,l)}j(this)};r.setEnd=function(q,l){try{this.nativeRange.setEnd(q,l)}catch(p){this.nativeRange.setStart(q,l);this.nativeRange.setEnd(q,l)}j(this)};u=function(p,l){return function(q){try{this.nativeRange[p](q)}catch(s){this.nativeRange[l](q);this.nativeRange[p](q)}j(this)}}}r.setStartBefore=u("setStartBefore","setEndBefore");r.setStartAfter=u("setStartAfter","setEndAfter");r.setEndBefore=u("setEndBefore","setStartBefore");r.setEndAfter=u("setEndAfter","setStartAfter");n.selectNodeContents(m);r.selectNodeContents=n.startContainer==m&&n.endContainer==m&&n.startOffset==0&&n.endOffset==m.length?function(l){this.nativeRange.selectNodeContents(l);j(this)}:function(l){this.setStart(l,0);this.setEnd(l,b.getEndOffset(l))};n.selectNodeContents(m);n.setEnd(m,3);i=document.createRange();i.selectNodeContents(m);i.setEnd(m,4);i.setStart(m,2);r.compareBoundaryPoints=n.compareBoundaryPoints(n.START_TO_END,i)==-1&n.compareBoundaryPoints(n.END_TO_START,i)==1?function(p,l){l=l.nativeRange||l;if(p==l.START_TO_END){p=l.END_TO_START}else{if(p==l.END_TO_START){p=l.START_TO_END}}return this.nativeRange.compareBoundaryPoints(p,l)}:function(p,l){return this.nativeRange.compareBoundaryPoints(p,l.nativeRange||l)};h.getBody(document).removeChild(m);n.detach();i.detach()})()}else{if(a.features.implementsTextRange){e=function(i){this.textRange=i;this.refresh()};e.prototype=new b(document);e.prototype.refresh=function(){var j,m,k=this.textRange;j=k.parentElement();var i=k.duplicate();i.collapse(true);m=i.parentElement();i=k.duplicate();i.collapse(false);k=i.parentElement();m=m==k?m:h.getCommonAncestor(m,k);m=m==j?m:h.getCommonAncestor(j,m);if(this.textRange.compareEndPoints("StartToEnd",this.textRange)==0){m=j=g(this.textRange,m,true,true)}else{j=g(this.textRange,m,true,false);m=g(this.textRange,m,false,false)}this.setStart(j.node,j.offset);this.setEnd(m.node,m.offset)};e.rangeToTextRange=function(i){if(i.collapsed){return c(new f(i.startContainer,i.startOffset),true)}else{var k=c(new f(i.startContainer,i.startOffset),true),j=c(new f(i.endContainer,i.endOffset),false);i=h.getDocument(i.startContainer).body.createTextRange();i.setEndPoint("StartToStart",k);i.setEndPoint("EndToEnd",j);return i}};b.copyComparisonConstants(e);var d=function(){return this}();if(typeof d.Range=="undefined"){d.Range=e}}}e.prototype.getName=function(){return"WrappedRange"};a.WrappedRange=e;a.createNativeRange=function(i){i=i||document;if(a.features.implementsDomRange){return i.createRange()}else{if(a.features.implementsTextRange){return i.body.createTextRange()}}};a.createRange=function(i){i=i||document;return new e(a.createNativeRange(i))};a.createRangyRange=function(i){i=i||document;return new b(i)};a.createIframeRange=function(i){return a.createRange(h.getIframeDocument(i))};a.createIframeRangyRange=function(i){return a.createRangyRange(h.getIframeDocument(i))};a.addCreateMissingNativeApiListener(function(i){i=i.document;if(typeof i.createRange=="undefined"){i.createRange=function(){return a.createRange(this)}}i=i=null})});rangy.createModule("WrappedSelection",function(an,v){function L(e){return(e||window).getSelection()}function M(e){return(e||window).document.selection}function ae(e,k,f){var j=f?"end":"start";f=f?"start":"end";e.anchorNode=k[j+"Container"];e.anchorOffset=k[j+"Offset"];e.focusNode=k[f+"Container"];e.focusOffset=k[f+"Offset"]}function P(e){e.anchorNode=e.focusNode=null;e.anchorOffset=e.focusOffset=0;e.rangeCount=0;e.isCollapsed=true;e._ranges.length=0}function D(e){var f;if(e instanceof ap){f=e._selectionNativeRange;if(!f){f=an.createNativeRange(at.getDocument(e.startContainer));f.setEnd(e.endContainer,e.endOffset);f.setStart(e.startContainer,e.startOffset);e._selectionNativeRange=f;e.attachListener("detach",function(){this._selectionNativeRange=null})}}else{if(e instanceof ag){f=e.nativeRange}else{if(window.Range&&e instanceof Range){f=e}}}return f}function i(e){var k=e.getNodes(),f;e:if(!k.length||k[0].nodeType!=1){f=false}else{f=1;for(var j=k.length;f<j;++f){if(!at.isAncestorOf(k[0],k[f])){f=false;break e}}f=true}if(!f){throw Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element")}return k[0]}function ao(e,j){var f=new ag(j);e._ranges=[f];ae(e,f,false);e.rangeCount=1;e.isCollapsed=f.collapsed}function al(e){e._ranges.length=0;if(e.docSelection.type=="None"){P(e)}else{var l=e.docSelection.createRange();if(l&&typeof l.text!="undefined"){ao(e,l)}else{e.rangeCount=l.length;for(var f,k=at.getDocument(l.item(0)),j=0;j<e.rangeCount;++j){f=an.createRange(k);f.selectNode(l.item(j));e._ranges.push(f)}e.isCollapsed=e.rangeCount==1&&e._ranges[0].collapsed;ae(e,e._ranges[e.rangeCount-1],false)}}}function ah(e,o){var f=e.docSelection.createRange(),m=i(o),l=at.getDocument(f.item(0));l=at.getBody(l).createControlRange();for(var k=0,p=f.length;k<p;++k){l.add(f.item(k))}try{l.add(m)}catch(j){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}l.select();al(e)}function af(e,j,f){this.nativeSelection=e;this.docSelection=j;this._ranges=[];this.win=f;this.refresh()}function R(e,m){var f=at.getDocument(m[0].startContainer);f=at.getBody(f).createControlRange();for(var l=0,k;l<rangeCount;++l){k=i(m[l]);try{f.add(k)}catch(j){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}f.select();al(e)}function ai(e,f){if(e.anchorNode&&at.getDocument(e.anchorNode)!==at.getDocument(f)){throw new am("WRONG_DOCUMENT_ERR")}}function ak(e){var m=[],f=new aj(e.anchorNode,e.anchorOffset),l=new aj(e.focusNode,e.focusOffset),k=typeof e.getName=="function"?e.getName():"Selection";if(typeof e.rangeCount!="undefined"){for(var j=0,o=e.rangeCount;j<o;++j){m[j]=ap.inspect(e.getRangeAt(j))}}return"["+k+"(Ranges: "+m.join(", ")+")(anchor: "+f.inspect()+", focus: "+l.inspect()+"]"}an.requireModules(["DomUtil","DomRange","WrappedRange"]);an.config.checkSelectionRanges=true;var at=an.dom,ar=an.util,ap=an.DomRange,ag=an.WrappedRange,am=an.DOMException,aj=at.DomPosition,S,n,C=an.util.isHostMethod(window,"getSelection"),g=an.util.isHostObject(document,"selection");if(C){S=L;an.isSelectionValid=function(){return true}}else{if(g){S=M;an.isSelectionValid=function(e){e=(e||window).document;var f=e.selection;return f.type!="None"||at.getDocument(f.createRange().parentElement())==e}}else{v.fail("No means of obtaining a selection object")}}an.getNativeSelection=S;C=S();var b=an.createNativeRange(document),z=at.getBody(document),d=ar.areHostObjects(C,ar.areHostProperties(C,["anchorOffset","focusOffset"]));an.features.selectionHasAnchorAndFocus=d;var X=ar.isHostMethod(C,"extend");an.features.selectionHasExtend=X;var aa=typeof C.rangeCount=="number";an.features.selectionHasRangeCount=aa;var a=false,ac=true;ar.areHostMethods(C,["addRange","getRangeAt","removeAllRanges"])&&typeof C.rangeCount=="number"&&an.features.implementsDomRange&&function(){var e=document.createElement("iframe");z.appendChild(e);var l=at.getIframeDocument(e);l.open();l.write("<html><head></head><body>12</body></html>");l.close();var f=at.getIframeWindow(e).getSelection(),k=l.documentElement.lastChild.firstChild;l=l.createRange();l.setStart(k,1);l.collapse(true);f.addRange(l);ac=f.rangeCount==1;f.removeAllRanges();var j=l.cloneRange();l.setStart(k,0);j.setEnd(k,2);f.addRange(l);f.addRange(j);a=f.rangeCount==2;l.detach();j.detach();z.removeChild(e)}();an.features.selectionSupportsMultipleRanges=a;an.features.collapsedNonEditableSelectionsSupported=ac;var w=false,aq;if(z&&ar.isHostMethod(z,"createControlRange")){aq=z.createControlRange();if(ar.areHostProperties(aq,["item","add"])){w=true}}an.features.implementsControlRange=w;n=d?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:false};var c;if(ar.isHostMethod(C,"getRangeAt")){c=function(e,j){try{return e.getRangeAt(j)}catch(f){return null}}}else{if(d){c=function(e){var f=at.getDocument(e.anchorNode);f=an.createRange(f);f.setStart(e.anchorNode,e.anchorOffset);f.setEnd(e.focusNode,e.focusOffset);if(f.collapsed!==this.isCollapsed){f.setStart(e.focusNode,e.focusOffset);f.setEnd(e.anchorNode,e.anchorOffset)}return f}}}an.getSelection=function(e){e=e||window;var k=e._rangySelection,f=S(e),j=g?M(e):null;if(k){k.nativeSelection=f;k.docSelection=j;k.refresh(e)}else{k=new af(f,j,e);e._rangySelection=k}return k};an.getIframeSelection=function(e){return an.getSelection(at.getIframeWindow(e))};aq=af.prototype;if(d&&ar.areHostMethods(C,["removeAllRanges","addRange"])){aq.removeAllRanges=function(){this.nativeSelection.removeAllRanges();P(this)};var h=function(e,j){var f=ap.getRangeDocument(j);f=an.createRange(f);f.collapseToPoint(j.endContainer,j.endOffset);e.nativeSelection.addRange(D(f));e.nativeSelection.extend(j.startContainer,j.startOffset);e.refresh()};aq.addRange=aa?function(e,j){if(w&&g&&this.docSelection.type=="Control"){ah(this,e)}else{if(j&&X){h(this,e)}else{var f;if(a){f=this.rangeCount}else{this.removeAllRanges();f=0}this.nativeSelection.addRange(D(e));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==f+1){if(an.config.checkSelectionRanges){if((f=c(this.nativeSelection,this.rangeCount-1))&&!ap.rangesEqual(f,e)){e=new ag(f)}}this._ranges[this.rangeCount-1]=e;ae(this,e,V(this.nativeSelection));this.isCollapsed=n(this)}else{this.refresh()}}}}:function(e,f){if(f&&X){h(this,e)}else{this.nativeSelection.addRange(D(e));this.refresh()}};aq.setRanges=function(e){if(w&&e.length>1){R(this,e)}else{this.removeAllRanges();for(var j=0,f=e.length;j<f;++j){this.addRange(e[j])}}}}else{if(ar.isHostMethod(C,"empty")&&ar.isHostMethod(b,"select")&&w&&g){aq.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var e;if(this.anchorNode){e=at.getDocument(this.anchorNode)}else{if(this.docSelection.type=="Control"){var j=this.docSelection.createRange();if(j.length){e=at.getDocument(j.item(0)).body.createTextRange()}}}if(e){e.body.createTextRange().select();this.docSelection.empty()}}}catch(f){}P(this)};aq.addRange=function(e){if(this.docSelection.type=="Control"){ah(this,e)}else{ag.rangeToTextRange(e).select();this._ranges[0]=e;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;ae(this,e,false)}};aq.setRanges=function(e){this.removeAllRanges();var f=e.length;if(f>1){R(this,e)}else{f&&this.addRange(e[0])}}}else{v.fail("No means of selecting a Range or TextRange was found");return false}}aq.getRangeAt=function(e){if(e<0||e>=this.rangeCount){throw new am("INDEX_SIZE_ERR")}else{return this._ranges[e]}};var ab;if(ar.isHostMethod(C,"getRangeAt")&&typeof C.rangeCount=="number"){ab=function(e){if(w&&g&&e.docSelection.type=="Control"){al(e)}else{e._ranges.length=e.rangeCount=e.nativeSelection.rangeCount;if(e.rangeCount){for(var j=0,f=e.rangeCount;j<f;++j){e._ranges[j]=new an.WrappedRange(e.nativeSelection.getRangeAt(j))}ae(e,e._ranges[e.rangeCount-1],V(e.nativeSelection));e.isCollapsed=n(e)}else{P(e)}}}}else{if(d&&typeof C.isCollapsed=="boolean"&&typeof b.collapsed=="boolean"&&an.features.implementsDomRange){ab=function(e){var f;f=e.nativeSelection;if(f.anchorNode){f=c(f,0);e._ranges=[f];e.rangeCount=1;f=e.nativeSelection;e.anchorNode=f.anchorNode;e.anchorOffset=f.anchorOffset;e.focusNode=f.focusNode;e.focusOffset=f.focusOffset;e.isCollapsed=n(e)}else{P(e)}}}else{if(ar.isHostMethod(C,"createRange")&&g){ab=function(e){var f;if(an.isSelectionValid(e.win)){f=e.docSelection.createRange()}else{f=at.getBody(e.win.document).createTextRange();f.collapse(true)}if(e.docSelection.type=="Control"){al(e)}else{f&&typeof f.text!="undefined"?ao(e,f):P(e)}}}else{v.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}}}aq.refresh=function(e){var f=e?this._ranges.slice(0):null;ab(this);if(e){e=f.length;if(e!=this._ranges.length){return false}for(;e--;){if(!ap.rangesEqual(f[e],this._ranges[e])){return false}}return true}};var ad=function(e,m){var f=e.getAllRanges(),l=false;e.removeAllRanges();for(var k=0,j=f.length;k<j;++k){if(l||m!==f[k]){e.addRange(f[k])}else{l=true}}e.rangeCount||P(e)};aq.removeRange=w?function(e){if(this.docSelection.type=="Control"){var m=this.docSelection.createRange();e=i(e);var f=at.getDocument(m.item(0));f=at.getBody(f).createControlRange();for(var l,k=false,j=0,o=m.length;j<o;++j){l=m.item(j);if(l!==e||k){f.add(m.item(j))}else{k=true}}f.select();al(this)}else{ad(this,e)}}:function(e){ad(this,e)};var V;if(d&&an.features.implementsDomRange){V=function(e){var f=false;if(e.anchorNode){f=at.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)==1}return f};aq.isBackwards=function(){return V(this)}}else{V=aq.isBackwards=function(){return false}}aq.toString=function(){for(var e=[],j=0,f=this.rangeCount;j<f;++j){e[j]=""+this._ranges[j]}return e.join("")};aq.collapse=function(e,j){ai(this,e);var f=an.createRange(at.getDocument(e));f.collapseToPoint(e,j);this.removeAllRanges();this.addRange(f);this.isCollapsed=true};aq.collapseToStart=function(){if(this.rangeCount){var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)}else{throw new am("INVALID_STATE_ERR")}};aq.collapseToEnd=function(){if(this.rangeCount){var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)}else{throw new am("INVALID_STATE_ERR")}};aq.selectAllChildren=function(e){ai(this,e);var f=an.createRange(at.getDocument(e));f.selectNodeContents(e);this.removeAllRanges();this.addRange(f)};aq.deleteFromDocument=function(){if(w&&g&&this.docSelection.type=="Control"){for(var e=this.docSelection.createRange(),j;e.length;){j=e.item(0);e.remove(j);j.parentNode.removeChild(j)}this.refresh()}else{if(this.rangeCount){e=this.getAllRanges();this.removeAllRanges();j=0;for(var f=e.length;j<f;++j){e[j].deleteContents()}this.addRange(e[f-1])}}};aq.getAllRanges=function(){return this._ranges.slice(0)};aq.setSingleRange=function(e){this.setRanges([e])};aq.containsNode=function(e,k){for(var f=0,j=this._ranges.length;f<j;++f){if(this._ranges[f].containsNode(e,k)){return true}}return false};aq.getName=function(){return"WrappedSelection"};aq.inspect=function(){return ak(this)};aq.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null};af.inspect=ak;an.Selection=af;an.addCreateMissingNativeApiListener(function(e){if(typeof e.getSelection=="undefined"){e.getSelection=function(){return an.getSelection(this)}}e=null})});