(function(){var d=false,c=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(a){var b=this.prototype;d=true;var h=new this();d=false;for(var i in a){h[i]=typeof a[i]=="function"&&typeof b[i]=="function"&&c.test(a[i])?(function(f,e){return function(){var g=this._super;this._super=b[f];var l=e.apply(this,arguments);this._super=g;return l}})(i,a[i]):a[i]}function j(){if(!d&&this.init){this.init.apply(this,arguments)}}j.prototype=h;j.constructor=j;j.extend=arguments.callee;return j}})();(function(b){b.srender=function(a,f,e){b.srender.cache=b.srender.cache||{};if(b.srender.cache[a]){fn=b.srender.cache[a]}else{if(typeof f=="undefined"){return false}fn=b.srender.cache[a]=new Function("obj",'var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push("'+f.replace(/[\r\t\n]/g," ").replace(/\"/g,'\\"').split("<%").join("\t").replace(/((^|%>)[^\t]*)/g,"$1\r").replace(/\t=(.*?)%>/g,'",$1,"').split("\t").join('");').split("%>").join('p.push("').split("\r").join("")+"\");}return p.join('');")}if(typeof e!="undefined"){return fn(e)}else{return fn}}})(jQuery);(function(f){var e="([^/]+)";var d=/:([\w\d]+)/g;Sammy={};Sammy.VERSION="0.2.1";Sammy.Object=Class.extend({init:function(a){f.extend(this,a)},clone:function(a){if(typeof a=="undefined"){a=this}return f.extend({},a)},toHash:function(){var a={};this.each(function(b,c){if(!f.isFunction(c)){a[b]=c}});return a},toHTML:function(){var a="";this.each(function(b,c){if(!f.isFunction(c)){a+="<strong>"+b+"</strong> "+c+"<br />"}});return a},uuid:function(){if(typeof this._uuid=="undefined"||!this._uuid){this._uuid=(new Date()).getTime()+"-"+parseInt(Math.random()*1000)}return this._uuid},each:function(){var b,c,a,h;b=this;if(typeof arguments[0]!="function"){c=arguments[0];a=arguments[1]}else{c=this;a=arguments[0]}h=function(){return a.apply(b,arguments)};f.each(c,h)},log:function(){var a=[].slice.call(arguments);a.unshift("["+Date()+"]");if(typeof window.console!="undefined"){window.console.log.apply(window.console,a)}else{if(typeof console!="undefined"){console.log.apply(this,a)}else{}}}});Sammy.Application=Sammy.Object.extend({ROUTE_VERBS:["get","post","put","delete"],APP_EVENTS:["run","unload","lookup-route","run-route","route-found","event-context-before","event-context-after","changed","error-404","check-form-submission","redirect"],_last_route:null,_running:false,data_store_name:"sammy-app",element_selector:"body",debug:false,silence_404:true,run_interval_every:50,init:function(b){var a=this;this.routes={};this.listeners={};this.befores=[];this.namespace=this.uuid();this.context_prototype=Sammy.EventContext.extend({});this.each(this.ROUTE_VERBS,function(h,c){this._defineRouteShortcut(c)});b.apply(this);if(this.debug){this.addLogger(function(c,h){a.log(a.toString(),c.cleaned_type,h||{})})}},toString:function(){return"Sammy.Application:"+this.element_selector},$element:function(){return f(this.element_selector)},route:function(c,l,a){var k=this;var b=[];if(l.constructor==String){while((path_match=d.exec(l))!=null){b.push(path_match[1])}l=new RegExp(l.replace(d,e)+"$")}var n={verb:c,path:l,callback:a,param_names:b};if(typeof this.routes[c]=="undefined"||this.routes[c].length==0){this.routes[c]=[n]}else{var m=false;this.each(this.routes[c],function(g,h){if(l.toString().length>=h.path.toString().length){this.routes[c].splice(g,0,n);m=true;return false}});if(!m){this.routes[c].push(n)}}return n},eventNamespace:function(){return this.data_store_name+"-"+this.namespace+"-"},bind:function(h,b,a){if(typeof a=="undefined"){a=b}var c=function(){var g,l,k;g=arguments[0];l=arguments[1];k=arguments[2];g.cleaned_type=g.type.replace(l.eventNamespace(),"");a.apply(l,[g,k])};if(!this.listeners[h]){this.listeners[h]=[]}this.listeners[h].push(c);if(this.isRunning()){return this._listen(h,c)}},trigger:function(c,a,b){if(typeof b=="undefined"){b=new this.context_prototype(this,"bind",c,a)}return this.$element().triggerHandler(b.eventNamespace()+c,[b,a])},before:function(a){return this.befores.push(a)},after:function(a){return this.bind("event-context-after",a)},isRunning:function(){return this._running},helpers:function(a){this.context_prototype=this.context_prototype.extend(a)},run:function(b){if(this.isRunning()){return false}var a=this;this.each(this.listeners,function(h,c){this.each(c,function(g,i){this._listen(h,i)})});this.trigger("run",{start_url:b});this._running=true;this.$element().data(this.data_store_name,this);this.last_location=null;if(this.getLocation()==""&&typeof b!="undefined"){this.setLocation(b)}this._checkLocation();this._interval=setInterval(function(){a._checkLocation.apply(a)},this.run_interval_every);this.bind("changed",function(){a.$element().find("form:not(."+a.eventNamespace()+")").bind("submit",function(){return a._checkFormSubmission(this)}).addClass(a.eventNamespace())});f("body").bind("onunload",function(){a.unload()});this.trigger("changed")},unload:function(){if(!this.isRunning()){return false}var a=this;this.trigger("unload");clearInterval(this._interval);this.$element().find("form").unbind("submit").removeClass(a.eventNamespace());this.$element().removeData(this.data_store_name);this.each(this.listeners,function(c,b){this.each(b,function(i,j){this._unlisten(c,j)})});this._running=false},addLogger:function(a){this.each(this.APP_EVENTS,function(c,b){this.bind(b,a)})},lookupRoute:function(a,b){var h=false,c=b.match(/^(.*#.*)\?/);if(c){b=c[1]}this.trigger("lookup-route",{verb:a,path:b});if(typeof this.routes[a]!="undefined"){this.each(this.routes[a],function(g,i){if(b.match(i.path)){h=i;return false}})}return h},_parse_query:function(b){var i={},c,k,a,l;c=b.match(/^#.*\?(.*)$/);if(c){k=c[1].split("&");for(l=0;l<k.length;l+=1){a=k[l].split("=");i[a[0]]=a[1]}}return i},runRoute:function(a,l,b){this.trigger("run-route",{verb:a,path:l,params:b});if(typeof b=="undefined"){b={}}jQuery.extend(b,this._parse_query(l));var o=this.lookupRoute(a,l);if(o){this.trigger("route-found",{route:o});if((path_params=o.path.exec(l))!=null){path_params.shift();this.each(path_params,function(h,g){if(o.param_names[h]){b[o.param_names[h]]=g}else{if(!b.splat){b.splat=[]}b.splat.push(g)}})}var n=new this.context_prototype(this,a,l,b);this.last_route=o;var p=true;var c=this.befores.slice(0);while(c.length>0){if(c.shift().apply(n)===false){return false}}n.trigger("event-context-before");var m=o.callback.apply(n);n.trigger("event-context-after");return m}else{this.notFound(a,l)}},getLocation:function(){return this.clone(window.location).hash.toString()},setLocation:function(a){window.location=a},swap:function(a){return this.$element().html(a)},notFound:function(a,b){this.trigger("error-404",{verb:a,path:b});throw ("404 Not Found "+a+" "+b)},_defineRouteShortcut:function(a){var b=this;this[a]=function(h,c){b.route.apply(b,[a,h,c])}},_checkLocation:function(){try{var c,b;c=this.getLocation();if(c!=this.last_location){b=this.runRoute("get",c)}this.last_location=c}catch(a){this.last_location=c;if(a.toString().match(/^404/)&&this.silence_404){return b}else{throw (a)}}return b},_checkFormSubmission:function(m){var o,c,a,b,n;this.trigger("check-form-submission",{form:m});o=f(m);c=o.attr("action");a=o.attr("method").toString().toLowerCase();b={};o.find(":input[type!=submit]").each(function(){b[f(this).attr("name")]=f(this).val()});try{n=this.runRoute(a,c,b);this.last_location=c}catch(l){if(l.toString().match(/^404/)&&this.silence_404){return true}else{throw (l)}}return(typeof n=="undefined")?false:n},_listen:function(b,a){return this.$element().bind(this.eventNamespace()+b,a)},_unlisten:function(b,a){return this.$element().unbind(this.eventNamespace()+b,a)}});Sammy.EventContext=Sammy.Object.extend({init:function(a,b,h,c){this.app=a;this.verb=b;this.path=h;this.params=new Sammy.Object(c)},$element:function(){return this.app.$element()},template:function(b,a,c){if(typeof c=="undefined"){c=b}return f.srender(c,b,f.extend({},a,this))},partial:function(c,j,a){var k,b,l;l=this;if(typeof a=="undefined"){if(typeof j=="function"){a=j;j={}}else{a=function(g){l.app.swap(g)}}}k=f.srender(c);j=f.extend({},j,this);if(k&&!this.app.debug){b=k(j);a.apply(l,[b]);l.trigger("changed")}else{f.get(c,function(g){b=f.srender(c,g,j);a.apply(l,[b]);l.trigger("changed")})}},redirect:function(a){this.trigger("redirect",{to:a});return this.app.setLocation(a)},trigger:function(b,a){return this.app.trigger(b,a,this)},eventNamespace:function(){return this.app.eventNamespace()},notFound:function(){return this.app.notFound(this.verb,this.path)}});f.sammy=function(a){return new Sammy.Application(a)}})(jQuery);