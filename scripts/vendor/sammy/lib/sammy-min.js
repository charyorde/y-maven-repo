(function(){var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.SammyClass=function(){};SammyClass.extend=function(g){var e=this.prototype;a=true;var d=new this();a=false;for(var c in g){d[c]=typeof g[c]=="function"&&typeof e[c]=="function"&&b.test(g[c])?(function(h,i){return function(){var k=this._super;this._super=e[h];var j=i.apply(this,arguments);this._super=k;return j}})(c,g[c]):g[c]}function f(){if(!a&&this.init){this.init.apply(this,arguments)}}f.prototype=d;f.constructor=f;f.extend=arguments.callee;return f}})();(function(a){a.srender=function(b,c,d){a.srender.cache=a.srender.cache||{};if(a.srender.cache[b]){fn=a.srender.cache[b]}else{if(typeof c=="undefined"){return false}fn=a.srender.cache[b]=new Function("obj",'var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push("'+c.replace(/[\r\t\n]/g," ").replace(/\"/g,'\\"').split("<%").join("\t").replace(/((^|%>)[^\t]*)/g,"$1\r").replace(/\t=(.*?)%>/g,'",$1,"').split("\t").join('");').split("%>").join('p.push("').split("\r").join("")+"\");}return p.join('');")}if(typeof d!="undefined"){return fn(d)}else{return fn}}})(jQuery);(function(d){var b="([^/]+)";var c=/:([\w\d]+)/g;var a=/\?([^#]*)$/;Sammy={};Sammy.VERSION="0.2.1";Sammy.Object=SammyClass.extend({init:function(e){d.extend(this,e)},clone:function(e){if(typeof e=="undefined"){e=this}return d.extend({},e)},toHash:function(){var e={};this.each(function(g,f){if(!d.isFunction(f)){e[g]=f}});return e},toHTML:function(){var e="";this.each(function(g,f){if(!d.isFunction(f)){e+="<strong>"+g+"</strong> "+f+"<br />"}});return e},uuid:function(){if(typeof this._uuid=="undefined"||!this._uuid){this._uuid=(new Date()).getTime()+"-"+parseInt(Math.random()*1000)}return this._uuid},each:function(){var g,f,h,e;g=this;if(typeof arguments[0]!="function"){f=arguments[0];h=arguments[1]}else{f=this;h=arguments[0]}e=function(){return h.apply(g,arguments)};d.each(f,e)},log:function(){var e=[].slice.call(arguments);e.unshift("["+Date()+"]");if(typeof window.console!="undefined"){window.console.log.apply(window.console,e)}else{if(typeof console!="undefined"){console.log.apply(this,e)}else{}}}});Sammy.Application=Sammy.Object.extend({ROUTE_VERBS:["get","post","put","delete"],APP_EVENTS:["run","unload","lookup-route","run-route","route-found","event-context-before","event-context-after","changed","error-404","check-form-submission","redirect"],_last_route:null,_running:false,data_store_name:"sammy-app",element_selector:"body",debug:false,silence_404:true,run_interval_every:50,init:function(e){var f=this;this.routes={};this.listeners={};this.befores=[];this.namespace=this.uuid();this.context_prototype=Sammy.EventContext.extend({});this.each(this.ROUTE_VERBS,function(g,h){this._defineRouteShortcut(h)});e.apply(this);if(this.debug){this.addLogger(function(h,g){f.log(f.toString(),h.cleaned_type,g||{})})}},toString:function(){return"Sammy.Application:"+this.element_selector},$element:function(){return d(this.element_selector)},route:function(k,h,m){var j=this;var l=[];var e;if(h.constructor==String){l=(h.match(c)||[]);for(e=0;e<l.length;e+=1){l[e]=l[e].replace(/^:/,"")}h=new RegExp(h.replace(c,b)+"$")}var f={verb:k,path:h,callback:m,param_names:l};if(typeof this.routes[k]=="undefined"||this.routes[k].length==0){this.routes[k]=[f]}else{var g=false;this.each(this.routes[k],function(o,n){if(h.toString().length>=n.path.toString().length){this.routes[k].splice(o,0,f);g=true;return false}});if(!g){this.routes[k].push(f)}}return f},eventNamespace:function(){return this.data_store_name+"-"+this.namespace+"-"},bind:function(e,g,h){if(typeof h=="undefined"){h=g}var f=function(){var k,i,j;k=arguments[0];i=arguments[1];j=arguments[2];k.cleaned_type=k.type.replace(i.eventNamespace(),"");h.apply(i,[k,j])};if(!this.listeners[e]){this.listeners[e]=[]}this.listeners[e].push(f);if(this.isRunning()){return this._listen(e,f)}},trigger:function(e,g,f){if(typeof f=="undefined"){f=new this.context_prototype(this,"bind",e,g)}return this.$element().triggerHandler(f.eventNamespace()+e,[f,g])},before:function(e){return this.befores.push(e)},after:function(e){return this.bind("event-context-after",e)},isRunning:function(){return this._running},helpers:function(e){this.context_prototype=this.context_prototype.extend(e)},run:function(e){if(this.isRunning()){return false}var f=this;this.each(this.listeners,function(g,h){this.each(h,function(k,j){this._listen(g,j)})});this.trigger("run",{start_url:e});this._running=true;this.$element().data(this.data_store_name,this);this.last_location=null;if(this.getLocation()==""&&typeof e!="undefined"){this.setLocation(e)}this._checkLocation();this._interval=setInterval(function(){f._checkLocation.apply(f)},this.run_interval_every);this.bind("changed",function(){f.$element().find("form:not(."+f.eventNamespace()+")").bind("submit",function(){return f._checkFormSubmission(this)}).addClass(f.eventNamespace())});d("body").bind("onunload",function(){f.unload()});this.trigger("changed")},unload:function(){if(!this.isRunning()){return false}var e=this;this.trigger("unload");clearInterval(this._interval);this.$element().find("form").unbind("submit").removeClass(e.eventNamespace());this.$element().removeData(this.data_store_name);this.each(this.listeners,function(f,g){this.each(g,function(j,h){this._unlisten(f,h)})});this._running=false},addLogger:function(e){this.each(this.APP_EVENTS,function(f,g){this.bind(g,e)})},_canonical:function(e){return e.replace(a,"")},lookupRoute:function(g,f){var e=false;this.trigger("lookup-route",{verb:g,path:f});if(typeof this.routes[g]!="undefined"){this.each(this.routes[g],function(j,h){if(this._canonical(f).match(h.path)){e=h;return false}})}return e},_parse_query:function(j){var g={},h,f,k,e;h=j.match(a);if(h){f=h[1].split("&");for(e=0;e<f.length;e+=1){k=f[e].split("=");g[k[0]]=k[1]}}return g},runRoute:function(l,i,k){this.trigger("run-route",{verb:l,path:i,params:k});if(typeof k=="undefined"){k={}}jQuery.extend(k,this._parse_query(i));var f=this.lookupRoute(l,i);if(f){this.trigger("route-found",{route:f});if((path_params=f.path.exec(this._canonical(i)))!=null){path_params.shift();this.each(path_params,function(m,n){if(f.param_names[m]){k[f.param_names[m]]=n}else{if(!k.splat){k.splat=[]}k.splat.push(n)}})}var g=new this.context_prototype(this,l,i,k);this.last_route=f;var e=true;var j=this.befores.slice(0);while(j.length>0){if(j.shift().apply(g)===false){return false}}g.trigger("event-context-before");var h=f.callback.apply(g);g.trigger("event-context-after");return h}else{this.notFound(l,i)}},getLocation:function(){var e=window.location.toString().match(/^[^#]*(#.+)$/);if(e){return e[1]}else{return""}},setLocation:function(e){window.location=e},swap:function(e){return this.$element().html(e)},notFound:function(f,e){this.trigger("error-404",{verb:f,path:e});throw ("404 Not Found "+f+" "+e)},_defineRouteShortcut:function(f){var e=this;this[f]=function(g,h){e.route.apply(e,[f,g,h])}},_checkLocation:function(){try{var f,g;f=this.getLocation();if(f!=this.last_location){g=this.runRoute("get",f)}this.last_location=f}catch(h){this.last_location=f;if(h.toString().match(/^404/)&&this.silence_404){return g}else{throw (h)}}return g},_checkFormSubmission:function(h){var f,j,l,k,g;this.trigger("check-form-submission",{form:h});f=d(h);j=f.attr("action");l=f.attr("method").toString().toLowerCase();k={};f.find(":input[type!=submit]").each(function(){if(d(this).is(":checkbox:not(:checked)")){k[d(this).attr("name")]=""}else{k[d(this).attr("name")]=d(this).val()}});try{g=this.runRoute(l,j,k);this.last_location=j}catch(i){if(i.toString().match(/^404/)&&this.silence_404){return true}else{throw (i)}}return(typeof g=="undefined")?false:g},_listen:function(e,f){return this.$element().bind(this.eventNamespace()+e,f)},_unlisten:function(e,f){return this.$element().unbind(this.eventNamespace()+e,f)}});Sammy.EventContext=Sammy.Object.extend({init:function(h,g,e,f){this.app=h;this.verb=g;this.path=e;this.params=f},$element:function(){return this.app.$element()},template:function(f,g,e){if(typeof e=="undefined"){e=f}return d.srender(e,f,d.extend({},g,this))},partial:function(h,g,j){var f,i,e;e=this;if(typeof j=="undefined"){if(typeof g=="function"){j=g;g={}}else{j=function(k){e.app.swap(k)}}}f=d.srender(h);g=d.extend({},g,this);if(f&&!this.app.debug){i=f(g);j.apply(e,[i]);e.trigger("changed")}else{d.get(h,function(k){i=d.srender(h,k,g);j.apply(e,[i]);e.trigger("changed")})}},redirect:function(e){this.trigger("redirect",{to:e});return this.app.setLocation(e)},trigger:function(e,f){return this.app.trigger(e,f,this)},eventNamespace:function(){return this.app.eventNamespace()},notFound:function(){return this.app.notFound(this.verb,this.path)}});d.sammy=function(e){return new Sammy.Application(e)}})(jQuery);