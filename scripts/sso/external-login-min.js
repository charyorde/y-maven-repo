$j(document).ready(function(){var urlLabel=$j('label[for="openid_url"]');var urlLabelValue=urlLabel.text();var usernameLabel=$j('label[for="openid_username"]');var usernameLabelValue=usernameLabel.text();var loginRow=$j(".js-openid-login-row");var urlRow=$j(".js-openid-url-row");var urlField=$j("#openid_url");var usernameField=$j("#openid_username");var idField=$j("#openid_identifier");var buttonHolder=$j(".openid_provider_btns");var openidError=$j("<span class='jive-error-message'/>").insertAfter(usernameField).hide();var form=$j("#external-login-choice");$j(".ext_login_large_btn").each(function(){var el=$j(this);el.click(function(event){event.stopPropagation();form.unbind("submit").bind(coreSubmitHandler);loginRow.hide();usernameField.val("");var href=el.attr("href");if(href.indexOf("{}")!=-1){buttonHolder.fadeOut(50,function(){loginRow.fadeIn(50)});var handler=function(){idField.val(href.replace("{}",usernameField.val()));urlField.val(idField.val())};handler();usernameField.keyup(handler);form.submit(handler)}else{if(href.indexOf("javascript:")==0){eval(href.substr("javascript:".length))}else{idField.val(href);form.submit()}}if(el.hasClass("openid")){usernameLabel.text(urlLabelValue);urlRow.hide()}else{usernameLabel.text(usernameLabelValue);urlRow.show()}return false})});$j("input.cancel").click(function(){loginRow.fadeOut(50,function(){buttonHolder.fadeIn(50)});return false});var coreSubmitHandler=function(){if(usernameField.filter(":visible").size()==1&&usernameLabel.text()==urlLabelValue){var openid_url=usernameField.val()||"";var proto_page=window.location.protocol;var idx=openid_url.indexOf(":");if(idx<0){var proto_openid="invalid"}else{var proto_openid=openid_url.substring(0,idx+1)}openidError.hide();if(proto_page==proto_openid){return true}if(proto_page=="http:"&&proto_openid=="https:"){openidError.text(jive.i18n.getMsg("sso.openid.implicit_upgrade"))}else{if(proto_page=="https:"&&proto_openid=="http:"){openidError.text(jive.i18n.getMsg("sso.openid.implicit_downgrade"))}else{openidError.text(jive.i18n.getMsg("sso.openid.invalid_url"))}}openidError.show();event.stopImmediatePropagation();return false}}});function facebook_login(){FB.init({appId:appId,status:false,cookie:true,xfbml:false});FB.login(function(a){if(a.status=="connected"){window.location=window._jive_base_url+"/facebook/sso?access_token="+a.authResponse.accessToken}},{scope:"email"})};