jive.namespace("hte");jive.hte.HTE=function(e,k){var i=$j(e);if(i.length!=1){console.log("selector must select a single element.  Selector: ",e,i);throw new Error("selector must select a single element",e,i)}var g=this;jive.conc.observable(this);this.editor=null;this.$elem=i;this.load=a(j);this.save=a(h);this.getValue=a(f);k=$j.extend({},{},k);var b=c(e,k);b.done(function(l){g.editor=tinymce.get(l.prop("id"));g.emit("initFinished",this)}).fail(function(l){console.log("failed to construct hyper-text editors for element",l);g.emit("initFailed",this)});function a(m){return function l(){if(!this.editor){console.log("not initialized when attempting to call "+m.name);throw new Error("The HTE is not yet initialized")}return m.apply(this,arguments)}}function j(l){this.editor.setContent(l)}function f(){return this.editor.getContent()}function h(){var l=this.getValue();this.$elem.val(l)}function d(){if(!jive.hte.HTE.next){jive.hte.HTE.next=1}return jive.hte.HTE.next++}function c(l,m){var o=new $j.Deferred();try{define(["jive.rte"],function(){try{var r=$j(l);if(!r.prop("id")){r.prop("id","hypertext-editor-id-"+d())}function u(){o.resolve(r)}var t={mode:"exact",theme:"advanced",theme_advanced_toolbar_location:"none",theme_advanced_statusbar_location:"none",content_css:computeRTEPluginStyle(CS_RESOURCE_BASE_URL+"/styles/tiny_mce3/themes/advanced/skins/default/content.css"),editor_css:" ",body_class:"tiny_mce_content",plugins:"paste",skin:"hte",formats:{alignleft:{},aligncenter:{},alignright:{},alignfull:{},bold:{},italic:{},underline:{},strikethrough:{},forecolor:{},hilitecolor:{},fontname:{},fontsize:{},blockquote:{},removeformat:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},div:{},address:{},pre:{},code:{},dt:{},dd:{},samp:{}},valid_elements:"p/div/pre/blockquote/h1/h2/h3/h4/h5/h6,a[href],span[class|id|data-*]",oninit:function q(){var v=tinymce.get(r.prop("id"));v.onInit.add(u)},oninitFail:function p(){o.reject(r)},elements:r.prop("id")};tinymce.init(t)}catch(s){console.log("Failed to init the HTE",s);jive.conc.nextTick(function(){o.reject(r,"initHte failed",s)})}})}catch(n){console.log("Failed load the TinyMCE JS files",n);jive.conc.nextTick(function(){o.reject($elem,"TinyMCE failed to load",n)})}return o.promise()}};