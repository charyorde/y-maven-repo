jive.rte.RTELayout=function(e){var m=this;var n;var o=null;var s,p,j,h,q;function u(K){if(s.length){var C=null;if(!K){if(q.is(":visible")){K=q.offset();var J=q.width();var G=n.find("table:first").outerWidth(true);var D=$j(window).width();if(!(K.left+G<D)&&(K.left+J-G>0)){K.left-=G-J}K.width=Math.max(J,G)}else{K={};K.width=q.width()}C=q.height();var E=n.find("table:first").height();var I=s.height();var H=I-E;if(C<=I){q.height(s.height())}else{K.height=C-H}}if(K.top!=null&&K.left!=null){var F={top:K.top,left:K.left};s.offset(F)}if(K.width){s.width(K.width)}if(K.height){r(K.height)}}}function x(C){t();o=C}function f(){if(jive&&jive.loader&&jive.loader.LoaderView){h=new jive.loader.LoaderView({size:"big"});h.prependTo(n)}else{h=null}}function t(){n.removeClass("loading");if(h){h.destroy();h.getContent().remove()}}function l(){j.hide()}function A(){j.show()}function B(){p.hide()}function b(){p.show()}var i="<textarea class='usertext'></textarea>";function y(C){s=$j("<div class='j-rte-wrap-box'><div class='wysiwygtext_html_link'><a href='javascript:void(0);' class='toggle_html' style='display:none;'>"+C.toggleText+"</a>&nbsp;<a href='javascript:void(0);' class='rte_preferred' style='display:none;'>"+C.alwaysUseTabText+"</a>&nbsp;&nbsp;</div><div class='jive-panel-wrapper'><div id='wysiwyg-panel' class='current loading toolbar-container'><div class='readOnlyMessage' style='display: none;'><h4></h4><p></p><br /><p></p></div>"+i+"</div></div></div>");n=s.find(".jive-panel-wrapper .toolbar-container");p=s.find("a.toggle_html").click(function(D){m.emit("toggleHtml",D)});j=s.find(".wysiwygtext_html_link a.rte_preferred").click(function(D){m.emit("setPreferred",D)});if(C.readOnlyMessage){n.find(".readOnlyMessage").find("h4").text(C.editDisabledText).end().find("p:last").text(C.editDisabledSummary.replace("{0}",C.communityName));n.find(".readOnlyMessage").show();n.addClass("disabled")}if(C.shouldFloat){s.css({position:"absolute","z-index":C.zIndex||100});q=$j("<div style='width: 100%;'></div>").height(C.$element.outerHeight(true));C.$element.before(q);$j("body").append(s);s.offset(q.offset()).width(q.width())}else{q=$j();C.$element.before(s)}f()}var c=500;function k(){if(c>0){c=$j(window).height()-100}}function z(){if(o){var C=$j(o.getBody()).outerHeight(true);var D=$j(o.getWindow()).height();if(C>D&&C<c&&c>0){r(Math.min(C+100,c))}}}function r(C){var E=n.find("table:first");var D=n.find("iframe");var F=E.height()-D.height();E.height(C);D.height(C-F);g().height(C);q.height(s.height());m.emit("resized",C,s.height())}function g(){return n.find("textarea.usertext")}function a(){s.remove();q.remove();g().remove();$j(window).unbind("resize.rteLayout",d);$j("body").undelegate("div.mceSplitButtonMenu, div.mceDropDown","mouseover.rteLayout",w)}function d(){k();u()}var v=7;function w(C){var F=$j(window);var E=F.width();var D=F.scrollLeft();if(E+D-v<=C.pageX){F.scrollLeft(D+v*2)}}if(!e.domExists){y(e)}else{n=e.$editorPanel;n.prepend(i);s=$j();q=$j();p=$j();j=$j();o=e.rte}k();$j(window).bind("resize.rteLayout",d);$j("body").delegate("div.mceSplitButtonMenu, div.mceDropDown","mouseover.rteLayout",w);$j.extend(this,{reposition:u,expandToFitContent:z,resizeTo:r,getEditorPanel:function(){return n},getUserTextarea:g,hidePreferredButton:l,showPreferredButton:A,hideToggleHtmlButton:B,showToggleHtmlButton:b,teardown:a,doneLoading:x})};jive.conc.observable(jive.rte.RTELayout.prototype);