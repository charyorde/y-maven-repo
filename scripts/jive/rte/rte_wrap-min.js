jive.rte.RTEWrap=function(k){var h=window.jive;var c={$element:null,id:k.$element.attr("id")?k.$element.attr("id"):"wysiwygtext",controller:null,preset:"wiki",preferredMode:"advanced",startMode:"advanced",mobileUI:false,toggleText:"",alwaysUseTabText:"",editDisabledText:"",editDisabledSummary:"",isEditing:false,height:0,onReady:function(){}};k=$j.extend({},c,k);k.images_enabled=k.images_enabled||k._imagesEnabled||false;var e="advanced";var b=k.preferredMode?k.preferredMode:"advanced";var a,j;var d=this;if(k.mobileUI){e="rawhtml";b="rawhtml"}if(!k.$element||!k.$element.length){return}this.destroy=function(){a.destroy();j.teardown();k.$element.remove();window.editor.clear(k.id)};this.teardownServices=function(){a.teardownServices()};function g(l){if(k.mobileUI){f();return}WikiTextConverter.setPreferredEditorMode(l,{callback:function(){b=l;f()},timeout:DWRTimeout,errorHandler:editorErrorHandler})}function f(){if(k.mobileUI){j.hideToggleHtmlButton();j.hidePreferredButton();return}if(e=="rawhtml"){j.showToggleHtmlButton()}else{j.hideToggleHtmlButton()}if(b==e){j.hidePreferredButton()}else{j.showPreferredButton()}}function i(n,m){var o=new h.rte.RTEListener();if(k.height==0){o.onResize=function(p){return function(){var q=new Date();q.setTime(q.getTime()+3600000*24*365);var s=window.editor.get(p).getHeight();var r=window._jive_base_url==""?"/":window._jive_base_url;setCookie("jive_wysiwygtext_height",""+s,q,r)}}(k.id)}o.onKeyUp=function(){m.expandToFitContent()};o.doneTogglingMode=function(){if(e=="advanced"){e="rawhtml"}else{e="advanced"}f()};o.initFinished=function l(){var q=new $j.Deferred();if(b=="rawhtml"){h.conc.nextTick(function t(){n.toggleEditorMode(n.getID());q.resolve()})}else{q.resolve()}var r=new $j.Deferred();h.conc.nextTick(function p(){var u=k.height;if(!u){try{u=parseInt(getCookie("jive_wysiwygtext_height"))}catch(v){u=500}if(!u){u=500}}if(tinymce.isGecko){setTimeout(function(){m.resizeTo(u);m.expandToFitContent();m.reposition();r.resolve()},300)}else{m.resizeTo(u);m.expandToFitContent();m.reposition();r.resolve();if(tinymce.isIE){tinymce.activeEditor.getBody().className+=" "}}});m.doneLoading(n);$j.when(r,q).done(h.conc.nextTick(function s(){k.onReady()}))};if(k.autoSave&&k.autoSave.messageChangeHandler){o.onKeyUp=function(){k.autoSave.messageChangeHandler()};o.onChange=function(){k.autoSave.messageChangeHandler()}}n.addListener(o)}k.$element.css("color","white");require(["jive.rte"],function(){h.conc.nextTick(function l(){var m={images_enabled:k.images_enabled||false,rteLayout:j};a=new h.rte.RTE(k.services,k.id,k.preset,m);a.getReadyPromise().fail(function(){j.doneLoading(a)}).always(function(){k.$element.css("color","")});if(k.mobileUI){if(k.isEditing){a.setDisabled(true);a.getReadyPromise().fail(h.conc.nextTick(function(){k.$element.hide()}))}else{a.getReadyPromise().fail(h.conc.nextTick(function(){k.$element.hide();j.getUserTextarea().show();j.reposition()}))}k.$element.before("<input name='mobileEditor' value='true' type='hidden' />");a.setMobileOnly(true)}for(var n in a){if(typeof(d[n])=="undefined"){d[n]=a[n]}}h.rte.multiRTE.push(k.id);window.editor.put(k.id,d);i(a,j)})});if(h.rte.LinkService){k.services=$j.extend({linkService:new h.rte.LinkService()},k.services)}j=new h.rte.RTELayout({$element:k.$element,toggleText:k.toggleText,alwaysUseTabText:k.alwaysUseTabText,destinationPosition:k.destinationPosition,readOnlyMessage:k.mobileUI&&k.isEditing,editDisabledText:k.editDisabledText,editDisabledSummary:k.editDisabledSummary,communityName:k.communityName,shouldFloat:k.shouldFloat});j.addListener("setPreferred",function(){g(e)});j.addListener("toggleHtml",function(){a.toggleEditorMode(k.id)});this._getLayout=function(){return j};f()};