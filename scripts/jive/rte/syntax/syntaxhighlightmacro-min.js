if(typeof(jive)!="undefined"){jive.rte.plugin.code=function(f,a,g,m,b,n,e,k,i){var j=this;var h=$j("<span style='height:12px;width:1px;background-color:black;position:absolute;top:0px;'></span>");function c(o,p){while(p.parentNode){if(p.parentNode==o){return true}p=p.parentNode}return false}setInterval(function(){if(h.parents("body").length>0){if(h.is(":visible")){h.hide()}else{h.show()}}},500);var l=null;e=[{name:"__default_attr",value:"plain"}];this.getName=function(){return f};this.getUrl=function(){return a};this.isButton=function(){return i};this.isEnabled=function(){return k};this.isShowSettings=function(){return m};this.isShowInMacroList=function(){return b};this.getMacroType=function(){return g};this.getParameterSets=function(){var r=new Array();r.push({name:"html",deleteAll:true,params:[{name:"__default_attr",value:"html"}]});r.push({name:"xml",deleteAll:false,params:[{name:"__default_attr",value:"xml"}]});r.push({name:"sql",deleteAll:false,params:[{name:"__default_attr",value:"sql"}]});r.push({name:"java",deleteAll:false,params:[{name:"__default_attr",value:"java"}]});r.push({name:"plain",deleteAll:false,params:[{name:"__default_attr",value:"plain"}]});r.push({name:"c++",deleteAll:false,params:[{name:"__default_attr",value:"c++"}]});r.push({name:"c#",deleteAll:false,params:[{name:"__default_attr",value:"c#"}]});r.push({name:"css",deleteAll:false,params:[{name:"__default_attr",value:"css"}]});r.push({name:"javascript",deleteAll:false,params:[{name:"__default_attr",value:"javascript"}]});r.push({name:"php",deleteAll:false,params:[{name:"__default_attr",value:"php"}]});r.push({name:"python",deleteAll:false,params:[{name:"__default_attr",value:"python"}]});r.push({name:"ruby",deleteAll:false,params:[{name:"__default_attr",value:"ruby"}]});var q=new Array();for(var o=0;o<r.length;o++){var p=new jive.rte.ParamSet();p.name=r[o].name;p.deleteAll=r[o].deleteAll;p.params=r[o].params;q.push(p)}return q};this.getAllowedParameters=function(){return e};this.usesCustomBackground=function(){return true};this.updateCursor=function(p,E,x){if(l!=p.selection()||h.parents("body").length==0){var r=l=p.selection();if(r&&r.collapsed){var q=r.startContainer;if(q){var y=r.startOffset;if(q.nodeType!=3){y=0;for(var u=0;u<r.startOffset&&u<q.childNodes.length;u++){y+=$j(q.childNodes[u]).text().length}}else{while(q.previousSibling){y+=$j(q.previousSibling).text().length;q=q.previousSibling}}var C=$j(q.nodeType==3?q.parentNode:q);C=C.parents().andSelf().filter("p:first");if(c(E,q)){h.show();h.height(C.height());var D=0;while(C.prev().length){C=C.prev();D++}x.data("line",D);x.data("offset",y);var A=x.find("li:nth("+D+") span:first");A.prepend(h.remove());if(A.length==0){return}if(A.contents().length==1){h.css({left:0})}else{var s=A.get(0).childNodes[1];var t=0;var o=null;while(t<y){if(s.nodeType!=3){if(t+$j(s).text().length<y){t+=$j(s).text().length;if(s.nextSibling){s=s.nextSibling}else{var B=document.createElement("span");s.parentNode.insertBefore(B,s);s.parentNode.insertBefore(s,B);s=B;o=B;break}}else{if(s.childNodes.length==0){break}else{s=s.childNodes[0]}}}else{if(t+s.nodeValue.length<y){t+=s.nodeValue.length;if(s.nextSibling){s=s.nextSibling}else{var B=document.createElement("span");s.parentNode.insertBefore(B,s);s.parentNode.insertBefore(s,B);s=B;o=B;break}}else{if(t+s.nodeValue.length==y){t+=s.nodeValue.length;var B=document.createElement("span");s.parentNode.insertBefore(B,s);s.parentNode.insertBefore(s,B);s=B;o=B;break}else{if(t+s.nodeValue.length>y){var w=y-t;var z=s.nodeValue.substr(w);s.nodeValue=s.nodeValue.substr(0,w);var v=document.createTextNode(z);s.parentNode.insertBefore(v,s);s.parentNode.insertBefore(s,v);B=document.createElement("span");s.parentNode.insertBefore(B,s);s.parentNode.insertBefore(s,B);s=B;o=B;t+=w;break}}}}}h.css({left:t?$j(s).position().left:A.position().left});if(o){o.parentNode.removeChild(o)}}}else{h.remove()}}else{h.remove()}}else{h.remove()}}};this.refreshPosition=function(o,y,u,p){var q=$j(y);var x=p.top;var r=p.left;var s=q.outerHeight();var v=Math.max.apply(Math,u.find("span").add(q).map(function(){return $j(this).outerWidth()+59}).get());u.css("width",v);u.css("height",s);u.css("top",x);u.css("left",r);if(u.data("needrefresh")=="true"){u.data("needrefresh","false");j.refresh(o,y)}j.updateCursor(o,y,u)};function d(q){var o="";for(var p=0;p<q.childNodes.length;p++){if(q.childNodes[p].nodeType==4){o+=q.childNodes[p].nodeValue}else{if(q.childNodes[p].nodeType==3){o+=q.childNodes[p].nodeValue}else{var r=q.childNodes[p];var s=d(r);if(tinymce.DOM.isBlock(r)){s+="\n"}else{if(r.nodeName.toLowerCase()=="br"&&r.nextSibling!=null){s+="\n"}}o+=s}}}return o}this.refresh=function(q,r){var p=q.getUIDForElement($j(r));var u=q.getHiddenElementFor(p);var v;if(u.children().length==0){v=$j("<pre name='_code_"+p+"'></pre>");u.append(v)}else{v=u.children("pre")}var t=$j(r).attr("___default_attr");if(!t){t="plain"}v.attr("class",t);var s=d(r);if(s==""){s="\n"}if(v.data("text")!=s||t!=v.data("lang")){v.text(s.replace(/\n/g," \n"));v.data("text",s);v.data("lang",t);var o=q.getCurrentNode().parents(".jive_macro_code");u.children("div").remove();dp.SyntaxHighlighter.HighlightAll("_code_"+p)}j.refreshPosition(q,r,u,$j(r).offset())};this.caresAboutChangeTo=function(o,q,p){return false}}};