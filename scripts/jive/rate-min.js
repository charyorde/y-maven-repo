jive.Rate=function(h,g,p,s,w,l,y,r,b){var o=jive.rest.url("/rating/"+p+"/"+s);var q;var d;var c;var e;var u;var f;var t;$j.getJSON(o,function(A){q=A.ratingInfo;x();v();j();if(f){var z={body:"",element:t,i18n:l,containerType:h,containerID:g,resourceType:p,resourceID:s,rteOptions:b};new jive.Rate.Main(z)}});function v(){if(r){t=$j('.jive-content-rating[data-guid="'+r+'"]')}else{t=$j("#jive-content-rating")}}function x(){d=(q.ratedByUser&&q.userRating.score>0)?q.userRating.score:0;c=q.userRating?q.userRating.description:"";e=false;u=q.availableRatings;f=q.commentable&&y}function i(){$j.getJSON(o+"/mean",function(z){k(z)});$j.getJSON(o+"/count",function(z){m(z)});return false}function k(z){t.find(".jive-content-avgrating-score").attr("title",l.avgUserRatingLabeli18n+": "+z);$j.each(u,function(A,B){t.find(".jive-icon-avgrating-"+B.score).toggleClass("jive-icon-rate-avg-on",z>=B.score).toggleClass("jive-icon-rate-avg-half",z<B.score&&z>=B.score-0.5).toggleClass("jive-icon-rate-avg-off",z<B.score-0.5)})}function m(z){var A=(z==1)?l.rateRatingLabel:l.rateRatingsLabel;t.find(".jive-content-avgrating-count").text("("+z+" "+A+")")}function a(A){e=true;var z=t.find(".j-rating-comment-instruct .font-color-okay strong");z.html(l.rateSavingText);if(!t.find(".j-rating-container").hasClass("j-rating-container-active")){t.find(".j-rating-container").addClass("j-rating-container-active");if(!t.find(".j-rating-container").hasClass("j-rating-container-active-tab")){t.find(".j-rating-comment-instruct").css("opacity","0").animate({width:"toggle",opacity:1},500)}}$j.post(o,{score:A},function(){i();d=A;n(A);z.html(l.rateSavedText);if(!f){t.find(".j-rating-comment-instruct").fadeOut(2500,function(){t.find(".j-rating-container").removeClass("j-rating-container-active")})}e=false})}function n(z){$j.each(u,function(A,B){if(z==0){t.find(".jive-content-userrating-desc").html("")}if(z==B.score){t.find(".jive-content-userrating-desc").html(B.description)}t.find(".jive-icon-userrating-"+B.score).toggleClass("jive-icon-rate-usr-on",z>=B.score).toggleClass("jive-icon-rate-usr-off",z<B.score)})}function j(){var z=jive.rate.soy.renderRating({ratingInfo:q,i18n:l});if(q.rateable){z+=jive.rate.soy.renderUserRating({ratingInfo:q,userRating:d,commentable:f,ratingDescription:c,i18n:l})}t.append(z);t.find(".jive-content-userrating").show();$j.each(q.availableRatings,function(B,A){t.find(".jive-icon-userrating-"+A.score).bind("click",function(){a(A.score)});t.find(".jive-icon-userrating-"+A.score).hover(function(){n(A.score)},function(){n(d)})})}};