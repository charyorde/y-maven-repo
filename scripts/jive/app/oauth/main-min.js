define("jive.JAF.Configuration.OAuthMain",["jive.JAF.Configuration.OAuthOverlay","jive.JAF.Configuration.OAuthPopup"],function(b,a){return jive.oo.Class.extend(function(c){jive.conc.observable(this);this.init=function(g,e,d,f,h){this.app=g;this.alias=e;this.redirectURI=d;this.windowchars=f;this.callback=h};this.getApp=function(){return this.app};this.invokeCallback=function(){if(this.callback){this.callback()}};c.create_popup=function(){var d=this;var e=new a(this.redirectURI,this.windowChars);var g=this.callback;var f=this.app;e.addListener("popup.opened",function(){d.container.hideGrant();d.container.showWaiting();d.emit("popup.opened",f)});e.addListener("popup.closed",function(){d.container.hideWaiting();var h={authorized:true};g(h);d.emit("popup.closed",f)});return e};this.launch_popup=function(d){this.popupWrapper=this.create_popup();this.container=new b(this.popupWrapper,d,this.alias);var e=this.app;this.container.addListener("oauth.approved",function(){var h=d.find("#_error");var j=d.find("#_errorDescription");var g=!(h.length>0||j.length>0);var i=d.find("#_alias").attr("value");var f={alias:i};if(!g){f.error={code:h.attr("value"),message:j.attr("value")}}callback(f);self.emit("oauth.approved",e)})};this.authorization_done=function(f,g){var e=$j("#j-app-view-"+this.app.id);var d=e.find(".j-oauth-authorize");if(f){d.append("<input type='hidden' id='_error' value='"+f+"'/>")}if(g){d.append("<input type='hidden' id='_errorDescription' value='"+g+"'/>")}e.find(".j-error-msg-oauth-approved-btn").click()}})});