define("jive.AppProfileTooltip",["jquery"],function(a){return $Class.extend({init:function(b){this.app=b;this.appIframe=a("#"+b.iframeId);this.presence=false;this.urlToLoad=profileShortUrl;this.loadingText=profileLoadingTooltip;this.errorText=profileErrorTooltip;this.loadingHTML='<strong class="jive-tooltip2-loading">'+this.loadingText+"</strong>"},show:function(d,b){var e=this.getTooltipPos(b);this.hide();var c=a(jive.apps.base.renderAppProfileTooltip({top:e.top,left:e.left}));a("body").append(c);this.getUserProfileTooltip(d,this.presence)},hide:function(){a("#jive-app-profile-toolip").remove()},getTooltipPos:function(b){var g=this.appIframe.offset();var h=a("html");var d=a("body");var e=(h.height()-d.height())/2;var c=(h.width()-d.width())/2;var f=b.top+g.top-e;var i=b.left+g.left-c;f-=10;i-=10;return{top:f,left:i}},getUserProfileTooltip:function(b,c){if(c){this.presence=c}this.cancelTooltip();a("#jive-app-profile-toolip-body").html(this.loadingHTML);this.timeoutExecutor=new TimeoutExecutor(this.getUserProfile.bind(this,b),700)},getUserProfile:function(c){var b=this;var d=this.presence;var e=this.urlToLoad;if(this.presence){e=this.urlToLoad+"&presencePostfix="+this.presence.getPresencePostfix()}a.ajax({url:e,type:"GET",dataType:"html",data:{userID:c,presence:this.presence},success:function(f){a("#jive-app-profile-toolip-body").html(f)},error:function(){a("#jive-app-profile-toolip-body").text(b.profileErrorTooltip)},complete:function(){if(d&&d.start){d.start()}}})},cancelTooltip:function(){if(this.timeoutExecutor){this.timeoutExecutor.cancel()}if(this.presence){this.presence.stop()}}})});