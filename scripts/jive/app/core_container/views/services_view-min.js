define("jive.JAF.CoreContainer.AppServicesView",["jquery","jive.JAF.CoreContainer.AppsContainerView","jive.JAF.Configuration.ConfigureMainV2","jive.JAF.Preferences"],function(d,a,b,c){return a.extend(function(e,f){jive.conc.observable(this);var h;var g;this.init=function(k,i,j){f.init.call(this,i,j);this.app=k;this.commonContainer=i;this.options=j;this.serviceSites=[]};this.setMarketApp=function(i){this.marketApp=i};this.isActive=function(){return d("#app-services-container").length?true:false};this.createUI=function(){return d(jive.apps.container.servicesView({app:this.app}))};this.activate=function(){this.determineLeftNavItems(this.app);this.registerLeftNavHandlers();d(".j-modal-nav li a").click(function(i){d(this).parent("li").addClass("selected").siblings("li").removeClass("selected")});this.hideNav();d("#j-app-svcs-about").click()};e.determineLeftNavItems=function(i){d("#j-app-svcs-settings").parent().show();if(!i.userPrefsAvailable){d("#j-app-svcs-settings").hide()}if(!i.configurationAvailable||i.configurationError){d("#j-app-svcs-config").hide()}};e.hideNav=function(){d("#app-services-container .j-modal-footer").hide()};e.showNav=function(){d("#app-services-container .j-modal-footer").show()};e.wireButtonListeners=function(j){var i=this;j.addListener("app.service.wire.submit",function(k){i.showNav();d("#j-app-services-submit").click(k.callback)});j.addListener("app.service.wire.cancel",function(k){i.showNav();d("#j-app-services-cancel").click(k.callback)});j.addListener("app.service.wire.nav.show",function(){i.showNav()});j.addListener("app.service.wire.nav.hide",function(){i.hideNav()})};this.prepareDetail=function(){var i=d("#app-services-detail");i.html("");return i};e.registerLeftNavHandlers=function(){var i=this;if(d("#j-app-sys-settings").length==1){d("#j-app-sys-settings").click(function(m){i.hideNav();var n="sys-settings-view";var k=i.prepareDetail();i.setCurrentSettingsView(n);var l=i.prepareSiteViewIfRequired(n,k[0]);i.showSpinner(k);i.requestNavigateTo(i.app,l,"system-settings",null,function(o){l.jiveData=new JiveSiteData(i,i.app,{});l.jiveData.setGadgetMetaData(o)});i.emit("app.navigate.admin-settings");m.preventDefault()})}d("#j-app-svcs-settings").click(function(l){i.hideNav();var k={};var n="user-settings-view";var o=i.prepareDetail();i.setCurrentSettingsView(n);var m=new c(i.app,o);i.wireButtonListeners(m);m.addListener("app.preferences.get.custom.view",function(r){var p=o[0];var q=i.prepareSiteViewIfRequired(n,p);i.showSpinner(o);i.requestNavigateTo(i.app,q,"user-prefs",null,function(s){q.jiveData=new JiveSiteData(i,i.app,{});q.jiveData.setGadgetMetaData(s)})});m.addListener("app.preferences.default.saved",function(p){i.servicesClose();i.sendNotification({severity:"info",message:p.message});i.emit("app.reload")});i.emit("app.navigate.user-prefs");l.preventDefault()});d("#j-app-svcs-config").click(function(m){var k=i.prepareDetail();var n="app-service-config-view";i.setCurrentSettingsView(n);var l=new b({app:i.app,domTarget:k});i.wireButtonListeners(l);l.addListener("app.configure.success",function(){i.servicesClose();var o=jive.apps.container.renderMessage({messageKey:"appframework.app.configure.success"});i.sendNotification({severity:"info",message:o});i.emit("app.reload")});l.addListener("app.configure.failed",function(){var o=jive.apps.container.renderMessage({messageKey:"appframework.app.configure.failure"});i.sendNotification({severity:"error",message:o})});i.emit("app.navigate.configure");m.preventDefault()});d("#j-app-svcs-developer").click(function(m){i.hideNav();var n="app-developer-view";i.setCurrentSettingsView(n);var l=i.prepareDetail();var o=i.app;if(typeof(o.developerModel)=="undefined"){o.developerModel=new jive.JAF.Configuration.DeveloperModel()}var k=new jive.JAF.Configuration.Developer({app:o,domTarget:l});i.emit("app.navigate.developer");m.preventDefault()});d("#j-app-svcs-about").click(function(o){var p="app-about-view";if(i.currentView==p){return}i.hideNav();var l=i.prepareDetail();i.setCurrentSettingsView(p);var m=i.prepareSiteViewIfRequired(p,l[0]);if(i.app.aboutViewAvailable){i.requestNavigateTo(i.app,m,"about",null,function(r){m.jiveData=new JiveSiteData(i,i.app,{});m.jiveData.setGadgetMetaData(r)})}else{var q={};if(i.app.appUUID){q.market={experience:"about"};q.market.appUUID=i.app.appUUID}else{q.market={experience:"default"}}var k=i.prepareMarketContext(q);var n=i.getEmbeddedContext(k.embeddedID);n.target.view="embedded";i.renderAppEE_(l[0],i.marketApp,n,function(s,r){aboutSite=s;aboutSite.jiveData=new JiveSiteData(i,i.marketApp,{});aboutSite.jiveData.setEEContext(n);aboutSite.jiveData.setGadgetMetaData(r);var t=l.find("iframe");t.removeData();if(i.marketApp.marketFeatureAvailable){t.data("hasMarketFeature",true)}t.css({height:"500px",width:"450px"})})}i.emit("app.navigate.about");o.preventDefault()});var j=function(k){i.servicesClose();k.preventDefault()};d(".j-modal-back-top").click(j);d("#j-app-services-cancel").click(j)};e.servicesClose=function(i){this.setCurrentSettingsView(null);this.emit("app.services.close")};this.setCurrentSettingsView=function(i){if(this.currentView!=i){if(this.serviceSites[i]){this.commonContainer.closeGadget(this.serviceSites[i]);this.currentView=null;this.serviceSites[i]=null}}this.currentView=i};this.prepareSiteViewIfRequired=function(k,i){var j=this.serviceSites[k];if(j){return j}this.serviceSites[k]=this.commonContainer.newGadgetSite(i);this.currentView=k;return this.serviceSites[k]};this.requestNavigateTo=function(l,i,k,j,m){l.view=k;this.renderApp_(i,l,m,j)};e.showSpinner=function(i){var j=new jive.loader.LoaderView({size:"small",inline:true});j.appendTo(d(i));j.show()}})});