jive.namespace("JAF.CoreContainer");define("jive.JAF.CoreContainer.Main",["jive.AppFileUploader","jive.JAF.Configuration.OAuthMain","jive.JAF.CoreContainer.AppCredentialsView","jive.JAF.CoreContainer.AppServicesView","jive.JAF.CoreContainer.AppsContainerModel","jive.JAF.CoreContainer.MarketEvents","jive.JAF.CoreContainer.ModalView","jive.JAF.Preferences.Model"],function(d,c,g,f,h,e,b,a){jive.JAF.CoreContainer.Main=jive.oo.Class.extend(function(i){jive.conc.observable(this);var k=jive.JAF.CoreContainer;var n={};var m={};var l=new e();var j=new jive.Apps.RteArtifacts();this.init=function(p){this.options=p=p||{};if((typeof osapi==="undefined")||(typeof osapi.container==="undefined")){return}this.initializeOpenSocialCommonContainer(p);this.modalView=new b(this.commonContainer,p);jQuery.extend(n,this.modalView.getActionOriginEnum());this.model=new h(this.commonContainer,p);this.rpcRegister();this.initializeEventHandlers();osapi=osapi||{};osapi.jive=osapi.jive||{};osapi.jive.corev3=osapi.jive.corev3||{};osapi.jive.corev3.extensions=osapi.jive.corev3.extensions||{};var o=[];osapi.jive.corev3.extensions.runWhenReady=function(q){o.push(q)};this.model.addListener("container.token.refreshed",function(){for(var q=0;q<o.length;q++){jive.conc.nextTick(o[q])}delete osapi.jive.corev3.extensions.runWhenReady})};i.initializeOpenSocialCommonContainer=function(o){this.commonContainer=new osapi.container.Container(this.createConfig(o));osapi.container.Service.prototype.getLanguage=function(){try{var p=_jive_locale;return p.split("_")[0]||"all"}catch(q){return"all"}};osapi.container.Service.prototype.getCountry=function(){try{var p=_jive_locale;return p.split("_")[1]||"ALL"}catch(q){return"ALL"}}};this.initEditContext=function(p){this.options.editedContentBean=p;var o=p.appContextBean;if(o){this.editContext={jive:{content:{type:o.coreAPIType,id:o.containerId<0?0:o.containerId}}}}};i.initializeEventHandlers=function(){var o=this;$j.each(n,function(q,p){o.modalView.addListener(p,function(r){o.handleRunAction(r,p)})});this.applyAppReloadHandlers(this.modalView);this.modalView.addListener("app.services.show",function(p){if(o.servicesView&&o.servicesView.isActive()){return}if(o.servicesView){delete o.servicesView}if(p){o.model.getApp(p).addCallback(function(q){o.servicesView=new f(q,o.commonContainer,o.options);o.servicesView.addListener("app.reload",function(){o.reloadApp()});o.model.getAppsMarketApp().addCallback(function(r){o.servicesView.setMarketApp(r);o.servicesView.addListener("app.services.close",function(){o.modalView.destroySettings();if(q.developerModel){o.modalView.setSparkline(q.developerModel.getMonitorState())}});o.modalView.invokeSettings(o.servicesView)})})}});this.modalView.addListener("app.chrome.close",function(){delete o.servicesView;if(o.credentialsView){o.credentialsView.cleanup();delete o.credentialsView}o.servicesView=null;o.credentialsView=null;o.oauthView=null});l.addListener("show_information",function(r,p,q){o.sendNotification(q,r)});l.addListener("app_install",function(t,r,s){var q=$j.isArray(t)?(t.length?t[0]:null):t;if(o.postInstallActionRun){var v=o.postInstallActionRun.actionInfo;var w=o.postInstallActionRun.origin;var x=function(){if(o.postInstallActionRun&&q&&v&&w&&q.appUUID===q.appUUID){delete o.postInstallActionRun;o.handleRunAction(v,w);o.postInstallActionRun=null}jive.switchboard.removeListener("app.install.animation.ended",x)};jive.switchboard.addListener("app.install.animation.ended",x);setTimeout(x,4250)}else{var p=s[osapi.container.GadgetSite.RPC_ARG_KEY];var u=p.jiveData.mvcView;o.model.cacheApp(q,false);u.handleAppsMarketInstall(q)}});o.applyAppAlertHandlers(o.modalView);o.applyOAuthHandlers(o.modalView);o.applyRefreshHandlers(o.modalView);o.applyCredentialsHandlers(o.modalView);$j(document).ready(function(){o.modalView.documentReady()})};i.applyAppReloadHandlers=function(q){var o=this;var p=function(){if(o.oauthView){delete o.oauthView}if(o.servicesView){delete o.servicesView}if(o.credentialsView){delete o.credentialsView}};q.addListener("app.reload",function(r){p();o.reloadApp(r)})};i.applyOAuthHandlers=function(p){var o=this;p.addListener("app.oauth.show",function(q){if(o.oauthView){return}o.oauthView=new c(q.app,q.options.alias,q.options.redirectURI,q.options.windowChars,q.callback);p.invokeOauthDance(o.oauthView);o.oauthView.addListener("popup.closed",function(){delete o.oauthView})})};i.applyRefreshHandlers=function(p){var o=this;p.addListener("app.services.refresh",function(q){var s=$j(q).attr("data-appuuid");var r=$j(q).attr("data-endpoint");o.model.refreshApp(r,function(){p.refresh()},function(){p.displayRefreshMsg(false)})})};i.applyCredentialsHandlers=function(p){var o=this;p.addListener("app.credentials.show",function(q){if(o.credentialsView){return}o.credentialsView=new g(q);p.invokeCredentials(o.credentialsView);o.credentialsView.addListener("app.credentials.complete.error",function(){p.closeModal()});o.credentialsView.addListener("app.credentials.complete.success",function(){p.destroyCredentials();delete o.credentialsView});o.credentialsView.addListener("app.service.message",function(r){p.sendNotification(r)})})};i.applyAppAlertHandlers=function(p){var o=this;p.addListener("app.remove.banned",function(s,q,r){o.model.appRemove("ban",s.id,q,r);jive.switchboard.emit("apps_market.apps_have_changed")});p.addListener("app.remove.blacklisted",function(s,q,r){o.model.appRemove("blacklist",s.id,q,r);jive.switchboard.emit("apps_market.apps_have_changed")});p.addListener("app.remove.throttle.violation",function(s,q,r){o.model.acknowledgeThrottle(s.id,function(){q();o.reloadApp(false)},r)});p.addListener("app.hide",function(s,q,r){o.model.appHide(s.id,q,r);jive.switchboard.emit("apps_market.apps_have_changed")});p.addListener("app.refresh",function(){o.reloadApp(false)});p.addListener("app.delete",function(s,q,r){o.model.deleteApp(s.appInstanceUUID,q,r);jive.switchboard.emit("apps_market.apps_have_changed")})};i.rpcRegister=function(){var o=this;this.commonContainer.rpcRegister("actions.bindAction",o.bindAction.bind(o));this.commonContainer.rpcRegister("maximize_app",o.maximizeApp.bind(o));this.commonContainer.rpcRegister("set_pref",o.setPref.bind(o));this.commonContainer.rpcRegister("set_title",o.setTitle.bind(o));this.commonContainer.rpcRegister("close_app",o.closeApp.bind(o));this.commonContainer.rpcRegister("editor_insert",o.editorInsert.bind(o));this.commonContainer.rpcRegister("send_notification",o.sendNotification.bind(o));this.commonContainer.rpcRegister("request_place_picker",o.initPlacePicker.bind(o));this.commonContainer.rpcRegister("request_user_picker",o.initUserPicker.bind(o));this.commonContainer.rpcRegister("requestNavigateTo",o.requestNavigateTo.bind(o));this.commonContainer.rpcRegister("request_upload_app_data_media_item",o.requestNavigateTo.bind(o));this.commonContainer.rpcRegister("request_core_api_upload",o.requestCoreApiUploadMediaItem.bind(o));this.commonContainer.rpcRegister("actions",this.router.bind(o));this.commonContainer.rpcRegister("resize_iframe",this.resizeContainerHeight.bind(o));this.commonContainer.rpcRegister("resize_iframe_width",this.resizeContainerWidth.bind(o));this.commonContainer.rpcRegister("scroll_into_view",this.scrollIntoView.bind(o));this.commonContainer.rpcRegister("get_canvas_dimensions",this.getCanvasDimensions.bind(o));this.commonContainer.rpcRegister("fire_market_events",this.fireMarketEvents.bind(o));this.commonContainer.rpcRegister("build_artifact_markup",this.buildArtifactMarkup.bind(o));this.commonContainer.rpcRegister("host_app_icon",this.uploadAppIcon.bind(o));this.commonContainer.rpcRegister("gather_oauth_credentials",o.gatherOAuthCredentials.bind(o));this.commonContainer.rpcRegister("halt_app",o.gatherCredentials.bind(o));this.commonContainer.rpcRegister("editing_finished",o.editingFinished.bind(o));this.commonContainer.rpcRegister("editing_canceled",o.editingCanceled.bind(o));this.commonContainer.rpcRegister("ee_gadget_rendered",this.eeGadgetRendered.bind(o));gadgets.rpc.registerDefault(function(p){})};this.initActionLinkContext=function(o){this.actionLinkContext={jive:{content:{type:o.coreAPIType,id:o.id}}}};this.renderCanvasView=function(p){var o=this;define(["jive.JAF.CoreContainer.CanvasView"],function(u){i.loadCanvasView(o,u);var r=null;if(p.viewParamsToken!==null){var t=p.viewParamsToken;if(t.view!==null){p.appInstanceView.view=t.view}if(t.params!==null){r=t.params}}if(p.isMarketApp){p.marketContext=o.buildMarketContext(p.appInstanceView,o.canvasView,p.marketInitialToken);p.marketContext=o.canvasView.getEmbeddedContext(p.marketContext.embeddedID);p.marketContext.target.view="default"}var s=shindig.auth.getSecurityToken();var q=function(v){if(!!v){o.model.cacheApp(p.appInstanceView,p.isMarketApp);o.canvasView.render(p.appInstanceView,r,p.marketContext,function(w){})}else{window.location.reload()}};if(s){q(s)}else{o.model.addListener("container.token.refreshed",q)}})};i.loadCanvasView=function(o,p){if(typeof(o.canvasView)=="undefined"){o.canvasView=new p(o.commonContainer,{});jQuery.extend(n,o.canvasView.getActionOriginEnum());o.applyAppReloadHandlers(o.canvasView);o.applyAppAlertHandlers(o.canvasView);o.applyOAuthHandlers(o.canvasView);o.applyRefreshHandlers(o.canvasView);o.applyCredentialsHandlers(o.canvasView);o.canvasView.addListener("app.services.show",function(q){if(o.servicesView&&o.servicesView.isActive()){return}o.servicesView=new f(q,o.commonContainer,o.options);o.model.getAppsMarketApp().addCallback(function(r){o.servicesView.setMarketApp(r);o.canvasView.invokeSettings(o.servicesView,q);o.servicesView.addListener("app.services.close",function(){o.canvasView.destroySettings();if(q.developerModel){o.canvasView.setSparkline(q.developerModel.getMonitorState())}})});o.servicesView.addListener("app.reload",function(){o.reloadApp()})});o.canvasView.addListener("app.canvas.modal.close",function(){delete o.servicesView;if(o.credentialsView){o.credentialsView.cleanup();delete o.credentialsView}o.servicesView=null;o.credentialsView=null;o.oauthView=null})}};i.createConfig=function(p){p=p||{};var o={};o[osapi.container.ServiceConfig.API_PATH]=jive.app.url({path:"/gadgets/api/rpc"});if(typeof(window.__JAF_DEBUG)!=="undefined"&&window.__JAF_DEBUG===1){o[osapi.container.ContainerConfig.RENDER_DEBUG]=true}else{o[osapi.container.ContainerConfig.RENDER_DEBUG]=false}for(var q in osapi.container.ContainerConfig){if(osapi.container.ContainerConfig.hasOwnProperty(q)){if(p.hasOwnProperty(q)){o[q]=p[q]}}}return o};i.router=function(o,p){switch(p){case"bindAction":this.bindAction(o,o.a[1]);break;case"runAction":case"removeAction":case"getActionsByPath":case"getActionsByDataType":case"addShowActionListener":case"addHideActionListener":break}};i.bindAction=function(p,o){if(m[o.id]){var q={};q.actionId=o.id;q.selectionObj=this.commonContainer.selection.getSelection();gadgets.rpc.call(m[o.id],"actions",null,"runAction",q);delete m[o.id]}};i.handleRunAction=function(q,p){if(window._jive_current_user.anonymous||window._jive_current_user.partner){return}var o=this;delete this.postInstallActionRun;this.model.getApp(q.appUUID,q.appInstanceUUID).addCallback(function(r){o.preCacheAppResources(r);r.appURL=typeof(q.appURL)!=="undefined"?q.appURL:r.appURL;r.view=q.view;r.actionHeight=(r.heightByView&&r.heightByView[q.view])||r.height;r.actionWidth=(r.widthByView&&r.widthByView[q.view])||r.width;r.actionLabel=q.label;o.runAction(r,q,p)}).addErrback(function(r){if(r&&q&&q.appUUID){if(console){console.log("App URL passed to market:",q.url)}o.handleMarketContext({experience:"marketapp",appUUID:q.appUUID,embeddedID:q.embeddedID,isDevelopmentApp:q.isDevelopment||false,alternateUrl:q.url});o.postInstallActionRun={actionInfo:q,origin:p}}})};i.runAction=function(r,q,o){var p=this.setSelection(q,o);this.modalView.render(r,q,p,function(s){m[q.actionId]=s.getActiveGadgetHolder().getIframeId()})};i.setSelection=function(q,o){var p;switch(o){case n.CONTENT:break;case n.LINK:p=this.actionLinkContext;break;case n.RTE:p=this.determineContainerContext();p.jive.rte=this.determineRTEContext();if(q.currentArtifact){$j.extend(p,q.currentArtifact)}p.actionId=q.actionId;break}this.commonContainer.selection.setSelection(p);return p};i.determineContainerContext=function(){var q=$j.extend(true,{},this.editContext||this.actionLinkContext);if(jive.discussions&&jive.discussions.instance){q.jive.content.type="osapi.jive.core.Discussion";q.jive.content.id=jive.discussions.instance.getObjectId()}if(this.modalView.getCommentContext()!=null){q.jive.content=$j.extend(this.modalView.getCommentContext().content,{parent:q.jive.content})}else{if(this.modalView.getInboxEntryContext()!=null){q.jive.content=this.modalView.getInboxEntryContext().content}else{if(this.modalView.getActivityStreamContext()!=null){q.jive.content=this.modalView.getActivityStreamContext().content}else{if(jive.advancedComment&&jive.advancedComment.instance){var p=jive.advancedComment.instance.getAppContext();$j.extend(q.jive.content,{id:jive.advancedComment.instance.getObjectId(),parent:{id:p.containerId,type:p.coreAPIType},type:"osapi.jive.core.Message"});$j.extend(q.jive.content,function(r){return r?{inReplyTo:{id:r.id,type:"osapi.jive.core.Message"}}:{}}(jive.advancedComment.instance.getParent()))}else{var o=this.editContext?this.editContext.jive:undefined;o=o||this.actionLinkContext.jive;$j.extend(q.jive,o)}}}}return q};i.determineRTEContext=function(){return this.rteContext};i.maximizeApp=function(p){var o=p[osapi.container.GadgetSite.RPC_ARG_KEY];o.jiveData.mvcView.maximizeApp(o)};i.initPlacePicker=function(q,p){var o=q[osapi.container.GadgetSite.RPC_ARG_KEY];o.jiveData.mvcView.initPlacePicker(p,q.callback)};i.initUserPicker=function(q,p){var o=q[osapi.container.GadgetSite.RPC_ARG_KEY];o.jiveData.mvcView.initUserPicker(p,q.callback)};i.requestNavigateTo=function(q,o,r,s){var p=q[osapi.container.GadgetSite.RPC_ARG_KEY];p.jiveData.app.view=o;p.jiveData.mvcView.requestNavigateTo(p.jiveData.app,p,o,r,s)};i.gatherCredentials=function(q,p){var o=q[osapi.container.GadgetSite.RPC_ARG_KEY];var r=o.jiveData.app;o.jiveData.mvcView.emit("app.credentials.show",{app:r,callback:q.callback,args:p})};i.gatherOAuthCredentials=function(q,p){var o=q[osapi.container.GadgetSite.RPC_ARG_KEY];var r=o.jiveData.app;o.jiveData.mvcView.emit("app.oauth.show",{app:r,callback:q.callback,options:p})};i.requestCoreApiUpload=function(p,r,o,q){o=o||{};new d(this,r,o,q,p.callback)};i.requestCoreApiUploadMediaItem=function(p,r,o,q){this.requestCoreApiUpload(p,r,o,q)};i.setPref=function(p,u,q,r){var o=p[osapi.container.GadgetSite.RPC_ARG_KEY];var t=o.jiveData.app;var s=new a();s.setPref(t.instanceAppID,q,r)};i.setTitle=function(p,r){var o=p[osapi.container.GadgetSite.RPC_ARG_KEY];var q=o.jiveData.app;o.jiveData.mvcView.setTitle(r)};i.editingFinished=function(q,p){var o=q[osapi.container.GadgetSite.RPC_ARG_KEY];var r=o.jiveData.app;if(p&&p.message){o.jiveData.mvcView.emit("app.service.message",{message:p.message})}o.jiveData.mvcView.emit("app.services.close");this.reloadApp()};i.editingCanceled=function(q,p){var o=q[osapi.container.GadgetSite.RPC_ARG_KEY];var r=o.jiveData.app;if(p&&p.message){o.jiveData.mvcView.emit("app.service.message",{message:p.message})}o.jiveData.mvcView.emit("app.services.close")};i.scheduleModalClose=function(o,p){jive.conc.nextTick(function(){var q=function(){o.closeModal(p)};if(jive.Navbar.Menu.Apps.whenAnimationStarts){jive.Navbar.Menu.Apps.whenAnimationStarts().always(q)}else{q()}if(jive.Navbar.Menu.Apps.whenAnimationEnds){jive.Navbar.Menu.Apps.whenAnimationEnds()}})};i.editorInsert=function(s,r){var q=s[osapi.container.GadgetSite.RPC_ARG_KEY];var o=q.jiveData.mvcView;if(typeof(r.html)!=="undefined"&&this.appActionDataPromise){var p=new jive.Apps.RteArtifacts();p.makeArtifactURLsAbsolute(r,q.jiveData.app);this.appActionDataPromise.resolve(r,s,this.options.editedContentBean)}i.scheduleModalClose(o,r)};i.closeApp=function(s,r){var q=s[osapi.container.GadgetSite.RPC_ARG_KEY];var o=q.jiveData.mvcView;if(typeof(r.navigateTo)!=="undefined"){if(/^http(s)?\:\/\//i.test(r.navigateTo)){var t=gadgets.io.getProxyUrl().split("?")[0].replace(/\/gadgets\/proxy/,"");if(!r.navigateTo.startsWith(t)){console.error("Error: Unable to navigation to external URL: "+r.navigateTo);delete r.navigateTo}}}if(typeof(r.data||r.html)!=="undefined"&&this.appActionDataPromise){var p=new jive.Apps.RteArtifacts();p.makeArtifactURLsAbsolute(r.data,q.jiveData.app);this.appActionDataPromise.resolve(r.data,s,this.options.editedContentBean)}i.scheduleModalClose(o,r)};i.sendNotification=function(s,r){var q=s?s[osapi.container.GadgetSite.RPC_ARG_KEY]:null;r=r||{};if(typeof(r.message)!=="undefined"){if(typeof(r.severity)!=="undefined"){r.severity=r.severity.toLowerCase();if(!(r.severity in {error:1,info:1,success:1})){throw"Invalid severity: must be 'error', 'info' or 'success'"}}}if(q){var o=q.jiveData.mvcView;o.sendNotification(r)}else{r=r||{};var t=r.message;var p=r.severity||"info";if(typeof(t)!="undefined"){$j("<p/>").html(t).message({style:p})}}};this.reloadApp=function(o){var q=this;function p(){if(q.modalView){q.modalView.reload(function(s,t){m[t.actionId]=s.getActiveGadgetHolder().getIframeId()})}if(q.canvasView){q.canvasView.reload()}}if(o){p()}else{var r=this.modalView.getRenderedApp()||(this.canvasView&&this.canvasView.getRenderedApp());if(r){r.outdated=true;this.model.getApp(r.appUUID).addCallback(function(s){q.preCacheAppResources(s);p()})}}};this.preCacheAppResources=function(q){var o=q.appUUID;var p=encodeURIComponent(q.appURL);$j("body").append('<iframe src="'+jive.app.url({path:"/gadgets/concatresources"})+"?appId="+o+"&gadget="+p+'" width="1px" height="1px"></iframe>')};this.handleRTEActionSelect=function(q,o,p){this.appActionDataPromise=p;this.rteContext=o;this.modalView.handleCreateActionSelect(q,n.RTE)};this.handleRTEActionContextEdit=function(r,o,s,q){this.appActionDataPromise=q;this.rteContext=o;var p={actionId:r.id,appURL:r.appURL,appInstanceUUID:r.appInstanceUUID,appUUID:r.appUUID,label:r.label,selectionType:"",selectionID:"",view:r.view,currentArtifact:s};this.modalView.handleEditActionSelect(p,n.RTE)};this.handleMarketContext=function(s){var r=this;var q=null;this.appActionDataPromise=$j.Deferred();this.appActionDataPromise.done(function(v,u){if(v){q=$j("#"+u.f);r.fireMarketEventsImpl(v.events,q,u)}});var t=function(){l.emit("market_shown")};var p=function(){l.emit("market_hidden")};var o={};if(typeof s==="string"){o.initialToken=s}else{if(s){o=s}else{o={}}}r.model.getAppsMarketApp().addCallback(function(v){var u=r.buildMarketContext(v,r.modalView,s);r.modalView.render(v,u,null,t,p,o)})};this.buildMarketContext=function(t,s,p){var r=this.buildJiveContextForMarket(p);if(typeof p==="string"){this.hackInitialTokenIntoMarketContext(p,r.market)}var q=s.prepareMarketContext(r);if(p&&p.view){var o=s.getEmbeddedContext(q.embeddedID);if(o){o.target.view=p.view}}return q};this.getMarketEvents=function(){return l};i.buildJiveContextForMarket=function(p){var o=p&&p.embeddedID&&this.modalView.getEmbeddedContext(p.embeddedID);var q=(o&&o.jive)?$j.extend({},o.jive):{};q.market={experience:p.experience||"default"};if(p.appUUID){q.market.appUUID=p.appUUID}if(p.appFilter){q.market.appFilter=p.appFilter}if(p.appShortName){q.market.appShortName=p.appShortName}if(p.isDevelopmentApp){q.market.isDevelopmentApp=p.isDevelopmentApp}if(p.alternateUrl){q.market.alternateUrl=p.alternateUrl}return q};i.hackInitialTokenIntoMarketContext=function(r,q){var o=r.split(";");q.experience=o[0]||"default";for(var p=1;p<o.length;p++){var s=o[p].split("=",2);if(s[1]){if(s[0]=="uuid"){q.appUUID=s[1]}else{if(s[0]=="name"){q.appFilter=s[1]}}}}};this.removeAppFromPage=function(o){this.commonContainer.closeGadget(o)};i.eeGadgetRendered=function(q){var p=q[osapi.container.GadgetSite.RPC_ARG_KEY];if(p){var s=p.currentGadgetHolder_.renderParams_;var r=s.eeDataModel;return r?r.context:null}else{var o=this.modalView.getEmbeddedContext("latest");if(o){return o}else{return{}}}};i.resizeContainerHeight=function(q,o){var p=q[osapi.container.GadgetSite.RPC_ARG_KEY];if(!p){return}p.jiveData.mvcView.resizeContainerHeight(o,true,p)};i.resizeContainerWidth=function(p,q){var o=p[osapi.container.GadgetSite.RPC_ARG_KEY];if(!o){return}o.jiveData.mvcView.resizeContainerWidth(q,true);if(p.callback){p.callback.call()}};i.scrollIntoView=function(p){var o=p[osapi.container.GadgetSite.RPC_ARG_KEY];var r=p.f;var q=p.a[0]||{};o.jiveData.mvcView.scrollIntoView(r,q)};i.getCanvasDimensions=function(r){var q=$j(window);var p=q.width();var s=q.height();var t=$j("#"+r.f);var o=t.parents(".js-app-chrome");if(o.length){p-=(o.outerWidth()-t.innerWidth());s-=(o.outerHeight()-t.innerHeight())}r.callback({width:p,height:s})};i.ensureHasMarketFeature=function(o){if(!$j("#"+o).data("hasMarketFeature")){throw"Unauthorized call to market restricted RPC function"}};i.fireMarketEvents=function(o,p){this.ensureHasMarketFeature(o.f);if(p&&p.events){this.fireMarketEventsImpl(p.events,$j("#"+o.f),o)}};i.fireMarketEventsImpl=function(r,t,p){if(r&&r.length){for(var q=0,o=r.length;q<o;++q){var s=r[q];if(s&&s.eventName){l.emit(s.eventName,s.eventData,t,p)}}}};i.buildArtifactMarkup=function(p,o){j.buildArtifactMarkup(p,o)};i.uploadAppIcon=function(q,p){var o=q?q[osapi.container.GadgetSite.RPC_ARG_KEY]:null;var u=q.callback;var t=o.jiveData.app;var r=p.iconUrl;var s=j.uploadArtifactIcon(r,t.appInstanceUUID);s.addCallback(function(v){u(v)}).addErrback(function(v){if(console){console.log("error uploading "+r,v)}u()})}});return jive.JAF.CoreContainer.Main});