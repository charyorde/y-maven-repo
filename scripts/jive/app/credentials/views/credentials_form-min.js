define("jive.JAF.Configuration.CredentialsForm",["jquery","jive.JAF.Configuration.MsgPoster","jive.JAF.Configuration.Validate","jive.JAF.Configuration.Error"],function(c,a,d,b){return jive.AbstractView.extend(function(e){jive.conc.observable(this);e.init=function(g){var f=this;this.content=g.domTarget;this.approved=[];this.denied=[];this.currentService=1;this.configuredServices=[];this.totalServices=0;this.msg_poster=new a()};this.render=function(g){var f=this;var h=c(jive.apps.configure.renderConfigureCredentialBlocks({credentialsSetupView:g}));this.content.append(h.html());this.servicesCount=g.serviceOptionView.length;if(this.servicesCount<2){this.content.find("#current-service-counter").remove()}else{this.content.find("#current-service").text(this.currentService)}this.processServices(this.content.find(".j-service-block-container:first"))};this.activate=function(){this.content.find(".j-service-focus-hint").first().focus()};e.save=function(){var g=this.content.find(".j-service-block-container:first");var f=g.find(".j-service-block:first");var h=f.attr("data-connectionid");if(this.validate_block(f)){this.approved.push(Number(h));this.process_block(f);this.currentService++;this.content.find("#current-service").text(this.currentService);if(this.currentService<=this.servicesCount){g.hide().next().show()}else{this.postConfigurations()}}};e.process_block=function(g){var h=this;var f={serviceID:g.attr("data-serviceid"),alias:g.attr("data-alias")};f.credentials=h.get_credentials(g);this.configuredServices.push(f)};e.get_credentials=function(g){var f=[];g.find(".j-service-credential").each(function(){f.push({name:this.getAttribute("data-name"),value:this.value})});return f};e.cancel=function(){var g=this.content.find(".j-service-block-container:first");var f=g.find(".j-service-block:first");var h=f.attr("data-connectionid");this.denied.push(Number(h));this.currentService++;this.content.find("#current-service").text(this.currentService);if(this.currentService<=this.servicesCount){g.hide().next().show()}else{this.postConfigurations()}};this.completed=function(){return this.currentService>this.servicesCount};e.processServices=function(g){var j=true;var f=g;var h=this;var i;while(f.length){var k=f.find(".app-config-save");f.find(".app-config-save").click(function(){h.save()});f.find(".app-config-cancel").click(function(){h.cancel()});f.find(".j-service-credential").keypress(function(m){var l=m.which||m.keyCode;if(l===jive.Event.KEY_RETURN){k.click()}});if(j&&f.css("display")!="none"){i=f.find(".j-service-focus-hint");if(i.length){j=false}}f=f.next()}};e.validate_block=function(g){var i=new b();i.clear();var f={};var h=[];g.find(".j-service-error").removeClass("j-service-error");var j=new d(g,f,h);j.work();if(h.length){i.render(f);i.fieldsToVisualMarkers(h)}return h.length==0};e.postConfigurations=function(){if(!this.denied||this.denied.length<1){this.emit("app.credentials_done",{services:this.configuredServices,approved:this.approved,denied:this.denied})}else{this.emit("app.credentials_cancelled")}};this.msgSuccess=function(f){this.msg_poster.post_message("credentials.success","success")};this.msgFailed=function(f){this.msg_poster.post_message("credentials.fail","success")};this.msgCancelled=function(f){this.msg_poster.post_message("credentials.cancel","warn")}})});