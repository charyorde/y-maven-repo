jive.model.PlacesCache=function(e){var g=this;var f=jive.rest.url("/places/types/ordered");var c=jive.rest.url("/places/types/followed");var d=jive.rest.url("/places/followed");var l=jive.rest.url("/places/");var h;var a;this.initCacheData=function(n){a=new jive.ext.y.HashTable();for(var m=0;m<n.length;m++){a.put(n[m].name,new Array())}};this.loadPlacesCache=function(q,o){var p=a.get(o.name).length;for(var n=0;n<q.length;n++){var m=q[n];var r=a.get(m.type.name);r.push(m);a.put(m.type.name,r)}return p};this.doLoadExternalPlaces=function(o){try{var m=o.placesCollection;for(var n=0;n<m.length;n++){var r=m[n].placeType;var p=m[n].places;if(p&&p.length){g.loadPlaces(p,r)}g.notifyLoadPlaces(r)}}catch(q){g.notifyLoadFail()}return null};this.getPlaces=function(m){return a.get(m.name)};var b=false;this.isInitialized=function(){return b};this.loadPlaces=function(n,m){return g.loadPlacesCache(n,m)};this.morePlaces=function(m){g.notifyLoadBegin();if(m.type.name.startsWith("FOLLOWED")){$j.getJSON(d,{page:m.page},function(o){var n=g.loadPlaces(o.place,m.type);if(m.refreshAllFollowedTypes){$j.getJSON(c,function(q){for(var p=0;p<q.placetype.length;p++){g.notifyLoadFinish({type:q.placetype[p],startIndex:0})}})}else{g.notifyLoadFinish(m,n)}})}else{if("COMMUNITY"==m.type.name){$j.getJSON(l+"COMMUNITY",{communityID:m.communityID,page:m.page},function(o){var n=g.loadPlaces(o.place,m.type);g.notifyLoadFinish(m,n)})}else{$j.getJSON(l+m.type.name,{page:m.page},function(o){var n=g.loadPlaces(o.place,m.type);g.notifyLoadFinish(m,n)})}}};this.loadExternalPlaces=function(m){b=true;if(!h){$j.getJSON(f,function(o){h=o.placetype;g.initCacheData(h);return n()})}else{return n()}function n(){if(m){$j.getJSON(l+m.type.name,m,function(o){g.loadPlaces(o.place,m.type);return g.notifyLoadPlaces(m.type)})}else{$j.getJSON(l,function(o){return g.doLoadExternalPlaces(o)})}}};this.doReloadPlaces=function(){$j.getJSON(c,function(n){g.notifyResetPlaces({name:"FOLLOWED_ALL"});for(var m=0;m<n.placetype.length;m++){a.put(n.placetype[m].name,new Array())}g.morePlaces({type:{name:"FOLLOWED_ALL"},page:-1,refreshAllFollowedTypes:true})})};this.reloadPlaces=function(m){if(m.name.startsWith("FOLLOWED")){g.doReloadPlaces()}};this.addListener=function(m){i.push(m)};var i=new Array();var j=0;var k=new Array();this.addListenerAction=function(m){k.push(m)};this.executeListenerActions=function(){while(k.length>0){k[0]();k.splice(0,1)}};this.removeListener=function(n){if(j==0){for(var m=0;m<i.length;m++){if(i[m]==n){i.splice(m,1)}}}else{g.addListenerAction(function(o){return function(){g.removeListener(o)}}(n))}};this.notifyLoadPlaces=function(n){j++;for(var m=0;m<i.length;m++){i[m].loadPlaces(n)}j--;g.executeListenerActions()};this.notifyLoadBegin=function(){j++;for(var m=0;m<i.length;m++){i[m].beginLoadingPlaces()}j--;g.executeListenerActions()};this.notifyLoadFinish=function(n,o){j++;for(var m=0;m<i.length;m++){i[m].doneLoadingPlaces(n,o)}j--;g.executeListenerActions()};this.notifyLoadFail=function(){j++;for(var m=0;m<i.length;m++){i[m].loadingPlacesFailed()}j--;g.executeListenerActions()};this.notifyResetPlaces=function(n){j++;for(var m=0;m<i.length;m++){i[m].resetPlaces(n)}j--;g.executeListenerActions()}};define("jive.model.PlacesCache",function(){return jive.model.PlacesCache});