$j(function(){var g=new jive.Util.AjaxErrorHandler();var i=$j("#jive-nub");var j=$j("#bridge-choose-container");var a=$j("#bridge-choose-content");var d=$j("#bridge-compose-message");var l=$j("#bridge-upload");var b=$j("div.jive-bridge-frame");var c=$j(document);var f={target:"#bridge-choose-container",error:g.handleError,success:m};i.delegate(".jive-nub-link","click",function(){var o=$j(this).attr("id").split("_")[1];if($j(this).hasClass("jive-nub-loaded")){$j("#menu-"+o).slideToggle("fast");$j("#bridge-"+o).toggleClass("jive-nub-selected")}else{$j("#bridge-"+o).addClass("jive-nub-loading");$j("#jive-instance-favicon_"+o).hide();$j("#jive-menu-loading_"+o).show();$j("#jive-bridge-expand").val(o);var n={target:"#menu-"+o,success:function(){$j("#jive-menu-loading_"+o).hide();$j("#menu-"+o).slideToggle("fast");$j("#bridge-"+o).toggleClass("jive-nub-selected");$j("#jive-instance-favicon_"+o).show();$j("#bridge-"+o).removeClass("jive-nub-loading")},error:function(p){$j("#jive-menu-loading_"+o).hide();$j("#jive-instance-favicon_"+o).show();$j("#bridge-"+o).removeClass("jive-nub-loading");$j("#menu-"+o).text("Error loading bridge data");g.handleError(p)}};$j("#jiveBridgeExpandForm").ajaxSubmit(n);$j(this).addClass("jive-nub-loaded")}return false});i.delegate("#bridge-bar-raquo","click",function(n){$j(".bridges-expanded").toggle("fast");$j("#bridge-bar-laquo").show();$j("#bridge-bar-raquo").hide();n.preventDefault()});i.delegate("#bridge-bar-laquo","click",function(n){$j(".bridges-expanded").toggle("fast");$j("#bridge-bar-raquo").show();$j("#bridge-bar-laquo").hide();n.preventDefault()});i.delegate("#relative-selector","click",function(n){$j("#replies-exist").scrollTo({top:"300px",left:"0px"},1000);n.preventDefault()});function m(){var n={target:"#containerlist",error:g.handleError};var o=function(){var p=$j("#container-search-input").val();if(p&&p.length>=2){$j("#search-query-form").ajaxSubmit(n)}};$j("#container-search-input").delayedObserver(o,1);$j("#container-search-input").keypress(function(q){var p=q.which||q.keyCode;if(p==jive.Event.KEY_RETURN){o();q.preventDefault()}})}i.delegate(".jive-nub-discuss","click",function(p){var q=$j(this).attr("id").split("_")[1];var n=$j(document).height();$j("#bridge-overlay_"+q).fadeIn("fast");$j(".jive-bridge-overlay").height(n);$j("#bridge-overlay_"+q).children(".jive-loading-backdrop").fadeIn("slow");$j("#jive-wrapper").addClass("static");$j("#jive-bridge").val(q);var o=$j(this).attr("id").split("_")[2];$j("#jive-remove-objectType").val(o);$j("#jiveBridgeNubForm").ajaxSubmit(f);$j("#jive-nub").hide("fast");$j("#bridge-choose-container").fadeIn("slow");$j("#bridge-overlay_"+q).fadeIn("slow");scroll(0,0);p.preventDefault()});b.delegate(".jive-bridge-close","click",function(){window.location.reload()});l.delegate(".jive-bridge-done","click",function(){window.location.reload()});b.delegate(".jive-help-links","click",function(n){$j(".jive-bridge-help").slideToggle("fast");$j(".jive-help-show").toggle();$j(".jive-help-hide").toggle();n.preventDefault()});j.delegate(".bridge-search-link","click",function(n){$j("#search-query-form").slideToggle("fast");$j("#location-search").toggleClass("jive-search-locations");$j("#location").toggle();$j("#choose-location").toggle();setTimeout(function(){$j("#container-search-input").focus()},500);n.preventDefault()});i.delegate(".jive-indicator-replylist li","hover",function(n){if(n.type==="mouseenter"){$j(this).addClass("hover")}else{$j(this).removeClass("hover")}});j.delegate(".bridge-choose-link","click",function(n){var o=$j(this).attr("id").split("_")[1];$j("#jive-bridge").val(o);$j("#jiveBridgeNubForm").ajaxSubmit(f);$j("#jive-nub").hide();$j("#bridge-choose-container").show();scroll(0,0);n.preventDefault()});j.delegate(".jive-choose-containers-container","click",function(o){var n=$j(this).attr("id").split("_");$j("#jive-choose-container-type").val(n[1]);$j("#jive-choose-container-id").val(n[2]);$j("#jive-choose-container-name").val(n[3]);$j("#jiveBridgeChooseContainerForm").ajaxSubmit({success:function(p){if($j("#jiveBridgeComposeMessageForm",p).length>0){$j("#bridge-compose-message").html(p);$j("#bridge-compose-message").fadeIn("slow");$j("#bridge-choose-content").fadeOut("fast");$j("#bridge-choose-container").hide();$j(".jive-bridge-help").hide();$j(".jive-help-show").show();$j(".jive-help-hide").hide();jive.rte.multiRTE.push("wysiwygbridge");if(typeof(window.editor)=="undefined"){window.editor=new jive.ext.y.HashTable()}buildBridgeRTE()}else{$j("#bridge-choose-content").html(p);$j("#bridge-choose-content").show();$j("#bridge-choose-container").fadeOut("slow");$j("#bridge-choose-container").hide();scroll(0,0);m()}},error:g.handleError});o.preventDefault()});function k(n){n.delegate(".jive-bridge-message","click",function(p){var o=$j(this);$j(this).find(".sel-message").each(function(){var q=$j(this);if(p.target!==this&&!$j(p.target).is("a")){if(q.is(":checked")){q.prop("checked",false)}else{q.prop("checked",true)}}o.toggleClass("selected",q.is(":checked"))})});n.delegate(".jive-message-preview a","hover",function(o){if(o.type=="mouseenter"){$j(this).closest(".jive-bridge-message").find(".jive-message-preview-body").fadeIn("slow")}else{$j(this).closest(".jive-bridge-message").find(".jive-message-preview-body").fadeOut("medium")}});n.delegate(".jive-message-select","click",function(o){if($j(this).attr("id")=="select-all"){n.find("#select-all").hide();n.find("#select-none").show();n.find(".sel-message").each(function(){if(!$j(this).hasClass("original")){$j(this).prop("checked",true);$j(this).closest(".jive-bridge-message").addClass("selected")}})}else{if($j(this).attr("id")=="select-none"){n.find("#select-all").show();n.find("#select-none").hide();n.find(".sel-message").each(function(){if(!$j(this).hasClass("original")){$j(this).prop("checked",false);$j(this).closest(".jive-bridge-message").removeClass("selected")}})}}o.preventDefault()});n.delegate("#jiveBridgeChooseContentForm","submit",function(p){var o=$j(this);$j(".jive-bridge-help").hide();$j(".jive-help-show").show();$j(".jive-help-hide").hide();o.find('input[type="submit"]').prop("disabled",true);o.ajaxSubmit({success:function(r){var q=$j("#jiveBridgeChooseContentForm",r);if(q.length>0){o.replaceWith(q);q.find('input[type="submit"]').prop("disabled",false)}else{$j("#bridge-compose-message").html(r).fadeIn("slow").find('input[type="submit"]').prop("disabled",false);$j("#bridge-choose-content").fadeOut("fast");$j("#bridge-choose-container").hide();jive.rte.multiRTE.push("wysiwygbridge");if(typeof(window.editor)=="undefined"){window.editor=new jive.ext.y.HashTable()}buildBridgeRTE()}},error:g.handleError});p.preventDefault()});n.delegate(".jive-insert-messages","click",function(){var o=$j(".sel-message").fieldValue();var q={bridge:$j("#jive-bridge-reply").fieldValue()[0],object:$j("#jive-bridge-reply-object").fieldValue()[0],contentObjectType:$j("#jive-bridge-reply-contentObjectType").fieldValue()[0],comment:$j("#jive-bridge-reply-comment").fieldValue()[0],selectedReply:o.join(",")};var p=$j("#bridge-reply-select-messages-link").attr("href");$j.post(p,q,function(t){if($j(t).attr("id")=="jive-bridge-choose-reply"){$j("#jive-bridge-choose-reply").replaceWith($j(t))}else{$j(".jive-modal").trigger("close");var s=window.editor.get("wysiwygtext");if(s){s.insertHTMLAtCursor(t)}else{if(jive.rte.multiRTE&&jive.rte.multiRTE.length>0){var r=jive.rte.multiRTE[jive.rte.multiRTE.length-1];s=window.editor.get(r);if(s){s.insertHTMLAtCursor(t)}}}}},"html")})}k(a);a.add(d).delegate("#location-chosen a","click",function(o){var n=$j(this).attr("href");var p=$j(this).closest("#location-chosen");if(p.hasClass("choose-content")){$j("#jiveBridgeChooseContentForm").attr("action",n).ajaxSubmit(f);$j("#bridge-choose-content").hide();$j("#bridge-choose-container").show();scroll(0,0)}else{if(p.hasClass("compose")){$j("#jiveBridgeComposeMessageForm").attr("action",n).ajaxSubmit(f);$j("#bridge-choose-content").hide();$j("#bridge-compose-message").hide();$j("#bridge-choose-container").show();scroll(0,0)}}o.preventDefault()});d.delegate("#messages-selected a","click",function(p){var o={target:"#bridge-choose-content",error:g.handleError};var n=$j(this).attr("href");$j("#jiveBridgeComposeMessageForm").attr("action",n).ajaxSubmit(o);$j("#bridge-compose-message").hide();$j("#bridge-choose-content").show();scroll(0,0);p.preventDefault()});function h(o){if($j("#jiveBridgeComposeMessageForm",o).length>0){var n=window.editor.get("wysiwygbridge");if(typeof(n)!="undefined"){n.killYourself()}$j("#bridge-compose-message").html(o);$j(".jive-bridge-help").hide();$j(".jive-help-show").show();$j(".jive-help-hide").hide();jive.rte.multiRTE.push("wysiwygbridge");if(typeof(window.editor)=="undefined"){window.editor=new jive.ext.y.HashTable()}buildBridgeRTE()}else{if(o.indexOf("jive-body-intro")!=-1){var p="Unexpected form token validation, please close this page and try again";$j("<p />").html(p).message({style:"error"})}else{$j("#bridge-upload").html(o);setTimeout(function(){$j("#done").show("fast");$j("#spaceused1_percentText").hide();$j("#upload-status").show("fast");$j("#progress").removeClass("jive-upload-status");$j("#progress").addClass("jive-upload-status-done");$j("#viewmsg").prop("disabled",false);$j("#viewmsg2").prop("disabled",false);$j("#cancel").hide()},3000)}}}function e(o){var n=validatePost(true,true,"wysiwygbridge");$j(".jive-compose-form-submit").prop("disabled",true);if(n){scroll(0,0);$j("#jiveBridgeComposeMessageForm").ajaxSubmit({beforeSubmit:function(){$j("#bridge-upload").show("fast")},success:function(p){h(p)},error:g.handleError})}else{$j(".jive-compose-form-submit").prop("disabled",false)}o.preventDefault()}d.delegate(".jive-compose-form-submit","click",e);d.delegate("#jiveBridgeComposeMessageForm","submit",e);d.delegate("#jive-content-preview","click",function(o){$j(".preview-toggle span.jive-icon-magnifyingglass").hide();$j("#preview-toggle").addClass("working");var n={target:"#bridge-toggle",success:function(){scroll(0,0);$j("#preview-toggle").removeClass("working");$j(".preview-toggle span.jive-icon-magnifyingglass").show();$j("#jive-preview-modal").lightbox_me({closeSelector:".jive-modal-close-top, .close"})},error:g.handleError};$j("#jiveBridgePreviewMessagesForm").ajaxSubmit(n);o.preventDefault()});c.delegate("#collapsed-thread a","click",function(o){var n=$j(this).closest("#collapsed-thread");$j("#jive-bridge-toggle-section").slideToggle("fast");n.find(".show-content, #showmsgs").toggle();n.find(".hide-content, #hidemsgs").toggle();o.preventDefault()});c.delegate(".jive-bridged-content-deets-link","click",function(o){if($j("#jive-bridged-content-details").hasClass("not-loaded")){var n={target:"#jive-bridged-content-details",success:function(){$j("#jive-bridged-content-details").slideDown("fast");$j("#jive-bridged-content-details").removeClass("not-loaded")},error:g.handleError};$j("#jiveBridgeContentMetaForm").ajaxSubmit(n)}else{$j("#jive-bridged-content-details").slideToggle()}o.preventDefault()});c.delegate(".jive-bridge-explanation","click",function(o){var n=$j("#jive-bridged-content-explanation");if(n.hasClass("not-loaded")){n.slideDown("fast").removeClass("not-loaded")}else{n.slideToggle()}o.preventDefault()});i.find("div.jive-discussion-indicator").effect("bounce",{times:3},300);c.delegate("#jive-quote-help-link","click",function(n){$j(".jive-quote-help").slideToggle("fast");n.preventDefault()});c.delegate(".jive-bridge-reply-item a","click",function(r){var o=$j(this);var n=o.closest(".jive-bridge-reply-item").attr("id").split("_")[1];var q=$j("#jive-bridge-quote-modal");var p,s;$j(".jive-bridge-reply-item").each(function(){var t=$j(this);if(t.data("bridgeID")==n){if(!p){p=t.data("actionUrl")}if(!s){s=t.data("actionData")}}});q.load(p,s,function(){q.lightbox_me({closeSelector:".jive-modal-close, .close"});k(q)});r.preventDefault()})});