jive.gui.PlacesGui=function(m,q,r,h,b,a,t){var i=this;var s=jive.rest.url("/places/view");var v=jive.rest.url("/places/filter");var n=jive.rest.url("/places/search/");t.addListener(i);var d="spaces";if("HOMEPAGE"==h){d="spaces;"}else{if(b){d=b;if("search"==b){setTimeout(function(){$j(".jive-widget-places-search input:text:visible:enabled:first").focus()},500)}}else{d="yours"}}var j=false;var A=$j("#jive-accordion-container_"+q+" [id^='jive-accordion-toggle-']").map(function(){var C=this.id.substring("jive-accordion-toggle-".length);if(C==d){j=true}return C});console.log(d,j,A);if(!j){d=A[0]}console.log(d);$j("#jive-accordion-container_"+q).accordion({active:"#jive-accordion-toggle-"+d,change:function(D,C){if(C.newHeader.attr("id")=="jive-accordion-toggle-search"){$j("#jive-accordion-toggle-search").next().find("input:text:visible:enabled:first").focus()}}});$j("#jive-accordion-container_"+q).each(function(){$j(this).find(".jive-accordion-places-filter").find(".jive-places-filter-entry").each(function(){var D=$j(this).attr("id").split("_");var C=D[0]+"_"+D[1];$j(this).click(function(){i.filterPlaces($j(this),C);$j.post(v,{id:C});return false})});$j(this).find(".jive-accordion-content").find(".jive-scrollable").scroll(function(){i.scroller($j(this))})});var y=function(){$j("#container-search-input_"+q).val("");$j("#jive-places-search-results_"+q).hide();return false};var u=function(){var C=$j("#container-search-input_"+q).val();if(C.length>1){$j("#jive-search-loading_"+q).show();$j("#jive-places-search-results_"+q).hide();var D={showDescription:false};$j.getJSON(n+C,D,function(E){var F=new JiveContainerAutoComplete(C,"","","","","#places_search_"+q,"","false",r.get("widget.places.noresults.text"));F.clearPlaces();F.loadExternalPlaces(E);$j("#jive-search-loading_"+q).hide();$j("#jive-places-search-results_"+q).show()})}if(C.length<1){y()}};$j("#container-search-input_"+q).delayedObserver(u,0.5);$j("#container-search-input_"+q).keypress(function(D){var C=D.which||D.keyCode;switch(C){case jive.Event.KEY_RETURN:u();D.preventDefault();break}});this.loadPlaces=function(C){if(C.name.match(/^FOLLOWED/)){i.populatePlaces()}else{i.populateContainers(C)}};this.beginLoadingPlaces=function(){};this.doneLoadingPlaces=function(E,H){if(E.type.name=="COMMUNITY"){var C=t.getPlaces(E.type);var D=C.slice(H,C.length);if(E.communityID<=1){i.populateSpaces(D,$j("#COMMUNITY_list_"+q))}else{i.populateSpaces(D,$j("#places-spaces-list_"+q+"_"+E.communityID))}if(E.slide&&E.widgetID==q){var F;if(E.parentID<=1){F=$j("#slider-root_"+q)}else{F=$j("#slider-sub_"+q+"_"+E.parentID)}var G=$j("#slider-sub_"+q+"_"+E.communityID);i.slideForward($j("#place-space-list-entry_"+q+"_"+E.communityID),F,G)}}else{var C=t.getPlaces(E.type);var D=C.slice(H,C.length);i.addListEntries(D,$j("#"+E.type.name+"_list_"+q))}};this.loadingPlacesFailed=function(){};this.slideReset=function p(){$j(".jive-slider-sub").hide();$j(".jive-slider-sub").css({left:"200px"});$j(".jive-slider-root").css({left:"0px"});$j(".jive-slider-root").show()};this.slideReset=function p(){$j(".jive-slider-sub").hide();$j(".jive-slider-sub").css({left:"200px"});$j(".jive-slider-root").css({left:"0px"});$j(".jive-slider-root").show()};function w(D){var C=158.25;var E=0.75;return C+(D.width()*E)}this.slideForward=function l(G,D,C){var E=D.width(),F=w(D);C.css({left:E});D.animate({left:(-1*E)},F,function(){$j(this).hide()});C.show().animate({left:"0px"},F)};this.slideBack=function k(F,C,D){var E=w(C);F.parent().addClass("");C.animate({left:"225px"},E,function(){C.hide()});D.show().animate({left:"0px"},E)};this.filterPlaces=function f(D,C){D.parents(".jive-accordion-places-filter").find("li a").removeClass("selected");D.parents("div.jive-accordion-content").find("ul.yourplaces").hide();D.addClass("selected");$j("#"+C+"_list_"+q).show()};if(a){$j("#jive-accordion-container_"+q).find(".jive-accordion-places-filter").find(".jive-places-filter-entry").each(function(){var D=$j(this).attr("id").split("_");var C=D[0]+"_"+D[1];if(a==C){i.filterPlaces($j(this),C)}})}this.populatePlaces=function e(){$j("#jive-widget-places-yours_"+q).find(".jive-scrollable").each(function(){var E=$j(this).attr("id").split("_");var D=E[0]+"_"+E[1];var C=t.getPlaces({name:D});if(!C||C.length==0){$j(this).append('<li><p class="empty">'+r.get(D)+"</p></li>")}else{i.addListEntries(t.getPlaces({name:D}),$j(this))}})};this.populateContainers=function o(D){if(D.name=="COMMUNITY"){var C=t.getPlaces(D);if(!C||C.length==0){$j("#COMMUNITY_list_"+q).append('<li><p class="empty">'+r.get(D.name)+"</p></li>")}else{i.populateSpaces(t.getPlaces(D),$j("#COMMUNITY_list_"+q))}}else{var C=t.getPlaces(D);if(!C||C.length==0){$j("#"+D.name+"_list_"+q).append('<li><p class="empty">'+r.get(D.name)+"</p></li>")}else{i.addListEntries(t.getPlaces(D),$j("#"+D.name+"_list_"+q))}}};this.populateSpaces=function c(C,E){for(var H=0;H<C.length;H++){var D=C[H];if(E.find("#place-space-list-entry_"+q+"_"+D.ID).length>0){return false}var G=$j("<li id='place-space-list-entry_"+q+"_"+D.ID+"' class='place-space-list-entry clearfix'></li>");G.append(i.createObjectLink(D));if(D.parent=="true"||D.parent==true){var F=r.get("VIEW_SUBSPACES_MESSAGE");var I=$j("<a href='#' class='jive-slider-link' id='jive-slider-link_"+D.id+"' title='"+F+" "+D.name+"'>"+F+"<span class='jive-icon-med jive-icon-arrow-right'></span></a>");I.bind("click",D,function(Q){var L=Q.data;if($j("#jive-space-slider_"+q).find("#slider-sub_"+q+"_"+L.ID).length>0){var N;if(L.parentID<=1){N=$j("#slider-root_"+q)}else{N=$j("#slider-sub_"+q+"_"+L.parentID)}var P=$j("#slider-sub_"+q+"_"+L.ID);i.slideForward($j("#place-space-list-entry_"+q+"_"+L.ID),N,P);return false}else{var O=$j("<div class='jive-slider-sub' id='slider-sub_"+q+"_"+L.ID+"' style='display: none'></div>");$j("#jive-space-slider_"+q).append(O);var J=$j("<span class='jive-space-current'><strong>"+L.name+"</strong></span>");var K=$j("<a href='#' class='jive-slider-link jive-slider-link-back' title='Back'><span class='jive-icon-med jive-icon-arrow-left'></span>"+r.get("BACK_TEXT")+"</a>");K.click(function(){var R;if(L.parentID<=1){R=$j("#slider-root_"+q)}else{R=$j("#slider-sub_"+q+"_"+L.parentID)}i.slideBack(K,O,R);return false});J.append(K);O.append(J);var M=$j("<ul id='places-spaces-list_"+q+"_"+L.ID+"' class='j-place-list clearfix'></ul>");O.append(M);M.scroll(function(){i.scroller($j(this))});t.morePlaces({type:L.type,page:0,communityID:L.ID,parentID:L.parentID,slide:true,widgetID:q});return false}});G.append(I)}E.append(G)}};this.addListEntries=function g(C,E){for(var G=0;G<C.length;G++){var D=C[G];var F=$j("<li class='clearfix'></li>");F.append(i.createObjectLink(D));E.append(F)}};this.createObjectLink=function x(D){var C=$j("<a href='"+D.objectURL+"' class='jivecontainerTT-hover-container' data-objectId='"+D.ID+"' data-objectType='"+D.objectType+"'></a>");var F=$j("<span class='jive-places-name'></span>");F.text(D.name);var G=$j("<span class='jive-icon-med "+D.iconCssClass+"'></span>");C.append(G);C.append(F);if(D.visibleToPartner){var E=$j("<span class='jive-icon-med jive-icon-partner' title='"+r.get("partner.browse.ext_access")+"'></span>");C.append(E)}return C};this.scroller=function z(E){if(E[0].scrollHeight-E.scrollTop()==E.outerHeight()){var G=E.find("li").length;if(G%30==0){var C=E.attr("id");var F;if(C.match(/^FOLLOWED/)){var I=C.split("_");F=I[0]+"_"+I[1]}else{F=C.split("_")[0]}var D=-1;if(E.parent().attr("id").match(/^slider-sub_/)){D=E.parent().attr("id").split("_")[2];F="COMMUNITY"}var H=G/30;t.morePlaces({type:{name:F},page:H,communityID:D,parentID:-1})}}};this.resetPlaces=function B(C){if(C.name.match(/^FOLLOWED/)){$j("#jive-widget-places-yours_"+q).find(".jive-scrollable").each(function(){$j(this).empty()})}}};define("jive.gui.PlacesGui",function(){return jive.gui.PlacesGui});