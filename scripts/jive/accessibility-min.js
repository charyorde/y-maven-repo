jive.namespace("Accessibility");jive.Accessibility=jive.oo.Class.extend(function(b){b.init=function d(f){var g=this;this.hotkeys={};f=$j.extend({},{hoverSelection:false,focusableSelector:jive.Accessibility.DEFAULT_FOCUSABLE_SELECTOR,focusOnHover:true},f);this._$keydownScope=$j(f.scope);if(f.hotkeys){$j.each(f.hotkeys,function(){var h=this;g.addHotkey(h.ch,h.ctrl,h.alt,h.shift,h.action)})}if(f.otherActions){this._$keydownScope.on("keydown.jiveAccess",function(k){if(b.isTextField(k.target)){return}for(var j=0;j<f.otherActions.length;++j){var h=f.otherActions[j](k);if(h===false){return false}}})}if(f.hoverSelection){this._$keydownScope.on("mousemove.jiveAccess",function(i){var h=$j(i.target).closest(f.focusableSelector);g._$keydownScope.find("."+jive.Accessibility.SELECTED_CLASS).removeClass(jive.Accessibility.SELECTED_CLASS);h.addClass(jive.Accessibility.SELECTED_CLASS);if(f.focusOnHover){h.focus()}})}};this.teardown=function(){this._$keydownScope.off("keydown.jiveAccess mousemove.jiveAccess")};var c=navigator.userAgent.indexOf("Mac")!=-1;this.addHotkey=function a(i,k,l,g,j){if(typeof i!="string"||!/^[a-z]$/i.test(i)){throw new Error("hotkeys require an alphabet character")}if(!this._hotkeyHandler){this._hotkeyHandler=this.hotkeyHandler.bind(this);this._$keydownScope.on("keydown.jiveAccess",this._hotkeyHandler)}var f={ctrl:!!k,alt:!!l,shift:!!g,charCode:i.charCodeAt(0),keyCode:i.toUpperCase().charCodeAt(0),action:j};var h=(f.shift?"shift+":"")+(f.ctrl?"ctrl+":"")+(f.alt?"alt+":"")+i.toUpperCase();this.hotkeys[h]=f};b.isTextField=function(f){return $j(f).filter('textarea, input, *[contentEditable="true"]').not("input[type=radio], input[type=checkbox], input[type=submit], input[type=file], input[type=image], input[type=reset], input[type=button]").length>0};b.hotkeyHandler=function e(g){if(!(g.metaKey||g.ctrlKey||g.altKey)&&this.isTextField(g.target)){return}var f="";if(g.shiftKey){f+="shift+"}if((c&&g.metaKey)||g.ctrlKey){f+="ctrl+"}if(g.altKey){f+="alt+"}f+=String.fromCharCode(g.keyCode);if(this.hotkeys[f]){this.hotkeys[f].action(g)}}});jive.Accessibility.filterFocusable=function filterFocusable(a){return a.filter(":visible").not(":disabled")};jive.Accessibility.DEFAULT_FOCUSABLE_SELECTOR="a, input, select, textarea, button";jive.Accessibility.SELECTED_CLASS="j-selected";jive.Accessibility.focusAction=function(a){return function b(){$j(a).focus()}};jive.Accessibility.clickAction=function(c,b){return function a(){if(!b){b=c}$j(b).focus();$j(c).click()}};jive.Accessibility.focusRingAction=function(a,c){if(!c){c=jive.Accessibility.DEFAULT_FOCUSABLE_SELECTOR}function d(){return jive.Accessibility.filterFocusable($j(a).find(c))}return function b(k){if(65<=k.keyCode&&k.keyCode<=90){var j=d(),h=String.fromCharCode(k.keyCode),g,f,e=j.index($j(a).get(0).ownerDocument.activeElement);if(e>=0){for(g=(e+1)%j.length;g!=e;g=(g+1)%j.length){f=j.eq(g);if(f.text().charAt(0).toUpperCase()==h){f.focus();return false}}}else{for(g=0;g<j.length;++g){f=j.eq(g);if(f.text().charAt(0).toUpperCase()==h){f.focus();return false}}}}}};jive.Accessibility.menuSelectAction=function(a,d,c){if(!d){d=jive.Accessibility.DEFAULT_FOCUSABLE_SELECTOR}function e(){return jive.Accessibility.filterFocusable($j(a).find(d))}return function b(h){if($j(h.target).is("select, input:radio, input:text, textarea")){return}if(h.keyCode==38||h.keyCode==40||h.keyCode==9){var g=e(),f,i=g.find("."+jive.Accessibility.SELECTED_CLASS);if(i.length==0){i=$j(a).get(0).ownerDocument.activeElement}f=g.index(i);g.removeClass(jive.Accessibility.SELECTED_CLASS);if(h.keyCode==38||(h.keyCode==9&&h.shiftKey)){if(f<=0){f=g.length-1}else{f-=1}}else{if(f==g.length-1){f=0}else{f+=1}}g.eq(f).addClass(jive.Accessibility.SELECTED_CLASS);if(c){g.eq(f).focus()}return false}}};jive.Accessibility.main=new jive.Accessibility({scope:"body"});