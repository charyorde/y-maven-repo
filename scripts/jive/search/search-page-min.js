(function(d,g){var n=jive.search,p=jive.locationState,e,o=0,c={content:null,people:null,places:null},b=new jive.search.SearchParams(jive.locationState.getState()),s={},z=false,a=false,x=new jive.search.SearchMetrics("search-page"),f=jive.search.SearchMetricsQuery;function r(){var C=location.pathname.split("/").pop();if(!b.getParam("q")&&C!=="search.jspa"){b.setParam("q",C)}}r();function i(E,C,D){var F=D==="abort"||(E.status===0&&D==="");if(!F){console.error(D);var G=jive.error.rest.soy.errorFinding({href:window.location});d(G).message({style:"error"})}}function v(C){return d("<div></div>").text(C||"").html()}function B(F){var C=F.replace(/\+\d+/,"Z");var E=new Date(C);if(isNaN(E.getTime())){var D=C.replace(/-/,"/").replace("T"," ").replace(/\.\d+Z/," GMT");E=new Date(D)}return E}function k(D,C){if(D=="content"){if(C.type=="file"&&C.binaryURL){C.extension=C.binaryURL.split(".").slice(-1).join(".").toLowerCase()}C.displayExternalAccess=(!_jive_current_user.partner)&&C.visibleToExternalContributors;C.summary=C.highlightBody;C.subject=C.highlightSubject||v(C.subject);C.publishedDate=B(C.published).getTime();C.updatedDate=B(C.updated).getTime();if(C.author&&!C.author.displayName){C.author.displayName=C.author.name.formatted||C.author.jive.username}}else{if(D=="people"){if(C.emails&&C.emails instanceof Array&&C.emails.length>0&&C.emails[0].value){C.email=C.emails[0].value}if(C.jive&&C.jive.profile&&C.jive.profile instanceof Array){d(C.jive.profile).each(function(E,F){if(F.jive_label=="Title"){C.title=F.value}else{if(F.jive_label=="Department"){C.department=F.value}}})}C.displayExternalContributor=(!_jive_current_user.partner)&&C.jive&&C.jive.externalContributor;C.displayOrgChart=!_jive_current_user.partner&&!C.displayExternalContributor;if(!C.displayName){C.displayName=C.name.formatted||C.jive.username}if(C.highlightSubject){C.displayName=C.highlightSubject}}else{if(D=="places"){if(C.type=="project"){if(C.projectStatus=="MEDIUM"){C.projectStatus="med"}else{if(C.projectStatus){C.projectStatus=C.projectStatus.toLowerCase()}}}C.description=C.highlightBody||v(C.description);C.name=C.highlightSubject||v(C.name);C.displayExternalAccess=(!_jive_current_user.partner)&&C.visibleToExternalContributors;if(C.type=="space"){C.typeid=14}else{if(C.type=="group"){C.typeid=700}else{if(C.type=="project"){C.typeid=600}else{if(C.type=="blog"){C.typeid=37}}}}}}}}function l(E,D){var C={view:E,results:[]};if(D.data){d(D.data).each(function(G,F){k(E,F)});C.results=D.data}else{if(D.list){d(D.list).each(function(G,F){k(E,F)});C.results=D.list}}return C}function y(C){return{id:C.id,type:C.type}}function m(){var G=b.getParam("facet");var C;var D=d(".j-column-l").offset().top;if(d(window).scrollTop()>D){d(window).scrollTop(D)}if(c[G]){x.getQuery("main").abort();c[G].abort()}if(b.getParam("q").replace(/\s+/,"")===""){d("#j-main-results ol").html(jive.search.noResults({}));return}d("#j-main-results ol").html(jive.search.loadingBar());var F=new jive.loader.LoaderView({size:"small",showLabel:false});F.appendTo("#j-main-results li.j-loading-bar .j-loading-content");var E=n.query(G,b.getSearchParams()).then(function(J){o=1;if(J.suggestedQuery){J.suggestedQuery=J.suggestedQuery.replace(/^search\(|\)$/g,"")}c[G]=null;C.addResults(J.list.map(y)).setReturnedDate(E.returnedDate);try{var H=l(G,J);var I=jive.search.searchResults(H);d("#j-main-results").html(I)}catch(K){i(null,null,K);d("#j-main-results ol").html({})}A();if(d("#j-main-results li").length){if(e.next){d("#j-main-results li.j-loading-bar").html(jive.search.loadMore())}else{d("#j-main-results li.j-loading-bar").html(jive.search.noMore());if(o===1&&J.suggestedQuery){d("#j-main-results ol").prepend(jive.search.noResults(J))}}}else{d("#j-main-results ol").html(jive.search.noResults(J))}},function(J,H,I){if(I!=="abort"){d("#j-main-results ol").html(jive.search.noResults({}));i(J,H,I)}});c[G]=e=E;C=new f(E.query,E.sentDate);x.addQuery(C,"main")}function j(G,D){var E;if(c[G]){x.getQuery("alt"+D).abort(true);c[G].abort()}var C={count:6,filter:b.getFormattedFilter("q")};d("div.j-search-results-aside > div").eq(D).html("");if(b.getParam("q").replace(/\s+/,"")===""){return}var F=n.query(G,C).then(function(J){var K=c[G];delete c[G];E.addResults(J.list.map(y)).setReturnedDate(K.returnedDate);var H=l(G,J);var I=jive.search.altSearchResults(H);d("div.j-search-results-aside > div").eq(D).html(I)},i);c[G]=F;E=new f(F.query,F.sentDate);x.addQuery(E,"alt"+D)}function h(){d("#j-communities dd[data-id]").each(function(){var E=d(this);var D=E.data("id");var C=d("#j-engine-results-"+D);C.find("ol").html(jive.search.loadingBar());var F=new jive.loader.LoaderView({size:"small",showLabel:false});F.appendTo(C.find("li.j-loading-bar .j-loading-content"));OpenSearchQuery.getSearchResultsByEngineID(D,b.getParam("q"),{callback:function(G){G.results.forEach(function(H){H.lastUpdatedDate=H.lastUpdatedDate.getTime();H.publishedDate=H.publishedDate.getTime()});if(G.results.length){G.name=E.data("name");G.url=E.data("url").replace("{searchTerms}",decodeURIComponent(b.getParam("q")));E.find(".j-name").text(G.name+" ("+G.totalItemCount+")");C.html(jive.search.openSearchResults(G))}else{C.find("ol").html(jive.search.noResults({}))}},errorHandler:function(H,G){console.error(H);C.find("ol").html(jive.search.noResults({}))}})})}function w(C){t();m();if(C){var D=b.getParam("facet");if(D!=="content"){j("content",0)}if(D!=="people"){j("people",D==="content"?0:1)}if(D!=="places"){j("places",1)}h()}}function u(){var D=b.getParam("facet");if(c[D]||!e||!e.next){return}d("#j-main-results li.j-loading-bar").remove();d("#j-main-results ol").append(jive.search.loadingBar());var C=new jive.loader.LoaderView({size:"small",showLabel:false});C.appendTo("#j-main-results li.j-loading-bar .j-loading-content");e=e.next().then(function(G){o+=1;c[D]=null;x.getQuery("main").incPage().addResults(G.list.map(y));var E=l(D,G);var F=jive.search.searchResults(E);d("#j-main-results li.j-loading-bar").before('<li class="j-divider"></li>');d("#j-main-results li.j-loading-bar").before(d(F).find("li:not(.j-loading-bar)"));d("#j-main-results li.j-loading-bar").html(e.next?jive.search.loadMore():jive.search.noMore())},i);c[D]=e}function q(H,G,D,F){var E;function C(){var I={};I[G]=s[E];d(D).next("ul").remove();d(F(I)).insertAfter(d(D).hide()).data("filter",H)}if(b.getParam(H)){E=b.getParam(H);if(!s[E]){d.getJSON(jive.search.getBaseUrl()+E).then(function(I){s[E]=I;C();A()})}else{C()}}else{d(D).next("ul").remove();d(D).show()}}function A(){var E={q:b.getParam("q")};if(b.getParam("facet")!=="content"){E.view=b.getParam("facet")}if(b.getParam("after")){E.dateRange={day:"yesterday",week:"last7days",month:"last30days",quarter:"lastyear",year:"lastyear"}[b.getParam("after")]}if(b.getParam("nameonly")){E.peopleNameOnly="true"}if(b.getParam("type")){E.resultTypes=b.getParam("type")}if(b.getParam("author")){E.userID=b.getParam("author").split("/").pop()}if(b.getParam("place")&&s[b.getParam("place")]){var D=s[b.getParam("place")];E.containerName=D.displayName}var C=jive.app.url({path:"/community/feeds/search"})+"?"+d.param(E);d("#j-main-results .j-search-rss-link a").attr("href",C)}function t(){d("#j-search-input").val(b.getParam("q")||"");var C=b.getParam("facet");d("html").removeClass("j-content j-people j-places").addClass("j-"+C);document.title=(b.getParam("q")||"[empty search]")+" | "+document.title.split(" | ").pop();d("#sort").val(b.getParam("sort"));d("div.j-column-s ul[data-param]").each(function(){var E=d(this);var D=E.data("facet");if(D&&D!==C){return}var G=E.data("param");var F=b.getParam(G);if(F){E.find("li[data-value="+F.replace(/ /g,"-")+"]").addClass("j-active").siblings().removeClass("j-active")}else{E.find("li[data-value]:first").addClass("j-active").siblings().removeClass("j-active")}});d("div.j-column-s :checkbox").each(function(){var E=d(this);var F=E.attr("name");var D=E.val();E.prop("checked",b.getParam(F)===D)});A();q("author","user","#author",jive.search.facets.selectedUserAutocomplete);q("place","place","#place",jive.search.facets.selectedPlaceAutocomplete)}p.addListener("change",function(C){if(!z){a=true;b.setUrlParams(C);r()}else{z=false}});b.addListener("change",function(){if(!a){if(!b.matches(p.getState())){z=true;p.setState(b.getUrlParams())}}else{a=false}w(b.getUpdateAll())});d(function(){d("#j-search-form").submit(function(H){H.preventDefault();var I=d("#j-search-input").val();if(b.getParam("q")===I){w()}else{b.setParam("q",d("#j-search-input").val())}});d("#j-communities img").bind("error",function(){d(this).replaceWith('<span class="j-favicon-placeholder j-rc4"></span>')});d.ajaxSetup({dataFilter:function(I,H){return I.replace(/^throw [^;]*;\n/,"")}});d.fn.setupAutocomplete=function(H){this.suggest(H.url,{attachObject:d("#autocomplete-results").appendTo("body").css("z-index",10000),paramName:"filter",liClass:"user-autocomplete-item clearfix",minchars:2,extraParams:{count:"6"},transformParams:function(I){I.filter="search("+I.filter.replace(/\*?$/,"*")+")"},transformData:function(K){var J=K.list;J.forEach(function(L){L.url=L.resources.self.ref.split(n.getBaseUrl()).pop()});var I=d(H.template({results:J}));return d.makeArray(I.find("li")).map(function(L){return[d(L).html()]})},onSelect:function(J,L){var I=d(L);var K=I.data();K.avatarHtml=I.find("span").remove().end().html();s[K.url]=K;b.setParam(H.type,K.url);d(this).val("")}})};d("#author").setupAutocomplete({type:"author",url:n.getUrl("people"),template:jive.search.facets.userAutocomplete});d("#place").setupAutocomplete({type:"place",url:n.getUrl("places"),template:jive.search.facets.placeAutocomplete});d("a.j-searchtips-link").click(function(H){H.preventDefault();d(jive.search.helpTips()).lightbox_me({destroyOnClose:true})});d("div.j-autocomplete-options").delegate("a.remove","click",function(I){I.preventDefault();var H=d(this).closest("ul").data("filter");b.removeParam(H)});d("div.j-column-s").delegate("li[data-value] a","click",function(H){H.preventDefault();var J=d(this).closest("ul").data("param");var I=d(this).closest("li").data("value").replace(/-/g," ");if(I==="all"){I=""}b.setParam(J,I)});d("div.j-column-s :checkbox").change(function(H){H.preventDefault();var J=d(this).attr("name");var I=d(this).val();if(d(this).prop("checked")){b.setParam(J,I)}else{b.removeParam(J,I)}});d("div.j-search-results-aside-container").delegate(".j-view-more a","click",function(H){H.preventDefault();var I=d(this).closest(".j-view-more").data("facet");b.setParam("facet",I)});d("#sort").change(function(){b.setParam("sort",d(this).val())});d("#j-main-results").delegate(".j-disambiguation a","click",function(H){H.preventDefault();b.setParam("q",d(this).text())});d("#j-main-results").delegate("li.j-loading-bar a","click",function(H){H.preventDefault();u()});d("#j-main-results, .j-search-results-aside").delegate("a","click",function(M){var K=d(this);var H=K.closest("li");var L=H.find(".j-search-result-value");if(!L.length){return}var J=K.get(0)!==L.get(0)?K.attr("href"):g;var I=H.prevAll(".j-search-result").length;var N="main";if(!d(this).closest("#j-main-results").length){var O=d(this).closest("div.j-alternate-search").prevAll().length;N="alt"+O}x.setChoice(N,I,J)});d(window).load(function(){C()});d(window).resize(function(){C()});d(window).scroll(function(){if(o<3&&d(window).scrollTop()>=d(document).height()-d(window).height()-100){u()}C()});var G=d("div.j-search-container");var F=d("div.j-column-content");var E=G.offset().top;var D=d("body").height()-d(".j-body-main").outerHeight()-d(".j-body-main").offset().top;function C(){var I=d(window).scrollTop();var L=d(".j-search-results-main").height()===860;var H=Math.max(G.outerHeight(),F.outerHeight());if(!L&&I>=E&&H<d(window).height()-D){d("body").addClass("fixed");var J=d(".j-search-results-main-container");var K=d(".j-search-results-aside-container > *:first");d(".j-search-container").css({left:J.offset().left+1,right:d(window).width()-K.offset().left-K.width()})}else{d("body").removeClass("fixed");d(".j-search-container").css({left:"",right:""})}}d("#j-communities a").click(function(J){J.preventDefault();var I=d(this).closest("dd");if(I.is(".j-active")){return}var L=I.data("id");I.addClass("j-active").siblings(".j-active").removeClass("j-active");var H=".j-facets, .j-sub-facets, .j-sort-attr";var K="div.j-search-results-aside > div";if(L){d(H).hide();d(K).hide();d("#j-engine-results-"+L).show().siblings().hide()}else{d(H).css("display","");d(K).css("display","");d("#j-main-results").show().siblings().hide()}});w(true)})})(jQuery);