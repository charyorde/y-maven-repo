jive.namespace("search");jive.search.arrived=new Date().getTime();jive.search.SearchMetrics=jive.oo.Class.extend(function(a){var b=jQuery;a.init=function(d){this.data={name:d,referrer:document.referrer,pageArriveDate:jive.search.arrived,pageLeftDate:undefined,queries:[]};this.byName={};var c=this;b(window).on("beforeunload",function(){c.data.pageLeftDate=new Date().getTime();if(c.data.queries.length){c.commit(true)}})};this.commit=function(c){var d=JSON.stringify(this);return b.ajax({type:"POST",url:jive.app.url({path:"/api/core/v3/search/monitor"}),data:d,async:!c,contentType:"application/json",dataType:"json"})};this.addQuery=function(d,c){this.data.queries.push(d);if(c){this.byName[c]=d;if(c.slice(0,3)==="alt"){d.isAlternate=true}}return this};this.getQuery=function(c){return this.byName[c]};this.forEachCurrent=function(d){for(var c in this.byName){if(this.byName.hasOwnProperty(c)){d(this.byName[c],c)}}return this};this.setChoice=function(f,e,d){var g=this.byName[f];var c=g.getResult(e);g.setChoice({index:e,item:c,clickedUrl:d,date:new Date().getTime()});return this};this.toJSON=function(){return this.data}});jive.search.SearchMetricsQuery=jive.oo.Class.extend(function(a){a.init=function(c,b){this.data={query:c||"",sentDate:b||new Date().getTime(),returnedDate:undefined,results:[]}};this.addResults=function(b){var c=this.data.results;c.push.apply(c,b);return this};this.getResult=function(b){return this.data.results[b]};this.forEachResult=function(d){var c=this.data.results;for(var b in c){if(c.hasOwnProperty(b)){d(c[b],b)}}return this};this.setReturnedDate=function(b){this.data.returnedDate=b;return this};this.incPage=function(){this.data.pagesLoaded=(this.data.pagesLoaded||0)+1;return this};this.abort=function(){this.data.aborted=new Date().getTime();return this};this.setChoice=function(b){this.data.choice=b;return this};this.toJSON=function(){return this.data}});