function processLabels(f,d){var b=d.find("select.jive-labels-shadow");var a=b.attr("name");var e;for(var c=0;c<f.length;c++){if(f[c].name==a){e=f[c];break}}if(!e){f.push({name:a,value:""})}else{e.value=b.find("option").map(function(){return $j(this).val().split("|")[0]}).get().join(",")}}function deserializeLabels(a,b){var c=b?$j(b):$j(document);$j("select.jive-favorite-labels option:not([value=ignore]):not([value=create])").remove();$j("select.jive-labels-shadow option").remove();$j(".mini-label-list li:visible").remove();$j.each(a,function(d,e){if(e.active){c.find("select.jive-labels-shadow").append($j("<option selected='selected' value='"+e.id+"|"+e.color+"'>"+e.value+"</option>"));c.find(".mini-label-list li:has(input)").before($j("<li class='"+e.color+"'><span class='id' style='display:none'>"+e.id+"</span><span class='color'></span><span class='label_text li_text'>"+e.value+"</span>&nbsp;</li>"))}else{c.find(".jive-favorite-labels :first").after($j("<option value='"+e.id+"|"+e.color+"'>"+e.value+"</option>"))}})}$j(function(){if(window.___labelsInitializedByJive){return}var c="<a class='delete_label' href='#'>X</a>";function f(){$j("select.jive-labels").siblings("ul.mini-label-list").find("li:visible").filter(function(){return $j(this).children("a").length<=0}).append($j(c).bind("click",e));$j.each($j("select.jive-labels"),a)}var b=[{name:"green"},{name:"orange"},{name:"red"},{name:"blue"},{name:"purple"},{name:"grey"},{name:"pink"},{name:"black"}];$j(".jive-edit-label-form .color_picker").livequery("click",function(){var g=$j(this).parent().siblings(".color_array");if(g.is(":visible")){g.hide()}else{if(g.is(":empty")){$j.each(b,function(h,j){var k=$j("<span class='color "+j.name+"'></span>");k.click(function(){var i=$j(this).parents(".jive-edit-label-form");i.find(".color_picker span.color").removeClass().addClass("color").addClass(j.name);i.find(".color_array").hide();i.find("input[name='color']").val(j.name)});g.prepend(k)})}g.show()}return false});function a(){var i=$j(this);var j=i.siblings("ul.mini-label-list").find("li:last").children("div.fakeForm").unbind().bind("fakeSubmit",function(){var k=$j(this).find("input").val();var l=$j(this);FavoriteLabels.create(k,$j(this).find("input[name='color']").val(),function(m){var n=$j("<option />").text(m.name).val(m.ID+"|"+m.displayStyle);i.find("option:first").after(n);l.parent("li").slideUp("fast");n.prop("selected",true);i.triggerHandler("change")});$j(this).find("input.jive-label-input").val("");return false});var g=function(k){if(k.keyCode==13){return false}};var h=function(k){if(k.keyCode==13){j.trigger("fakeSubmit");return false}};j.find("input").unbind().keypress(g).keydown(g).keyup(h);j.find("a.jive-label-save").unbind().click(function(){j.trigger("fakeSubmit");return false})}function e(){var j=$j(this).siblings("span.id:first").text();var g=$j(this).parents("ul:first").siblings("select");var i=g.siblings("select.jive-labels-shadow");var h=i.find("option").filter(function(){return $j(this).val().split("|")[0]==j});g.find("[value='ignore']:last").before(h.remove());g.find("[value='ignore']").css("display","");g.find("[value='ignore']:first").prop("selected",true);$j(this).parent("li").fadeOut("fast",function(){$j(this).remove()});return false}function d(g){var i=g.siblings("ul.mini-label-list").find("li:last").children("div");var h=i.find("input");i.parents("li").slideDown("fast",function(){h.focus()});g.find("[value='ignore']:first").prop("selected",true)}$j("select.jive-labels").livequery("change",function(){var h=$j(this);var k=$j(this).find("option:selected").val();if(k=="create"){d(h);return false}else{if(k!="ignore"){var j=$j(this).find("option:selected");var m=j.val().split("|")[0];var g=j.val().split("|")[1];var i=$j("<li class='"+g+"'/>").append($j("<span class='id'/>").css("display","none").text(m)).append("<span class='color'/>").append("<span class='label_text li_text'>"+j.text()+"</span>&nbsp;</li>").css("display","none");i.append($j(c).bind("click",e));var l=h.siblings("select.jive-labels-shadow");l.append(j.remove());l.find("option").prop("selected",true);h.find("[value='ignore']:first").prop("selected",true);h.triggerHandler("change");$j(this).siblings("ul.mini-label-list").find("li:last").before(i);i.slideDown("fast")}}});$j("select.jive-labels").livequery(function(){f()});window.___labelsInitializedByJive=true});