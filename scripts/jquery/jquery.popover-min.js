(function(a){a.fn.popover=function(d){var e=a.extend({},a.fn.popover.defaults,d);if(e.closeOtherPopovers===true){a(e.closeOtherPopoversSelector).trigger("close")}return this.each(function(){var p=e.context,u=a(this).addClass("j-pop-main"),v={left:a(window).scrollLeft()+10,right:a(window).scrollLeft()+a(window).width()-10,top:a(window).scrollTop()+10,bottom:a(window).scrollTop()+a(window).height()-10},i,h=a('<div class="j-pop js-pop" />').addClass(e.addClass),t,l,k=a(this).parent();if(u.data("closePopover")){(u.data("closePopover"))();u.removeData("closePopover");return}if(e.returnPopover){a.extend(d,{popOver:h,closeFunc:s})}if(!e.container||e.container.length===0){e.container=a("body")}if(e.container.is("body")){e.containerOffset={top:0,left:0}}else{e.containerOffset=e.container.offset()}h.append(u);u.show();h.appendTo(e.container).show().css("visibility","hidden");function j(F){var E=11,G=18,D=14,B=14,A;if(!F){F={width:h.outerWidth(),height:h.outerHeight()};if(e.position=="below"){F.height=F.height+E}else{if(e.position=="above"){}else{if(e.position=="left"){F.width=F.width+D}else{if(e.position=="right"){F.width=F.width+B}}}}}if(e.position=="below"){A={top:p.offset().top+p.outerHeight()+E,left:p.offset().left-((F.width-p.outerWidth())/2)}}else{if(e.position=="above"){A={top:p.offset().top-(F.height+G),left:p.offset().left-((F.width-p.outerWidth())/2)}}else{if(e.position=="left"){A={top:p.offset().top-((F.height-p.outerHeight())/2),left:p.offset().left-F.width}}else{if(e.position=="right"){A={top:p.offset().top-((F.height-p.outerHeight())/2),left:p.offset().left+p.outerWidth()+B}}else{A={top:p.offset().top+p.outerHeight(),left:p.offset().left-((F.width-p.outerWidth())/2)}}}}}if(e.nudge.top){A.top=A.top+e.nudge.top}if(e.nudge.left){var C=Math.min(((F.width-p.outerWidth())/2)-20,e.nudge.left);A.left=A.left+C}A.left-=e.containerOffset.left;A.top-=e.containerOffset.top;v.left-=e.containerOffset.left;v.right-=e.containerOffset.left;v.top-=e.containerOffset.top;v.bottom-=e.containerOffset.top;if(e.adjust){if(e.position=="above"||e.position=="below"){if(A.left<v.left){A.left=v.left}else{if(A.left+h.outerWidth()>v.right){A.left=v.right-h.outerWidth()-5}}}if(e.position=="left"||e.position=="right"){if(A.top<v.top){A.top=v.top}else{if(A.top+h.outerHeight()>v.bottom){A.top=v.bottom-h.outerHeight()}}}}i=e.position;if(e.flip){if(e.position=="above"){if(A.top<v.top&&p.offset().top+p.outerHeight()+h.outerHeight()<v.bottom){A.top=p.offset().top+p.outerHeight()+E-e.containerOffset.top;e.flipCallback();i="below"}}else{if(e.position=="below"){if(A.top+h.outerHeight()>v.bottom&&p.offset().top-h.outerHeight()>v.top){A.top=p.offset().top-(F.height+G)-e.containerOffset.top;e.flipCallback();i="above";if(e.nudge.bottom){A.top+=e.nudge.bottom}}}else{if(e.position=="left"){if(A.left<v.left&&p.offset().left+p.outerWidth()+h.outerWidth()+B<v.right){A.left=p.offset().left+p.outerWidth()+B-e.containerOffset.left;e.flipCallback();i="right"}}else{if(e.position=="right"){if(A.left+h.outerWidth()>v.right&&p.offset().left-h.outerWidth()-D>v.left){A.left=p.offset().left-h.outerWidth()-D-e.containerOffset.left;e.flipCallback();i="left"}}}}}}if(e.arrowAdjust&&i=="left"){A.left+=(e.arrowAdjust*2-1)}else{if(e.arrowAdjust&&i=="right"){A.left-=(e.arrowAdjust*2-1)}}return A}function q(B){var D={top:"",left:""};var C,A;if(i=="above"||i=="below"){C=p.offset().left-B.left+((p.outerWidth()-t.outerWidth())/2);A=e.containerOffset.left+e.arrowAdjust/2;D.left=Math.round(C-A)}else{C=p.offset().top-B.top+((p.outerHeight()-t.outerHeight())/2);A=e.containerOffset.top-e.arrowAdjust/2;D.top=Math.round(C-A)}if(e.arrowAdjust&&i=="left"){D.left=D.left-e.arrowAdjust;var E=l.split(" ");E[0]=parseFloat(E[0])-e.arrowAdjust+"px";D["background-position"]=E.join(" ")}else{if(e.arrowAdjust&&i=="right"){D.left=D.left+e.arrowAdjust}}return D}(function(){var A=j();h.find("span.pointer").remove();h.append(a('<span class="'+i+'Arrow pointer"></span>')).addClass("popover").css({position:"absolute",top:A.top,left:A.left}).appendTo(e.container).css("visibility","visible");h.children().show();t=h.find(".pointer");l=t.css("background-position");if(e.arrowAdjust){t.width(t.width()-e.arrowAdjust);t.height(t.height()-e.arrowAdjust)}f(t,q(A));a(window).one("resize",s);if(e.focusPopover){jive.conc.nextTick(n)}e.onLoad()})();u.autoclose(a.extend({},e,{onClose:m,decoration:h}));var o=new jive.Accessibility({scope:u,hoverSelection:e.focusPopover,otherActions:[function z(A){if(A.keyCode==27){m(A);p.focus();return false}},jive.Accessibility.focusRingAction(u),jive.Accessibility.menuSelectAction(u,null,true)]});if(e.allowResize){u.bind("popover.html",g)}if(e.allowResize){u.bind("popover.resize",w)}u.bind("eject",y);function r(){return u.find("a, input, select, textarea, button")}function n(){r().first().focus()}function y(){h.before(u).remove()}function s(){u.trigger("close")}function m(A){e.beforeClose();if(e.destroyOnClose){h.remove()}else{if(e.putBack){k.append(u.hide());h.remove()}h.hide()}u.unbind("popover.html",g);u.unbind("popover.resize",w);u.unbind("eject",y);u.removeData("closePopover");a(window).off("resize",s);o.teardown();return e.onClose()}u.data("closePopover",s);function w(B,A,C){return g(B,null,A,C)}function g(A,E,J,I){var H=a(E),G=h.width(),F=h.height(),C,B,D;if(a.isFunction(J)){I=J;J=null}J=a.extend({},e,J);h.css({width:"auto",height:"auto"});c(u,H,function(){C=h.width()+1;B=h.height();D=j({width:h.outerWidth(),height:h.outerHeight()})});h.css({width:G,height:F});if(J.fade){if(!a.browser.msie||parseFloat(a.browser.version)>8){u.animate({opacity:0},J.duration/2,function(){if(E){u.html(H)}u.animate({opacity:1},J.duration/2)})}else{if(E){u.children().detach();setTimeout(function(){u.html(H)},J.duration)}}}else{if(E){u.html(H)}}h.css("overflow","visible");h.animate({left:D.left,top:D.top,width:C,height:B},J.duration,J.easing,function(){if(typeof I=="function"){I.apply(u)}});h.css("overflow","");x(D,J)}function x(A,D){var E=q(A),C=E["background-position"],B={};Object.keys(E).forEach(function(F){if(F!="background-position"&&!!E[F]){B[F]=E[F]}});t.animate(B,D.duration,D.easing);setTimeout(function(){t.removeClass().addClass(i+"Arrow pointer");try{t.css("background-position",C)}catch(F){console.error(F)}},D.duration/2)}});function f(j,i){var h=i["background-position"],g={};Object.keys(i).filter(function(l){return l!="background-position"&&!!i[l]}).forEach(function(l){g[l]=i[l]});j.css(g);try{j.css("background-position",h)}catch(k){console.error(k)}}function c(i,j,k){var h=i.children(),g;if(j&&j.length>0){h.detach();j.appendTo(i)}g=k();if(j&&j.length>0){j.detach();h.appendTo(i)}return g}};var b=navigator.userAgent.match(/iPad/i)!=null;a.fn.popover.defaults={context:a(),container:a("body"),position:"below",nudge:{},adjust:true,flip:true,arrowAdjust:0,flipCallback:a.noop,beforeClose:a.noop,onClose:a.noop,onLoad:a.noop,destroyOnClose:true,closeOtherPopovers:false,closeOtherPopoversSelector:"BODY > .j-pop > *",returnPopover:false,putBack:false,focusPopover:true,closeOnBlur:false,darkPopover:false,addClass:"",fade:true,duration:b?0:400,easing:"easeInOutQuint",allowResize:true}})(jQuery);