function userAutocompleteLoader(a){a.fn.userAutocomplete=function(c){var d={loaded:function(){},usersAdded:function(){},userAdded:function(){},userRemoved:function(){},userParam:"user",userValue:"userID",startingUsers:[],multiple:false,large:false,emailAllowed:false,userAllowed:true,inlineRemoval:false,browseModal:true,document:$j(document),existingModal:{modalContainer:"",prevContainer:"",browseContainer:""},minInputLength:2,minUsers:0,urls:{userAutocomplete:_jive_base_url+"/user-autocomplete.jspa",browseModal:_jive_base_url+"/user-autocomplete-modal.jspa"},i18nKeys:{remove:"Remove",add:"Add",change:"Change",browse:"Select Users"}};var e=a.extend(d,c);console.log("this is me3");var b=e.existingModal.modalContainer!=""&&e.existingModal.prevContainer!=""&&e.existingModal.browseContainer!="";if(e.browseModal&&!b){if(e.document.find("#user-autocomplete-modal-container").length==0){e.document.find("body").append('<div class="jive-modal" id="user-autocomplete-modal-container" style="display: none;"><h2 class="jive-modal-title">'+e.i18nKeys.browse+'</h2><a href="#" class="jive-modal-close-top jive-close close">Close</a><div id="user-picker-modal-content" class="jive-modal-content"></div></div>')}}return Array.prototype.slice.call(this.map(function(){var u=a(this);u.addClass("jive-chooser-input jive-form-textinput-variable");u.attr("autocomplete","off");var o=a('<input type="hidden" name="'+e.userParam+'"/>');var h=a('<div class="jive-chooser-autocomplete"></div>').hide();var B=a('<ul class="jive-chooser-list j-people-list clearfix"></ul>').hide();if(e.large){B.addClass("user_auto_large")}else{if(e.multiple){B.addClass("user_auto_multiple")}}u.before(o);u.after(B).after(h);var j=0;var v;a(window).unload(function(){o=null;h=null;B=null;u=null});var p=function(F){switch(F.keyCode){case a.ui.keyCode.UP:w(j-1);return false;case a.ui.keyCode.DOWN:w(j+1);return false;case a.ui.keyCode.ENTER:m();a.stop(F,true,true);if(j>0){r()}return false;case a.ui.keyCode.ESCAPE:f();return false;case a.ui.keyCode.LEFT:case a.ui.keyCode.RIGHT:case a.ui.keyCode.TAB:case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:return false}m();v=setTimeout(function(){x()},400)};var i=function(){setTimeout(function(){x()},250)};var t=function(){setTimeout(function(){f()},250)};var f=function(){h.html("").hide()};var m=function(){if(v){clearTimeout(v)}};var s=function(F){j=parseInt(a(this).parent().attr("id").split("_")[1]);r();F.stopPropagation();return false};var r=function(){var J=h.find("#user-autocomplete-index_"+j)[0];if(J&&a(J).children("a")[0]){var I=a(a(J).children("a")[0]),H=I.attr("id").split("_")[1],F=I.find("span").text();var G={userID:H,userName:(I.find("img").attr("src").match(/\/people\/([^\/]+)\//)||[])[1],avatar:I.find("img"),displayName:F,email:(H&&H!="email")?undefined:F};E([G]);u.val("");h.html("").hide()}};var E=function(F){if(!a.isArray(F)){F=[F]}F.forEach(function(G){q(G)});e.usersAdded(F);y()};var y=function(){var F=0;if(a.trim(o.val())!=""){F=o.val().split(",").length}if(F>e.minUsers){B.find(".user-autocomplete-remove").parent().show()}else{if(F==e.minUsers){B.find(".user-autocomplete-remove").parent().hide()}}};var q=function(I){var K=I.email||I[e.userValue];if(typeof K=="undefined"){return false}if(e.multiple){var F=[];if(a.trim(o.val())!=""){F=o.val().split(",")}if(a.inArray(K,F)==-1){F.push(K);o.val(F.join(","));var J=a('<li class="user-autocomplete-selection clearfix user-autocomplete-selection_'+I.userID+'"></li>');var G=a("<span/>").text(I.displayName).html();if(e.large){J.append('<a href="#" class="user-autocomplete-remove">'+G+'</a><a href="#" class="user-autocomplete-add" style="display:none">'+G+"</a>")}else{if(I.avatar){J.append(a(I.avatar).clone())}J.append("<span><span>"+G+'</span> <em>(<a href="#" class="user-autocomplete-remove">'+e.i18nKeys.remove+'</a>)</em><em style="display:none;">(<a href="#" class="user-autocomplete-add">'+e.i18nKeys.add+"</a>)</em></span>")}B.append(J)}u.focus()}else{o.val(K);u.hide().prop("disabled",true);if(e.browseModal){z.hide()}var H=a('<li class="user-autocomplete-selection clearfix user-autocomplete-selection_'+I.userID+'"></li>');var G=a("<span/>").text(I.displayName).html();if(I.avatar){H.append(a(I.avatar).clone())}H.append("<span><span>"+G+'</span> <em>(<a href="#" class="user-autocomplete-remove">'+e.i18nKeys.change+"</a>)</em></span>");B.html(H)}B.find(".user-autocomplete-remove").click(l);B.find(".user-autocomplete-add").click(n);B.show();e.userAdded(I)};var A=function(){B.html("").hide();o.val("")};var l=function(H){if(e.multiple){var G=a(this).parents("li:eq(0)").attr("class").split("_")[1];if(G=="email"){G=a(this).parents("span:eq(0)").find("span:eq(0)").text()}var F=o.val().split(",");F.splice(a.inArray(G,F),1);o.val(F.join(","));y();if(e.inlineRemoval){var I=a(this).parents("li:eq(0)");a(I).find(".user-autocomplete-remove").parents("em").hide();a(I).find(".user-autocomplete-add").parents("em").show();a(this).parents("span:eq(0)").find("span:eq(0)").addClass("excluded")}else{a(this).parents("li:eq(0)").remove();if(F.length==0){B.hide()}}}else{A();u.prop("disabled",false).show();if(e.browseModal){z.show()}}H.stopPropagation();u.focus();e.userRemoved(G);return false};var n=function(G){if(e.multiple){var F=a(this).parents("li:eq(0)").attr("class").split("_")[1];if(F=="email"){F=a(this).parents("span:eq(0)").find("span:eq(0)").text()}o.val(o.val()+","+F);var H=a(this).parents("li:eq(0)");a(H).find(".user-autocomplete-add").parents("em").hide();a(H).find(".user-autocomplete-remove").parents("em").show();a(this).parents("span:eq(0)").find("span:eq(0)").removeClass("excluded");return false}G.stopPropagation()};var x=function(){var F=u.val();if(F.length>=e.minInputLength){F=F+"*";h.html("");h.load(e.urls.userAutocomplete,{query:F,emailAllowed:e.emailAllowed,userAllowed:e.userAllowed},function(){if(h.html()!=""){var H=(u.offset().top-u.offsetParent().offset().top)+u.outerHeight();var G=u.offset().left-u.offsetParent().offset().left;h.css({top:H,left:G});h.width(u.width());h.find(".user-autocomplete-item").mouseover(function(){a(this).addClass("hover")});h.find(".user-autocomplete-item").mouseout(function(){a(this).removeClass("hover")});h.find(".user-autocomplete-item A").click(s);h.show();w(1)}})}else{f()}};var w=function(F){if(F>0){var G=h.find("#user-autocomplete-index_"+F).addClass("hover").get(0);if(G){h.find("li.hover:not(#user-autocomplete-index_"+F+")").removeClass("hover");j=F}}else{h.find("li.hover").removeClass("hover");j=0}};var g=function(){if(!b){e.document.find("#user-picker-modal-content").prev(".jive-close").trigger("click")}else{a(e.existingModal.modalContainer).scrollTo(a(e.existingModal.prevContainer),500)}};var C=function(F){console.log("this is me2");a.ajax({url:e.urls.browseModal,data:{multiple:e.multiple},success:function(G){if(!b){e.document.find("#user-picker-modal-content").html(G);e.document.find("#user-picker-modal-content").unbind("select").bind("select",function(I){var H=Array.prototype.slice.call(arguments,1);E(H);g()});console.log("this is me");e.document.find("#user-autocomplete-modal-container").lightbox_me({zIndex:300015,onClose:function(){e.document.find("#user-autocomplete-modal-container .jive-modal-content").html("")}})}else{a(e.existingModal.browseContainer).html(G);a(e.existingModal.browseContainer).unbind("select").bind("select",function(I){var H=Array.prototype.slice.call(arguments,1);E(H);g()});a(e.existingModal.modalContainer).scrollTo(a(e.existingModal.browseContainer),500)}}});F.stopPropagation();return false};var k=function(G,F){E(F)};var D=function(G,H){for(var F=0;F<H.length;F++){B.find("li.user-autocomplete-selection_"+H[F].id+" A.user-autocomplete-remove").trigger("click")}};if(e.browseModal&&e.userAllowed){var z=a('<a href="#" class="jive-chooser-browse">'+e.i18nKeys.browse+"</a>");u.after(z);z.click(C)}if(e.startingUsers.length>0){if(!e.multiple){E([e.startingUsers[0]])}else{e.startingUsers.forEach(function(F){E([F])})}}u.keydown(function(F){if(F.keyCode==a.ui.keyCode.ENTER){a.stop(F,true,true)}}).keyup(p);u.blur(t);u.focus(i);u.bind("addSelection",k);u.bind("removeSelection",D);u.bind("reset",A);if(e.emailAllowed&&!e.userAllowed){o.closest("form").submit(function(){E({email:a.trim(u.val())})})}e.loaded();y();return{add:E,values:function(){return o.val().split(/\s*,\s*/)}}}),0)}}userAutocompleteLoader(jQuery);