function tagAutocompleteLoader(a){a.fn.tagAutocomplete=function(b){var c={loaded:function(){},tagAdded:function(){},tagRemoved:function(){},minInputLength:2};var d=a.extend(c,b);return Array.prototype.slice.call(this.map(function(){var i=a(this);i.addClass("jive-chooser-input");i.attr("autocomplete","off");var o=a('<div class="jive-chooser-autocomplete j-tag-result j-result-list j-rc4"></div>').hide();i.after(o);var p=-1;var j;a(window).unload(function(){o=null;i=null});var g=function(r){switch(r.keyCode){case a.ui.keyCode.UP:m(p-1);return false;case a.ui.keyCode.DOWN:m(p+1);return false;case a.ui.keyCode.ENTER:l();a.stop(r,true,true);if(p>-1){k()}return false;case a.ui.keyCode.ESCAPE:h();return false;case a.ui.keyCode.LEFT:case a.ui.keyCode.RIGHT:case a.ui.keyCode.TAB:case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:return false}l();j=setTimeout(function(){q()},400)};var n=function(){setTimeout(function(){q()},250)};var f=function(){setTimeout(function(){h()},250)};var h=function(){o.html("").hide();p=-1};var l=function(){if(j){clearTimeout(j)}};var e=function(r){p=parseInt(a(this).parent().attr("id").split("_")[1]);k();r.stopPropagation();return false};var k=function(){var u=o.find("#tag-autocomplete-index_"+p)[0];if(u&&a(u).children("a")[0]){var s=a(a(u).children("a")[0]),r=s.text();var t=$j.trim(i.val()).split(/\s+/);t[t.length-1]=r;i.val(t.join(" "));h()}};var q=function(){if(i.val().match(/ $/)){h()}else{var r=$j.trim(i.val()).split(/\s+/);var s=r[r.length-1];if(s.length>=d.minInputLength){h();$j.getJSON(jive.rest.url("/tags/search?query="+encodeURIComponent(s)+"*"),function(u){if(u.tagSearchResult.length>0){var t=a('<ul class="jive-tags-list"></ul>');$j.each(u.tagSearchResult,function(y,x){t.append($j("<li/>",{id:"tag-autocomplete-index_"+y,"class":"tag-autocomplete-item clearfix"}).append($j("<a/>",{href:"#","class":"font-color-normal",text:x.name})))});o.append(t);var w=(i.offset().top-i.offsetParent().offset().top)+i.outerHeight();var v=i.offset().left-i.offsetParent().offset().left;o.css({top:w,left:v});o.width(i.width());o.find(".tag-autocomplete-item").mouseover(function(){a(this).addClass("hover")});o.find(".tag-autocomplete-item").mouseout(function(){a(this).removeClass("hover")});o.find(".tag-autocomplete-item A").click(e);o.show()}})}else{h()}}};var m=function(r){if(r<0){o.find("li.hover").removeClass("hover");p=-1}else{var s=o.find("#tag-autocomplete-index_"+r).addClass("hover").get(0);if(s){o.find("li.hover:not(#tag-autocomplete-index_"+r+")").removeClass("hover");p=r}}};i.keydown(function(r){if(r.keyCode==a.ui.keyCode.ENTER){a.stop(r,true,true)}}).keyup(g);i.blur(f);i.focus(n);d.loaded()}),0)}}tagAutocompleteLoader(jQuery);