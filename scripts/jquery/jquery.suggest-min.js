(function(a){a.suggest=function(u,i){var d=a(u).attr("autocomplete","off");var h;var t=false;var g=0;var y=[];var w=0;if(a.isArray(i.source)){d.data("results",i.source);i.clientSearch=true}if(!i.attachObject){i.attachObject=a(document.createElement("ul")).appendTo("body")}h=a(i.attachObject);h.addClass(i.resultsClass);l();a(window).load(l).resize(l);d.focus(function(){var e=d.closest(".j-js-picker-container")[0];a(document.body).off("click.suggestPlugin").on("click.suggestPlugin",function(I){if(e&&!a.contains(e,I.target)){a(document.body).off("click.suggestPlugin");h.hide()}})});try{h.bgiframe()}catch(E){}if(a.browser.mozilla){d.keypress(q)}else{d.keydown(q)}function c(e){return e.replace(/([.*+?\^${}()|\[\]\/\\])/g,"\\$1")}function l(){if(a.isFunction(i.position)){i.position(d,h)}else{var e=d.offset();h.css({top:(e.top+u.offsetHeight)+"px",left:e.left+"px"})}}function q(J){if((/27$|38$|40$/.test(J.keyCode)&&h.is(":visible"))||(/^13$|^9$/.test(J.keyCode)&&G())){if(J.preventDefault){J.preventDefault()}if(J.stopPropagation){J.stopPropagation()}J.cancelBubble=true;J.returnValue=false;switch(J.keyCode){case 38:o();break;case 40:F();break;case 9:case 13:var I=G();if(I){C.apply(I)}break;case 27:h.hide();break}}else{if(d.val().length!=g){if(t){clearTimeout(t)}t=setTimeout(function(){n(i.limit)},i.delay);g=d.val().length}}}function A(J){var e=J.val(),I;if(i.multiple){I=e.split(i.multipleSeparator).last()}else{I=e}return a.trim(I)}function v(e){var I=a.extend({},i.extraParams);I[i.paramName]=e;if(i.transformParams){i.transformParams(I)}return I}function p(){n(Number.MAX_VALUE)}function n(e){var K=A(d);var I=d.data("results");if(K.length>=i.minchars){var J=H(K);if(J&&i.useCache===true){m(J.items,e)}else{if(i.clientSearch&&I&&i.useCache===true){D(I,K,e)}else{a.ajax({url:i.source,type:i.requestMethod,data:v(K),success:function(L){d.data("results",L);D(L,K,e)}})}}}else{h.hide()}}function x(e,I){D(e,I,Number.MAX_VALUE)}function D(e,K,I){h.hide();var J=z(e,K);m(J,I);j(K,J,e.length)}function H(I){for(var e=0;e<y.length;e++){if(y[e]["q"]==I){y.unshift(y.splice(e,1)[0]);return y[0]}}return false}function j(K,e,I){while(y.length&&(w+I>i.maxCacheSize)){var J=y.pop();w-=J.size}y.push({q:K,size:I,items:e});w+=I}function m(N,J){if(!N){return}if(!N.length){h.hide();return}if(N.length<J){J=N.length}if(a.isFunction(i.sort)){N.sort(function(U,T){return i.sort(U.originalValue[0],T.originalValue[0])})}l();h.html("");for(var L=0;L<J;L++){var P=i.template;var O=N[L]["value"];var e=N[L]["originalValue"];var Q=N[L]["selectedByDeafult"];for(var I=0;I<e.length;I++){var S="%\\{"+I+"\\}";P=P.replace(new RegExp(S,"g"),e[I])}for(var K=0;K<O.length;K++){var R="\\{"+K+"\\}";P=P.replace(new RegExp(R,"g"),O[K])}var M=a("<li>"+P+"</li>");if(i.liClass!=""){M.addClass(i.liClass)}if(Q||N.length<=1){M.addClass(i.selectClass)}M.data("key",N[L]["key"]);M.data("value",e[0]);h.append(M)}h.show();h.children("li").mouseover(function(){h.children("li").removeClass(i.selectClass);a(this).addClass(i.selectClass)}).click(function(T){T.preventDefault();T.stopPropagation();C.apply(this)});F()}function k(e){m(e,Number.MAX_VALUE)}function z(J,I){var e=i.transformData?i.transformData(J):J;if(a.isArray(e)){return s(e,I)}else{return b(e,I)}}function s(J,I){var e=new RegExp(c(I),"ig");return J.map(r.partial(_,e)).filter(function(L){var K=L.value.some(function(M){return M.match(e)||!i.clientSearch});return K&&L.value.length>0})}function b(e,I){var J=e.split(i.delimiter);return s(J,I)}function r(K,I){var M=a.isArray(K)?K:a.trim(K).split(i.dataDelimiter),e=M.slice(0,Math.max(M.length-1,1)),J=M.length>1?M.last():"",L=e.some(function(N){var O=N.match(I);return O&&O[0].length==N});return{value:e.map(B.partial(_,I)).filter(function(N){return a.trim(N)}),key:J,originalValue:M,selectedByDefault:L}}function B(K,I){function e(L){return L.contents().map(function(){var M;if(this.nodeType==3){return this.data.replace(I,'<span class="'+i.matchClass+'">$&</span>')}else{$j(this).html(e($j(this),I));M=$j("<div/>",{html:this});return M.html()}}).toArray().join("")}var J=$j("<div/>",{html:K});return e(J)}function G(){if(!h.is(":visible")){return false}var e=h.children("li."+i.selectClass);if(!e.length){e=false}return e}function C(){var e=a(this);f(d,e.data("value"));h.hide();d.focus();a(document.body).off("click.suggestPlugin");if(a(i.dataContainer)){a(i.dataContainer).val(e.data("key"))}if(i.onSelect){i.onSelect.call(d[0],e.data("key"),e.data("value"))}}function f(L,J){var I=i.multipleSeparator,K,e;if(i.multiple){K=L.val().split(I).slice(0,-1);e=K.concat([J,""]).join(I)}else{e=J}L.val(e)}function F(){var e=G();if(e){e.removeClass(i.selectClass).next().addClass(i.selectClass)}else{h.children("li:first-child").addClass(i.selectClass)}}function o(){var e=G();if(e){e.removeClass(i.selectClass).prev().addClass(i.selectClass)}else{h.children("li:last-child").addClass(i.selectClass)}}};a.fn.suggest=function(c,b){if(!c){return}b=b||{};b.source=c;b.delay=b.delay||150;b.resultsClass=b.resultsClass||"ac_results";b.selectClass=b.selectClass||"ac_over";b.matchClass=b.matchClass||"ac_match";b.liClass=b.liClass||"";b.minchars=b.minchars||2;b.delimiter=b.delimiter||"\n";b.onSelect=b.onSelect||false;b.maxCacheSize=b.maxCacheSize||65536;b.dataDelimiter=b.dataDelimiter||"\t";b.dataContainer=b.dataContainer||"#SuggestResult";b.attachObject=b.attachObject||null;b.clientSearch=b.clientSearch||false;b.template=b.template||"{0}";b.limit=b.limit&&b.limit>0?b.limit:Number.MAX_VALUE;b.multiple=b.multiple||false;b.multipleSeparator=b.multipleSeparator||", ";b.sort=b.sort||null;b.paramName=b.paramName||"q";b.extraParams=b.extraParams||{};b.requestMethod=b.requestMethod||"GET";b.transformData=b.transformData;b.useCache=b.useCache||true;b.position=b.position;b.transformParams=b.transformParams||null;this.each(function(){a.suggest(this,b)});return this}})(jQuery);