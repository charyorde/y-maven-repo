var Widgets=$Class.extend({args:{},init:function(a){this.args=a;this.loadSortables();makeDraggable($j("#jive-widgets-list-container .jive-widget-new"))},showCategoryWidgets:function(d,b,a){var c;if(b){c="#jive-widgets-list-container_"+b}else{c="#jive-widgets-list-container"}var e=$j(c);e.find(".jive-category-instructions").hide();e.find(".jive-widget-instructions").fadeIn("fast");e.find(".jive-widcat-widgets").hide();e.find(".jive-widcat-widget").removeClass("selected");e.find(".jive-widget-new-container").hide();e.find(".jive-widget-category").removeClass("selected");if(b){$j(c+" #widgets-"+d+"-"+b).show();$j(c+" #jive-widget-category-"+d+"-"+b).addClass("selected")}else{e.find("#widgets-"+a+"-"+d).show();e.find("#jive-widget-category-"+a+"-"+d).addClass("selected")}},selectWidget:function(a,g,e,c){$j(window).unbind("resize");var b;if(e){b="#jive-widgets-list-container_"+e}else{b="#jive-widgets-list-container"}var h=$j(b);h.find(".jive-widget-instructions").hide();h.find(".jive-widcat-widget").removeClass("selected");if(e){h.find("#widgets-"+a+"-"+g+"-"+e).addClass("selected")}else{h.find("#widgets-"+c+"-"+a+"-"+g).addClass("selected")}h.find(".jive-widget-new-container").hide();h.find("#jive-widget-new-container_"+g).show();var d={widgetID:g,widgetType:this.args.widgetTypeID,container:this.args.parentObjectID,containerType:this.args.parentObjectType};if(e){d.bridge=e}function i(){var j=$j("#jive-preview-widgetsize_"+g).width();var k=j-($j("#jive-widget-browser-preview-actions_"+g).width()+15)}var f=this;$j("#jive-widget-new-preview_"+g).load(this.args.previewURL,d,function(){f.toggleSize(g,true,e);i();$j(".jive-widget-browser-preview-wrapper .jive-widget-body a").bind("click",function(){return false})});$j(window).resize(i)},toggleSize:function(b,d,a){var c;if(a){c="#jive-widgets-list-container_"+a}else{c="#jive-widgets-list-container"}$j(c+" #jive-widget-browser-preview .jive-widget-browser-preview-actions a").removeClass("selectedSize font-color-normal");if(d){$j(c+" #jive-widget-new-preview_"+b).parent().removeClass("jive-widgetsize-small").addClass("jive-widgetsize-large");$j(c+" #jive-widget-new-preview_"+b+" .content-large").show();$j(c+" #jive-widget-new-preview_"+b+" .content-small").hide();$j(c+" #jive-widget-browser-preview #jive-widget-browser-preview-action-large_"+b).addClass("selectedSize font-color-normal")}else{$j(c+" #jive-widget-new-preview_"+b).parent().removeClass("jive-widgetsize-large").addClass("jive-widgetsize-small");$j(c+" #jive-widget-new-preview_"+b+" .content-small").show();$j(c+" #jive-widget-new-preview_"+b+" .content-large").hide();$j(c+" #jive-widget-browser-preview #jive-widget-browser-preview-action-small_"+b).addClass("selectedSize font-color-normal")}},removeWidgetFrame:function(b){$j(document.body).addClass("jive-widget-progresscursor");var a=$j("#jive-widgetframe_"+b);var c={widgetFrameID:b,parentObjectType:this.args.parentObjectType,parentObjectID:this.args.parentObjectID};$j.post(this.args.deleteURL,c,function(){$j(document.body).removeClass("jive-widget-progresscursor");a.remove()})},hideMenu:function(a){console.log("hiding menu: "+a);$j("#jive-widgetframe-edit_"+a).find(".jive-widget-menu-btn-link").removeClass("currentMenu");$j("#jive-widgetframe-options_"+a).hide()},editWidgetFrame:function(a){this.disableSortables();this.prepareEditWidgetFrame(a);var b={widgetFrameID:a,widgetTypeID:this.args.widgetTypeID};var c=this;$j("#jive-widgetframe-body_"+a).load(this.args.editURL,b,function(){c.postEditWidgetFrame(a)})},prepareEditWidgetFrame:function(a){this.hideMenu(a);$j(document.body).addClass("jive-widget-progresscursor");this.maximizeWidgetFrame(a)},postEditWidgetFrame:function(a){$j(document.body).removeClass("jive-widget-progresscursor");$j("#jive-widgetframe_"+a).effect("highlight",{},3000);$j(this).closest(".jive-widget").addClass("jive-widget-active");$j(this).css({overflow:"visible"});jive.conc.nextTick(function(){$j("#jive-widgetframe-body_"+a+" form input:visible:first").focus()})},minimizeWidgetFrame:function(a){this.hideMenu(a);$j("#jive-widgetframe-body_"+a).hide();$j("#jive-widgetframe-maxlink_"+a).show();$j("#jive-widgetframe-minlink_"+a).hide()},maximizeWidgetFrame:function(a){this.hideMenu(a);$j("#jive-widgetframe-body_"+a).show();$j("#jive-widgetframe-minlink_"+a).show();$j("#jive-widgetframe-maxlink_"+a).hide()},chooseLayout:function(c){if(this.args.currentLayoutID!=c){$j("#jive-layout-id"+this.args.currentLayoutID).removeClass("jive-layout-selected");$j("#jive-layout-id"+c).addClass("jive-layout-selected");this.args.currentLayoutID=c}$j(document.body).addClass("jive-widget-progresscursor");var b={layoutID:c,widgetTypeID:this.args.widgetTypeID,parentObjectType:this.args.parentObjectType,parentObjectID:this.args.parentObjectID};var a=this;$j("#jive-widget-content").load(this.args.layoutURL,b,function(){$j(document.body).removeClass("jive-widget-progresscursor");a.loadSortables()})},disableSortables:function(){$j(".jive-widget-container").sortable("disable")},enableSortables:function(){$j(".jive-widget-container").sortable("enable")},loadSortables:function(){var c=$j(".jive-widget-container");var b=!($j.browser.msie&&$j.browser.version<9);var a=this;makeHandlesUnselectable(c);c.each(function(){$j(this).sortable({appendTo:"body",delay:100,distance:10,items:"div.jive-widget",connectWith:c.slice().not(this),helper:"original",handle:"h4.jive-widget-handle",forceHelperSize:"false",forcePlaceholderSize:"true",opacity:0.7,revert:true,tolerance:"intersect",placeholder:"emptyPlaceMarker",start:function(d,e){if(b){a.loadAllSizes(d,e.item,e.helper)}},over:function(e,f){var d=$j(f.helper).find(".jive-widget-body");if($j(e.target).hasClass("jive-widget-container-large")){$j(f.helper).children("div.jive-widgetsize-small").removeClass("jive-widgetsize-small").addClass("jive-widgetsize-large");a.toggleFrameSize(d,"small",false);a.toggleFrameSize(d,"large",true)}else{$j(f.helper).children("div.jive-widgetsize-large").removeClass("jive-widgetsize-large").addClass("jive-widgetsize-small");a.toggleFrameSize(d,"small",true);a.toggleFrameSize(d,"large",false)}$j(f.helper).find(".jive-box-header-placeholder").addClass("jive-box-header");$j(f.helper).addClass("jive-widget-new-dragover-style");$j(f.helper).width($j(e.target).width())},update:function(i,j){$j(document.body).addClass("jive-widget-progresscursor");if(!b){a.loadAllSizes(i,j.item,j.item)}var f=$j(i.target);var e=i.target.id.split("_")[1];var d=f.find("div.jive-widget-new");if(d.length>0){d.each(function(){var n=this;var m=$j(n).data("widgetId");var o=f.find(".jive-widget, .jive-widget-new").toArray().map(function(p){return $j(p).data("widgetId")});var k=o.indexOf(m);var l={widgetID:m,widgetTypeID:a.args.widgetTypeID,parentObjectType:a.args.parentObjectType,parentObjectID:a.args.parentObjectID,containerID:e,index:k,size:f.hasClass("jive-widget-container-small")?1:2};$j.post(a.args.createURL,l,function(p){$j(document.body).addClass("jive-widget-progresscursor");var q=$j(p);$j(n).replaceWith(q);makeHandlesUnselectable(q)})})}else{var h=[];f.find("div.jive-widget").each(function(){var k=$j(this).data("widgetId");h.push(k)});var g={frames:h,widgetTypeID:a.args.widgetTypeID,parentObjectType:a.args.parentObjectType,parentObjectID:a.args.parentObjectID,containerID:e};$j.post(a.args.sortURL,g,function(){$j(document.body).removeClass("jive-widget-progresscursor")})}}})})},loadFullDescription:function(a){a.parent().slideUp("fast");a.parent().prev("p").slideDown("slow");a.hide();return false},getWidgetFrameID:function(d){var c=$j(d).closest(".jive-widget-body");if(c){var b=c.attr("id");if(b){var a=b.substr(b.lastIndexOf("_")+1);if(a){return a}}}return 0},toggleFrameSize:function(b,a,e){if(a===1){a="small"}if(a===2){a="large"}var d=b.filter('[id^="jive-widgetframe-body"]');var c=d.children(".content-"+a);if(c.length<1){c=$j("<div/>").addClass("content-"+a).appendTo(d)}c.toggle(e);return c},loadAllSizes:function(a,f,c){var h=$j(c).find(".content-small");var j=$j(c).find(".content-large");var o=f.data("widgetId");var g=$j("#jive-widgetframe-body_"+o);var e=g.is(":hidden");var n={small:1,large:2};var l=this;var m=h.is(":empty")||h.length<=0;var i=j.is(":empty")||j.length<=0;var k=function(s,p,r){var q;if(!s||s.data("isLoaded")){return}if(s.length<=0){s=l.toggleFrameSize(g,p,false)}if(!e){q=$j("#jive-widgetframe-loading_"+o).show()}s.safelyLoad(l.args.renderURL,{data:{frameID:o,size:n[p],widgetType:l.args.widgetTypeID,container:l.args.parentObjectID,containerType:l.args.parentObjectType}},function(){if(!e){q.hide();g.show()}$j("#jive-widgetframe_"+o).trigger("frameLoaded")});s.data("isLoaded",true)};var b=m?$j(h):null;var d=i?$j(j):null;k(b,"small","content-small");k(d,"large","content-large")}});var WidgetProps=$Class.extend({args:{},editorCounter:0,init:function(a){this.args=a;this.editorCounter=0},incrementEditorCount:function(){this.editorCounter++;var a=$j("iframe").filter(function(b){try{return typeof($j(this).get(0).contentWindow.setEditorValue)!="undefined"}catch(c){return false}});if(this.editorCounter==a.length){this.submitEditorValues()}},loadEditorValues:function(){widgets.enableSortables();var a=this.args.widgetFrameID;if(typeof(window["userSynced"+a])!="undefined"){var b=window["userSynced"+a];if(!b){$j("#username-holder"+a).val($j("#editUserID"+a).val())}}$j("#jivewidgetpropform-"+this.args.widgetFrameID).find("textarea").each(function(){var d=$j(this),c=d.data("rte");if(c){d.val(c.getHTML())}});this.submitEditorValues()},killRTEs:function(){$j("#jivewidgetpropform-"+this.args.widgetFrameID).find("textarea").each(function(){var b=$j(this),a=b.data("rte");if(a){a.destroy()}})},submitEditorValues:function(){var d=this;$j("#jive-widgetprops-save_"+this.args.widgetFrameID).prop("disabled",true);$j("#jive-widgetprops-cancel_"+this.args.widgetFrameID).prop("disabled",true);$j(document.body).addClass("jive-widget-progresscursor");var a=this;var c=$j("#jivewidgetpropform-"+this.args.widgetFrameID).serialize(true);var b=$j("#jive-widgetframe-body_"+this.args.widgetFrameID).parent().hasClass("jive-widgetsize-large")?2:1;c=c+"&size="+b;$j.ajax({url:this.args.submitURL,type:"POST",data:c,dataType:"html",success:function(e){d.killRTEs();$j("#jive-widgetframe-body_"+a.args.widgetFrameID).html(e);$j(document.body).removeClass("jive-widget-progresscursor");$j("#jive-widgetframe_"+a.args.widgetFrameID).effect("highlight",{},3000);$j(this).css({overflow:"hidden"});$j(".jive-widget").removeClass("jive-widget-active")}})},doCancel:function(){widgets.enableSortables();$j("#jive-widgetprops-save_"+this.args.widgetFrameID).prop("disabled",true);$j("#jive-widgetprops-cancel_"+this.args.widgetFrameID).prop("disabled",true);$j(document.body).addClass("jive-widget-progresscursor");var a=this;var b={widgetFrameID:this.args.widgetFrameID,widgetTypeID:this.args.widgetTypeID,size:$j("#jive-widgetframe-body_"+this.args.widgetFrameID).parent().hasClass("jive-widgetsize-large")?2:1};$j("#jive-widgetframe-body_"+this.args.widgetFrameID).load(this.args.cancelURL,b,function(){$j(document.body).removeClass("jive-widget-progresscursor");$j("#jive-widgetframe_"+a.args.widgetFrameID).effect("highlight",{},3000);$j(this).css({overflow:"hidden"});$j(".jive-widget").removeClass("jive-widget-active")});this.killRTEs()}});$j(function(){var b=":not(.jive-widget-menu, .jive-widget-menu *, .jive-widget-menu-btn-link, .jive-widget-menu-btn-link *)";function a(c){if($j(c.target).is(b)){$j(".jive-widget-menu").hide();$j(".jive-widget-menu-btn-link").removeClass("currentMenu");if($j(c.target).closest(".jive-widget-edit-container").length===0){$j(".jive-widget").removeClass("jive-widget-active")}$j(document).unbind("click",a)}}$j(document).undelegate(".jive-widget-menu-btn-link","click").delegate(".jive-widget-menu-btn-link","click",function(c){var d=$j(this),e=d.closest(".jive-widget");$j(document).unbind("click",a);if(d.hasClass("currentMenu")){if(!(e.find(".jive-widget-edit-container").is(":visible"))){e.removeClass("jive-widget-active")}d.removeClass("currentMenu");$j(".jive-widget-menu").hide()}else{$j(".jive-widget").removeClass("jive-widget-active");$j(".jive-widget-menu-btn-link").removeClass("currentMenu");$j(".jive-widget-menu").hide();d.addClass("currentMenu");d.closest(".jive-widget-header-options").find(".jive-widget-menu").slideDown(80);e.addClass("jive-widget-active");$j(document).bind("click",a)}c.preventDefault()})});function makeDraggable(a){a.draggable({helper:"clone",connectToSortable:".jive-widget-container",opacity:0.7,revert:"invalid",revertDuration:200,zIndex:8000,drag:function(){$j(".ui-draggable-dragging").addClass("jive-widget-new-dragging");$j(".ui-draggable-dragging .dragToAdd").hide();$j(".ui-draggable-dragging .widgetTitle").show()}});makeHandlesUnselectable(a)}function makeHandlesUnselectable(a){$j("h4.jive-widget-handle",a).find("*").andSelf().prop("unselectable",true)};